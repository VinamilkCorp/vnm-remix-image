"use strict";var g=require("fs"),m=require("path");const y={0:{66:{77:"image/bmp"},71:{73:{70:"image/gif"}},73:{73:{42:{0:"image/tiff"}}},77:{77:{0:{42:"image/tiff"}}},137:{80:{78:{71:{13:{10:{26:{10:"image/png"}}}}}}},255:{216:{255:"image/jpeg"}}},4:{102:{116:{121:{112:{97:{118:{105:{102:"image/avif",115:"image/avif"}}}}}}}},8:{87:{69:{66:{80:"image/webp"}}}}},k=[0,4,8];var I;!function(g){g.SVG="image/svg+xml",g.JPEG="image/jpeg",g.PNG="image/png",g.GIF="image/gif",g.WEBP="image/webp",g.BMP="image/bmp",g.TIFF="image/tiff",g.AVIF="image/avif"}(I||(I={}));const g$1=g=>{if(!g||g.byteLength<3)throw new Error("Buffer is not a valid image!");for(const m of k){let k=y[m];for(let y=m;y<=12;y+=1){const m=g[y];if("object"!=typeof k)return k;if(!Object.prototype.hasOwnProperty.call(k,m))break;k=k[m]}}throw new Error("Buffer is not a supported image type!")};var N,P;exports.CacheStatus=void 0,(N=exports.CacheStatus||(exports.CacheStatus={})).HIT="hit",N.STALE="stale",N.MISS="miss";class Cache{}class RemixImageError extends Error{errorCode;constructor(g,m){super(g),Object.setPrototypeOf(this,RemixImageError.prototype),this.errorCode=m||500}toString(){return this.message}}class UnsupportedImageError extends RemixImageError{constructor(g){super(g,415),Object.setPrototypeOf(this,UnsupportedImageError.prototype)}}exports.MimeType=void 0,(P=exports.MimeType||(exports.MimeType={})).SVG="image/svg+xml",P.JPEG="image/jpeg",P.PNG="image/png",P.GIF="image/gif",P.WEBP="image/webp",P.BMP="image/bmp",P.TIFF="image/tiff",P.AVIF="image/avif";const textResponse=(g,m="")=>new Response(m,{status:g});var z={},strictUriEncode=g=>encodeURIComponent(g).replace(/[!'()*]/g,(g=>`%${g.charCodeAt(0).toString(16).toUpperCase()}`)),O="%[a-f0-9]{2}",U=new RegExp("("+O+")|([^%]+?)","gi"),B=new RegExp("("+O+")+","gi");function decodeComponents(g,m){try{return[decodeURIComponent(g.join(""))]}catch(g){}if(1===g.length)return g;m=m||1;var y=g.slice(0,m),k=g.slice(m);return Array.prototype.concat.call([],decodeComponents(y),decodeComponents(k))}function decode(g){try{return decodeURIComponent(g)}catch(k){for(var m=g.match(U)||[],y=1;y<m.length;y++)m=(g=decodeComponents(m,y).join("")).match(U)||[];return g}}var decodeUriComponent=function(g){if("string"!=typeof g)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof g+"`");try{return g=g.replace(/\+/g," "),decodeURIComponent(g)}catch(m){return function customDecodeURIComponent(g){for(var m={"%FE%FF":"��","%FF%FE":"��"},y=B.exec(g);y;){try{m[y[0]]=decodeURIComponent(y[0])}catch(g){var k=decode(y[0]);k!==y[0]&&(m[y[0]]=k)}y=B.exec(g)}m["%C2"]="�";for(var I=Object.keys(m),N=0;N<I.length;N++){var P=I[N];g=g.replace(new RegExp(P,"g"),m[P])}return g}(g)}},splitOnFirst=(g,m)=>{if("string"!=typeof g||"string"!=typeof m)throw new TypeError("Expected the arguments to be of type `string`");if(""===m)return[g];const y=g.indexOf(m);return-1===y?[g]:[g.slice(0,y),g.slice(y+m.length)]},filterObj=function(g,m){for(var y={},k=Object.keys(g),I=Array.isArray(m),N=0;N<k.length;N++){var P=k[N],z=g[P];(I?-1!==m.indexOf(P):m(P,z,g))&&(y[P]=z)}return y};!function(g){const m=strictUriEncode,y=decodeUriComponent,k=splitOnFirst,I=filterObj,N=Symbol("encodeFragmentIdentifier");function validateArrayFormatSeparator(g){if("string"!=typeof g||1!==g.length)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(g,y){return y.encode?y.strict?m(g):encodeURIComponent(g):g}function decode(g,m){return m.decode?y(g):g}function keysSorter(g){return Array.isArray(g)?g.sort():"object"==typeof g?keysSorter(Object.keys(g)).sort(((g,m)=>Number(g)-Number(m))).map((m=>g[m])):g}function removeHash(g){const m=g.indexOf("#");return-1!==m&&(g=g.slice(0,m)),g}function extract(g){const m=(g=removeHash(g)).indexOf("?");return-1===m?"":g.slice(m+1)}function parseValue(g,m){return m.parseNumbers&&!Number.isNaN(Number(g))&&"string"==typeof g&&""!==g.trim()?g=Number(g):!m.parseBooleans||null===g||"true"!==g.toLowerCase()&&"false"!==g.toLowerCase()||(g="true"===g.toLowerCase()),g}function parse(g,m){validateArrayFormatSeparator((m=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},m)).arrayFormatSeparator);const y=function parserForArrayFormat(g){let m;switch(g.arrayFormat){case"index":return(g,y,k)=>{m=/\[(\d*)\]$/.exec(g),g=g.replace(/\[\d*\]$/,""),m?(void 0===k[g]&&(k[g]={}),k[g][m[1]]=y):k[g]=y};case"bracket":return(g,y,k)=>{m=/(\[\])$/.exec(g),g=g.replace(/\[\]$/,""),m?void 0!==k[g]?k[g]=[].concat(k[g],y):k[g]=[y]:k[g]=y};case"colon-list-separator":return(g,y,k)=>{m=/(:list)$/.exec(g),g=g.replace(/:list$/,""),m?void 0!==k[g]?k[g]=[].concat(k[g],y):k[g]=[y]:k[g]=y};case"comma":case"separator":return(m,y,k)=>{const I="string"==typeof y&&y.includes(g.arrayFormatSeparator),N="string"==typeof y&&!I&&decode(y,g).includes(g.arrayFormatSeparator);y=N?decode(y,g):y;const P=I||N?y.split(g.arrayFormatSeparator).map((m=>decode(m,g))):null===y?y:decode(y,g);k[m]=P};case"bracket-separator":return(m,y,k)=>{const I=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!I)return void(k[m]=y?decode(y,g):y);const N=null===y?[]:y.split(g.arrayFormatSeparator).map((m=>decode(m,g)));void 0!==k[m]?k[m]=[].concat(k[m],N):k[m]=N};default:return(g,m,y)=>{void 0!==y[g]?y[g]=[].concat(y[g],m):y[g]=m}}}(m),I=Object.create(null);if("string"!=typeof g)return I;if(!(g=g.trim().replace(/^[?#&]/,"")))return I;for(const N of g.split("&")){if(""===N)continue;let[g,P]=k(m.decode?N.replace(/\+/g," "):N,"=");P=void 0===P?null:["comma","separator","bracket-separator"].includes(m.arrayFormat)?P:decode(P,m),y(decode(g,m),P,I)}for(const g of Object.keys(I)){const y=I[g];if("object"==typeof y&&null!==y)for(const g of Object.keys(y))y[g]=parseValue(y[g],m);else I[g]=parseValue(y,m)}return!1===m.sort?I:(!0===m.sort?Object.keys(I).sort():Object.keys(I).sort(m.sort)).reduce(((g,m)=>{const y=I[m];return Boolean(y)&&"object"==typeof y&&!Array.isArray(y)?g[m]=keysSorter(y):g[m]=y,g}),Object.create(null))}g.extract=extract,g.parse=parse,g.stringify=(g,m)=>{if(!g)return"";validateArrayFormatSeparator((m=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},m)).arrayFormatSeparator);const shouldFilter=y=>m.skipNull&&null==g[y]||m.skipEmptyString&&""===g[y],y=function encoderForArrayFormat(g){switch(g.arrayFormat){case"index":return m=>(y,k)=>{const I=y.length;return void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,[encode(m,g),"[",I,"]"].join("")]:[...y,[encode(m,g),"[",encode(I,g),"]=",encode(k,g)].join("")]};case"bracket":return m=>(y,k)=>void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,[encode(m,g),"[]"].join("")]:[...y,[encode(m,g),"[]=",encode(k,g)].join("")];case"colon-list-separator":return m=>(y,k)=>void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,[encode(m,g),":list="].join("")]:[...y,[encode(m,g),":list=",encode(k,g)].join("")];case"comma":case"separator":case"bracket-separator":{const m="bracket-separator"===g.arrayFormat?"[]=":"=";return y=>(k,I)=>void 0===I||g.skipNull&&null===I||g.skipEmptyString&&""===I?k:(I=null===I?"":I,0===k.length?[[encode(y,g),m,encode(I,g)].join("")]:[[k,encode(I,g)].join(g.arrayFormatSeparator)])}default:return m=>(y,k)=>void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,encode(m,g)]:[...y,[encode(m,g),"=",encode(k,g)].join("")]}}(m),k={};for(const m of Object.keys(g))shouldFilter(m)||(k[m]=g[m]);const I=Object.keys(k);return!1!==m.sort&&I.sort(m.sort),I.map((k=>{const I=g[k];return void 0===I?"":null===I?encode(k,m):Array.isArray(I)?0===I.length&&"bracket-separator"===m.arrayFormat?encode(k,m)+"[]":I.reduce(y(k),[]).join("&"):encode(k,m)+"="+encode(I,m)})).filter((g=>g.length>0)).join("&")},g.parseUrl=(g,m)=>{m=Object.assign({decode:!0},m);const[y,I]=k(g,"#");return Object.assign({url:y.split("?")[0]||"",query:parse(extract(g),m)},m&&m.parseFragmentIdentifier&&I?{fragmentIdentifier:decode(I,m)}:{})},g.stringifyUrl=(m,y)=>{y=Object.assign({encode:!0,strict:!0,[N]:!0},y);const k=removeHash(m.url).split("?")[0]||"",I=g.extract(m.url),P=g.parse(I,{sort:!1}),z=Object.assign(P,m.query);let O=g.stringify(z,y);O&&(O=`?${O}`);let U=function getHash(g){let m="";const y=g.indexOf("#");return-1!==y&&(m=g.slice(y)),m}(m.url);return m.fragmentIdentifier&&(U=`#${y[N]?encode(m.fragmentIdentifier,y):m.fragmentIdentifier}`),`${k}${O}${U}`},g.pick=(m,y,k)=>{k=Object.assign({parseFragmentIdentifier:!0,[N]:!1},k);const{url:P,query:z,fragmentIdentifier:O}=g.parseUrl(m,k);return g.stringifyUrl({url:P,query:I(z,y),fragmentIdentifier:O},k)},g.exclude=(m,y,k)=>{const I=Array.isArray(y)?g=>!y.includes(g):(g,m)=>!y(g,m);return g.pick(m,I,k)}}(z);const parseURL=(g,m)=>{let y;try{y=new URL(g,m)}catch(m){throw new RemixImageError(`Invalid URL: ${g}`,400)}return y},M={0:{66:{77:"image/bmp"},71:{73:{70:"image/gif"}},73:{73:{42:{0:"image/tiff"}}},77:{77:{0:{42:"image/tiff"}}},137:{80:{78:{71:{13:{10:{26:{10:"image/png"}}}}}}},255:{216:{255:"image/jpeg"}}},4:{102:{116:{121:{112:{97:{118:{105:{102:"image/avif",115:"image/avif"}}}}}}}},8:{87:{69:{66:{80:"image/webp"}}}}},j=[0,4,8];var G;!function(g){g.SVG="image/svg+xml",g.JPEG="image/jpeg",g.PNG="image/png",g.GIF="image/gif",g.WEBP="image/webp",g.BMP="image/bmp",g.TIFF="image/tiff",g.AVIF="image/avif"}(G||(G={}));const i=g=>{if(!g||g.byteLength<3)throw new Error("Buffer is not a valid image!");for(const m of j){let y=M[m];for(let k=m;k<=12;k+=1){const m=g[k];if("object"!=typeof y)return y;if(!Object.prototype.hasOwnProperty.call(y,m))break;y=y[m]}}throw new Error("Buffer is not a supported image type!")};var H,V;!function(g){g.SVG="image/svg+xml",g.JPEG="image/jpeg",g.PNG="image/png",g.GIF="image/gif",g.WEBP="image/webp",g.BMP="image/bmp",g.TIFF="image/tiff",g.AVIF="image/avif"}(H||(H={})),function(g){g[g.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",g[g.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",g[g.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",g[g.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",g[g.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"}(V||(V={}));var $,q=V;class h{constructor(g,{toRGBA:m}={toRGBA:!1}){if(this.buffer=g,this.bufferView=new DataView(g.buffer,g.byteOffset,g.byteLength),this.toRGBA=!!m,this.bottomUp=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos=2,"BM"!==this.flag)throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.reserved2=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in q))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.planes=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),32===this.bitPP?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):16===this.bitPP&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>q.BITMAP_INFO_HEADER||3===this.compression||6===this.compression)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>q.BITMAP_V2_INFO_HEADER||6===this.compression)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>q.BITMAP_V3_INFO_HEADER&&(this.pos+=q.BITMAP_V4_HEADER-q.BITMAP_V3_INFO_HEADER),this.headerSize>q.BITMAP_V4_HEADER&&(this.pos+=q.BITMAP_V5_HEADER-q.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const g=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(g);for(let m=0;m<g;m++){const g=this.buffer[this.pos++],y=this.buffer[this.pos++],k=this.buffer[this.pos++],I=this.buffer[this.pos++];this.palette[m]={red:k,green:y,blue:g,quad:I}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const g=function(g,m,y,k){const I=1+~g&g,N=1+~m&m,P=1+~y&y,z=1+~k&k,O=g/I+1,U=m/N+1,B=y/P+1,M=k/z+1;return{shiftRed:m=>(m&g)/I*256/O,shiftGreen:g=>(g&m)/N*256/U,shiftBlue:g=>(g&y)/P*256/B,shiftAlpha:0!==k?g=>(g&k)/z*256/M:()=>255}}(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=g.shiftRed,this.shiftGreen=g.shiftGreen,this.shiftBlue=g.shiftBlue,this.shiftAlpha=g.shiftAlpha}parseRGBA(){switch(this.data=new Uint8Array(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const g=Math.ceil(this.width/8),m=g%4,y=0!==m?4-m:0;this.scanImage(y,g,((g,m)=>{const y=this.buffer[this.pos++],k=m*this.width*4+8*g*4;for(let m=0;m<8&&8*g+m<this.width;m++){const g=this.palette[y>>7-m&1];this.data[k+m*this.locAlpha]=0,this.data[k+4*m+this.locBlue]=g.blue,this.data[k+4*m+this.locGreen]=g.green,this.data[k+4*m+this.locRed]=g.red}}))}bit4(){if(2===this.compression){this.data.fill(0);let g=!1,m=this.bottomUp?this.height-1:0,y=0;for(;y<this.data.length;){const k=this.buffer[this.pos++],I=this.buffer[this.pos++];if(0===k){if(0===I){m+=this.bottomUp?-1:1,y=m*this.width*4,g=!1;continue}if(1===I)break;if(2===I){const g=this.buffer[this.pos++],k=this.buffer[this.pos++];m+=this.bottomUp?-k:k,y+=k*this.width*4+4*g}else{let m=this.buffer[this.pos++];for(let k=0;k<I;k++)y=this.setPixelData(y,g?15&m:(240&m)>>4),1&k&&k+1<I&&(m=this.buffer[this.pos++]),g=!g;1==(I+1>>1&1)&&this.pos++}}else for(let m=0;m<k;m++)y=this.setPixelData(y,g?15&I:(240&I)>>4),g=!g}}else{const g=Math.ceil(this.width/2),m=g%4,y=0!==m?4-m:0;this.scanImage(y,g,((g,m)=>{const y=this.buffer[this.pos++],k=m*this.width*4+2*g*4,I=y>>4;let N=this.palette[I];if(this.data[k]=0,this.data[k+1]=N.blue,this.data[k+2]=N.green,this.data[k+3]=N.red,2*g+1>=this.width)return!1;const P=15&y;N=this.palette[P],this.data[k+4]=0,this.data[k+4+1]=N.blue,this.data[k+4+2]=N.green,this.data[k+4+3]=N.red}))}}bit8(){if(1===this.compression){this.data.fill(0);let g=this.bottomUp?this.height-1:0,m=0;for(;m<this.data.length;){const y=this.buffer[this.pos++],k=this.buffer[this.pos++];if(0===y){if(0===k){g+=this.bottomUp?-1:1,m=g*this.width*4;continue}if(1===k)break;if(2===k){const y=this.buffer[this.pos++],k=this.buffer[this.pos++];g+=this.bottomUp?-k:k,m+=k*this.width*4+4*y}else{for(let g=0;g<k;g++){const g=this.buffer[this.pos++];m=this.setPixelData(m,g)}!0&k&&this.pos++}}else for(let g=0;g<y;g++)m=this.setPixelData(m,k)}}else{const g=this.width%4,m=0!==g?4-g:0;this.scanImage(m,this.width,((g,m)=>{const y=this.buffer[this.pos++],k=m*this.width*4+4*g;if(y<this.palette.length){const g=this.palette[y];this.data[k]=0,this.data[k+1]=g.blue,this.data[k+2]=g.green,this.data[k+3]=g.red}else this.data[k]=0,this.data[k+1]=255,this.data[k+2]=255,this.data[k+3]=255}))}}bit16(){const g=this.width%2*2;this.scanImage(g,this.width,((g,m)=>{const y=m*this.width*4+4*g,k=this.bufferView.getUint16(this.pos,!0);this.pos+=2,this.data[y+this.locRed]=this.shiftRed(k),this.data[y+this.locGreen]=this.shiftGreen(k),this.data[y+this.locBlue]=this.shiftBlue(k),this.data[y+this.locAlpha]=this.shiftAlpha(k)}))}bit24(){const g=this.width%4;this.scanImage(g,this.width,((g,m)=>{const y=m*this.width*4+4*g,k=this.buffer[this.pos++],I=this.buffer[this.pos++],N=this.buffer[this.pos++];this.data[y+this.locRed]=N,this.data[y+this.locGreen]=I,this.data[y+this.locBlue]=k,this.data[y+this.locAlpha]=0}))}bit32(){this.scanImage(0,this.width,((g,m)=>{const y=m*this.width*4+4*g,k=this.readUInt32LE();this.data[y+this.locRed]=this.shiftRed(k),this.data[y+this.locGreen]=this.shiftGreen(k),this.data[y+this.locBlue]=this.shiftBlue(k),this.data[y+this.locAlpha]=this.shiftAlpha(k)}))}scanImage(g=0,m=this.width,y){for(let k=this.height-1;k>=0;k--){const I=this.bottomUp?k:this.height-1-k;for(let g=0;g<m;g++)y.call(this,g,I);this.pos+=g}}readUInt32LE(){const g=this.bufferView.getUint32(this.pos,!0);return this.pos+=4,g}setPixelData(g,m){const{blue:y,green:k,red:I}=this.palette[m];return this.data[g+this.locAlpha]=0,this.data[g+1+this.locBlue]=y,this.data[g+2+this.locGreen]=k,this.data[g+3+this.locRed]=I,g+4}}function f(g){return g.reduce(((g,m)=>g<<1|m),0)}function l(g){return g.quad<<24|g.red<<16|g.green<<8|g.blue}class d{constructor(g){switch(this.buffer=g.data,this.width=g.width,this.height=g.height,this.headerSize=q.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=g.bitPP,this.offset=54,this.reserved1=g.reserved1||0,this.reserved2=g.reserved2||0,this.planes=1,this.compress=0,this.hr=g.hr||0,this.vr=g.vr||0,this.importantColors=g.importantColors||0,this.colors=Math.min(Math.pow(2,this.bitPP-1||1),g.colors||1/0),this.palette=g.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const m=this.width*this.bitPP/32,y=Math.ceil(m);this.extraBytes=4*(y-m),this.rawSize=this.height*y*4+2,this.fileSize=this.rawSize+this.offset,this.data=new Uint8Array(this.fileSize),this.dataView=new DataView(this.data.buffer),this.data.fill(1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data[this.pos++]=this.flag.charCodeAt(0),this.data[this.pos++]=this.flag.charCodeAt(1),this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.dataView.setUint16(this.pos,this.planes,!0),this.pos+=2,this.dataView.setUint16(this.pos,this.bitPP,!0),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&2===this.colors?this.initColors(1):(this.writeUInt32LE(16777215),this.writeUInt32LE(0)),this.pos+=1;let g=[];this.writeImage(((m,y,k)=>{let I=y;I++;const N=this.buffer[I++],P=this.buffer[I++],z=.2126*this.buffer[I++]+.7152*P+.0722*N;return g.push(z>127?0:1),(k+1)%8==0?(this.data[m-1]=f(g),g=[]):k===this.width-1&&g.length>0&&(this.data[m-1]=f(g)<<4,g=[]),I}))}bit4(){const g=this.initColors(4);let m=[];this.writeImage(((y,k,I)=>{let N=k;const P=l({quad:this.buffer[N++],blue:this.buffer[N++],green:this.buffer[N++],red:this.buffer[N++]}),z=g.findIndex((g=>g===P));return-1!==z?m.push(z):m.push(0),(I+1)%2==0&&(this.data[y]=m[0]<<4|m[1],m=[]),N}))}bit8(){const g=this.initColors(8);this.writeImage(((m,y)=>{let k=y;const I=l({quad:this.buffer[k++],blue:this.buffer[k++],green:this.buffer[k++],red:this.buffer[k++]}),N=g.findIndex((g=>g===I));return this.data[m]=-1!==N?N:0,k}))}bit16(){this.writeImage(((g,m)=>{let y=m+1;const k=this.buffer[y++]/8,I=this.buffer[y++]/8,N=this.buffer[y++]/8<<10|I<<5|k;return this.data[g]=255&N,this.data[g+1]=(65280&N)>>8,y}))}bit24(){this.writeImage(((g,m)=>{let y=m+1;return this.data[g]=this.buffer[y++],this.data[g+1]=this.buffer[y++],this.data[g+2]=this.buffer[y++],y}))}bit32(){this.writeImage(((g,m)=>{let y=m;return this.data[g+3]=this.buffer[y++],this.data[g]=this.buffer[y++],this.data[g+1]=this.buffer[y++],this.data[g+2]=this.buffer[y++],y}))}writeImage(g){const m=this.extraBytes+this.width*this.bytesInColor;let y=0;for(let k=0;k<this.height;k++)for(let I=0;I<this.width;I++){const N=Math.floor(this.pos+(this.height-1-k)*m+I*this.bytesInColor);y=g.call(this,N,y,I,k)}}initColors(g){const m=[];if(!this.palette.length)throw new Error(`To encode ${g}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let g=0;g<this.colors;g++){const y=l(this.palette[g]);this.writeUInt32LE(y),m.push(y)}return m}writeUInt32LE(g){this.dataView.setUint32(this.pos,g,!0),this.pos+=4}}!function(g){g[g.NONE=0]="NONE",g[g.BI_RLE8=1]="BI_RLE8",g[g.BI_RLE4=2]="BI_RLE4",g[g.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",g[g.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"}($||($={}));const p=g=>{const m=g.length,y=new Uint8Array(m);for(let k=0;k<m;k+=4)y[k]=g[k+3],y[k+1]=g[k+2],y[k+2]=g[k+1],y[k+3]=g[k];return y},Z={decode(g){const m=((g,m)=>new h(g,m))(g,{toRGBA:!0});return{width:m.width,height:m.height,data:m.data}},encode:g=>(g=>new d(g))({bitPP:32,width:g.width,height:g.height,data:p(g.data)}).data};var W,X,Y={};function b(g,m,y,k){for(var I=g[m++],N=1<<I,P=N+1,z=P+1,O=I+1,U=(1<<O)-1,B=0,M=0,j=0,G=g[m++],H=new Int32Array(4096),V=null;;){for(;B<16&&0!==G;)M|=g[m++]<<B,B+=8,1===G?G=g[m++]:--G;if(B<O)break;var $=M&U;if(M>>=O,B-=O,$!==N){if($===P)break;for(var q=$<z?$:V,Z=0,W=q;W>N;)W=H[W]>>8,++Z;var X=W;if(j+Z+(q!==$?1:0)>k)return void console.log("Warning, gif stream longer than expected.");y[j++]=X;var Y=j+=Z;for(q!==$&&(y[j++]=X),W=q;Z--;)W=H[W],y[--Y]=255&W,W>>=8;null!==V&&z<4096&&(H[z++]=V<<8|X,z>=U+1&&O<12&&(++O,U=U<<1|1)),V=$}else z=P+1,U=(1<<(O=I+1))-1,V=null}return j!==k&&console.log("Warning, gif stream shorter than expected."),y}try{X=Y.GifWriter=function(g,m,y,k){var I=0,N=void 0===(k=void 0===k?{}:k).loop?null:k.loop,P=void 0===k.palette?null:k.palette;if(m<=0||y<=0||m>65535||y>65535)throw new Error("Width/Height invalid.");function o(g){var m=g.length;if(m<2||m>256||m&m-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return m}g[I++]=71,g[I++]=73,g[I++]=70,g[I++]=56,g[I++]=57,g[I++]=97;var z=0,O=0;if(null!==P){for(var U=o(P);U>>=1;)++z;if(U=1<<z,--z,void 0!==k.background){if((O=k.background)>=U)throw new Error("Background index out of range.");if(0===O)throw new Error("Background index explicitly passed as 0.")}}if(g[I++]=255&m,g[I++]=m>>8&255,g[I++]=255&y,g[I++]=y>>8&255,g[I++]=(null!==P?128:0)|z,g[I++]=O,g[I++]=0,null!==P)for(var B=0,M=P.length;B<M;++B){var j=P[B];g[I++]=j>>16&255,g[I++]=j>>8&255,g[I++]=255&j}if(null!==N){if(N<0||N>65535)throw new Error("Loop count invalid.");g[I++]=33,g[I++]=255,g[I++]=11,g[I++]=78,g[I++]=69,g[I++]=84,g[I++]=83,g[I++]=67,g[I++]=65,g[I++]=80,g[I++]=69,g[I++]=50,g[I++]=46,g[I++]=48,g[I++]=3,g[I++]=1,g[I++]=255&N,g[I++]=N>>8&255,g[I++]=0}var G=!1;this.addFrame=function(m,y,k,N,z,O){if(!0===G&&(--I,G=!1),O=void 0===O?{}:O,m<0||y<0||m>65535||y>65535)throw new Error("x/y invalid.");if(k<=0||N<=0||k>65535||N>65535)throw new Error("Width/Height invalid.");if(z.length<k*N)throw new Error("Not enough pixels for the frame size.");var U=!0,B=O.palette;if(null==B&&(U=!1,B=P),null==B)throw new Error("Must supply either a local or global palette.");for(var M=o(B),j=0;M>>=1;)++j;M=1<<j;var H=void 0===O.delay?0:O.delay,V=void 0===O.disposal?0:O.disposal;if(V<0||V>3)throw new Error("Disposal out of range.");var $=!1,q=0;if(void 0!==O.transparent&&null!==O.transparent&&($=!0,(q=O.transparent)<0||q>=M))throw new Error("Transparent color index.");if((0!==V||$||0!==H)&&(g[I++]=33,g[I++]=249,g[I++]=4,g[I++]=V<<2|(!0===$?1:0),g[I++]=255&H,g[I++]=H>>8&255,g[I++]=q,g[I++]=0),g[I++]=44,g[I++]=255&m,g[I++]=m>>8&255,g[I++]=255&y,g[I++]=y>>8&255,g[I++]=255&k,g[I++]=k>>8&255,g[I++]=255&N,g[I++]=N>>8&255,g[I++]=!0===U?128|j-1:0,!0===U)for(var Z=0,W=B.length;Z<W;++Z){var X=B[Z];g[I++]=X>>16&255,g[I++]=X>>8&255,g[I++]=255&X}return I=function(g,m,y,k){g[m++]=y;var I=m++,N=1<<y,P=N-1,z=N+1,O=z+1,U=y+1,B=0,M=0;function u(y){for(;B>=y;)g[m++]=255&M,M>>=8,B-=8,m===I+256&&(g[I]=255,I=m++)}function c(g){M|=g<<B,B+=U,u(8)}var j=k[0]&P,G={};c(N);for(var H=1,V=k.length;H<V;++H){var $=k[H]&P,q=j<<8|$,Z=G[q];if(void 0===Z){for(M|=j<<B,B+=U;B>=8;)g[m++]=255&M,M>>=8,B-=8,m===I+256&&(g[I]=255,I=m++);4096===O?(c(N),O=z+1,U=y+1,G={}):(O>=1<<U&&++U,G[q]=O++),j=$}else j=Z}return c(j),c(z),u(1),I+1===m?g[I]=0:(g[I]=m-I-1,g[m++]=0),m}(g,I,j<2?2:j,z),I},this.end=function(){return!1===G&&(g[I++]=59,G=!0),I},this.getOutputBuffer=function(){return g},this.setOutputBuffer=function(m){g=m},this.getOutputBufferPosition=function(){return I},this.setOutputBufferPosition=function(g){I=g}},W=Y.GifReader=function(g){var m=0;if(71!==g[m++]||73!==g[m++]||70!==g[m++]||56!==g[m++]||56!=(g[m++]+1&253)||97!==g[m++])throw new Error("Invalid GIF 87a/89a header.");var y=g[m++]|g[m++]<<8,k=g[m++]|g[m++]<<8,I=g[m++],N=I>>7,P=1<<1+(7&I);g[m++],g[m++];var z=null,O=null;N&&(z=m,O=P,m+=3*P);var U=!0,B=[],M=0,j=null,G=0,H=null;for(this.width=y,this.height=k;U&&m<g.length;)switch(g[m++]){case 33:switch(g[m++]){case 255:if(11!==g[m]||78==g[m+1]&&69==g[m+2]&&84==g[m+3]&&83==g[m+4]&&67==g[m+5]&&65==g[m+6]&&80==g[m+7]&&69==g[m+8]&&50==g[m+9]&&46==g[m+10]&&48==g[m+11]&&3==g[m+12]&&1==g[m+13]&&0==g[m+16])m+=14,H=g[m++]|g[m++]<<8,m++;else for(m+=12;;){if(!((vt=g[m++])>=0))throw Error("Invalid block size");if(0===vt)break;m+=vt}break;case 249:if(4!==g[m++]||0!==g[m+4])throw new Error("Invalid graphics extension block.");var V=g[m++];M=g[m++]|g[m++]<<8,j=g[m++],!(1&V)&&(j=null),G=V>>2&7,m++;break;case 254:for(;;){if(!((vt=g[m++])>=0))throw Error("Invalid block size");if(0===vt)break;m+=vt}break;default:throw new Error("Unknown graphic control label: 0x"+g[m-1].toString(16))}break;case 44:var $=g[m++]|g[m++]<<8,q=g[m++]|g[m++]<<8,Z=g[m++]|g[m++]<<8,W=g[m++]|g[m++]<<8,X=g[m++],Y=X>>6&1,J=1<<1+(7&X),K=z,Q=O,tt=!1;X>>7&&(tt=!0,K=m,Q=J,m+=3*J);var et=m;for(m++;;){var vt;if(!((vt=g[m++])>=0))throw Error("Invalid block size");if(0===vt)break;m+=vt}B.push({x:$,y:q,width:Z,height:W,has_local_palette:tt,palette_offset:K,palette_size:Q,data_offset:et,data_length:m-et,transparent_index:j,interlaced:!!Y,delay:M,disposal:G});break;case 59:U=!1;break;default:throw new Error("Unknown gif block: 0x"+g[m-1].toString(16))}this.numFrames=function(){return B.length},this.loopCount=function(){return H},this.frameInfo=function(g){if(g<0||g>=B.length)throw new Error("Frame index out of range.");return B[g]},this.decodeAndBlitFrameBGRA=function(m,k){var I=this.frameInfo(m),N=I.width*I.height,P=new Uint8Array(N);b(g,I.data_offset,P,N);var z=I.palette_offset,O=I.transparent_index;null===O&&(O=256);var U=I.width,B=y-U,M=U,j=4*(I.y*y+I.x),G=4*((I.y+I.height)*y+I.x),H=j,V=4*B;!0===I.interlaced&&(V+=4*y*7);for(var $=8,q=0,Z=P.length;q<Z;++q){var W=P[q];if(0===M&&(M=U,(H+=V)>=G&&(V=4*B+4*y*($-1),H=j+(U+B)*($<<1),$>>=1)),W===O)H+=4;else{var X=g[z+3*W],Y=g[z+3*W+1],J=g[z+3*W+2];k[H++]=J,k[H++]=Y,k[H++]=X,k[H++]=255}--M}},this.decodeAndBlitFrameRGBA=function(m,k){var I=this.frameInfo(m),N=I.width*I.height,P=new Uint8Array(N);b(g,I.data_offset,P,N);var z=I.palette_offset,O=I.transparent_index;null===O&&(O=256);var U=I.width,B=y-U,M=U,j=4*(I.y*y+I.x),G=4*((I.y+I.height)*y+I.x),H=j,V=4*B;!0===I.interlaced&&(V+=4*y*7);for(var $=8,q=0,Z=P.length;q<Z;++q){var W=P[q];if(0===M&&(M=U,(H+=V)>=G&&(V=4*B+4*y*($-1),H=j+(U+B)*($<<1),$>>=1)),W===O)H+=4;else{var X=g[z+3*W],Y=g[z+3*W+1],J=g[z+3*W+2];k[H++]=X,k[H++]=Y,k[H++]=J,k[H++]=255}--M}}}}catch(M){}var J={exports:{}};if(!K)var K={map:function(g,m){var y={};return m?g.map((function(g,k){return y.index=k,m.call(y,g)})):g.slice()},naturalOrder:function(g,m){return g<m?-1:g>m?1:0},sum:function(g,m){var y={};return g.reduce(m?function(g,k,I){return y.index=I,g+m.call(y,k)}:function(g,m){return g+m},0)},max:function(g,m){return Math.max.apply(null,m?K.map(g,m):g)}};var Q=function(){function t(g,m,y){return(g<<10)+(m<<5)+y}function e(g){var m=[],y=!1;function i(){m.sort(g),y=!0}return{push:function(g){m.push(g),y=!1},peek:function(g){return y||i(),void 0===g&&(g=m.length-1),m[g]},pop:function(){return y||i(),m.pop()},size:function(){return m.length},map:function(g){return m.map(g)},debug:function(){return y||i(),m}}}function r(g,m,y,k,I,N,P){var z=this;z.r1=g,z.r2=m,z.g1=y,z.g2=k,z.b1=I,z.b2=N,z.histo=P}function i(){this.vboxes=new e((function(g,m){return K.naturalOrder(g.vbox.count()*g.vbox.volume(),m.vbox.count()*m.vbox.volume())}))}function n(g,m){if(m.count()){var y=m.r2-m.r1+1,k=m.g2-m.g1+1,I=m.b2-m.b1+1,N=K.max([y,k,I]);if(1==m.count())return[m.copy()];var P,z,O,U,B=0,M=[],j=[];if(N==y)for(P=m.r1;P<=m.r2;P++){for(U=0,z=m.g1;z<=m.g2;z++)for(O=m.b1;O<=m.b2;O++)U+=g[t(P,z,O)]||0;B+=U,M[P]=B}else if(N==k)for(P=m.g1;P<=m.g2;P++){for(U=0,z=m.r1;z<=m.r2;z++)for(O=m.b1;O<=m.b2;O++)U+=g[t(z,P,O)]||0;B+=U,M[P]=B}else for(P=m.b1;P<=m.b2;P++){for(U=0,z=m.r1;z<=m.r2;z++)for(O=m.g1;O<=m.g2;O++)U+=g[t(z,O,P)]||0;B+=U,M[P]=B}return M.forEach((function(g,m){j[m]=B-g})),function p(g){var y,k,I,N,z,O=g+"1",U=g+"2",G=0;for(P=m[O];P<=m[U];P++)if(M[P]>B/2){for(I=m.copy(),N=m.copy(),z=(y=P-m[O])<=(k=m[U]-P)?Math.min(m[U]-1,~~(P+k/2)):Math.max(m[O],~~(P-1-y/2));!M[z];)z++;for(G=j[z];!G&&M[z-1];)G=j[--z];return I[U]=z,N[O]=I[U]+1,[I,N]}}(N==y?"r":N==k?"g":"b")}}return r.prototype={volume:function(g){var m=this;return m._volume&&!g||(m._volume=(m.r2-m.r1+1)*(m.g2-m.g1+1)*(m.b2-m.b1+1)),m._volume},count:function(g){var m=this,y=m.histo;if(!m._count_set||g){var k,I,N,P=0;for(k=m.r1;k<=m.r2;k++)for(I=m.g1;I<=m.g2;I++)for(N=m.b1;N<=m.b2;N++)P+=y[t(k,I,N)]||0;m._count=P,m._count_set=!0}return m._count},copy:function(){var g=this;return new r(g.r1,g.r2,g.g1,g.g2,g.b1,g.b2,g.histo)},avg:function(g){var m=this,y=m.histo;if(!m._avg||g){var k,I,N,P,z=0,O=0,U=0,B=0;for(I=m.r1;I<=m.r2;I++)for(N=m.g1;N<=m.g2;N++)for(P=m.b1;P<=m.b2;P++)z+=k=y[t(I,N,P)]||0,O+=k*(I+.5)*8,U+=k*(N+.5)*8,B+=k*(P+.5)*8;m._avg=z?[~~(O/z),~~(U/z),~~(B/z)]:[~~(8*(m.r1+m.r2+1)/2),~~(8*(m.g1+m.g2+1)/2),~~(8*(m.b1+m.b2+1)/2)]}return m._avg},contains:function(g){var m=this,y=g[0]>>3;return gval=g[1]>>3,bval=g[2]>>3,y>=m.r1&&y<=m.r2&&gval>=m.g1&&gval<=m.g2&&bval>=m.b1&&bval<=m.b2}},i.prototype={push:function(g){this.vboxes.push({vbox:g,color:g.avg()})},palette:function(){return this.vboxes.map((function(g){return g.color}))},size:function(){return this.vboxes.size()},map:function(g){for(var m=this.vboxes,y=0;y<m.size();y++)if(m.peek(y).vbox.contains(g))return m.peek(y).color;return this.nearest(g)},nearest:function(g){for(var m,y,k,I=this.vboxes,N=0;N<I.size();N++)((y=Math.sqrt(Math.pow(g[0]-I.peek(N).color[0],2)+Math.pow(g[1]-I.peek(N).color[1],2)+Math.pow(g[2]-I.peek(N).color[2],2)))<m||void 0===m)&&(m=y,k=I.peek(N).color);return k},forcebw:function(){var g=this.vboxes;g.sort((function(g,m){return K.naturalOrder(K.sum(g.color),K.sum(m.color))}));var m=g[0].color;m[0]<5&&m[1]<5&&m[2]<5&&(g[0].color=[0,0,0]);var y=g.length-1,k=g[y].color;k[0]>251&&k[1]>251&&k[2]>251&&(g[y].color=[255,255,255])}},{quantize:function(g,m){if(!g.length||m<2||m>256)return!1;var y=function(g){var m,y,k,I,N=new Array(32768);return g.forEach((function(g){y=g[0]>>3,k=g[1]>>3,I=g[2]>>3,m=t(y,k,I),N[m]=(N[m]||0)+1})),N}(g);y.forEach((function(){}));var k=function(g,m){var y,k,I,N=1e6,P=0,z=1e6,O=0,U=1e6,B=0;return g.forEach((function(g){y=g[0]>>3,k=g[1]>>3,I=g[2]>>3,y<N?N=y:y>P&&(P=y),k<z?z=k:k>O&&(O=k),I<U?U=I:I>B&&(B=I)})),new r(N,P,z,O,U,B,m)}(g,y),I=new e((function(g,m){return K.naturalOrder(g.count(),m.count())}));function l(g,m){for(var k,I=1,N=0;N<1e3;)if((k=g.pop()).count()){var P=n(y,k),z=P[0],O=P[1];if(!z)return;if(g.push(z),O&&(g.push(O),I++),I>=m)return;if(N++>1e3)return}else g.push(k),N++}I.push(k),l(I,.75*m);for(var N=new e((function(g,m){return K.naturalOrder(g.count()*g.volume(),m.count()*m.volume())}));I.size();)N.push(I.pop());l(N,m-N.size());for(var P=new i;N.size();)P.push(N.pop());return P}}}(),tt=Q.quantize;function x(g,m){return g[m+3]>=127}function E(g,m,y,k){if(m="number"==typeof m?0|m:5,k="function"==typeof k?k:x,(y="number"==typeof y?0|y:10)<=0)throw new Error("quality must be > 0");for(var I=[],N=4*y,P=0,z=g.length;P<z;P+=N){var O=g[P+0],U=g[P+1],B=g[P+2];k(g,P,g)&&I.push([O,U,B])}var M=tt(I,Math.max(2,m)).vboxes;return M?M.map((function(g){return g})).slice(0,m):[]}J.exports=function(g,m,y,k){return E(g,m,y,k).map((function(g){return g.color}))},J.exports.bins=function(g,m,y,k){var I=E(g,m,y,k),N=(I=I.map((function(g){return{color:g.color,size:g.vbox.count()*g.vbox.volume(),amount:0}}))).reduce((function(g,m){return g+m.size}),0);return I.forEach((function(g){g.amount=g.size/N})),I};var et=J.exports;const vt={decode(g){const m=new W(g),y={width:m.width,height:m.height,data:new Uint8Array(m.width*m.height*4)};return m.decodeAndBlitFrameRGBA(0,y.data),y},encode(g,m){const y=[g.data],k=new Uint8Array(g.width*g.height*y.length+1024),I=new X(k,g.width,g.height,{loop:m.loop});return y.forEach((y=>{const k=((g,m)=>{const y=Math.pow(2,Math.ceil(Math.log(m)/Math.log(2)));let k=et(g,m).map((g=>[g[0],g[1],g[2],255]));if(0===k.length&&(k=et(g,m,10,(()=>!0)).map((g=>[g[0],g[1],g[2],255]))),k.length<y){const g=k.length>0?k[k.length-1]:[0,0,0,0],m=k.length;k.length=y,k.fill(g,m,y)}k[k.length-1]=[0,0,0,0];for(let g=0;g<k.length;g+=1)for(let m=0;m<4;m+=1){const y=k[g][m];null==y||Number.isNaN(y)||y<0?k[g][m]=0:y>255&&(k[g][m]=255)}return k})(y,16),N=((g,m)=>{const y=new Array(g.length/4),k=new Map;m.forEach(((g,m)=>k.set(g,m)));for(let I=0;I<g.length;I+=4){const N=[g[I],g[I+1],g[I+2],g[I+3]];if(k.has(N))y[I/4]=k.get(N);else{let g=1e3,P=0;m.map(((m,y)=>{const k=Math.sqrt(Math.pow(N[0]-m[0],2)+Math.pow(N[1]-m[1],2)+Math.pow(N[2]-m[2],2)+Math.pow(N[3]-m[3],2));k<g&&(g=k,P=y)})),k.set(N,P),y[I/4]=P}}return y})(y,k);I.addFrame(0,0,g.width,g.height,N,{palette:k.map((([g,m,y])=>((g,m,y)=>(g<<16)+(m<<8)+y)(g,m,y))),delay:m.delay,transparent:k.length-1,disposal:2})})),k.slice(0,I.end())}};var yt={exports:{}};!function(){function e(g){var m,y,k,I,N,P=Math.floor,z=new Array(64),O=new Array(64),U=new Array(64),B=new Array(64),M=new Array(65535),j=new Array(65535),G=new Array(64),H=new Array(64),V=[],$=0,q=7,Z=new Array(64),W=new Array(64),X=new Array(64),Y=new Array(256),J=new Array(2048),K=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],tt=[0,1,2,3,4,5,6,7,8,9,10,11],et=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],vt=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],yt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],xt=[0,1,2,3,4,5,6,7,8,9,10,11],kt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Et=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(g,m){for(var y=0,k=0,I=new Array,N=1;N<=16;N++){for(var P=1;P<=g[N];P++)I[m[k]]=[],I[m[k]][0]=y,I[m[k]][1]=N,k++,y++;y*=2}return I}function S(g){for(var m=g[0],y=g[1]-1;y>=0;)m&1<<y&&($|=1<<q),y--,--q<0&&(255==$?(T(255),T(0)):T($),q=7,$=0)}function T(g){V.push(g)}function C(g){T(g>>8&255),T(255&g)}function L(g,m,y,k,I){for(var N,P=I[0],z=I[240],O=function(g,m){var y,k,I,N,P,z,O,U,B,M,j=0;for(B=0;B<8;++B){y=g[j],k=g[j+1],I=g[j+2],N=g[j+3],P=g[j+4],z=g[j+5],O=g[j+6];var H=y+(U=g[j+7]),V=y-U,$=k+O,q=k-O,Z=I+z,W=I-z,X=N+P,Y=N-P,J=H+X,K=H-X,Q=$+Z,tt=$-Z;g[j]=J+Q,g[j+4]=J-Q;var et=.707106781*(tt+K);g[j+2]=K+et,g[j+6]=K-et;var vt=.382683433*((J=Y+W)-(tt=q+V)),yt=.5411961*J+vt,xt=1.306562965*tt+vt,kt=.707106781*(Q=W+q),Et=V+kt,It=V-kt;g[j+5]=It+yt,g[j+3]=It-yt,g[j+1]=Et+xt,g[j+7]=Et-xt,j+=8}for(j=0,B=0;B<8;++B){y=g[j],k=g[j+8],I=g[j+16],N=g[j+24],P=g[j+32],z=g[j+40],O=g[j+48];var zt=y+(U=g[j+56]),Ut=y-U,Bt=k+O,jt=k-O,Wt=I+z,Xt=I-z,Yt=N+P,Jt=N-P,Kt=zt+Yt,te=zt-Yt,ee=Bt+Wt,ie=Bt-Wt;g[j]=Kt+ee,g[j+32]=Kt-ee;var re=.707106781*(ie+te);g[j+16]=te+re,g[j+48]=te-re;var ne=.382683433*((Kt=Jt+Xt)-(ie=jt+Ut)),ae=.5411961*Kt+ne,he=1.306562965*ie+ne,le=.707106781*(ee=Xt+jt),fe=Ut+le,ce=Ut-le;g[j+40]=ce+ae,g[j+24]=ce-ae,g[j+8]=fe+he,g[j+56]=fe-he,j++}for(B=0;B<64;++B)M=g[B]*m[B],G[B]=M>0?M+.5|0:M-.5|0;return G}(g,m),U=0;U<64;++U)H[K[U]]=O[U];var B=H[0]-y;y=H[0],0==B?S(k[0]):(S(k[j[N=32767+B]]),S(M[N]));for(var V=63;V>0&&0==H[V];V--);if(0==V)return S(P),y;for(var $,q=1;q<=V;){for(var Z=q;0==H[q]&&q<=V;++q);var W=q-Z;if(W>=16){$=W>>4;for(var X=1;X<=$;++X)S(z);W&=15}N=32767+H[q],S(I[(W<<4)+j[N]]),S(M[N]),q++}return 63!=V&&S(P),y}function D(g){g<=0&&(g=1),g>100&&(g=100),N!=g&&(function(g){for(var m=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],y=0;y<64;y++){var k=P((m[y]*g+50)/100);k<1?k=1:k>255&&(k=255),z[K[y]]=k}for(var I=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],N=0;N<64;N++){var M=P((I[N]*g+50)/100);M<1?M=1:M>255&&(M=255),O[K[N]]=M}for(var j=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],G=0,H=0;H<8;H++)for(var V=0;V<8;V++)U[G]=1/(z[K[G]]*j[H]*j[V]*8),B[G]=1/(O[K[G]]*j[H]*j[V]*8),G++}(g<50?Math.floor(5e3/g):Math.floor(200-2*g)),N=g)}this.encode=function(g,N){var P;(new Date).getTime(),N&&D(N),V=new Array,$=0,q=7,C(65496),C(65504),C(16),T(74),T(70),T(73),T(70),T(0),T(1),T(1),T(0),C(1),C(1),T(0),T(0),void 0!==(P=g.comments)&&P.constructor===Array&&P.forEach((g=>{if("string"==typeof g){C(65534);var m,y=g.length;for(C(y+2),m=0;m<y;m++)T(g.charCodeAt(m))}})),function(g){if(g){C(65505),69===g[0]&&120===g[1]&&105===g[2]&&102===g[3]?C(g.length+2):(C(g.length+5+2),T(69),T(120),T(105),T(102),T(0));for(var m=0;m<g.length;m++)T(g[m])}}(g.exifBuffer),function(){C(65499),C(132),T(0);for(var g=0;g<64;g++)T(z[g]);T(1);for(var m=0;m<64;m++)T(O[m])}(),function(g,m){C(65472),C(17),T(8),C(m),C(g),T(3),T(1),T(17),T(0),T(2),T(17),T(1),T(3),T(17),T(1)}(g.width,g.height),function(){C(65476),C(418),T(0);for(var g=0;g<16;g++)T(Q[g+1]);for(var m=0;m<=11;m++)T(tt[m]);T(16);for(var y=0;y<16;y++)T(et[y+1]);for(var k=0;k<=161;k++)T(vt[k]);T(1);for(var I=0;I<16;I++)T(yt[I+1]);for(var N=0;N<=11;N++)T(xt[N]);T(17);for(var P=0;P<16;P++)T(kt[P+1]);for(var z=0;z<=161;z++)T(Et[z])}(),C(65498),C(12),T(3),T(1),T(0),T(2),T(17),T(3),T(17),T(0),T(63),T(0);var M=0,j=0,G=0;$=0,q=7,this.encode.displayName="_encode_";for(var H,Y,K,It,zt,Ut,Bt,jt,Wt,Xt=g.data,Yt=g.width,Jt=g.height,Kt=4*Yt,te=0;te<Jt;){for(H=0;H<Kt;){for(Ut=zt=Kt*te+H,Bt=-1,jt=0,Wt=0;Wt<64;Wt++)Ut=zt+(jt=Wt>>3)*Kt+(Bt=4*(7&Wt)),te+jt>=Jt&&(Ut-=Kt*(te+1+jt-Jt)),H+Bt>=Kt&&(Ut-=H+Bt-Kt+4),Y=Xt[Ut++],K=Xt[Ut++],It=Xt[Ut++],Z[Wt]=(J[Y]+J[K+256|0]+J[It+512|0]>>16)-128,W[Wt]=(J[Y+768|0]+J[K+1024|0]+J[It+1280|0]>>16)-128,X[Wt]=(J[Y+1280|0]+J[K+1536|0]+J[It+1792|0]>>16)-128;M=L(Z,U,M,m,k),j=L(W,B,j,y,I),G=L(X,B,G,y,I),H+=32}te+=8}if(q>=0){var ee=[];ee[1]=q+1,ee[0]=(1<<q+1)-1,S(ee)}return C(65497),new Uint8Array(V)},(new Date).getTime(),g||(g=50),function(){for(var g=String.fromCharCode,m=0;m<256;m++)Y[m]=g(m)}(),m=R(Q,tt),y=R(yt,xt),k=R(et,vt),I=R(kt,Et),function(){for(var g=1,m=2,y=1;y<=15;y++){for(var k=g;k<m;k++)j[32767+k]=y,M[32767+k]=[],M[32767+k][1]=y,M[32767+k][0]=k;for(var I=-(m-1);I<=-g;I++)j[32767+I]=y,M[32767+I]=[],M[32767+I][1]=y,M[32767+I][0]=m-1+I;g<<=1,m<<=1}}(),function(){for(var g=0;g<256;g++)J[g]=19595*g,J[g+256|0]=38470*g,J[g+512|0]=7471*g+32768,J[g+768|0]=-11059*g,J[g+1024|0]=-21709*g,J[g+1280|0]=32768*g+8421375,J[g+1536|0]=-27439*g,J[g+1792|0]=-5329*g}(),D(g),(new Date).getTime()}yt.exports=function(g,m){return void 0===m&&(m=50),{data:new e(m).encode(g,m),width:g.width,height:g.height}}}();var xt,kt,Et={exports:{}};xt=Et,kt=function(){var g=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),m=4017,y=799,k=3406,I=2276,N=1567,P=3784,z=5793,O=2896;function f(){}function l(g,m){for(var y,k,I=0,N=[],P=16;P>0&&!g[P-1];)P--;N.push({children:[],index:0});var z,O=N[0];for(y=0;y<P;y++){for(k=0;k<g[y];k++){for((O=N.pop()).children[O.index]=m[I];O.index>0;){if(0===N.length)throw new Error("Could not recreate Huffman Table");O=N.pop()}for(O.index++,N.push(O);N.length<=y;)N.push(z={children:[],index:0}),O.children[O.index]=z.children,O=z;I++}y+1<P&&(N.push(z={children:[],index:0}),O.children[O.index]=z.children,O=z)}return N[0].children}function d(m,y,k,I,N,P,z,O,U,B){k.precision,k.samplesPerLine,k.scanLines;var M=k.mcusPerLine,j=k.progressive;k.maxH,k.maxV;var G=y,H=0,V=0;function w(){if(V>0)return V--,H>>V&1;if(255==(H=m[y++])){var g=m[y++];if(g)throw new Error("unexpected marker: "+(H<<8|g).toString(16))}return V=7,H>>>7}function _(g){for(var m,y=g;null!==(m=w());){if("number"==typeof(y=y[m]))return y;if("object"!=typeof y)throw new Error("invalid huffman sequence")}return null}function v(g){for(var m=0;g>0;){var y=w();if(null===y)return;m=m<<1|y,g--}return m}function b(g){var m=v(g);return m>=1<<g-1?m:m+(-1<<g)+1}var $,q=0,Z=0;function A(g,m,y,k,I){var N=y%M,P=(y/M|0)*g.v+k,z=N*g.h+I;void 0===g.blocks[P]&&B.tolerantDecoding||m(g,g.blocks[P][z])}function x(g,m,y){var k=y/g.blocksPerLine|0,I=y%g.blocksPerLine;void 0===g.blocks[k]&&B.tolerantDecoding||m(g,g.blocks[k][I])}var W,X,Y,J,K,Q,tt=I.length;Q=j?0===P?0===O?function(g,m){var y=_(g.huffmanTableDC),k=0===y?0:b(y)<<U;m[0]=g.pred+=k}:function(g,m){m[0]|=w()<<U}:0===O?function(m,y){if(q>0)q--;else for(var k=P,I=z;k<=I;){var N=_(m.huffmanTableAC),O=15&N,B=N>>4;if(0!==O)y[g[k+=B]]=b(O)*(1<<U),k++;else{if(B<15){q=v(B)+(1<<B)-1;break}k+=16}}}:function(m,y){for(var k=P,I=z,N=0;k<=I;){var O=g[k],B=y[O]<0?-1:1;switch(Z){case 0:var M=_(m.huffmanTableAC),j=15&M;if(N=M>>4,0===j)N<15?(q=v(N)+(1<<N),Z=4):(N=16,Z=1);else{if(1!==j)throw new Error("invalid ACn encoding");$=b(j),Z=N?2:3}continue;case 1:case 2:y[O]?y[O]+=(w()<<U)*B:0==--N&&(Z=2==Z?3:0);break;case 3:y[O]?y[O]+=(w()<<U)*B:(y[O]=$<<U,Z=0);break;case 4:y[O]&&(y[O]+=(w()<<U)*B)}k++}4===Z&&0==--q&&(Z=0)}:function(m,y){var k=_(m.huffmanTableDC),I=0===k?0:b(k);y[0]=m.pred+=I;for(var N=1;N<64;){var P=_(m.huffmanTableAC),z=15&P,O=P>>4;if(0!==z)y[g[N+=O]]=b(z),N++;else{if(O<15)break;N+=16}}};var et,vt,yt,xt,kt=0;for(vt=1==tt?I[0].blocksPerLine*I[0].blocksPerColumn:M*k.mcusPerColumn,N||(N=vt);kt<vt;){for(X=0;X<tt;X++)I[X].pred=0;if(q=0,1==tt)for(W=I[0],K=0;K<N;K++)x(W,Q,kt),kt++;else for(K=0;K<N;K++){for(X=0;X<tt;X++)for(yt=(W=I[X]).h,xt=W.v,Y=0;Y<xt;Y++)for(J=0;J<yt;J++)A(W,Q,kt,Y,J);if(++kt===vt)break}if(kt===vt)do{if(255===m[y]&&0!==m[y+1])break;y+=1}while(y<m.length-2);if(V=0,(et=m[y]<<8|m[y+1])<65280)throw new Error("marker was not found");if(!(et>=65488&&et<=65495))break;y+=2}return y-G}function u(g,U){var B,M,j=[],G=U.blocksPerLine,H=U.blocksPerColumn,V=G<<3,$=new Int32Array(64),q=new Uint8Array(64);function b(g,B,M){var j,G,H,V,$,q,Z,W,X,Y,J=U.quantizationTable,K=M;for(Y=0;Y<64;Y++)K[Y]=g[Y]*J[Y];for(Y=0;Y<8;++Y){var Q=8*Y;0!=K[1+Q]||0!=K[2+Q]||0!=K[3+Q]||0!=K[4+Q]||0!=K[5+Q]||0!=K[6+Q]||0!=K[7+Q]?(j=z*K[0+Q]+128>>8,G=z*K[4+Q]+128>>8,H=K[2+Q],V=K[6+Q],$=O*(K[1+Q]-K[7+Q])+128>>8,W=O*(K[1+Q]+K[7+Q])+128>>8,q=K[3+Q]<<4,Z=K[5+Q]<<4,X=j-G+1>>1,j=j+G+1>>1,G=X,X=H*P+V*N+128>>8,H=H*N-V*P+128>>8,V=X,X=$-Z+1>>1,$=$+Z+1>>1,Z=X,X=W+q+1>>1,q=W-q+1>>1,W=X,X=j-V+1>>1,j=j+V+1>>1,V=X,X=G-H+1>>1,G=G+H+1>>1,H=X,X=$*I+W*k+2048>>12,$=$*k-W*I+2048>>12,W=X,X=q*y+Z*m+2048>>12,q=q*m-Z*y+2048>>12,Z=X,K[0+Q]=j+W,K[7+Q]=j-W,K[1+Q]=G+Z,K[6+Q]=G-Z,K[2+Q]=H+q,K[5+Q]=H-q,K[3+Q]=V+$,K[4+Q]=V-$):(X=z*K[0+Q]+512>>10,K[0+Q]=X,K[1+Q]=X,K[2+Q]=X,K[3+Q]=X,K[4+Q]=X,K[5+Q]=X,K[6+Q]=X,K[7+Q]=X)}for(Y=0;Y<8;++Y){var tt=Y;0!=K[8+tt]||0!=K[16+tt]||0!=K[24+tt]||0!=K[32+tt]||0!=K[40+tt]||0!=K[48+tt]||0!=K[56+tt]?(j=z*K[0+tt]+2048>>12,G=z*K[32+tt]+2048>>12,H=K[16+tt],V=K[48+tt],$=O*(K[8+tt]-K[56+tt])+2048>>12,W=O*(K[8+tt]+K[56+tt])+2048>>12,q=K[24+tt],Z=K[40+tt],X=j-G+1>>1,j=j+G+1>>1,G=X,X=H*P+V*N+2048>>12,H=H*N-V*P+2048>>12,V=X,X=$-Z+1>>1,$=$+Z+1>>1,Z=X,X=W+q+1>>1,q=W-q+1>>1,W=X,X=j-V+1>>1,j=j+V+1>>1,V=X,X=G-H+1>>1,G=G+H+1>>1,H=X,X=$*I+W*k+2048>>12,$=$*k-W*I+2048>>12,W=X,X=q*y+Z*m+2048>>12,q=q*m-Z*y+2048>>12,Z=X,K[0+tt]=j+W,K[56+tt]=j-W,K[8+tt]=G+Z,K[48+tt]=G-Z,K[16+tt]=H+q,K[40+tt]=H-q,K[24+tt]=V+$,K[32+tt]=V-$):(X=z*M[Y+0]+8192>>14,K[0+tt]=X,K[8+tt]=X,K[16+tt]=X,K[24+tt]=X,K[32+tt]=X,K[40+tt]=X,K[48+tt]=X,K[56+tt]=X)}for(Y=0;Y<64;++Y){var et=128+(K[Y]+8>>4);B[Y]=et<0?0:et>255?255:et}}w(V*H*8);for(var Z=0;Z<H;Z++){var W=Z<<3;for(B=0;B<8;B++)j.push(new Uint8Array(V));for(var X=0;X<G;X++){b(U.blocks[Z][X],q,$);var Y=0,J=X<<3;for(M=0;M<8;M++){var K=j[W+M];for(B=0;B<8;B++)K[J+B]=q[Y++]}}}return j}function c(g){return g<0?0:g>255?255:g}f.prototype={load:function(g){var m=new XMLHttpRequest;m.open("GET",g,!0),m.responseType="arraybuffer",m.onload=function(){var g=new Uint8Array(m.response||m.mozResponseArrayBuffer);this.parse(g),this.onload&&this.onload()}.bind(this),m.send(null)},parse:function(m){var y=1e3*this.opts.maxResolutionInMP*1e3,k=0;function n(){var g=m[k]<<8|m[k+1];return k+=2,g}function a(g){var m,y,k=1,I=1;for(y in g.components)g.components.hasOwnProperty(y)&&(k<(m=g.components[y]).h&&(k=m.h),I<m.v&&(I=m.v));var N=Math.ceil(g.samplesPerLine/8/k),P=Math.ceil(g.scanLines/8/I);for(y in g.components)if(g.components.hasOwnProperty(y)){m=g.components[y];var z=Math.ceil(Math.ceil(g.samplesPerLine/8)*m.h/k),O=Math.ceil(Math.ceil(g.scanLines/8)*m.v/I),U=N*m.h,B=P*m.v,M=[];w(B*U*256);for(var j=0;j<B;j++){for(var G=[],H=0;H<U;H++)G.push(new Int32Array(64));M.push(G)}m.blocksPerLine=z,m.blocksPerColumn=O,m.blocks=M}g.maxH=k,g.maxV=I,g.mcusPerLine=N,g.mcusPerColumn=P}m.length;var I,N,P,z,O=null,U=null,B=[],M=[],j=[],G=[],H=n(),V=-1;if(this.comments=[],65496!=H)throw new Error("SOI not found");for(H=n();65497!=H;){switch(H){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var $=(void 0,void 0,P=n(),z=m.subarray(k,k+P-2),k+=z.length,z);if(65534===H){var q=String.fromCharCode.apply(null,$);this.comments.push(q)}65504===H&&74===$[0]&&70===$[1]&&73===$[2]&&70===$[3]&&0===$[4]&&(O={version:{major:$[5],minor:$[6]},densityUnits:$[7],xDensity:$[8]<<8|$[9],yDensity:$[10]<<8|$[11],thumbWidth:$[12],thumbHeight:$[13],thumbData:$.subarray(14,14+3*$[12]*$[13])}),65505===H&&69===$[0]&&120===$[1]&&105===$[2]&&102===$[3]&&0===$[4]&&(this.exifBuffer=$.subarray(5,$.length)),65518===H&&65===$[0]&&100===$[1]&&111===$[2]&&98===$[3]&&101===$[4]&&0===$[5]&&(U={version:$[6],flags0:$[7]<<8|$[8],flags1:$[9]<<8|$[10],transformCode:$[11]});break;case 65499:for(var Z=n()+k-2;k<Z;){var W=m[k++];w(256);var X=new Int32Array(64);if(W>>4){if(W>>4!=1)throw new Error("DQT: invalid table spec");for(te=0;te<64;te++)X[g[te]]=n()}else for(te=0;te<64;te++)X[g[te]]=m[k++];B[15&W]=X}break;case 65472:case 65473:case 65474:n(),(I={}).extended=65473===H,I.progressive=65474===H,I.precision=m[k++],I.scanLines=n(),I.samplesPerLine=n(),I.components={},I.componentsOrder=[];var Y=I.scanLines*I.samplesPerLine;if(Y>y){var J=Math.ceil((Y-y)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${J}MP`)}var K,Q=m[k++];for(Jt=0;Jt<Q;Jt++){K=m[k];var tt=m[k+1]>>4,et=15&m[k+1],vt=m[k+2];if(tt<=0||et<=0)throw new Error("Invalid sampling factor, expected values above 0");I.componentsOrder.push(K),I.components[K]={h:tt,v:et,quantizationIdx:vt},k+=3}a(I),M.push(I);break;case 65476:var yt=n();for(Jt=2;Jt<yt;){var xt=m[k++],kt=new Uint8Array(16),Et=0;for(te=0;te<16;te++,k++)Et+=kt[te]=m[k];w(16+Et);var It=new Uint8Array(Et);for(te=0;te<Et;te++,k++)It[te]=m[k];Jt+=17+Et,(xt>>4?j:G)[15&xt]=l(kt,It)}break;case 65501:n(),N=n();break;case 65500:n(),n();break;case 65498:n();var zt=m[k++],Ut=[];for(Jt=0;Jt<zt;Jt++){ee=I.components[m[k++]];var Bt=m[k++];ee.huffmanTableDC=G[Bt>>4],ee.huffmanTableAC=j[15&Bt],Ut.push(ee)}var jt=m[k++],Wt=m[k++],Xt=m[k++],Yt=d(m,k,I,Ut,N,jt,Wt,Xt>>4,15&Xt,this.opts);k+=Yt;break;case 65535:255!==m[k]&&k--;break;default:if(255==m[k-3]&&m[k-2]>=192&&m[k-2]<=254){k-=3;break}if(224===H||225==H){if(-1!==V)throw new Error(`first unknown JPEG marker at offset ${V.toString(16)}, second unknown JPEG marker ${H.toString(16)} at offset ${(k-1).toString(16)}`);V=k-1;const g=n();if(255===m[k+g-2]){k+=g-2;break}}throw new Error("unknown JPEG marker "+H.toString(16))}H=n()}if(1!=M.length)throw new Error("only single frame JPEGs supported");for(var Jt=0;Jt<M.length;Jt++){var Kt=M[Jt].components;for(var te in Kt)Kt[te].quantizationTable=B[Kt[te].quantizationIdx],delete Kt[te].quantizationIdx}for(this.width=I.samplesPerLine,this.height=I.scanLines,this.jfif=O,this.adobe=U,this.components=[],Jt=0;Jt<I.componentsOrder.length;Jt++){var ee=I.components[I.componentsOrder[Jt]];this.components.push({lines:u(0,ee),scaleX:ee.h/I.maxH,scaleY:ee.v/I.maxV})}},getData:function(g,m){var y,k,I,N,P,z,O,U,B,M,j,G,H,V,$,q,Z,W,X,Y,J,K=this.width/g,Q=this.height/m,tt=0,et=g*m*this.components.length;w(et);var vt=new Uint8Array(et);switch(this.components.length){case 1:for(y=this.components[0],M=0;M<m;M++)for(P=y.lines[0|M*y.scaleY*Q],B=0;B<g;B++)j=P[0|B*y.scaleX*K],vt[tt++]=j;break;case 2:for(y=this.components[0],k=this.components[1],M=0;M<m;M++)for(P=y.lines[0|M*y.scaleY*Q],z=k.lines[0|M*k.scaleY*Q],B=0;B<g;B++)j=P[0|B*y.scaleX*K],vt[tt++]=j,j=z[0|B*k.scaleX*K],vt[tt++]=j;break;case 3:for(J=!0,this.adobe&&this.adobe.transformCode?J=!0:void 0!==this.opts.colorTransform&&(J=!!this.opts.colorTransform),y=this.components[0],k=this.components[1],I=this.components[2],M=0;M<m;M++)for(P=y.lines[0|M*y.scaleY*Q],z=k.lines[0|M*k.scaleY*Q],O=I.lines[0|M*I.scaleY*Q],B=0;B<g;B++)J?(j=P[0|B*y.scaleX*K],G=z[0|B*k.scaleX*K],W=c(j+1.402*((H=O[0|B*I.scaleX*K])-128)),X=c(j-.3441363*(G-128)-.71413636*(H-128)),Y=c(j+1.772*(G-128))):(W=P[0|B*y.scaleX*K],X=z[0|B*k.scaleX*K],Y=O[0|B*I.scaleX*K]),vt[tt++]=W,vt[tt++]=X,vt[tt++]=Y;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(J=!1,this.adobe&&this.adobe.transformCode?J=!0:void 0!==this.opts.colorTransform&&(J=!!this.opts.colorTransform),y=this.components[0],k=this.components[1],I=this.components[2],N=this.components[3],M=0;M<m;M++)for(P=y.lines[0|M*y.scaleY*Q],z=k.lines[0|M*k.scaleY*Q],O=I.lines[0|M*I.scaleY*Q],U=N.lines[0|M*N.scaleY*Q],B=0;B<g;B++)J?(j=P[0|B*y.scaleX*K],G=z[0|B*k.scaleX*K],H=O[0|B*I.scaleX*K],V=U[0|B*N.scaleX*K],$=255-c(j+1.402*(H-128)),q=255-c(j-.3441363*(G-128)-.71413636*(H-128)),Z=255-c(j+1.772*(G-128))):($=P[0|B*y.scaleX*K],q=z[0|B*k.scaleX*K],Z=O[0|B*I.scaleX*K],V=U[0|B*N.scaleX*K]),vt[tt++]=255-$,vt[tt++]=255-q,vt[tt++]=255-Z,vt[tt++]=255-V;break;default:throw new Error("Unsupported color mode")}return vt},copyToImageData:function(g,m){var y,k,I,N,P,z,O,U,B,M=g.width,j=g.height,G=g.data,H=this.getData(M,j),V=0,$=0;switch(this.components.length){case 1:for(k=0;k<j;k++)for(y=0;y<M;y++)I=H[V++],G[$++]=I,G[$++]=I,G[$++]=I,m&&(G[$++]=255);break;case 3:for(k=0;k<j;k++)for(y=0;y<M;y++)O=H[V++],U=H[V++],B=H[V++],G[$++]=O,G[$++]=U,G[$++]=B,m&&(G[$++]=255);break;case 4:for(k=0;k<j;k++)for(y=0;y<M;y++)P=H[V++],z=H[V++],I=H[V++],O=255-c(P*(1-(N=H[V++])/255)+N),U=255-c(z*(1-N/255)+N),B=255-c(I*(1-N/255)+N),G[$++]=O,G[$++]=U,G[$++]=B,m&&(G[$++]=255);break;default:throw new Error("Unsupported color mode")}}};var U=0,B=0;function w(g=0){var m=U+g;if(m>B){var y=Math.ceil((m-B)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${y}MB`)}U=m}return f.resetMaxMemoryUsage=function(g){U=0,B=g},f.getBytesAllocated=function(){return U},f.requestMemoryAllocation=w,f}(),xt.exports=function(g,m={}){var y={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...m},k=new Uint8Array(g),I=new kt;I.opts=y,kt.resetMaxMemoryUsage(1024*y.maxMemoryUsageInMB*1024),I.parse(k);var N=y.formatAsRGBA?4:3,P=I.width*I.height*N;try{kt.requestMemoryAllocation(P);var z={width:I.width,height:I.height,exifBuffer:I.exifBuffer,data:y.useTArray?new Uint8Array(P):Buffer.alloc(P)};I.comments.length>0&&(z.comments=I.comments)}catch(g){if(g instanceof RangeError)throw new Error("Could not allocate enough memory for the image. Required: "+P);if(g instanceof ReferenceError&&"Buffer is not defined"===g.message)throw new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true");throw g}return I.copyToImageData(z,y.formatAsRGBA),z};var It={encode:yt.exports,decode:Et.exports};const zt={decode(g){const m=It.decode(g,{useTArray:!0,colorTransform:!0});return{width:m.width,height:m.height,data:m.data}},encode(g,m){const y=It.encode(g,m.quality);return new Uint8Array(y.data)}};var Ut={};!function(g){var m="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(g,m){return Object.prototype.hasOwnProperty.call(g,m)}g.assign=function(g){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var y=m.shift();if(y){if("object"!=typeof y)throw new TypeError(y+"must be non-object");for(var k in y)r(y,k)&&(g[k]=y[k])}}return g},g.shrinkBuf=function(g,m){return g.length===m?g:g.subarray?g.subarray(0,m):(g.length=m,g)};var y={arraySet:function(g,m,y,k,I){if(m.subarray&&g.subarray)g.set(m.subarray(y,y+k),I);else for(var N=0;N<k;N++)g[I+N]=m[y+N]},flattenChunks:function(g){var m,y,k,I,N,P;for(k=0,m=0,y=g.length;m<y;m++)k+=g[m].length;for(P=new Uint8Array(k),I=0,m=0,y=g.length;m<y;m++)N=g[m],P.set(N,I),I+=N.length;return P}},k={arraySet:function(g,m,y,k,I){for(var N=0;N<k;N++)g[I+N]=m[y+N]},flattenChunks:function(g){return[].concat.apply([],g)}};g.setTyped=function(m){m?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,y)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,k))},g.setTyped(m)}(Ut);var Bt={},jt={},Wt={},Xt=Ut;function F(g){for(var m=g.length;--m>=0;)g[m]=0}var Yt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Jt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Kt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ee=new Array(576);F(ee);var ie=new Array(60);F(ie);var re=new Array(512);F(re);var ne=new Array(256);F(ne);var ae=new Array(29);F(ae);var he,le,fe,ce=new Array(30);function rt(g,m,y,k,I){this.static_tree=g,this.extra_bits=m,this.extra_base=y,this.elems=k,this.max_length=I,this.has_stree=g&&g.length}function it(g,m){this.dyn_tree=g,this.max_code=0,this.stat_desc=m}function nt(g){return g<256?re[g]:re[256+(g>>>7)]}function at(g,m){g.pending_buf[g.pending++]=255&m,g.pending_buf[g.pending++]=m>>>8&255}function st(g,m,y){g.bi_valid>16-y?(g.bi_buf|=m<<g.bi_valid&65535,at(g,g.bi_buf),g.bi_buf=m>>16-g.bi_valid,g.bi_valid+=y-16):(g.bi_buf|=m<<g.bi_valid&65535,g.bi_valid+=y)}function ot(g,m,y){st(g,y[2*m],y[2*m+1])}function ht(g,m){var y=0;do{y|=1&g,g>>>=1,y<<=1}while(--m>0);return y>>>1}function ft(g,m,y){var k,I,N=new Array(16),P=0;for(k=1;k<=15;k++)N[k]=P=P+y[k-1]<<1;for(I=0;I<=m;I++){var z=g[2*I+1];0!==z&&(g[2*I]=ht(N[z]++,z))}}function lt(g){var m;for(m=0;m<286;m++)g.dyn_ltree[2*m]=0;for(m=0;m<30;m++)g.dyn_dtree[2*m]=0;for(m=0;m<19;m++)g.bl_tree[2*m]=0;g.dyn_ltree[512]=1,g.opt_len=g.static_len=0,g.last_lit=g.matches=0}function dt(g){g.bi_valid>8?at(g,g.bi_buf):g.bi_valid>0&&(g.pending_buf[g.pending++]=g.bi_buf),g.bi_buf=0,g.bi_valid=0}function ut(g,m,y,k){var I=2*m,N=2*y;return g[I]<g[N]||g[I]===g[N]&&k[m]<=k[y]}function ct(g,m,y){for(var k=g.heap[y],I=y<<1;I<=g.heap_len&&(I<g.heap_len&&ut(m,g.heap[I+1],g.heap[I],g.depth)&&I++,!ut(m,k,g.heap[I],g.depth));)g.heap[y]=g.heap[I],y=I,I<<=1;g.heap[y]=k}function pt(g,m,y){var k,I,N,P,z=0;if(0!==g.last_lit)do{k=g.pending_buf[g.d_buf+2*z]<<8|g.pending_buf[g.d_buf+2*z+1],I=g.pending_buf[g.l_buf+z],z++,0===k?ot(g,I,m):(ot(g,(N=ne[I])+256+1,m),0!==(P=Yt[N])&&st(g,I-=ae[N],P),ot(g,N=nt(--k),y),0!==(P=Jt[N])&&st(g,k-=ce[N],P))}while(z<g.last_lit);ot(g,256,m)}function gt(g,m){var y,k,I,N=m.dyn_tree,P=m.stat_desc.static_tree,z=m.stat_desc.has_stree,O=m.stat_desc.elems,U=-1;for(g.heap_len=0,g.heap_max=573,y=0;y<O;y++)0!==N[2*y]?(g.heap[++g.heap_len]=U=y,g.depth[y]=0):N[2*y+1]=0;for(;g.heap_len<2;)N[2*(I=g.heap[++g.heap_len]=U<2?++U:0)]=1,g.depth[I]=0,g.opt_len--,z&&(g.static_len-=P[2*I+1]);for(m.max_code=U,y=g.heap_len>>1;y>=1;y--)ct(g,N,y);I=O;do{y=g.heap[1],g.heap[1]=g.heap[g.heap_len--],ct(g,N,1),k=g.heap[1],g.heap[--g.heap_max]=y,g.heap[--g.heap_max]=k,N[2*I]=N[2*y]+N[2*k],g.depth[I]=(g.depth[y]>=g.depth[k]?g.depth[y]:g.depth[k])+1,N[2*y+1]=N[2*k+1]=I,g.heap[1]=I++,ct(g,N,1)}while(g.heap_len>=2);g.heap[--g.heap_max]=g.heap[1],function(g,m){var y,k,I,N,P,z,O=m.dyn_tree,U=m.max_code,B=m.stat_desc.static_tree,M=m.stat_desc.has_stree,j=m.stat_desc.extra_bits,G=m.stat_desc.extra_base,H=m.stat_desc.max_length,V=0;for(N=0;N<=15;N++)g.bl_count[N]=0;for(O[2*g.heap[g.heap_max]+1]=0,y=g.heap_max+1;y<573;y++)(N=O[2*O[2*(k=g.heap[y])+1]+1]+1)>H&&(N=H,V++),O[2*k+1]=N,k>U||(g.bl_count[N]++,P=0,k>=G&&(P=j[k-G]),z=O[2*k],g.opt_len+=z*(N+P),M&&(g.static_len+=z*(B[2*k+1]+P)));if(0!==V){do{for(N=H-1;0===g.bl_count[N];)N--;g.bl_count[N]--,g.bl_count[N+1]+=2,g.bl_count[H]--,V-=2}while(V>0);for(N=H;0!==N;N--)for(k=g.bl_count[N];0!==k;)(I=g.heap[--y])>U||(O[2*I+1]!==N&&(g.opt_len+=(N-O[2*I+1])*O[2*I],O[2*I+1]=N),k--)}}(g,m),ft(N,U,g.bl_count)}function wt(g,m,y){var k,I,N=-1,P=m[1],z=0,O=7,U=4;for(0===P&&(O=138,U=3),m[2*(y+1)+1]=65535,k=0;k<=y;k++)I=P,P=m[2*(k+1)+1],++z<O&&I===P||(z<U?g.bl_tree[2*I]+=z:0!==I?(I!==N&&g.bl_tree[2*I]++,g.bl_tree[32]++):z<=10?g.bl_tree[34]++:g.bl_tree[36]++,z=0,N=I,0===P?(O=138,U=3):I===P?(O=6,U=3):(O=7,U=4))}function _t(g,m,y){var k,I,N=-1,P=m[1],z=0,O=7,U=4;for(0===P&&(O=138,U=3),k=0;k<=y;k++)if(I=P,P=m[2*(k+1)+1],!(++z<O&&I===P)){if(z<U)do{ot(g,I,g.bl_tree)}while(0!=--z);else 0!==I?(I!==N&&(ot(g,I,g.bl_tree),z--),ot(g,16,g.bl_tree),st(g,z-3,2)):z<=10?(ot(g,17,g.bl_tree),st(g,z-3,3)):(ot(g,18,g.bl_tree),st(g,z-11,7));z=0,N=I,0===P?(O=138,U=3):I===P?(O=6,U=3):(O=7,U=4)}}F(ce);var de=!1;function bt(g,m,y,k){st(g,0+(k?1:0),3),function(g,m,y){dt(g),at(g,y),at(g,~y),Xt.arraySet(g.pending_buf,g.window,m,y,g.pending),g.pending+=y}(g,m,y)}Wt._tr_init=function(g){de||(function(){var g,m,y,k,I,N=new Array(16);for(y=0,k=0;k<28;k++)for(ae[k]=y,g=0;g<1<<Yt[k];g++)ne[y++]=k;for(ne[y-1]=k,I=0,k=0;k<16;k++)for(ce[k]=I,g=0;g<1<<Jt[k];g++)re[I++]=k;for(I>>=7;k<30;k++)for(ce[k]=I<<7,g=0;g<1<<Jt[k]-7;g++)re[256+I++]=k;for(m=0;m<=15;m++)N[m]=0;for(g=0;g<=143;)ee[2*g+1]=8,g++,N[8]++;for(;g<=255;)ee[2*g+1]=9,g++,N[9]++;for(;g<=279;)ee[2*g+1]=7,g++,N[7]++;for(;g<=287;)ee[2*g+1]=8,g++,N[8]++;for(ft(ee,287,N),g=0;g<30;g++)ie[2*g+1]=5,ie[2*g]=ht(g,5);he=new rt(ee,Yt,257,286,15),le=new rt(ie,Jt,0,30,15),fe=new rt(new Array(0),Kt,0,19,7)}(),de=!0),g.l_desc=new it(g.dyn_ltree,he),g.d_desc=new it(g.dyn_dtree,le),g.bl_desc=new it(g.bl_tree,fe),g.bi_buf=0,g.bi_valid=0,lt(g)},Wt._tr_stored_block=bt,Wt._tr_flush_block=function(g,m,y,k){var I,N,P=0;g.level>0?(2===g.strm.data_type&&(g.strm.data_type=function(g){var m,y=4093624447;for(m=0;m<=31;m++,y>>>=1)if(1&y&&0!==g.dyn_ltree[2*m])return 0;if(0!==g.dyn_ltree[18]||0!==g.dyn_ltree[20]||0!==g.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==g.dyn_ltree[2*m])return 1;return 0}(g)),gt(g,g.l_desc),gt(g,g.d_desc),P=function(g){var m;for(wt(g,g.dyn_ltree,g.l_desc.max_code),wt(g,g.dyn_dtree,g.d_desc.max_code),gt(g,g.bl_desc),m=18;m>=3&&0===g.bl_tree[2*te[m]+1];m--);return g.opt_len+=3*(m+1)+5+5+4,m}(g),I=g.opt_len+3+7>>>3,(N=g.static_len+3+7>>>3)<=I&&(I=N)):I=N=y+5,y+4<=I&&-1!==m?bt(g,m,y,k):4===g.strategy||N===I?(st(g,2+(k?1:0),3),pt(g,ee,ie)):(st(g,4+(k?1:0),3),function(g,m,y,k){var I;for(st(g,m-257,5),st(g,y-1,5),st(g,k-4,4),I=0;I<k;I++)st(g,g.bl_tree[2*te[I]+1],3);_t(g,g.dyn_ltree,m-1),_t(g,g.dyn_dtree,y-1)}(g,g.l_desc.max_code+1,g.d_desc.max_code+1,P+1),pt(g,g.dyn_ltree,g.dyn_dtree)),lt(g),k&&dt(g)},Wt._tr_tally=function(g,m,y){return g.pending_buf[g.d_buf+2*g.last_lit]=m>>>8&255,g.pending_buf[g.d_buf+2*g.last_lit+1]=255&m,g.pending_buf[g.l_buf+g.last_lit]=255&y,g.last_lit++,0===m?g.dyn_ltree[2*y]++:(g.matches++,m--,g.dyn_ltree[2*(ne[y]+256+1)]++,g.dyn_dtree[2*nt(m)]++),g.last_lit===g.lit_bufsize-1},Wt._tr_align=function(g){st(g,2,3),ot(g,256,ee),function(g){16===g.bi_valid?(at(g,g.bi_buf),g.bi_buf=0,g.bi_valid=0):g.bi_valid>=8&&(g.pending_buf[g.pending++]=255&g.bi_buf,g.bi_buf>>=8,g.bi_valid-=8)}(g)};var ue,mt=function(g,m,y,k){for(var I=65535&g,N=g>>>16&65535,P=0;0!==y;){y-=P=y>2e3?2e3:y;do{N=N+(I=I+m[k++]|0)|0}while(--P);I%=65521,N%=65521}return I|N<<16},pe=function(){for(var g,m=[],y=0;y<256;y++){g=y;for(var k=0;k<8;k++)g=1&g?3988292384^g>>>1:g>>>1;m[y]=g}return m}(),At=function(g,m,y,k){var I=pe,N=k+y;g^=-1;for(var P=k;P<N;P++)g=g>>>8^I[255&(g^m[P])];return~g},ge={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},we=Ut,_e=Wt,Te=mt,Se=At,Ie=ge;function Pt(g,m){return g.msg=Ie[m],m}function Mt(g){return(g<<1)-(g>4?9:0)}function Rt(g){for(var m=g.length;--m>=0;)g[m]=0}function St(g){var m=g.state,y=m.pending;y>g.avail_out&&(y=g.avail_out),0!==y&&(we.arraySet(g.output,m.pending_buf,m.pending_out,y,g.next_out),g.next_out+=y,m.pending_out+=y,g.total_out+=y,g.avail_out-=y,m.pending-=y,0===m.pending&&(m.pending_out=0))}function Tt(g,m){_e._tr_flush_block(g,g.block_start>=0?g.block_start:-1,g.strstart-g.block_start,m),g.block_start=g.strstart,St(g.strm)}function Ct(g,m){g.pending_buf[g.pending++]=m}function Lt(g,m){g.pending_buf[g.pending++]=m>>>8&255,g.pending_buf[g.pending++]=255&m}function Dt(g,m){var y,k,I=g.max_chain_length,N=g.strstart,P=g.prev_length,z=g.nice_match,O=g.strstart>g.w_size-262?g.strstart-(g.w_size-262):0,U=g.window,B=g.w_mask,M=g.prev,j=g.strstart+258,G=U[N+P-1],H=U[N+P];g.prev_length>=g.good_match&&(I>>=2),z>g.lookahead&&(z=g.lookahead);do{if(U[(y=m)+P]===H&&U[y+P-1]===G&&U[y]===U[N]&&U[++y]===U[N+1]){N+=2,y++;do{}while(U[++N]===U[++y]&&U[++N]===U[++y]&&U[++N]===U[++y]&&U[++N]===U[++y]&&U[++N]===U[++y]&&U[++N]===U[++y]&&U[++N]===U[++y]&&U[++N]===U[++y]&&N<j);if(k=258-(j-N),N=j-258,k>P){if(g.match_start=m,P=k,k>=z)break;G=U[N+P-1],H=U[N+P]}}}while((m=M[m&B])>O&&0!=--I);return P<=g.lookahead?P:g.lookahead}function Ht(g){var m,y,k,I,N,P,z,O,U,B,M=g.w_size;do{if(I=g.window_size-g.lookahead-g.strstart,g.strstart>=M+(M-262)){we.arraySet(g.window,g.window,M,M,0),g.match_start-=M,g.strstart-=M,g.block_start-=M,m=y=g.hash_size;do{k=g.head[--m],g.head[m]=k>=M?k-M:0}while(--y);m=y=M;do{k=g.prev[--m],g.prev[m]=k>=M?k-M:0}while(--y);I+=M}if(0===g.strm.avail_in)break;if(P=g.strm,z=g.window,O=g.strstart+g.lookahead,U=I,B=void 0,(B=P.avail_in)>U&&(B=U),y=0===B?0:(P.avail_in-=B,we.arraySet(z,P.input,P.next_in,B,O),1===P.state.wrap?P.adler=Te(P.adler,z,B,O):2===P.state.wrap&&(P.adler=Se(P.adler,z,B,O)),P.next_in+=B,P.total_in+=B,B),g.lookahead+=y,g.lookahead+g.insert>=3)for(N=g.strstart-g.insert,g.ins_h=g.window[N],g.ins_h=(g.ins_h<<g.hash_shift^g.window[N+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[N+3-1])&g.hash_mask,g.prev[N&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=N,N++,g.insert--,!(g.lookahead+g.insert<3)););}while(g.lookahead<262&&0!==g.strm.avail_in)}function Nt(g,m){for(var y,k;;){if(g.lookahead<262){if(Ht(g),g.lookahead<262&&0===m)return 1;if(0===g.lookahead)break}if(y=0,g.lookahead>=3&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),0!==y&&g.strstart-y<=g.w_size-262&&(g.match_length=Dt(g,y)),g.match_length>=3)if(k=_e._tr_tally(g,g.strstart-g.match_start,g.match_length-3),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=3){g.match_length--;do{g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart}while(0!=--g.match_length);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else k=_e._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(k&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=g.strstart<2?g.strstart:2,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}function Gt(g,m){for(var y,k,I;;){if(g.lookahead<262){if(Ht(g),g.lookahead<262&&0===m)return 1;if(0===g.lookahead)break}if(y=0,g.lookahead>=3&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=2,0!==y&&g.prev_length<g.max_lazy_match&&g.strstart-y<=g.w_size-262&&(g.match_length=Dt(g,y),g.match_length<=5&&(1===g.strategy||3===g.match_length&&g.strstart-g.match_start>4096)&&(g.match_length=2)),g.prev_length>=3&&g.match_length<=g.prev_length){I=g.strstart+g.lookahead-3,k=_e._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-3),g.lookahead-=g.prev_length-1,g.prev_length-=2;do{++g.strstart<=I&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart)}while(0!=--g.prev_length);if(g.match_available=0,g.match_length=2,g.strstart++,k&&(Tt(g,!1),0===g.strm.avail_out))return 1}else if(g.match_available){if((k=_e._tr_tally(g,0,g.window[g.strstart-1]))&&Tt(g,!1),g.strstart++,g.lookahead--,0===g.strm.avail_out)return 1}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(k=_e._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<2?g.strstart:2,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}function Ot(g,m,y,k,I){this.good_length=g,this.max_lazy=m,this.nice_length=y,this.max_chain=k,this.func=I}function Ft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new we.Buf16(1146),this.dyn_dtree=new we.Buf16(122),this.bl_tree=new we.Buf16(78),Rt(this.dyn_ltree),Rt(this.dyn_dtree),Rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new we.Buf16(16),this.heap=new we.Buf16(573),Rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new we.Buf16(573),Rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zt(g){var m;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=2,(m=g.state).pending=0,m.pending_out=0,m.wrap<0&&(m.wrap=-m.wrap),m.status=m.wrap?42:113,g.adler=2===m.wrap?0:1,m.last_flush=0,_e._tr_init(m),0):Pt(g,-2)}function qt(g){var m,y=Zt(g);return 0===y&&((m=g.state).window_size=2*m.w_size,Rt(m.head),m.max_lazy_match=ue[m.level].max_lazy,m.good_match=ue[m.level].good_length,m.nice_match=ue[m.level].nice_length,m.max_chain_length=ue[m.level].max_chain,m.strstart=0,m.block_start=0,m.lookahead=0,m.insert=0,m.match_length=m.prev_length=2,m.match_available=0,m.ins_h=0),y}function Vt(g,m,y,k,I,N){if(!g)return-2;var P=1;if(-1===m&&(m=6),k<0?(P=0,k=-k):k>15&&(P=2,k-=16),I<1||I>9||8!==y||k<8||k>15||m<0||m>9||N<0||N>4)return Pt(g,-2);8===k&&(k=9);var z=new Ft;return g.state=z,z.strm=g,z.wrap=P,z.gzhead=null,z.w_bits=k,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=I+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+3-1)/3),z.window=new we.Buf8(2*z.w_size),z.head=new we.Buf16(z.hash_size),z.prev=new we.Buf16(z.w_size),z.lit_bufsize=1<<I+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new we.Buf8(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=m,z.strategy=N,z.method=y,qt(g)}ue=[new Ot(0,0,0,0,(function(g,m){var y=65535;for(y>g.pending_buf_size-5&&(y=g.pending_buf_size-5);;){if(g.lookahead<=1){if(Ht(g),0===g.lookahead&&0===m)return 1;if(0===g.lookahead)break}g.strstart+=g.lookahead,g.lookahead=0;var k=g.block_start+y;if((0===g.strstart||g.strstart>=k)&&(g.lookahead=g.strstart-k,g.strstart=k,Tt(g,!1),0===g.strm.avail_out))return 1;if(g.strstart-g.block_start>=g.w_size-262&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):(g.strstart>g.block_start&&(Tt(g,!1),g.strm.avail_out),1)})),new Ot(4,4,8,4,Nt),new Ot(4,5,16,8,Nt),new Ot(4,6,32,32,Nt),new Ot(4,4,16,16,Gt),new Ot(8,16,32,32,Gt),new Ot(8,16,128,128,Gt),new Ot(8,32,128,256,Gt),new Ot(32,128,258,1024,Gt),new Ot(32,258,258,4096,Gt)],jt.deflateInit=function(g,m){return Vt(g,m,8,15,8,0)},jt.deflateInit2=Vt,jt.deflateReset=qt,jt.deflateResetKeep=Zt,jt.deflateSetHeader=function(g,m){return g&&g.state?2!==g.state.wrap?-2:(g.state.gzhead=m,0):-2},jt.deflate=function(g,m){var y,k,I,N;if(!g||!g.state||m>5||m<0)return g?Pt(g,-2):-2;if(k=g.state,!g.output||!g.input&&0!==g.avail_in||666===k.status&&4!==m)return Pt(g,0===g.avail_out?-5:-2);if(k.strm=g,y=k.last_flush,k.last_flush=m,42===k.status)if(2===k.wrap)g.adler=0,Ct(k,31),Ct(k,139),Ct(k,8),k.gzhead?(Ct(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),Ct(k,255&k.gzhead.time),Ct(k,k.gzhead.time>>8&255),Ct(k,k.gzhead.time>>16&255),Ct(k,k.gzhead.time>>24&255),Ct(k,9===k.level?2:k.strategy>=2||k.level<2?4:0),Ct(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(Ct(k,255&k.gzhead.extra.length),Ct(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(g.adler=Se(g.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(Ct(k,0),Ct(k,0),Ct(k,0),Ct(k,0),Ct(k,0),Ct(k,9===k.level?2:k.strategy>=2||k.level<2?4:0),Ct(k,3),k.status=113);else{var P=8+(k.w_bits-8<<4)<<8;P|=(k.strategy>=2||k.level<2?0:k.level<6?1:6===k.level?2:3)<<6,0!==k.strstart&&(P|=32),P+=31-P%31,k.status=113,Lt(k,P),0!==k.strstart&&(Lt(k,g.adler>>>16),Lt(k,65535&g.adler)),g.adler=1}if(69===k.status)if(k.gzhead.extra){for(I=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>I&&(g.adler=Se(g.adler,k.pending_buf,k.pending-I,I)),St(g),I=k.pending,k.pending!==k.pending_buf_size));)Ct(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>I&&(g.adler=Se(g.adler,k.pending_buf,k.pending-I,I)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(73===k.status)if(k.gzhead.name){I=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>I&&(g.adler=Se(g.adler,k.pending_buf,k.pending-I,I)),St(g),I=k.pending,k.pending===k.pending_buf_size)){N=1;break}N=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,Ct(k,N)}while(0!==N);k.gzhead.hcrc&&k.pending>I&&(g.adler=Se(g.adler,k.pending_buf,k.pending-I,I)),0===N&&(k.gzindex=0,k.status=91)}else k.status=91;if(91===k.status)if(k.gzhead.comment){I=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>I&&(g.adler=Se(g.adler,k.pending_buf,k.pending-I,I)),St(g),I=k.pending,k.pending===k.pending_buf_size)){N=1;break}N=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,Ct(k,N)}while(0!==N);k.gzhead.hcrc&&k.pending>I&&(g.adler=Se(g.adler,k.pending_buf,k.pending-I,I)),0===N&&(k.status=103)}else k.status=103;if(103===k.status&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&St(g),k.pending+2<=k.pending_buf_size&&(Ct(k,255&g.adler),Ct(k,g.adler>>8&255),g.adler=0,k.status=113)):k.status=113),0!==k.pending){if(St(g),0===g.avail_out)return k.last_flush=-1,0}else if(0===g.avail_in&&Mt(m)<=Mt(y)&&4!==m)return Pt(g,-5);if(666===k.status&&0!==g.avail_in)return Pt(g,-5);if(0!==g.avail_in||0!==k.lookahead||0!==m&&666!==k.status){var z=2===k.strategy?function(g,m){for(var y;;){if(0===g.lookahead&&(Ht(g),0===g.lookahead)){if(0===m)return 1;break}if(g.match_length=0,y=_e._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++,y&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}(k,m):3===k.strategy?function(g,m){for(var y,k,I,N,P=g.window;;){if(g.lookahead<=258){if(Ht(g),g.lookahead<=258&&0===m)return 1;if(0===g.lookahead)break}if(g.match_length=0,g.lookahead>=3&&g.strstart>0&&(k=P[I=g.strstart-1])===P[++I]&&k===P[++I]&&k===P[++I]){N=g.strstart+258;do{}while(k===P[++I]&&k===P[++I]&&k===P[++I]&&k===P[++I]&&k===P[++I]&&k===P[++I]&&k===P[++I]&&k===P[++I]&&I<N);g.match_length=258-(N-I),g.match_length>g.lookahead&&(g.match_length=g.lookahead)}if(g.match_length>=3?(y=_e._tr_tally(g,1,g.match_length-3),g.lookahead-=g.match_length,g.strstart+=g.match_length,g.match_length=0):(y=_e._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++),y&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}(k,m):ue[k.level].func(k,m);if(3!==z&&4!==z||(k.status=666),1===z||3===z)return 0===g.avail_out&&(k.last_flush=-1),0;if(2===z&&(1===m?_e._tr_align(k):5!==m&&(_e._tr_stored_block(k,0,0,!1),3===m&&(Rt(k.head),0===k.lookahead&&(k.strstart=0,k.block_start=0,k.insert=0))),St(g),0===g.avail_out))return k.last_flush=-1,0}return 4!==m?0:k.wrap<=0?1:(2===k.wrap?(Ct(k,255&g.adler),Ct(k,g.adler>>8&255),Ct(k,g.adler>>16&255),Ct(k,g.adler>>24&255),Ct(k,255&g.total_in),Ct(k,g.total_in>>8&255),Ct(k,g.total_in>>16&255),Ct(k,g.total_in>>24&255)):(Lt(k,g.adler>>>16),Lt(k,65535&g.adler)),St(g),k.wrap>0&&(k.wrap=-k.wrap),0!==k.pending?0:1)},jt.deflateEnd=function(g){var m;return g&&g.state?42!==(m=g.state.status)&&69!==m&&73!==m&&91!==m&&103!==m&&113!==m&&666!==m?Pt(g,-2):(g.state=null,113===m?Pt(g,-3):0):-2},jt.deflateSetDictionary=function(g,m){var y,k,I,N,P,z,O,U,B=m.length;if(!g||!g.state)return-2;if(2===(N=(y=g.state).wrap)||1===N&&42!==y.status||y.lookahead)return-2;for(1===N&&(g.adler=Te(g.adler,m,B,0)),y.wrap=0,B>=y.w_size&&(0===N&&(Rt(y.head),y.strstart=0,y.block_start=0,y.insert=0),U=new we.Buf8(y.w_size),we.arraySet(U,m,B-y.w_size,y.w_size,0),m=U,B=y.w_size),P=g.avail_in,z=g.next_in,O=g.input,g.avail_in=B,g.next_in=0,g.input=m,Ht(y);y.lookahead>=3;){k=y.strstart,I=y.lookahead-2;do{y.ins_h=(y.ins_h<<y.hash_shift^y.window[k+3-1])&y.hash_mask,y.prev[k&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=k,k++}while(--I);y.strstart=k,y.lookahead=2,Ht(y)}return y.strstart+=y.lookahead,y.block_start=y.strstart,y.insert=y.lookahead,y.lookahead=0,y.match_length=y.prev_length=2,y.match_available=0,g.next_in=z,g.input=O,g.avail_in=P,y.wrap=N,0},jt.deflateInfo="pako deflate (from Nodeca project)";var Ne={},ze=Ut,Ce=!0,Le=!0;try{String.fromCharCode.apply(null,[0])}catch(M){Ce=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(M){Le=!1}for(var Fe=new ze.Buf8(256),Ue=0;Ue<256;Ue++)Fe[Ue]=Ue>=252?6:Ue>=248?5:Ue>=240?4:Ue>=224?3:Ue>=192?2:1;function $t(g,m){if(m<65534&&(g.subarray&&Le||!g.subarray&&Ce))return String.fromCharCode.apply(null,ze.shrinkBuf(g,m));for(var y="",k=0;k<m;k++)y+=String.fromCharCode(g[k]);return y}Fe[254]=Fe[254]=1,Ne.string2buf=function(g){var m,y,k,I,N,P=g.length,z=0;for(I=0;I<P;I++)55296==(64512&(y=g.charCodeAt(I)))&&I+1<P&&56320==(64512&(k=g.charCodeAt(I+1)))&&(y=65536+(y-55296<<10)+(k-56320),I++),z+=y<128?1:y<2048?2:y<65536?3:4;for(m=new ze.Buf8(z),N=0,I=0;N<z;I++)55296==(64512&(y=g.charCodeAt(I)))&&I+1<P&&56320==(64512&(k=g.charCodeAt(I+1)))&&(y=65536+(y-55296<<10)+(k-56320),I++),y<128?m[N++]=y:y<2048?(m[N++]=192|y>>>6,m[N++]=128|63&y):y<65536?(m[N++]=224|y>>>12,m[N++]=128|y>>>6&63,m[N++]=128|63&y):(m[N++]=240|y>>>18,m[N++]=128|y>>>12&63,m[N++]=128|y>>>6&63,m[N++]=128|63&y);return m},Ne.buf2binstring=function(g){return $t(g,g.length)},Ne.binstring2buf=function(g){for(var m=new ze.Buf8(g.length),y=0,k=m.length;y<k;y++)m[y]=g.charCodeAt(y);return m},Ne.buf2string=function(g,m){var y,k,I,N,P=m||g.length,z=new Array(2*P);for(k=0,y=0;y<P;)if((I=g[y++])<128)z[k++]=I;else if((N=Fe[I])>4)z[k++]=65533,y+=N-1;else{for(I&=2===N?31:3===N?15:7;N>1&&y<P;)I=I<<6|63&g[y++],N--;N>1?z[k++]=65533:I<65536?z[k++]=I:(I-=65536,z[k++]=55296|I>>10&1023,z[k++]=56320|1023&I)}return $t(z,k)},Ne.utf8border=function(g,m){var y;for((m=m||g.length)>g.length&&(m=g.length),y=m-1;y>=0&&128==(192&g[y]);)y--;return y<0||0===y?m:y+Fe[g[y]]>m?y:m};var Qt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Re=jt,Me=Ut,De=Ne,je=ge,Ve=Qt,$e=Object.prototype.toString;function se(g){if(!(this instanceof se))return new se(g);this.options=Me.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},g||{});var m=this.options;m.raw&&m.windowBits>0?m.windowBits=-m.windowBits:m.gzip&&m.windowBits>0&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ve,this.strm.avail_out=0;var y=Re.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if(0!==y)throw new Error(je[y]);if(m.header&&Re.deflateSetHeader(this.strm,m.header),m.dictionary){var k;if(k="string"==typeof m.dictionary?De.string2buf(m.dictionary):"[object ArrayBuffer]"===$e.call(m.dictionary)?new Uint8Array(m.dictionary):m.dictionary,0!==(y=Re.deflateSetDictionary(this.strm,k)))throw new Error(je[y]);this._dict_set=!0}}function oe(g,m){var y=new se(m);if(y.push(g,!0),y.err)throw y.msg||je[y.err];return y.result}se.prototype.push=function(g,m){var y,k,I=this.strm,N=this.options.chunkSize;if(this.ended)return!1;k=m===~~m?m:!0===m?4:0,"string"==typeof g?I.input=De.string2buf(g):"[object ArrayBuffer]"===$e.call(g)?I.input=new Uint8Array(g):I.input=g,I.next_in=0,I.avail_in=I.input.length;do{if(0===I.avail_out&&(I.output=new Me.Buf8(N),I.next_out=0,I.avail_out=N),1!==(y=Re.deflate(I,k))&&0!==y)return this.onEnd(y),this.ended=!0,!1;0!==I.avail_out&&(0!==I.avail_in||4!==k&&2!==k)||("string"===this.options.to?this.onData(De.buf2binstring(Me.shrinkBuf(I.output,I.next_out))):this.onData(Me.shrinkBuf(I.output,I.next_out)))}while((I.avail_in>0||0===I.avail_out)&&1!==y);return 4===k?(y=Re.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,0===y):2!==k||(this.onEnd(0),I.avail_out=0,!0)},se.prototype.onData=function(g){this.chunks.push(g)},se.prototype.onEnd=function(g){0===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Me.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},Bt.Deflate=se,Bt.deflate=oe,Bt.deflateRaw=function(g,m){return(m=m||{}).raw=!0,oe(g,m)},Bt.gzip=function(g,m){return(m=m||{}).gzip=!0,oe(g,m)};var qe={},Ze={},We=Ut,Xe=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ye=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Qe=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],ti=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],ei=Ut,ii=mt,ri=At,ve=function(g,m){var y,k,I,N,P,z,O,U,B,M,j,G,H,V,$,q,Z,W,X,Y,J,K,Q,tt,et;y=g.state,k=g.next_in,tt=g.input,I=k+(g.avail_in-5),N=g.next_out,et=g.output,P=N-(m-g.avail_out),z=N+(g.avail_out-257),O=y.dmax,U=y.wsize,B=y.whave,M=y.wnext,j=y.window,G=y.hold,H=y.bits,V=y.lencode,$=y.distcode,q=(1<<y.lenbits)-1,Z=(1<<y.distbits)-1;t:do{H<15&&(G+=tt[k++]<<H,H+=8,G+=tt[k++]<<H,H+=8),W=V[G&q];e:for(;;){if(G>>>=X=W>>>24,H-=X,0==(X=W>>>16&255))et[N++]=65535&W;else{if(!(16&X)){if(!(64&X)){W=V[(65535&W)+(G&(1<<X)-1)];continue e}if(32&X){y.mode=12;break t}g.msg="invalid literal/length code",y.mode=30;break t}Y=65535&W,(X&=15)&&(H<X&&(G+=tt[k++]<<H,H+=8),Y+=G&(1<<X)-1,G>>>=X,H-=X),H<15&&(G+=tt[k++]<<H,H+=8,G+=tt[k++]<<H,H+=8),W=$[G&Z];i:for(;;){if(G>>>=X=W>>>24,H-=X,!(16&(X=W>>>16&255))){if(!(64&X)){W=$[(65535&W)+(G&(1<<X)-1)];continue i}g.msg="invalid distance code",y.mode=30;break t}if(J=65535&W,H<(X&=15)&&(G+=tt[k++]<<H,(H+=8)<X&&(G+=tt[k++]<<H,H+=8)),(J+=G&(1<<X)-1)>O){g.msg="invalid distance too far back",y.mode=30;break t}if(G>>>=X,H-=X,J>(X=N-P)){if((X=J-X)>B&&y.sane){g.msg="invalid distance too far back",y.mode=30;break t}if(K=0,Q=j,0===M){if(K+=U-X,X<Y){Y-=X;do{et[N++]=j[K++]}while(--X);K=N-J,Q=et}}else if(M<X){if(K+=U+M-X,(X-=M)<Y){Y-=X;do{et[N++]=j[K++]}while(--X);if(K=0,M<Y){Y-=X=M;do{et[N++]=j[K++]}while(--X);K=N-J,Q=et}}}else if(K+=M-X,X<Y){Y-=X;do{et[N++]=j[K++]}while(--X);K=N-J,Q=et}for(;Y>2;)et[N++]=Q[K++],et[N++]=Q[K++],et[N++]=Q[K++],Y-=3;Y&&(et[N++]=Q[K++],Y>1&&(et[N++]=Q[K++]))}else{K=N-J;do{et[N++]=et[K++],et[N++]=et[K++],et[N++]=et[K++],Y-=3}while(Y>2);Y&&(et[N++]=et[K++],Y>1&&(et[N++]=et[K++]))}break}}break}}while(k<I&&N<z);k-=Y=H>>3,G&=(1<<(H-=Y<<3))-1,g.next_in=k,g.next_out=N,g.avail_in=k<I?I-k+5:5-(k-I),g.avail_out=N<z?z-N+257:257-(N-z),y.hold=G,y.bits=H},be=function(g,m,y,k,I,N,P,z){var O,U,B,M,j,G,H,V,$,q=z.bits,Z=0,W=0,X=0,Y=0,J=0,K=0,Q=0,tt=0,et=0,vt=0,yt=null,xt=0,kt=new We.Buf16(16),Et=new We.Buf16(16),It=null,zt=0;for(Z=0;Z<=15;Z++)kt[Z]=0;for(W=0;W<k;W++)kt[m[y+W]]++;for(J=q,Y=15;Y>=1&&0===kt[Y];Y--);if(J>Y&&(J=Y),0===Y)return I[N++]=20971520,I[N++]=20971520,z.bits=1,0;for(X=1;X<Y&&0===kt[X];X++);for(J<X&&(J=X),tt=1,Z=1;Z<=15;Z++)if(tt<<=1,(tt-=kt[Z])<0)return-1;if(tt>0&&(0===g||1!==Y))return-1;for(Et[1]=0,Z=1;Z<15;Z++)Et[Z+1]=Et[Z]+kt[Z];for(W=0;W<k;W++)0!==m[y+W]&&(P[Et[m[y+W]]++]=W);if(0===g?(yt=It=P,G=19):1===g?(yt=Xe,xt-=257,It=Ye,zt-=257,G=256):(yt=Qe,It=ti,G=-1),vt=0,W=0,Z=X,j=N,K=J,Q=0,B=-1,M=(et=1<<J)-1,1===g&&et>852||2===g&&et>592)return 1;for(;;){H=Z-Q,P[W]<G?(V=0,$=P[W]):P[W]>G?(V=It[zt+P[W]],$=yt[xt+P[W]]):(V=96,$=0),O=1<<Z-Q,X=U=1<<K;do{I[j+(vt>>Q)+(U-=O)]=H<<24|V<<16|$}while(0!==U);for(O=1<<Z-1;vt&O;)O>>=1;if(0!==O?(vt&=O-1,vt+=O):vt=0,W++,0==--kt[Z]){if(Z===Y)break;Z=m[y+P[W]]}if(Z>J&&(vt&M)!==B){for(0===Q&&(Q=J),j+=X,tt=1<<(K=Z-Q);K+Q<Y&&!((tt-=kt[K+Q])<=0);)K++,tt<<=1;if(et+=1<<K,1===g&&et>852||2===g&&et>592)return 1;I[B=vt&M]=J<<24|K<<16|j-N}}return 0!==vt&&(I[j+vt]=Z-Q<<24|64<<16),z.bits=J,0};function me(g){return(g>>>24&255)+(g>>>8&65280)+((65280&g)<<8)+((255&g)<<24)}function ye(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ei.Buf16(320),this.work=new ei.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ke(g){var m;return g&&g.state?(m=g.state,g.total_in=g.total_out=m.total=0,g.msg="",m.wrap&&(g.adler=1&m.wrap),m.mode=1,m.last=0,m.havedict=0,m.dmax=32768,m.head=null,m.hold=0,m.bits=0,m.lencode=m.lendyn=new ei.Buf32(852),m.distcode=m.distdyn=new ei.Buf32(592),m.sane=1,m.back=-1,0):-2}function Ae(g){var m;return g&&g.state?((m=g.state).wsize=0,m.whave=0,m.wnext=0,ke(g)):-2}function xe(g,m){var y,k;return g&&g.state?(k=g.state,m<0?(y=0,m=-m):(y=1+(m>>4),m<48&&(m&=15)),m&&(m<8||m>15)?-2:(null!==k.window&&k.wbits!==m&&(k.window=null),k.wrap=y,k.wbits=m,Ae(g))):-2}function Ee(g,m){var y,k;return g?(k=new ye,g.state=k,k.window=null,0!==(y=xe(g,m))&&(g.state=null),y):-2}var ni,si,ai=!0;function Be(g){if(ai){var m;for(ni=new ei.Buf32(512),si=new ei.Buf32(32),m=0;m<144;)g.lens[m++]=8;for(;m<256;)g.lens[m++]=9;for(;m<280;)g.lens[m++]=7;for(;m<288;)g.lens[m++]=8;for(be(1,g.lens,0,288,ni,0,g.work,{bits:9}),m=0;m<32;)g.lens[m++]=5;be(2,g.lens,0,32,si,0,g.work,{bits:5}),ai=!1}g.lencode=ni,g.lenbits=9,g.distcode=si,g.distbits=5}function Pe(g,m,y,k){var I,N=g.state;return null===N.window&&(N.wsize=1<<N.wbits,N.wnext=0,N.whave=0,N.window=new ei.Buf8(N.wsize)),k>=N.wsize?(ei.arraySet(N.window,m,y-N.wsize,N.wsize,0),N.wnext=0,N.whave=N.wsize):((I=N.wsize-N.wnext)>k&&(I=k),ei.arraySet(N.window,m,y-k,I,N.wnext),(k-=I)?(ei.arraySet(N.window,m,y-k,k,0),N.wnext=k,N.whave=N.wsize):(N.wnext+=I,N.wnext===N.wsize&&(N.wnext=0),N.whave<N.wsize&&(N.whave+=I))),0}Ze.inflateReset=Ae,Ze.inflateReset2=xe,Ze.inflateResetKeep=ke,Ze.inflateInit=function(g){return Ee(g,15)},Ze.inflateInit2=Ee,Ze.inflate=function(g,m){var y,k,I,N,P,z,O,U,B,M,j,G,H,V,$,q,Z,W,X,Y,J,K,Q,tt,et=0,vt=new ei.Buf8(4),yt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!g||!g.state||!g.output||!g.input&&0!==g.avail_in)return-2;12===(y=g.state).mode&&(y.mode=13),P=g.next_out,I=g.output,O=g.avail_out,N=g.next_in,k=g.input,z=g.avail_in,U=y.hold,B=y.bits,M=z,j=O,K=0;t:for(;;)switch(y.mode){case 1:if(0===y.wrap){y.mode=13;break}for(;B<16;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(2&y.wrap&&35615===U){y.check=0,vt[0]=255&U,vt[1]=U>>>8&255,y.check=ri(y.check,vt,2,0),U=0,B=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&U)<<8)+(U>>8))%31){g.msg="incorrect header check",y.mode=30;break}if(8!=(15&U)){g.msg="unknown compression method",y.mode=30;break}if(B-=4,J=8+(15&(U>>>=4)),0===y.wbits)y.wbits=J;else if(J>y.wbits){g.msg="invalid window size",y.mode=30;break}y.dmax=1<<J,g.adler=y.check=1,y.mode=512&U?10:12,U=0,B=0;break;case 2:for(;B<16;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(y.flags=U,8!=(255&y.flags)){g.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){g.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=U>>8&1),512&y.flags&&(vt[0]=255&U,vt[1]=U>>>8&255,y.check=ri(y.check,vt,2,0)),U=0,B=0,y.mode=3;case 3:for(;B<32;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}y.head&&(y.head.time=U),512&y.flags&&(vt[0]=255&U,vt[1]=U>>>8&255,vt[2]=U>>>16&255,vt[3]=U>>>24&255,y.check=ri(y.check,vt,4,0)),U=0,B=0,y.mode=4;case 4:for(;B<16;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}y.head&&(y.head.xflags=255&U,y.head.os=U>>8),512&y.flags&&(vt[0]=255&U,vt[1]=U>>>8&255,y.check=ri(y.check,vt,2,0)),U=0,B=0,y.mode=5;case 5:if(1024&y.flags){for(;B<16;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}y.length=U,y.head&&(y.head.extra_len=U),512&y.flags&&(vt[0]=255&U,vt[1]=U>>>8&255,y.check=ri(y.check,vt,2,0)),U=0,B=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&((G=y.length)>z&&(G=z),G&&(y.head&&(J=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),ei.arraySet(y.head.extra,k,N,G,J)),512&y.flags&&(y.check=ri(y.check,k,G,N)),z-=G,N+=G,y.length-=G),y.length))break t;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(0===z)break t;G=0;do{J=k[N+G++],y.head&&J&&y.length<65536&&(y.head.name+=String.fromCharCode(J))}while(J&&G<z);if(512&y.flags&&(y.check=ri(y.check,k,G,N)),z-=G,N+=G,J)break t}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(0===z)break t;G=0;do{J=k[N+G++],y.head&&J&&y.length<65536&&(y.head.comment+=String.fromCharCode(J))}while(J&&G<z);if(512&y.flags&&(y.check=ri(y.check,k,G,N)),z-=G,N+=G,J)break t}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;B<16;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(U!==(65535&y.check)){g.msg="header crc mismatch",y.mode=30;break}U=0,B=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),g.adler=y.check=0,y.mode=12;break;case 10:for(;B<32;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}g.adler=y.check=me(U),U=0,B=0,y.mode=11;case 11:if(0===y.havedict)return g.next_out=P,g.avail_out=O,g.next_in=N,g.avail_in=z,y.hold=U,y.bits=B,2;g.adler=y.check=1,y.mode=12;case 12:if(5===m||6===m)break t;case 13:if(y.last){U>>>=7&B,B-=7&B,y.mode=27;break}for(;B<3;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}switch(y.last=1&U,B-=1,3&(U>>>=1)){case 0:y.mode=14;break;case 1:if(Be(y),y.mode=20,6===m){U>>>=2,B-=2;break t}break;case 2:y.mode=17;break;case 3:g.msg="invalid block type",y.mode=30}U>>>=2,B-=2;break;case 14:for(U>>>=7&B,B-=7&B;B<32;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if((65535&U)!=(U>>>16^65535)){g.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&U,U=0,B=0,y.mode=15,6===m)break t;case 15:y.mode=16;case 16:if(G=y.length){if(G>z&&(G=z),G>O&&(G=O),0===G)break t;ei.arraySet(I,k,N,G,P),z-=G,N+=G,O-=G,P+=G,y.length-=G;break}y.mode=12;break;case 17:for(;B<14;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(y.nlen=257+(31&U),U>>>=5,B-=5,y.ndist=1+(31&U),U>>>=5,B-=5,y.ncode=4+(15&U),U>>>=4,B-=4,y.nlen>286||y.ndist>30){g.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;B<3;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}y.lens[yt[y.have++]]=7&U,U>>>=3,B-=3}for(;y.have<19;)y.lens[yt[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,Q={bits:y.lenbits},K=be(0,y.lens,0,19,y.lencode,0,y.work,Q),y.lenbits=Q.bits,K){g.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;q=(et=y.lencode[U&(1<<y.lenbits)-1])>>>16&255,Z=65535&et,!(($=et>>>24)<=B);){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(Z<16)U>>>=$,B-=$,y.lens[y.have++]=Z;else{if(16===Z){for(tt=$+2;B<tt;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(U>>>=$,B-=$,0===y.have){g.msg="invalid bit length repeat",y.mode=30;break}J=y.lens[y.have-1],G=3+(3&U),U>>>=2,B-=2}else if(17===Z){for(tt=$+3;B<tt;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}B-=$,J=0,G=3+(7&(U>>>=$)),U>>>=3,B-=3}else{for(tt=$+7;B<tt;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}B-=$,J=0,G=11+(127&(U>>>=$)),U>>>=7,B-=7}if(y.have+G>y.nlen+y.ndist){g.msg="invalid bit length repeat",y.mode=30;break}for(;G--;)y.lens[y.have++]=J}}if(30===y.mode)break;if(0===y.lens[256]){g.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,Q={bits:y.lenbits},K=be(1,y.lens,0,y.nlen,y.lencode,0,y.work,Q),y.lenbits=Q.bits,K){g.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,Q={bits:y.distbits},K=be(2,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,Q),y.distbits=Q.bits,K){g.msg="invalid distances set",y.mode=30;break}if(y.mode=20,6===m)break t;case 20:y.mode=21;case 21:if(z>=6&&O>=258){g.next_out=P,g.avail_out=O,g.next_in=N,g.avail_in=z,y.hold=U,y.bits=B,ve(g,j),P=g.next_out,I=g.output,O=g.avail_out,N=g.next_in,k=g.input,z=g.avail_in,U=y.hold,B=y.bits,12===y.mode&&(y.back=-1);break}for(y.back=0;q=(et=y.lencode[U&(1<<y.lenbits)-1])>>>16&255,Z=65535&et,!(($=et>>>24)<=B);){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(q&&!(240&q)){for(W=$,X=q,Y=Z;q=(et=y.lencode[Y+((U&(1<<W+X)-1)>>W)])>>>16&255,Z=65535&et,!(W+($=et>>>24)<=B);){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}U>>>=W,B-=W,y.back+=W}if(U>>>=$,B-=$,y.back+=$,y.length=Z,0===q){y.mode=26;break}if(32&q){y.back=-1,y.mode=12;break}if(64&q){g.msg="invalid literal/length code",y.mode=30;break}y.extra=15&q,y.mode=22;case 22:if(y.extra){for(tt=y.extra;B<tt;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}y.length+=U&(1<<y.extra)-1,U>>>=y.extra,B-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;q=(et=y.distcode[U&(1<<y.distbits)-1])>>>16&255,Z=65535&et,!(($=et>>>24)<=B);){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(!(240&q)){for(W=$,X=q,Y=Z;q=(et=y.distcode[Y+((U&(1<<W+X)-1)>>W)])>>>16&255,Z=65535&et,!(W+($=et>>>24)<=B);){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}U>>>=W,B-=W,y.back+=W}if(U>>>=$,B-=$,y.back+=$,64&q){g.msg="invalid distance code",y.mode=30;break}y.offset=Z,y.extra=15&q,y.mode=24;case 24:if(y.extra){for(tt=y.extra;B<tt;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}y.offset+=U&(1<<y.extra)-1,U>>>=y.extra,B-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){g.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(0===O)break t;if(G=j-O,y.offset>G){if((G=y.offset-G)>y.whave&&y.sane){g.msg="invalid distance too far back",y.mode=30;break}G>y.wnext?(G-=y.wnext,H=y.wsize-G):H=y.wnext-G,G>y.length&&(G=y.length),V=y.window}else V=I,H=P-y.offset,G=y.length;G>O&&(G=O),O-=G,y.length-=G;do{I[P++]=V[H++]}while(--G);0===y.length&&(y.mode=21);break;case 26:if(0===O)break t;I[P++]=y.length,O--,y.mode=21;break;case 27:if(y.wrap){for(;B<32;){if(0===z)break t;z--,U|=k[N++]<<B,B+=8}if(j-=O,g.total_out+=j,y.total+=j,j&&(g.adler=y.check=y.flags?ri(y.check,I,j,P-j):ii(y.check,I,j,P-j)),j=O,(y.flags?U:me(U))!==y.check){g.msg="incorrect data check",y.mode=30;break}U=0,B=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;B<32;){if(0===z)break t;z--,U+=k[N++]<<B,B+=8}if(U!==(4294967295&y.total)){g.msg="incorrect length check",y.mode=30;break}U=0,B=0}y.mode=29;case 29:K=1;break t;case 30:K=-3;break t;case 31:return-4;default:return-2}return g.next_out=P,g.avail_out=O,g.next_in=N,g.avail_in=z,y.hold=U,y.bits=B,(y.wsize||j!==g.avail_out&&y.mode<30&&(y.mode<27||4!==m))&&Pe(g,g.output,g.next_out,j-g.avail_out),M-=g.avail_in,j-=g.avail_out,g.total_in+=M,g.total_out+=j,y.total+=j,y.wrap&&j&&(g.adler=y.check=y.flags?ri(y.check,I,j,g.next_out-j):ii(y.check,I,j,g.next_out-j)),g.data_type=y.bits+(y.last?64:0)+(12===y.mode?128:0)+(20===y.mode||15===y.mode?256:0),(0===M&&0===j||4===m)&&0===K&&(K=-5),K},Ze.inflateEnd=function(g){if(!g||!g.state)return-2;var m=g.state;return m.window&&(m.window=null),g.state=null,0},Ze.inflateGetHeader=function(g,m){var y;return g&&g.state&&2&(y=g.state).wrap?(y.head=m,m.done=!1,0):-2},Ze.inflateSetDictionary=function(g,m){var y,k=m.length;return g&&g.state?0!==(y=g.state).wrap&&11!==y.mode?-2:11===y.mode&&ii(1,m,k,0)!==y.check?-3:Pe(g,m,k,k)?(y.mode=31,-4):(y.havedict=1,0):-2},Ze.inflateInfo="pako inflate (from Nodeca project)";var oi={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},hi=Ze,li=Ut,fi=Ne,ci=oi,di=ge,ui=Qt,He=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},pi=Object.prototype.toString;function Ge(g){if(!(this instanceof Ge))return new Ge(g);this.options=li.assign({chunkSize:16384,windowBits:0,to:""},g||{});var m=this.options;m.raw&&m.windowBits>=0&&m.windowBits<16&&(m.windowBits=-m.windowBits,0===m.windowBits&&(m.windowBits=-15)),!(m.windowBits>=0&&m.windowBits<16)||g&&g.windowBits||(m.windowBits+=32),m.windowBits>15&&m.windowBits<48&&!(15&m.windowBits)&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ui,this.strm.avail_out=0;var y=hi.inflateInit2(this.strm,m.windowBits);if(y!==ci.Z_OK)throw new Error(di[y]);if(this.header=new He,hi.inflateGetHeader(this.strm,this.header),m.dictionary&&("string"==typeof m.dictionary?m.dictionary=fi.string2buf(m.dictionary):"[object ArrayBuffer]"===pi.call(m.dictionary)&&(m.dictionary=new Uint8Array(m.dictionary)),m.raw&&(y=hi.inflateSetDictionary(this.strm,m.dictionary))!==ci.Z_OK))throw new Error(di[y])}function Oe(g,m){var y=new Ge(m);if(y.push(g,!0),y.err)throw y.msg||di[y.err];return y.result}Ge.prototype.push=function(g,m){var y,k,I,N,P,z=this.strm,O=this.options.chunkSize,U=this.options.dictionary,B=!1;if(this.ended)return!1;k=m===~~m?m:!0===m?ci.Z_FINISH:ci.Z_NO_FLUSH,"string"==typeof g?z.input=fi.binstring2buf(g):"[object ArrayBuffer]"===pi.call(g)?z.input=new Uint8Array(g):z.input=g,z.next_in=0,z.avail_in=z.input.length;do{if(0===z.avail_out&&(z.output=new li.Buf8(O),z.next_out=0,z.avail_out=O),(y=hi.inflate(z,ci.Z_NO_FLUSH))===ci.Z_NEED_DICT&&U&&(y=hi.inflateSetDictionary(this.strm,U)),y===ci.Z_BUF_ERROR&&!0===B&&(y=ci.Z_OK,B=!1),y!==ci.Z_STREAM_END&&y!==ci.Z_OK)return this.onEnd(y),this.ended=!0,!1;z.next_out&&(0!==z.avail_out&&y!==ci.Z_STREAM_END&&(0!==z.avail_in||k!==ci.Z_FINISH&&k!==ci.Z_SYNC_FLUSH)||("string"===this.options.to?(I=fi.utf8border(z.output,z.next_out),N=z.next_out-I,P=fi.buf2string(z.output,I),z.next_out=N,z.avail_out=O-N,N&&li.arraySet(z.output,z.output,I,N,0),this.onData(P)):this.onData(li.shrinkBuf(z.output,z.next_out)))),0===z.avail_in&&0===z.avail_out&&(B=!0)}while((z.avail_in>0||0===z.avail_out)&&y!==ci.Z_STREAM_END);return y===ci.Z_STREAM_END&&(k=ci.Z_FINISH),k===ci.Z_FINISH?(y=hi.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===ci.Z_OK):k!==ci.Z_SYNC_FLUSH||(this.onEnd(ci.Z_OK),z.avail_out=0,!0)},Ge.prototype.onData=function(g){this.chunks.push(g)},Ge.prototype.onEnd=function(g){g===ci.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=li.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},qe.Inflate=Ge,qe.inflate=Oe,qe.inflateRaw=function(g,m){return(m=m||{}).raw=!0,Oe(g,m)},qe.ungzip=Oe;var gi={};(0,Ut.assign)(gi,Bt,qe,oi);var mi,bi,vi,wi=gi,_i={toRGBA8:function(g){var m=g.width,y=g.height;if(null==g.tabs.acTL)return[_i.toRGBA8.decodeImage(g.data,m,y,g).buffer];var k=[];null==g.frames[0].data&&(g.frames[0].data=g.data);for(var I=m*y*4,N=new Uint8Array(I),P=new Uint8Array(I),z=new Uint8Array(I),O=0;O<g.frames.length;O++){var U=g.frames[O],B=U.rect.x,M=U.rect.y,j=U.rect.width,G=U.rect.height,H=_i.toRGBA8.decodeImage(U.data,j,G,g);if(0!=O)for(var V=0;V<I;V++)z[V]=N[V];if(0==U.blend?_i._copyTile(H,j,G,N,m,y,B,M,0):1==U.blend&&_i._copyTile(H,j,G,N,m,y,B,M,1),k.push(N.buffer.slice(0)),0==U.dispose);else if(1==U.dispose)_i._copyTile(P,j,G,N,m,y,B,M,0);else if(2==U.dispose)for(V=0;V<I;V++)N[V]=z[V]}return k}};_i.toRGBA8.decodeImage=function(g,m,y,k){var I=m*y,N=_i.decode._getBPP(k),P=Math.ceil(m*N/8),z=new Uint8Array(4*I),O=new Uint32Array(z.buffer),U=k.ctype,B=k.depth,M=_i._bin.readUshort;if(6==U){var j=I<<2;if(8==B)for(var G=0;G<j;G+=4)z[G]=g[G],z[G+1]=g[G+1],z[G+2]=g[G+2],z[G+3]=g[G+3];if(16==B)for(G=0;G<j;G++)z[G]=g[G<<1]}else if(2==U){var H=k.tabs.tRNS;if(null==H){if(8==B)for(G=0;G<I;G++){var V=3*G;O[G]=255<<24|g[V+2]<<16|g[V+1]<<8|g[V]}if(16==B)for(G=0;G<I;G++)V=6*G,O[G]=255<<24|g[V+4]<<16|g[V+2]<<8|g[V]}else{var $=H[0],q=H[1],Z=H[2];if(8==B)for(G=0;G<I;G++){var W=G<<2;V=3*G,O[G]=255<<24|g[V+2]<<16|g[V+1]<<8|g[V],g[V]==$&&g[V+1]==q&&g[V+2]==Z&&(z[W+3]=0)}if(16==B)for(G=0;G<I;G++)W=G<<2,V=6*G,O[G]=255<<24|g[V+4]<<16|g[V+2]<<8|g[V],M(g,V)==$&&M(g,V+2)==q&&M(g,V+4)==Z&&(z[W+3]=0)}}else if(3==U){var X=k.tabs.PLTE,Y=k.tabs.tRNS,J=Y?Y.length:0;if(1==B)for(var K=0;K<y;K++){var Q=K*P,tt=K*m;for(G=0;G<m;G++){W=tt+G<<2;var et=3*(vt=g[Q+(G>>3)]>>7-(7&G)&1);z[W]=X[et],z[W+1]=X[et+1],z[W+2]=X[et+2],z[W+3]=vt<J?Y[vt]:255}}if(2==B)for(K=0;K<y;K++)for(Q=K*P,tt=K*m,G=0;G<m;G++)W=tt+G<<2,et=3*(vt=g[Q+(G>>2)]>>6-((3&G)<<1)&3),z[W]=X[et],z[W+1]=X[et+1],z[W+2]=X[et+2],z[W+3]=vt<J?Y[vt]:255;if(4==B)for(K=0;K<y;K++)for(Q=K*P,tt=K*m,G=0;G<m;G++)W=tt+G<<2,et=3*(vt=g[Q+(G>>1)]>>4-((1&G)<<2)&15),z[W]=X[et],z[W+1]=X[et+1],z[W+2]=X[et+2],z[W+3]=vt<J?Y[vt]:255;if(8==B)for(G=0;G<I;G++){var vt;W=G<<2,et=3*(vt=g[G]),z[W]=X[et],z[W+1]=X[et+1],z[W+2]=X[et+2],z[W+3]=vt<J?Y[vt]:255}}else if(4==U){if(8==B)for(G=0;G<I;G++){W=G<<2;var yt=g[xt=G<<1];z[W]=yt,z[W+1]=yt,z[W+2]=yt,z[W+3]=g[xt+1]}if(16==B)for(G=0;G<I;G++){var xt;W=G<<2,yt=g[xt=G<<2],z[W]=yt,z[W+1]=yt,z[W+2]=yt,z[W+3]=g[xt+2]}}else if(0==U)for($=k.tabs.tRNS?k.tabs.tRNS:-1,K=0;K<y;K++){var kt=K*P,Et=K*m;if(1==B)for(var It=0;It<m;It++){var zt=(yt=255*(g[kt+(It>>>3)]>>>7-(7&It)&1))==255*$?0:255;O[Et+It]=zt<<24|yt<<16|yt<<8|yt}else if(2==B)for(It=0;It<m;It++)zt=(yt=85*(g[kt+(It>>>2)]>>>6-((3&It)<<1)&3))==85*$?0:255,O[Et+It]=zt<<24|yt<<16|yt<<8|yt;else if(4==B)for(It=0;It<m;It++)zt=(yt=17*(g[kt+(It>>>1)]>>>4-((1&It)<<2)&15))==17*$?0:255,O[Et+It]=zt<<24|yt<<16|yt<<8|yt;else if(8==B)for(It=0;It<m;It++)zt=(yt=g[kt+It])==$?0:255,O[Et+It]=zt<<24|yt<<16|yt<<8|yt;else if(16==B)for(It=0;It<m;It++)yt=g[kt+(It<<1)],zt=M(g,kt+(It<<G))==$?0:255,O[Et+It]=zt<<24|yt<<16|yt<<8|yt}return z},_i.decode=function(g){for(var m,y=new Uint8Array(g),k=8,I=_i._bin,N=I.readUshort,P=I.readUint,z={tabs:{},frames:[]},O=new Uint8Array(y.length),U=0,B=0,M=[137,80,78,71,13,10,26,10],j=0;j<8;j++)if(y[j]!=M[j])throw"The input is not a PNG file!";for(;k<y.length;){var G=I.readUint(y,k);k+=4;var H=I.readASCII(y,k,4);if(k+=4,"IHDR"==H)_i.decode._IHDR(y,k,z);else if("IDAT"==H){for(j=0;j<G;j++)O[U+j]=y[k+j];U+=G}else if("acTL"==H)z.tabs[H]={num_frames:P(y,k),num_plays:P(y,k+4)},m=new Uint8Array(y.length);else if("fcTL"==H){var V;0!=B&&((V=z.frames[z.frames.length-1]).data=_i.decode._decompress(z,m.slice(0,B),V.rect.width,V.rect.height),B=0);var $={x:P(y,k+12),y:P(y,k+16),width:P(y,k+4),height:P(y,k+8)},q=N(y,k+22);q=N(y,k+20)/(0==q?100:q);var Z={rect:$,delay:Math.round(1e3*q),dispose:y[k+24],blend:y[k+25]};z.frames.push(Z)}else if("fdAT"==H){for(j=0;j<G-4;j++)m[B+j]=y[k+j+4];B+=G-4}else if("pHYs"==H)z.tabs[H]=[I.readUint(y,k),I.readUint(y,k+4),y[k+8]];else if("cHRM"==H)for(z.tabs[H]=[],j=0;j<8;j++)z.tabs[H].push(I.readUint(y,k+4*j));else if("tEXt"==H){null==z.tabs[H]&&(z.tabs[H]={});var W=I.nextZero(y,k),X=I.readASCII(y,k,W-k),Y=I.readASCII(y,W+1,k+G-W-1);z.tabs[H][X]=Y}else if("iTXt"==H){null==z.tabs[H]&&(z.tabs[H]={}),W=0;var J=k;W=I.nextZero(y,J),X=I.readASCII(y,J,W-J),y[J=W+1],y[J+1],J+=2,W=I.nextZero(y,J),I.readASCII(y,J,W-J),J=W+1,W=I.nextZero(y,J),I.readUTF8(y,J,W-J),J=W+1,Y=I.readUTF8(y,J,G-(J-k)),z.tabs[H][X]=Y}else if("PLTE"==H)z.tabs[H]=I.readBytes(y,k,G);else if("hIST"==H){var K=z.tabs.PLTE.length/3;for(z.tabs[H]=[],j=0;j<K;j++)z.tabs[H].push(N(y,k+2*j))}else if("tRNS"==H)3==z.ctype?z.tabs[H]=I.readBytes(y,k,G):0==z.ctype?z.tabs[H]=N(y,k):2==z.ctype&&(z.tabs[H]=[N(y,k),N(y,k+2),N(y,k+4)]);else if("gAMA"==H)z.tabs[H]=I.readUint(y,k)/1e5;else if("sRGB"==H)z.tabs[H]=y[k];else if("bKGD"==H)0==z.ctype||4==z.ctype?z.tabs[H]=[N(y,k)]:2==z.ctype||6==z.ctype?z.tabs[H]=[N(y,k),N(y,k+2),N(y,k+4)]:3==z.ctype&&(z.tabs[H]=y[k]);else if("IEND"==H)break;k+=G,I.readUint(y,k),k+=4}return 0!=B&&((V=z.frames[z.frames.length-1]).data=_i.decode._decompress(z,m.slice(0,B),V.rect.width,V.rect.height),B=0),z.data=_i.decode._decompress(z,O,z.width,z.height),delete z.compress,delete z.interlace,delete z.filter,z},_i.decode._decompress=function(g,m,y,k){var I=_i.decode._getBPP(g),N=Math.ceil(y*I/8),P=new Uint8Array((N+1+g.interlace)*k);return m=_i.decode._inflate(m,P),0==g.interlace?m=_i.decode._filterZero(m,g,0,y,k):1==g.interlace&&(m=_i.decode._readInterlace(m,g)),m},_i.decode._inflate=function(g,m){return _i.inflateRaw(new Uint8Array(g.buffer,2,g.length-6),m)},_i.inflateRaw=((vi={}).H={},vi.H.N=function(g,m){var y,k,I=Uint8Array,N=0,P=0,z=0,O=0,U=0,B=0,M=0,j=0,G=0;if(3==g[0]&&0==g[1])return m||new I(0);var H=vi.H,V=H.b,$=H.e,q=H.R,Z=H.n,W=H.A,X=H.Z,Y=H.m,J=null==m;for(J&&(m=new I(g.length>>>2<<3));0==N;)if(N=V(g,G,1),P=V(g,G+1,2),G+=3,0!=P){if(J&&(m=vi.H.W(m,j+(1<<17))),1==P&&(y=Y.J,k=Y.h,B=511,M=31),2==P){z=$(g,G,5)+257,O=$(g,G+5,5)+1,U=$(g,G+10,4)+4,G+=14;for(var K=1,Q=0;Q<38;Q+=2)Y.Q[Q]=0,Y.Q[Q+1]=0;for(Q=0;Q<U;Q++){var tt=$(g,G+3*Q,3);Y.Q[1+(Y.X[Q]<<1)]=tt,tt>K&&(K=tt)}G+=3*U,Z(Y.Q,K),W(Y.Q,K,Y.u),y=Y.w,k=Y.d,G=q(Y.u,(1<<K)-1,z+O,g,G,Y.v);var et=H.V(Y.v,0,z,Y.C);B=(1<<et)-1;var vt=H.V(Y.v,z,O,Y.D);M=(1<<vt)-1,Z(Y.C,et),W(Y.C,et,y),Z(Y.D,vt),W(Y.D,vt,k)}for(;;){var yt=y[X(g,G)&B];G+=15&yt;var xt=yt>>>4;if(xt>>>8==0)m[j++]=xt;else{if(256==xt)break;var kt=j+xt-254;if(xt>264){var Et=Y.q[xt-257];kt=j+(Et>>>3)+$(g,G,7&Et),G+=7&Et}var It=k[X(g,G)&M];G+=15&It;var zt=It>>>4,Ut=Y.c[zt],Bt=(Ut>>>4)+V(g,G,15&Ut);for(G+=15&Ut;j<kt;)m[j]=m[j++-Bt],m[j]=m[j++-Bt],m[j]=m[j++-Bt],m[j]=m[j++-Bt];j=kt}}}else{7&G&&(G+=8-(7&G));var jt=4+(G>>>3),Wt=g[jt-4]|g[jt-3]<<8;J&&(m=vi.H.W(m,j+Wt)),m.set(new I(g.buffer,g.byteOffset+jt,Wt),j),G=jt+Wt<<3,j+=Wt}return m.length==j?m:m.slice(0,j)},vi.H.W=function(g,m){var y=g.length;if(m<=y)return g;var k=new Uint8Array(y<<1);return k.set(g,0),k},vi.H.R=function(g,m,y,k,I,N){for(var P=vi.H.e,z=vi.H.Z,O=0;O<y;){var U=g[z(k,I)&m];I+=15&U;var B=U>>>4;if(B<=15)N[O]=B,O++;else{var M=0,j=0;16==B?(j=3+P(k,I,2),I+=2,M=N[O-1]):17==B?(j=3+P(k,I,3),I+=3):18==B&&(j=11+P(k,I,7),I+=7);for(var G=O+j;O<G;)N[O]=M,O++}}return I},vi.H.V=function(g,m,y,k){for(var I=0,N=0,P=k.length>>>1;N<y;){var z=g[N+m];k[N<<1]=0,k[1+(N<<1)]=z,z>I&&(I=z),N++}for(;N<P;)k[N<<1]=0,k[1+(N<<1)]=0,N++;return I},vi.H.n=function(g,m){for(var y,k,I,N,P=vi.H.m,z=g.length,O=P.j,U=0;U<=m;U++)O[U]=0;for(U=1;U<z;U+=2)O[g[U]]++;var B=P.K;for(y=0,O[0]=0,k=1;k<=m;k++)y=y+O[k-1]<<1,B[k]=y;for(I=0;I<z;I+=2)0!=(N=g[I+1])&&(g[I]=B[N],B[N]++)},vi.H.A=function(g,m,y){for(var k=g.length,I=vi.H.m.r,N=0;N<k;N+=2)if(0!=g[N+1])for(var P=N>>1,z=g[N+1],O=P<<4|z,U=m-z,B=g[N]<<U,M=B+(1<<U);B!=M;)y[I[B]>>>15-m]=O,B++},vi.H.l=function(g,m){for(var y=vi.H.m.r,k=15-m,I=0;I<g.length;I+=2){var N=g[I]<<m-g[I+1];g[I]=y[N]>>>k}},vi.H.M=function(g,m,y){y<<=7&m;var k=m>>>3;g[k]|=y,g[k+1]|=y>>>8},vi.H.I=function(g,m,y){y<<=7&m;var k=m>>>3;g[k]|=y,g[k+1]|=y>>>8,g[k+2]|=y>>>16},vi.H.e=function(g,m,y){return(g[m>>>3]|g[1+(m>>>3)]<<8)>>>(7&m)&(1<<y)-1},vi.H.b=function(g,m,y){return(g[m>>>3]|g[1+(m>>>3)]<<8|g[2+(m>>>3)]<<16)>>>(7&m)&(1<<y)-1},vi.H.Z=function(g,m){return(g[m>>>3]|g[1+(m>>>3)]<<8|g[2+(m>>>3)]<<16)>>>(7&m)},vi.H.i=function(g,m){return(g[m>>>3]|g[1+(m>>>3)]<<8|g[2+(m>>>3)]<<16|g[3+(m>>>3)]<<24)>>>(7&m)},vi.H.m=(mi=Uint16Array,bi=Uint32Array,{K:new mi(16),j:new mi(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new mi(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new bi(32),J:new mi(512),_:[],h:new mi(32),$:[],w:new mi(32768),C:[],v:[],d:new mi(32768),D:[],u:new mi(512),Q:[],r:new mi(32768),s:new bi(286),Y:new bi(30),a:new bi(19),t:new bi(15e3),k:new mi(65536),g:new mi(32768)}),function(){for(var g=vi.H.m,m=0;m<32768;m++){var y=m;y=(4278255360&(y=(4042322160&(y=(3435973836&(y=(2863311530&y)>>>1|(1431655765&y)<<1))>>>2|(858993459&y)<<2))>>>4|(252645135&y)<<4))>>>8|(16711935&y)<<8,g.r[m]=(y>>>16|y<<16)>>>17}function i(g,m,y){for(;0!=m--;)g.push(0,y)}for(m=0;m<32;m++)g.q[m]=g.S[m]<<3|g.T[m],g.c[m]=g.p[m]<<4|g.z[m];i(g._,144,8),i(g._,112,9),i(g._,24,7),i(g._,8,8),vi.H.n(g._,9),vi.H.A(g._,9,g.J),vi.H.l(g._,9),i(g.$,32,5),vi.H.n(g.$,5),vi.H.A(g.$,5,g.h),vi.H.l(g.$,5),i(g.Q,19,0),i(g.C,286,0),i(g.D,30,0),i(g.v,320,0)}(),vi.H.N),_i.decode._readInterlace=function(g,m){for(var y=m.width,k=m.height,I=_i.decode._getBPP(m),N=I>>3,P=Math.ceil(y*I/8),z=new Uint8Array(k*P),O=0,U=[0,0,4,0,2,0,1],B=[0,4,0,2,0,1,0],M=[8,8,8,4,4,2,2],j=[8,8,4,4,2,2,1],G=0;G<7;){for(var H=M[G],V=j[G],$=0,q=0,Z=U[G];Z<k;)Z+=H,q++;for(var W=B[G];W<y;)W+=V,$++;var X=Math.ceil($*I/8);_i.decode._filterZero(g,m,O,$,q);for(var Y=0,J=U[G];J<k;){for(var K=B[G],Q=O+Y*X<<3;K<y;){var tt;if(1==I&&(tt=(tt=g[Q>>3])>>7-(7&Q)&1,z[J*P+(K>>3)]|=tt<<7-(7&K)),2==I&&(tt=(tt=g[Q>>3])>>6-(7&Q)&3,z[J*P+(K>>2)]|=tt<<6-((3&K)<<1)),4==I&&(tt=(tt=g[Q>>3])>>4-(7&Q)&15,z[J*P+(K>>1)]|=tt<<4-((1&K)<<2)),I>=8)for(var et=J*P+K*N,vt=0;vt<N;vt++)z[et+vt]=g[(Q>>3)+vt];Q+=I,K+=V}Y++,J+=H}$*q!=0&&(O+=q*(1+X)),G+=1}return z},_i.decode._getBPP=function(g){return[1,null,3,1,2,null,4][g.ctype]*g.depth},_i.decode._filterZero=function(g,m,y,k,I){var N=_i.decode._getBPP(m),P=Math.ceil(k*N/8),z=_i.decode._paeth;N=Math.ceil(N/8);var O=0,U=1,B=g[y],M=0;if(B>1&&(g[y]=[0,0,1][B-2]),3==B)for(M=N;M<P;M++)g[M+1]=g[M+1]+(g[M+1-N]>>>1)&255;for(var j=0;j<I;j++)if(M=0,0==(B=g[(U=(O=y+j*P)+j+1)-1]))for(;M<P;M++)g[O+M]=g[U+M];else if(1==B){for(;M<N;M++)g[O+M]=g[U+M];for(;M<P;M++)g[O+M]=g[U+M]+g[O+M-N]}else if(2==B)for(;M<P;M++)g[O+M]=g[U+M]+g[O+M-P];else if(3==B){for(;M<N;M++)g[O+M]=g[U+M]+(g[O+M-P]>>>1);for(;M<P;M++)g[O+M]=g[U+M]+(g[O+M-P]+g[O+M-N]>>>1)}else{for(;M<N;M++)g[O+M]=g[U+M]+z(0,g[O+M-P],0);for(;M<P;M++)g[O+M]=g[U+M]+z(g[O+M-N],g[O+M-P],g[O+M-N-P])}return g},_i.decode._paeth=function(g,m,y){var k=g+m-y,I=k-g,N=k-m,P=k-y;return I*I<=N*N&&I*I<=P*P?g:N*N<=P*P?m:y},_i.decode._IHDR=function(g,m,y){var k=_i._bin;y.width=k.readUint(g,m),m+=4,y.height=k.readUint(g,m),m+=4,y.depth=g[m],m++,y.ctype=g[m],m++,y.compress=g[m],m++,y.filter=g[m],m++,y.interlace=g[m],m++},_i._bin={nextZero:function(g,m){for(;0!=g[m];)m++;return m},readUshort:function(g,m){return g[m]<<8|g[m+1]},writeUshort:function(g,m,y){g[m]=y>>8&255,g[m+1]=255&y},readUint:function(g,m){return 16777216*g[m]+(g[m+1]<<16|g[m+2]<<8|g[m+3])},writeUint:function(g,m,y){g[m]=y>>24&255,g[m+1]=y>>16&255,g[m+2]=y>>8&255,g[m+3]=255&y},readASCII:function(g,m,y){for(var k="",I=0;I<y;I++)k+=String.fromCharCode(g[m+I]);return k},writeASCII:function(g,m,y){for(var k=0;k<y.length;k++)g[m+k]=y.charCodeAt(k)},readBytes:function(g,m,y){for(var k=[],I=0;I<y;I++)k.push(g[m+I]);return k},pad:function(g){return g.length<2?"0"+g:g},readUTF8:function(g,m,y){for(var k,I="",N=0;N<y;N++)I+="%"+_i._bin.pad(g[m+N].toString(16));try{k=decodeURIComponent(I)}catch(k){return _i._bin.readASCII(g,m,y)}return k}},_i._copyTile=function(g,m,y,k,I,N,P,z,O){for(var U=Math.min(m,I),B=Math.min(y,N),M=0,j=0,G=0;G<B;G++)for(var H=0;H<U;H++)if(P>=0&&z>=0?(M=G*m+H<<2,j=(z+G)*I+P+H<<2):(M=(-z+G)*m-P+H<<2,j=G*I+H<<2),0==O)k[j]=g[M],k[j+1]=g[M+1],k[j+2]=g[M+2],k[j+3]=g[M+3];else if(1==O){var V=g[M+3]*(1/255),$=g[M]*V,q=g[M+1]*V,Z=g[M+2]*V,W=k[j+3]*(1/255),X=k[j]*W,Y=k[j+1]*W,J=k[j+2]*W,K=1-V,Q=V+W*K,tt=0==Q?0:1/Q;k[j+3]=255*Q,k[j+0]=($+X*K)*tt,k[j+1]=(q+Y*K)*tt,k[j+2]=(Z+J*K)*tt}else if(2==O)V=g[M+3],$=g[M],q=g[M+1],Z=g[M+2],W=k[j+3],X=k[j],Y=k[j+1],J=k[j+2],V==W&&$==X&&q==Y&&Z==J?(k[j]=0,k[j+1]=0,k[j+2]=0,k[j+3]=0):(k[j]=$,k[j+1]=q,k[j+2]=Z,k[j+3]=V);else if(3==O){if(V=g[M+3],$=g[M],q=g[M+1],Z=g[M+2],W=k[j+3],X=k[j],Y=k[j+1],J=k[j+2],V==W&&$==X&&q==Y&&Z==J)continue;if(V<220&&W>20)return!1}return!0},_i.encode=function(g,m,y,k,I,N,P){null==k&&(k=0),null==P&&(P=!1);var z=_i.encode.compress(g,m,y,k,[!1,!1,!1,0,P]);return _i.encode.compressPNG(z,-1),_i.encode._main(z,m,y,I,N)},_i.encodeLL=function(g,m,y,k,I,N,P,z){for(var O={ctype:0+(1==k?0:2)+(0==I?0:4),depth:N,frames:[]},U=(k+I)*N,B=U*m,M=0;M<g.length;M++)O.frames.push({rect:{x:0,y:0,width:m,height:y},img:new Uint8Array(g[M]),blend:0,dispose:1,bpp:Math.ceil(U/8),bpl:Math.ceil(B/8)});return _i.encode.compressPNG(O,0,!0),_i.encode._main(O,m,y,P,z)},_i.encode._main=function(g,m,y,k,I){null==I&&(I={});var N=_i.crc.crc,P=_i._bin.writeUint,z=_i._bin.writeUshort,O=_i._bin.writeASCII,U=8,B=g.frames.length>1,M=!1,j=33+(B?20:0);if(null!=I.sRGB&&(j+=13),null!=I.pHYs&&(j+=21),3==g.ctype){for(var G=g.plte.length,H=0;H<G;H++)g.plte[H]>>>24!=255&&(M=!0);j+=8+3*G+4+(M?8+1*G+4:0)}for(var V=0;V<g.frames.length;V++)B&&(j+=38),j+=(Q=g.frames[V]).cimg.length+12,0!=V&&(j+=4);j+=12;var $=new Uint8Array(j),q=[137,80,78,71,13,10,26,10];for(H=0;H<8;H++)$[H]=q[H];if(P($,U,13),O($,U+=4,"IHDR"),P($,U+=4,m),P($,U+=4,y),$[U+=4]=g.depth,$[++U]=g.ctype,$[++U]=0,$[++U]=0,$[++U]=0,P($,++U,N($,U-17,17)),U+=4,null!=I.sRGB&&(P($,U,1),O($,U+=4,"sRGB"),$[U+=4]=I.sRGB,P($,++U,N($,U-5,5)),U+=4),null!=I.pHYs&&(P($,U,9),O($,U+=4,"pHYs"),P($,U+=4,I.pHYs[0]),P($,U+=4,I.pHYs[1]),$[U+=4]=I.pHYs[2],P($,++U,N($,U-13,13)),U+=4),B&&(P($,U,8),O($,U+=4,"acTL"),P($,U+=4,g.frames.length),P($,U+=4,null!=I.loop?I.loop:0),P($,U+=4,N($,U-12,12)),U+=4),3==g.ctype){for(P($,U,3*(G=g.plte.length)),O($,U+=4,"PLTE"),U+=4,H=0;H<G;H++){var Z=3*H,W=g.plte[H],X=255&W,Y=W>>>8&255,J=W>>>16&255;$[U+Z+0]=X,$[U+Z+1]=Y,$[U+Z+2]=J}if(P($,U+=3*G,N($,U-3*G-4,3*G+4)),U+=4,M){for(P($,U,G),O($,U+=4,"tRNS"),U+=4,H=0;H<G;H++)$[U+H]=g.plte[H]>>>24&255;P($,U+=G,N($,U-G-4,G+4)),U+=4}}var K=0;for(V=0;V<g.frames.length;V++){var Q=g.frames[V];B&&(P($,U,26),O($,U+=4,"fcTL"),P($,U+=4,K++),P($,U+=4,Q.rect.width),P($,U+=4,Q.rect.height),P($,U+=4,Q.rect.x),P($,U+=4,Q.rect.y),z($,U+=4,k[V]),z($,U+=2,1e3),$[U+=2]=Q.dispose,$[++U]=Q.blend,P($,++U,N($,U-30,30)),U+=4);var tt=Q.cimg;P($,U,(G=tt.length)+(0==V?0:4));var et=U+=4;O($,U,0==V?"IDAT":"fdAT"),U+=4,0!=V&&(P($,U,K++),U+=4),$.set(tt,U),P($,U+=G,N($,et,U-et)),U+=4}return P($,U,0),O($,U+=4,"IEND"),P($,U+=4,N($,U-4,4)),U+=4,$.buffer},_i.encode.compressPNG=function(g,m,y){for(var k=0;k<g.frames.length;k++){var I=g.frames[k];I.rect.width;var N=I.rect.height,P=new Uint8Array(N*I.bpl+N);I.cimg=_i.encode._filterZero(I.img,N,I.bpp,I.bpl,P,m,y)}},_i.encode.compress=function(g,m,y,k,I){for(var N=I[0],P=I[1],z=I[2],O=I[3],U=I[4],B=6,M=8,j=255,G=0;G<g.length;G++)for(var H=new Uint8Array(g[G]),V=H.length,$=0;$<V;$+=4)j&=H[$+3];var q=255!=j,Z=_i.encode.framize(g,m,y,N,P,z),W={},X=[],Y=[];if(0!=k){var J=[];for($=0;$<Z.length;$++)J.push(Z[$].img.buffer);var K=_i.encode.concatRGBA(J),Q=_i.quantize(K,k),tt=0,et=new Uint8Array(Q.abuf);for($=0;$<Z.length;$++){var vt=(re=Z[$].img).length;for(Y.push(new Uint8Array(Q.inds.buffer,tt>>2,vt>>2)),G=0;G<vt;G+=4)re[G]=et[tt+G],re[G+1]=et[tt+G+1],re[G+2]=et[tt+G+2],re[G+3]=et[tt+G+3];tt+=vt}for($=0;$<Q.plte.length;$++)X.push(Q.plte[$].est.rgba)}else for(G=0;G<Z.length;G++){var yt=Z[G],xt=new Uint32Array(yt.img.buffer),kt=yt.rect.width,Et=(V=xt.length,new Uint8Array(V));for(Y.push(Et),$=0;$<V;$++){var It=xt[$];if(0!=$&&It==xt[$-1])Et[$]=Et[$-1];else if($>kt&&It==xt[$-kt])Et[$]=Et[$-kt];else{var zt=W[It];if(null==zt&&(W[It]=zt=X.length,X.push(It),X.length>=300))break;Et[$]=zt}}}var Ut=X.length;for(Ut<=256&&0==U&&(M=Ut<=2?1:Ut<=4?2:Ut<=16?4:8,M=Math.max(M,O)),G=0;G<Z.length;G++){(yt=Z[G]).rect.x,yt.rect.y,kt=yt.rect.width;var Bt=yt.rect.height,jt=yt.img;new Uint32Array(jt.buffer);var Wt=4*kt,Xt=4;if(Ut<=256&&0==U){Wt=Math.ceil(M*kt/8);for(var Yt=new Uint8Array(Wt*Bt),Jt=Y[G],Kt=0;Kt<Bt;Kt++){$=Kt*Wt;var te=Kt*kt;if(8==M)for(var ee=0;ee<kt;ee++)Yt[$+ee]=Jt[te+ee];else if(4==M)for(ee=0;ee<kt;ee++)Yt[$+(ee>>1)]|=Jt[te+ee]<<4-4*(1&ee);else if(2==M)for(ee=0;ee<kt;ee++)Yt[$+(ee>>2)]|=Jt[te+ee]<<6-2*(3&ee);else if(1==M)for(ee=0;ee<kt;ee++)Yt[$+(ee>>3)]|=Jt[te+ee]<<7-1*(7&ee)}jt=Yt,B=3,Xt=1}else if(0==q&&1==Z.length){Yt=new Uint8Array(kt*Bt*3);var ie=kt*Bt;for($=0;$<ie;$++){var re,ne=4*$;Yt[re=3*$]=jt[ne],Yt[re+1]=jt[ne+1],Yt[re+2]=jt[ne+2]}jt=Yt,B=2,Xt=3,Wt=3*kt}yt.img=jt,yt.bpl=Wt,yt.bpp=Xt}return{ctype:B,depth:M,plte:X,frames:Z}},_i.encode.framize=function(g,m,y,k,I,N){for(var P=[],z=0;z<g.length;z++){var O,U=new Uint8Array(g[z]),B=new Uint32Array(U.buffer),M=0,j=0,G=m,H=y,V=k?1:0;if(0!=z){for(var $=N||k||1==z||0!=P[z-2].dispose?1:2,q=0,Z=1e9,W=0;W<$;W++){for(var X=new Uint8Array(g[z-1-W]),Y=new Uint32Array(g[z-1-W]),J=m,K=y,Q=-1,tt=-1,et=0;et<y;et++)for(var vt=0;vt<m;vt++)B[Ut=et*m+vt]!=Y[Ut]&&(vt<J&&(J=vt),vt>Q&&(Q=vt),et<K&&(K=et),et>tt&&(tt=et));-1==Q&&(J=K=Q=tt=0),I&&(!(1&~J)&&J--,!(1&~K)&&K--);var yt=(Q-J+1)*(tt-K+1);yt<Z&&(Z=yt,q=W,M=J,j=K,G=Q-J+1,H=tt-K+1)}X=new Uint8Array(g[z-1-q]),1==q&&(P[z-1].dispose=2),O=new Uint8Array(G*H*4),_i._copyTile(X,m,y,O,G,H,-M,-j,0),1==(V=_i._copyTile(U,m,y,O,G,H,-M,-j,3)?1:0)?_i.encode._prepareDiff(U,m,y,O,{x:M,y:j,width:G,height:H}):_i._copyTile(U,m,y,O,G,H,-M,-j,0)}else O=U.slice(0);P.push({rect:{x:M,y:j,width:G,height:H},img:O,blend:V,dispose:0})}if(k)for(z=0;z<P.length;z++)if(1!=(Bt=P[z]).blend){var xt=Bt.rect,kt=P[z-1].rect,Et=Math.min(xt.x,kt.x),It=Math.min(xt.y,kt.y),zt={x:Et,y:It,width:Math.max(xt.x+xt.width,kt.x+kt.width)-Et,height:Math.max(xt.y+xt.height,kt.y+kt.height)-It};P[z-1].dispose=1,z-1!=0&&_i.encode._updateFrame(g,m,y,P,z-1,zt,I),_i.encode._updateFrame(g,m,y,P,z,zt,I)}if(1!=g.length)for(var Ut=0;Ut<P.length;Ut++){var Bt;(Bt=P[Ut]).rect.width,Bt.rect.height}return P},_i.encode._updateFrame=function(g,m,y,k,I,N,P){for(var z=Uint8Array,O=Uint32Array,U=new z(g[I-1]),B=new O(g[I-1]),M=I+1<g.length?new z(g[I+1]):null,j=new z(g[I]),G=new O(j.buffer),H=m,V=y,$=-1,q=-1,Z=0;Z<N.height;Z++)for(var W=0;W<N.width;W++){var X=N.x+W,Y=N.y+Z,J=Y*m+X,K=G[J];0==K||0==k[I-1].dispose&&B[J]==K&&(null==M||0!=M[4*J+3])||(X<H&&(H=X),X>$&&($=X),Y<V&&(V=Y),Y>q&&(q=Y))}-1==$&&(H=V=$=q=0),P&&(!(1&~H)&&H--,!(1&~V)&&V--),N={x:H,y:V,width:$-H+1,height:q-V+1};var Q=k[I];Q.rect=N,Q.blend=1,Q.img=new Uint8Array(N.width*N.height*4),0==k[I-1].dispose?(_i._copyTile(U,m,y,Q.img,N.width,N.height,-N.x,-N.y,0),_i.encode._prepareDiff(j,m,y,Q.img,N)):_i._copyTile(j,m,y,Q.img,N.width,N.height,-N.x,-N.y,0)},_i.encode._prepareDiff=function(g,m,y,k,I){_i._copyTile(g,m,y,k,I.width,I.height,-I.x,-I.y,2)},_i.encode._filterZero=function(g,m,y,k,I,N,P){var z,O=[],U=[0,1,2,3,4];-1!=N?U=[N]:(m*k>5e5||1==y)&&(U=[0]),P&&(z={level:0});for(var B=P&&null!=UZIP?UZIP:wi,M=0;M<U.length;M++){for(var j=0;j<m;j++)_i.encode._filterLine(I,g,j,k,y,U[M]);O.push(B.deflate(I,z))}var G,H=1e9;for(M=0;M<O.length;M++)O[M].length<H&&(G=M,H=O[M].length);return O[G]},_i.encode._filterLine=function(g,m,y,k,I,N){var P=y*k,z=P+y,O=_i.decode._paeth;if(g[z]=N,z++,0==N)if(k<500)for(var U=0;U<k;U++)g[z+U]=m[P+U];else g.set(new Uint8Array(m.buffer,P,k),z);else if(1==N){for(U=0;U<I;U++)g[z+U]=m[P+U];for(U=I;U<k;U++)g[z+U]=m[P+U]-m[P+U-I]+256&255}else if(0==y){for(U=0;U<I;U++)g[z+U]=m[P+U];if(2==N)for(U=I;U<k;U++)g[z+U]=m[P+U];if(3==N)for(U=I;U<k;U++)g[z+U]=m[P+U]-(m[P+U-I]>>1)+256&255;if(4==N)for(U=I;U<k;U++)g[z+U]=m[P+U]-O(m[P+U-I],0,0)+256&255}else{if(2==N)for(U=0;U<k;U++)g[z+U]=m[P+U]+256-m[P+U-k]&255;if(3==N){for(U=0;U<I;U++)g[z+U]=m[P+U]+256-(m[P+U-k]>>1)&255;for(U=I;U<k;U++)g[z+U]=m[P+U]+256-(m[P+U-k]+m[P+U-I]>>1)&255}if(4==N){for(U=0;U<I;U++)g[z+U]=m[P+U]+256-O(0,m[P+U-k],0)&255;for(U=I;U<k;U++)g[z+U]=m[P+U]+256-O(m[P+U-I],m[P+U-k],m[P+U-I-k])&255}}},_i.crc={table:function(){for(var g=new Uint32Array(256),m=0;m<256;m++){for(var y=m,k=0;k<8;k++)1&y?y=3988292384^y>>>1:y>>>=1;g[m]=y}return g}(),update:function(g,m,y,k){for(var I=0;I<k;I++)g=_i.crc.table[255&(g^m[y+I])]^g>>>8;return g},crc:function(g,m,y){return 4294967295^_i.crc.update(4294967295,g,m,y)}},_i.quantize=function(g,m){var y=new Uint8Array(g),k=y.slice(0),I=new Uint32Array(k.buffer),N=_i.quantize.getKDtree(k,m),P=N[0],z=N[1];_i.quantize.planeDst;for(var O=y,U=I,B=O.length,M=new Uint8Array(y.length>>2),j=0;j<B;j+=4){var G=O[j]*(1/255),H=O[j+1]*(1/255),V=O[j+2]*(1/255),$=O[j+3]*(1/255),q=_i.quantize.getNearest(P,G,H,V,$);M[j>>2]=q.ind,U[j>>2]=q.est.rgba}return{abuf:k.buffer,inds:M,plte:z}},_i.quantize.getKDtree=function(g,m,y){null==y&&(y=1e-4);var k=new Uint32Array(g.buffer),I={i0:0,i1:g.length,bst:null,est:null,tdst:0,left:null,right:null};I.bst=_i.quantize.stats(g,I.i0,I.i1),I.est=_i.quantize.estats(I.bst);for(var N=[I];N.length<m;){for(var P=0,z=0,O=0;O<N.length;O++)N[O].est.L>P&&(P=N[O].est.L,z=O);if(P<y)break;var U=N[z],B=_i.quantize.splitPixels(g,k,U.i0,U.i1,U.est.e,U.est.eMq255);if(U.i0>=B||U.i1<=B)U.est.L=0;else{var M={i0:U.i0,i1:B,bst:null,est:null,tdst:0,left:null,right:null};M.bst=_i.quantize.stats(g,M.i0,M.i1),M.est=_i.quantize.estats(M.bst);var j={i0:B,i1:U.i1,bst:null,est:null,tdst:0,left:null,right:null};for(j.bst={R:[],m:[],N:U.bst.N-M.bst.N},O=0;O<16;O++)j.bst.R[O]=U.bst.R[O]-M.bst.R[O];for(O=0;O<4;O++)j.bst.m[O]=U.bst.m[O]-M.bst.m[O];j.est=_i.quantize.estats(j.bst),U.left=M,U.right=j,N[z]=M,N.push(j)}}for(N.sort((function(g,m){return m.bst.N-g.bst.N})),O=0;O<N.length;O++)N[O].ind=O;return[I,N]},_i.quantize.getNearest=function(g,m,y,k,I){if(null==g.left)return g.tdst=_i.quantize.dist(g.est.q,m,y,k,I),g;var N=_i.quantize.planeDst(g.est,m,y,k,I),P=g.left,z=g.right;N>0&&(P=g.right,z=g.left);var O=_i.quantize.getNearest(P,m,y,k,I);if(O.tdst<=N*N)return O;var U=_i.quantize.getNearest(z,m,y,k,I);return U.tdst<O.tdst?U:O},_i.quantize.planeDst=function(g,m,y,k,I){var N=g.e;return N[0]*m+N[1]*y+N[2]*k+N[3]*I-g.eMq},_i.quantize.dist=function(g,m,y,k,I){var N=m-g[0],P=y-g[1],z=k-g[2],O=I-g[3];return N*N+P*P+z*z+O*O},_i.quantize.splitPixels=function(g,m,y,k,I,N){var P=_i.quantize.vecDot;for(k-=4;y<k;){for(;P(g,y,I)<=N;)y+=4;for(;P(g,k,I)>N;)k-=4;if(y>=k)break;var z=m[y>>2];m[y>>2]=m[k>>2],m[k>>2]=z,y+=4,k-=4}for(;P(g,y,I)>N;)y-=4;return y+4},_i.quantize.vecDot=function(g,m,y){return g[m]*y[0]+g[m+1]*y[1]+g[m+2]*y[2]+g[m+3]*y[3]},_i.quantize.stats=function(g,m,y){for(var k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I=[0,0,0,0],N=y-m>>2,P=m;P<y;P+=4){var z=g[P]*(1/255),O=g[P+1]*(1/255),U=g[P+2]*(1/255),B=g[P+3]*(1/255);I[0]+=z,I[1]+=O,I[2]+=U,I[3]+=B,k[0]+=z*z,k[1]+=z*O,k[2]+=z*U,k[3]+=z*B,k[5]+=O*O,k[6]+=O*U,k[7]+=O*B,k[10]+=U*U,k[11]+=U*B,k[15]+=B*B}return k[4]=k[1],k[8]=k[2],k[9]=k[6],k[12]=k[3],k[13]=k[7],k[14]=k[11],{R:k,m:I,N:N}},_i.quantize.estats=function(g){var m=g.R,y=g.m,k=g.N,I=y[0],N=y[1],P=y[2],z=y[3],O=0==k?0:1/k,U=[m[0]-I*I*O,m[1]-I*N*O,m[2]-I*P*O,m[3]-I*z*O,m[4]-N*I*O,m[5]-N*N*O,m[6]-N*P*O,m[7]-N*z*O,m[8]-P*I*O,m[9]-P*N*O,m[10]-P*P*O,m[11]-P*z*O,m[12]-z*I*O,m[13]-z*N*O,m[14]-z*P*O,m[15]-z*z*O],B=U,M=_i.M4,j=[.5,.5,.5,.5],G=0,H=0;if(0!=k)for(var V=0;V<10&&(j=M.multVec(B,j),H=Math.sqrt(M.dot(j,j)),j=M.sml(1/H,j),!(Math.abs(H-G)<1e-9));V++)G=H;var $=[I*O,N*O,P*O,z*O];return{Cov:U,q:$,e:j,L:G,eMq255:M.dot(M.sml(255,$),j),eMq:M.dot(j,$),rgba:(Math.round(255*$[3])<<24|Math.round(255*$[2])<<16|Math.round(255*$[1])<<8|Math.round(255*$[0]))>>>0}},_i.M4={multVec:function(g,m){return[g[0]*m[0]+g[1]*m[1]+g[2]*m[2]+g[3]*m[3],g[4]*m[0]+g[5]*m[1]+g[6]*m[2]+g[7]*m[3],g[8]*m[0]+g[9]*m[1]+g[10]*m[2]+g[11]*m[3],g[12]*m[0]+g[13]*m[1]+g[14]*m[2]+g[15]*m[3]]},dot:function(g,m){return g[0]*m[0]+g[1]*m[1]+g[2]*m[2]+g[3]*m[3]},sml:function(g,m){return[g*m[0],g*m[1],g*m[2],g*m[3]]}},_i.encode.concatRGBA=function(g){for(var m=0,y=0;y<g.length;y++)m+=g[y].byteLength;var k=new Uint8Array(m),I=0;for(y=0;y<g.length;y++){for(var N=new Uint8Array(g[y]),P=N.length,z=0;z<P;z+=4){var O=N[z],U=N[z+1],B=N[z+2],M=N[z+3];0==M&&(O=U=B=0),k[I+z]=O,k[I+z+1]=U,k[I+z+2]=B,k[I+z+3]=M}I+=P}return k.buffer};const yi={decode(g){const m=_i.decode(g);return{width:m.width,height:m.height,data:new Uint8Array(_i.toRGBA8(m)[0])}},encode(g){const m=_i.encode([g.data],g.width,g.height,0);return new Uint8Array(m)}};var xi={256:"imageWidth",257:"imageLength",258:"bitsPerSample",259:"compression",262:"photometricInterpretation",273:"stripOffsets",278:"rowsPerStrip",279:"stripByteCounts",296:"resolutionUnit",320:"colorMap"};function Je(g,m){var y=g.colorMap,k=g.bitsPerSample,I=g.photometricInterpretation,N=void 0;if(m=function(g,m){var y=g.compression;if(y&&1!==y[0])throw 2===y[0]?new Error("CCITT group3 decompressionion is not implemented."):5===y[0]?new Error("LZW decompressionion is not implemented."):6===y[0]?new Error("JPEG decompressionion is not implemented."):7===y[0]?new Error("JPEG2 decompressionion is not implemented."):8===y[0]?new Error("Zip (Adove Deflate) decompressionion is not implemented."):32773===y[0]?new Error("Packbits decompression is not implemented."):new Error("Unknown compression type: "+y[0]);return m}(g,m),!k)throw new Error("Bilevel image decode is not implemented.");if(y)throw new Error("Palette-color image decode is not implemented.");if(I[0]=4===k.length)return m;if(I[0]=3===k.length){N=new Uint8Array(m.length/3*4);for(var P=0;P<m.length/3;P++)N[4*P]=m[3*P],N[4*P+1]=m[3*P+1],N[4*P+2]=m[3*P+2],N[4*P+3]=255;return N}if(I[0]<2&&1===k.length&&4===k[0]){N=new Uint8Array(4*m.length);for(var z=0;z<m.length;z++)N[4*z]=m[z]<<4,N[4*z+1]=m[z+1]<<4,N[4*z+2]=m[z+2]<<4,N[4*z+3]=255;return N}if(I[0]<2&&1===k.length&&8===k[0]){N=new Uint8Array(4*m.length);for(var O=0;O<m.length;O++)N[4*O]=m[O],N[4*O+1]=m[O+1],N[4*O+2]=m[O+2],N[4*O+3]=255;return N}throw new Error("Can't detect image type. PhotometricInterpretation: "+I[0]+", BitsPerSample: "+k)}var $e_decode=function(g){var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{singlePage:!0},y=function Ke(g){var m=0,y=void 0,k={},I=void 0;function a(m,k){var I=m,N=m+k;if(y)return g.subarray(I,N);for(var P=g.subarray(I,N),z=new Uint8Array(N-I),O=0;O<P.byteLength;O++)z[P.byteLength-O-1]=P[O];return z}function s(m){var k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments[2];if(y){var N=new DataView(g.buffer);if(k>1||I){for(var P=new Uint16Array(k),z=0;z<k;z++)P[z]=N.getUint16(m+(z<<1));return P}return N.getUint16(m)}var O=new DataView(a(m,k<<1).buffer);if(k>1||I){for(var U=new Uint16Array(k),B=0;B<k;B++)U[B]=O.getUint16(B<<1);return U}return O.getUint16(0)}function o(m){var k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,I=arguments[2];if(y){var N=new DataView(g.buffer);if(k>1||I){for(var P=new Uint32Array(k),z=0;z<k;z++)P[z]=N.getUint32(m+(z<<2));return P}return N.getUint32(m)}var O=new DataView(a(m,k<<2).buffer);if(k>1||I){for(var U=new Uint32Array(k),B=0;B<k;B++)U[B]=O.getUint32(B<<2);return U}return O.getUint32(0)}function h(g,m,I,N){var P=xi[g];P&&(k[P]=function(g,m,k){var I,N=function(g,m){switch(g){case 1:return m;case 3:return m<<1;case 4:default:return m<<2;case 5:return m<<3}}(g,m);N>4&&(k=o(k)),I=N<4?4/N:m;var P=void 0;switch(g){case 1:break;case 3:P=s(k,I,!0);break;case 4:P=o(k,I,!0)}if(P)return N<4?y?P.slice(0,I-m):P.slice(I-m):P}(m,I,N))}function f(m){for(var y=new Uint8Array(m.stripByteCounts.reduce((function(g,m){return g+m}),0)),k=0,I=0;I<m.stripOffsets.length;I++){var N=g.subarray(m.stripOffsets[I],m.stripOffsets[I]+m.stripByteCounts[I]);y.set(N,k),k+=N.byteLength}return y}if(77===g[0]&&77===g[1])y=!0;else{if(73!==g[0]||73!==g[1])throw new Error("Invalid byte order "+g[0]+g[1]);y=!1}if(42!==a(2,2)[1])throw new Error("not tiff");for(var N=[],P=o(4);0!==P;P=o(m)){var z=s(m=P);k={},m+=2;for(var O=0;O<z;O++)h(s(m),s(m+=2),o(m+=2),m+=4),m+=4;I=f(k),N.push({stripData:I,ifdEntries:k})}return N}(new Uint8Array(g)),k=y.map((function(g){return{width:g.ifdEntries.imageWidth[0],height:g.ifdEntries.imageLength[0],data:Je(g.ifdEntries,g.stripData),ifdEntries:g.ifdEntries}}));if(m.singlePage){if(!k||!k.length)throw new Error("No pages");return k[0]}return k};const ki={decode(g){const m=$e_decode(g,{singlePage:!0});return{width:m.width,height:m.height,data:m.data}},encode(){throw new Error("Encoding is not supported for TIFF images!")}},Ei={[H.JPEG]:zt,[H.PNG]:yi,[H.GIF]:vt,[H.BMP]:Z,[H.TIFF]:ki},er=(g,m,y)=>{const k=[],I=[],N=[],P=[];for(let z=0;z<m*y;z++)k.push(g[4*z]),I.push(g[4*z+1]),N.push(g[4*z+2]),P.push(g[4*z+3]);return[k,I,N,P]},rr=(g,m,y,k,I,N)=>{ir(g,m,y,k,(N[0]-1)/2),ir(m,g,y,k,(N[1]-1)/2),ir(g,m,y,k,(N[2]-1)/2)},ir=(g,m,y,k,I)=>{for(let y=0;y<g.length;y++)m[y]=g[y];nr(m,g,y,k,I),ar(g,m,y,k,I)},nr=(g,m,y,k,I)=>{const N=1/(I+I+1);for(let P=0;P<k;P++){let k=P*y,z=k,O=k+I;const U=g[k],B=g[k+y-1];let M=(I+1)*U;for(let m=0;m<I;m++)M+=g[k+m];for(let y=0;y<=I;y++)M+=g[O++]-U,m[k++]=M*N;for(let P=I+1;P<y-I;P++)M+=g[O++]-g[z++],m[k++]=M*N;for(let P=y-I;P<y;P++)M+=B-g[z++],m[k++]=M*N}},ar=(g,m,y,k,I)=>{const N=1/(I+I+1);for(let P=0;P<y;P++){let z=P,O=z,U=z+I*y;const B=g[z],M=g[z+y*(k-1)];let j=(I+1)*B;for(let m=0;m<I;m++)j+=g[z+m*y];for(let k=0;k<=I;k++)j+=g[U]-B,m[z]=j*N,U+=y,z+=y;for(let P=I+1;P<k-I;P++)j+=g[U]-g[O],m[z]=j*N,O+=y,U+=y,z+=y;for(let P=k-I;P<k;P++)j+=M-g[O],m[z]=j*N,O+=y,z+=y}},or=(g,m)=>g<1?Math.round(g*m):g,Ai={"center bottom":{horizontalPosition:"center",verticalPosition:"bottom"},"center center":{horizontalPosition:"center",verticalPosition:"center"},"center top":{horizontalPosition:"center",verticalPosition:"top"},"left bottom":{horizontalPosition:"left",verticalPosition:"bottom"},"left center":{horizontalPosition:"left",verticalPosition:"center"},"left top":{horizontalPosition:"left",verticalPosition:"top"},"right bottom":{horizontalPosition:"right",verticalPosition:"bottom"},"right center":{horizontalPosition:"right",verticalPosition:"center"},"right top":{horizontalPosition:"right",verticalPosition:"top"},bottom:{horizontalPosition:"center",verticalPosition:"bottom"},center:{horizontalPosition:"center",verticalPosition:"center"},left:{horizontalPosition:"left",verticalPosition:"center"},right:{horizontalPosition:"right",verticalPosition:"center"},top:{horizontalPosition:"center",verticalPosition:"top"}},dr=(g,m,y,k,I,N)=>{const P=g/m,z=y/k;let O=y,U=k,B=0,M=0;if("contain"===I||"cover"===I){"contain"===I?P>=z?U=y/P:O=k*P:"cover"===I&&(P<z?(O=y,U=y/P):(O=k*P,U=k));const{horizontalPosition:g,verticalPosition:m}=(g=>Ai[g]||Ai.center)(N);"left"===g?B=0:"center"===g?B=y/2-O/2:"right"===g&&(B=y-O),"top"===m?M=0:"center"===m?M=k/2-U/2:"bottom"===m&&(M=k-U)}return{imageWidth:Math.round(O),imageHeight:Math.round(U),xOffset:Math.round(B),yOffset:Math.round(M)}},ur=(g,m,y,k,I)=>m===k?y:Math.round((g-m)*I+(k-g)*y),cr=(g,m,y,k,I,N,P,z,O,U)=>{const B=[0,0,0,0];for(let m=0;m<4;m+=1){let y=4*(z*g.width+I)+m,U=4*(z*g.width+N)+m;const M=ur(k,I,g.data[y],N,g.data[U]);if(O===z)B[m]=M;else{y=4*(O*g.width+I)+m,U=4*(O*g.width+N)+m;const j=ur(k,I,g.data[y],N,g.data[U]);B[m]=ur(P,z,M,O,j)}}B.every((g=>0===g))?m.set(U,y):m.set(B,y)},pr=(g,m)=>(y,k)=>({x:y+g,y:k+m}),Ti=new Set([H.JPEG,H.PNG,H.GIF,H.BMP,H.TIFF]),Si=new Set([H.JPEG,H.PNG,H.GIF,H.BMP]);class _r{#t;#e;outputOptions;constructor(g,m,y={}){let k={};if(null==m?(this.#e=i(g),k=y||{}):"string"==typeof m?(this.#e=m,k=y||{}):(this.#e=i(g),"object"!=typeof m||Array.isArray(m)||(k=m||{})),!Ti.has(this.#e))throw new Error(`Unsupported input file type: ${this.#e}`);this.#t=Ei[this.#e].decode(g),this.outputOptions={background:k.background??[0,0,0,0],quality:k.quality??80,compressionLevel:k.compressionLevel??9,loop:k.loop??0,delay:k.delay??100}}get width(){return this.#t.width}get height(){return this.#t.height}crop(g,m,y,k){return((g,m,y)=>{const k=or(m.x,g.width),I=or(m.y,g.height),N=or(m.width,g.width),P=or(m.height,g.height),z=new Uint8Array(N*P*4);for(let g=0;g<z.length;g+=4)z.set(y,g);const O=N-k,U=P-I;for(let m=0;m<U;m+=1){const y=(I+m)*g.width+k<<2,P=y+(O<<2),U=g.data.subarray(y,P),B=m*N<<2;z.set(U,B)}g.data=z,g.width=N,g.height=P})(this.#t,{x:g,y:m,width:y,height:k},this.outputOptions.background),this}resize(g,m=null,y={}){let k=null,I={};if(null==m?(k=null,I=y||{}):"number"==typeof m?(k=m,I=y||{}):(k=null,"object"!=typeof m||Array.isArray(m)||(I=m||{})),!g&&!k)throw new Error("At least one dimension must be provided!");return((g,m,y,k,I)=>{if(!m&&!y)throw new Error("At least one dimension must be provided!");const{frameWidth:N,frameHeight:P}=((g,m,y,k,I)=>{if(y&&k){if("fill"===I||"contain"===I)return{frameWidth:y,frameHeight:k};if("inside"===I){const I=Math.min(y/g,k/m);return{frameWidth:Math.round(g*I),frameHeight:Math.round(m*I)}}if("outside"===I){const I=Math.max(y/g,k/m);return{frameWidth:Math.round(g*I),frameHeight:Math.round(m*I)}}}const N=g/m;return{frameWidth:y||Math.round(k*N),frameHeight:k||Math.round(y/N)}})(g.width,g.height,m,y,k.fit),{imageWidth:z,imageHeight:O,xOffset:U,yOffset:B}=dr(g.width,g.height,N,P,k.fit,k.position),M=new Uint8Array(N*P*4);for(let g=0;g<M.length;g+=4)M.set(I,g);for(let m=0;m<O&&m+B<P;m+=1)for(let y=0;y<z&&y+U<N;y+=1){if(y+U<0||y+U>=N||m+B<0||m+B>=P)continue;const k=4*((m+B)*N+(y+U)),j=y*g.width/z,G=Math.floor(j),H=Math.min(Math.ceil(j),g.width-1),V=m*g.height/O,$=Math.floor(V),q=Math.min(Math.ceil(V),g.height-1);cr(g,M,k,j,G,H,V,$,q,I)}g.data=M,g.width=N,g.height=P})(this.#t,g,k,{fit:I.fit??"cover",position:I.position??"center"},this.outputOptions.background),this}flip(g){return((g,m)=>{if("horizontal"===m||"both"===m)for(let m=0;m<g.height;m+=1){const y=m*g.width;for(let m=0;m<g.width/2;m+=1){const k=y+m<<2,I=g.data.slice(k,k+4),N=y+(g.width-1-m)<<2,P=g.data.slice(N,N+4);g.data.set(I,N),g.data.set(P,k)}}if("vertical"===m||"both"===m)for(let m=0;m<g.width;m+=1)for(let y=0;y<g.height/2;y+=1){const k=y*g.width+m<<2,I=g.data.slice(k,k+4),N=(g.height-1-y)*g.width+m<<2,P=g.data.slice(N,N+4);g.data.set(I,N),g.data.set(P,k)}})(this.#t,g),this}rotate(g){return((g,m,y)=>{const k=m%360*Math.PI/180,I=Math.cos(k),N=Math.sin(k),P=new Uint8Array(g.data.length);for(let g=0;g<P.length;g+=4)P.set(y,g);const z=pr(-g.width/2,-g.height/2),O=pr(g.width/2+.5,g.height/2+.5);for(let m=1;m<=g.height;m++)for(let y=1;y<=g.width;y++){const k=z(y,m),U=O(I*k.x-N*k.y,I*k.y+N*k.x),B=g.width*(m-1)+y-1<<2;if(U.x>=0&&U.x<g.width&&U.y>=0&&U.y<g.height){const m=g.width*(0|U.y)+U.x<<2,y=g.data.subarray(m,m+4);P.set(y,B)}}g.data=P})(this.#t,g,this.outputOptions.background),this}blur(g){return((g,m)=>{const y=er(g.data,g.width,g.height),k=er(g.data,g.width,g.height),I=(g=>{const m=Math.sqrt(12*g*g/3+1);let y=Math.floor(m);y%2==0&&y--;const k=y+2,I=(12*g*g-3*y*y-12*y-9)/(-4*y-4),N=Math.round(I),P=[];for(let g=0;g<3;g++)P.push(g<N?y:k);return P})(m);rr(y[0],k[0],g.width,g.height,0,I),rr(y[1],k[1],g.width,g.height,0,I),rr(y[2],k[2],g.width,g.height,0,I),((g,m,y,k,I,N,P)=>{for(let z=0;z<m*y;z++)g[4*z]=k[z],g[4*z+1]=I[z],g[4*z+2]=N[z],g[4*z+3]=P[z]})(g.data,g.width,g.height,k[0],k[1],k[2],k[3])})(this.#t,g),this}toBuffer(g){const m=g||this.#e;if(!Si.has(m))throw new Error(`Unsupported output file type: ${m}`);return Ei[m].encode(((g,m,y)=>{if(m===H.GIF){const m=g.data.slice(0),k=y.slice(0);k[3]=255;for(let g=0;g<m.length;g+=4)m[g+3]<128?m.set(k,g):m[g+3]=255;return{width:g.width,height:g.height,data:m}}if(m===H.JPEG){const m=g.data.slice(0);for(let g=3;g<m.length;g+=4)m[g]=255;return{width:g.width,height:g.height,data:m}}return g})(this.#t,m,this.outputOptions.background),this.outputOptions)}}const Ii={name:"pureTransformer",supportedInputs:Ti,supportedOutputs:Si,fallbackOutput:exports.MimeType.PNG,transform:async({data:g,contentType:m},{contentType:y,width:k,height:I,fit:N,position:P,background:z,quality:O,loop:U,delay:B,blurRadius:M,rotate:j,flip:G,crop:H,compressionLevel:V})=>{const $=new _r(g,m,{background:z,loop:U,delay:B,quality:O,compressionLevel:V});return H&&$.crop(H.x,H.y,H.width,H.height),null==k&&null==I||$.resize(k,I,{fit:N,position:P}),G&&$.flip(G),j&&0!==j&&$.rotate(j),M&&M>0&&$.blur(M),$.toBuffer(y)}},Ni="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,Pi="function"==typeof AbortController?AbortController:class AbortController{constructor(){this.signal=new Oi}abort(g=new Error("This operation was aborted")){this.signal.reason=this.signal.reason||g,this.signal.aborted=!0,this.signal.dispatchEvent({type:"abort",target:this.signal})}},zi="function"==typeof AbortSignal,Ci="function"==typeof Pi.AbortSignal,Oi=zi?AbortSignal:Ci?Pi.AbortController:class AbortSignal{constructor(){this.reason=void 0,this.aborted=!1,this._listeners=[]}dispatchEvent(g){"abort"===g.type&&(this.aborted=!0,this.onabort(g),this._listeners.forEach((m=>m(g)),this))}onabort(){}addEventListener(g,m){"abort"===g&&this._listeners.push(m)}removeEventListener(g,m){"abort"===g&&(this._listeners=this._listeners.filter((g=>g!==m)))}},Li=new Set,deprecatedOption=(g,m)=>{const y=`LRU_CACHE_OPTION_${g}`;shouldWarn(y)&&warn(y,`${g} option`,`options.${m}`,LRUCache)},deprecatedMethod=(g,m)=>{const y=`LRU_CACHE_METHOD_${g}`;if(shouldWarn(y)){const{prototype:k}=LRUCache,{get:I}=Object.getOwnPropertyDescriptor(k,g);warn(y,`${g} method`,`cache.${m}()`,I)}},emitWarning=(...g)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...g):console.error(...g)},shouldWarn=g=>!Li.has(g),warn=(g,m,y,k)=>{Li.add(g);emitWarning(`The ${m} is deprecated. Please use ${y} instead.`,"DeprecationWarning",g,k)},isPosInt=g=>g&&g===Math.floor(g)&&g>0&&isFinite(g),getUintArray=g=>isPosInt(g)?g<=Math.pow(2,8)?Uint8Array:g<=Math.pow(2,16)?Uint16Array:g<=Math.pow(2,32)?Uint32Array:g<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null;class ZeroArray extends Array{constructor(g){super(g),this.fill(0)}}class Stack{constructor(g){if(0===g)return[];const m=getUintArray(g);this.heap=new m(g),this.length=0}push(g){this.heap[this.length++]=g}pop(){return this.heap[--this.length]}}class LRUCache{constructor(g={}){const{max:m=0,ttl:y,ttlResolution:k=1,ttlAutopurge:I,updateAgeOnGet:N,updateAgeOnHas:P,allowStale:z,dispose:O,disposeAfter:U,noDisposeOnSet:B,noUpdateTTL:M,maxSize:j=0,maxEntrySize:G=0,sizeCalculation:H,fetchMethod:V,fetchContext:$,noDeleteOnFetchRejection:q,noDeleteOnStaleGet:Z,allowStaleOnFetchRejection:W,allowStaleOnFetchAbort:X,ignoreFetchAbort:Y}=g,{length:J,maxAge:K,stale:Q}=g instanceof LRUCache?{}:g;if(0!==m&&!isPosInt(m))throw new TypeError("max option must be a nonnegative integer");const tt=m?getUintArray(m):Array;if(!tt)throw new Error("invalid max value: "+m);if(this.max=m,this.maxSize=j,this.maxEntrySize=G||this.maxSize,this.sizeCalculation=H||J,this.sizeCalculation){if(!this.maxSize&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=V||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.fetchContext=$,!this.fetchMethod&&void 0!==$)throw new TypeError("cannot set fetchContext without fetchMethod");if(this.keyMap=new Map,this.keyList=new Array(m).fill(null),this.valList=new Array(m).fill(null),this.next=new tt(m),this.prev=new tt(m),this.head=0,this.tail=0,this.free=new Stack(m),this.initialFill=1,this.size=0,"function"==typeof O&&(this.dispose=O),"function"==typeof U?(this.disposeAfter=U,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!B,this.noUpdateTTL=!!M,this.noDeleteOnFetchRejection=!!q,this.allowStaleOnFetchRejection=!!W,this.allowStaleOnFetchAbort=!!X,this.ignoreFetchAbort=!!Y,0!==this.maxEntrySize){if(0!==this.maxSize&&!isPosInt(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");if(!isPosInt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!z||!!Q,this.noDeleteOnStaleGet=!!Z,this.updateAgeOnGet=!!N,this.updateAgeOnHas=!!P,this.ttlResolution=isPosInt(k)||0===k?k:1,this.ttlAutopurge=!!I,this.ttl=y||K||0,this.ttl){if(!isPosInt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const g="LRU_CACHE_UNBOUNDED";if(shouldWarn(g)){Li.add(g);emitWarning("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",g,LRUCache)}}Q&&deprecatedOption("stale","allowStale"),K&&deprecatedOption("maxAge","ttl"),J&&deprecatedOption("length","sizeCalculation")}getRemainingTTL(g){return this.has(g,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new ZeroArray(this.max),this.starts=new ZeroArray(this.max),this.setItemTTL=(g,m,y=Ni.now())=>{if(this.starts[g]=0!==m?y:0,this.ttls[g]=m,0!==m&&this.ttlAutopurge){const y=setTimeout((()=>{this.isStale(g)&&this.delete(this.keyList[g])}),m+1);y.unref&&y.unref()}},this.updateItemAge=g=>{this.starts[g]=0!==this.ttls[g]?Ni.now():0},this.statusTTL=(m,y)=>{m&&(m.ttl=this.ttls[y],m.start=this.starts[y],m.now=g||getNow(),m.remainingTTL=m.now+m.ttl-m.start)};let g=0;const getNow=()=>{const m=Ni.now();if(this.ttlResolution>0){g=m;const y=setTimeout((()=>g=0),this.ttlResolution);y.unref&&y.unref()}return m};this.getRemainingTTL=m=>{const y=this.keyMap.get(m);return void 0===y?0:0===this.ttls[y]||0===this.starts[y]?1/0:this.starts[y]+this.ttls[y]-(g||getNow())},this.isStale=m=>0!==this.ttls[m]&&0!==this.starts[m]&&(g||getNow())-this.starts[m]>this.ttls[m]}updateItemAge(g){}statusTTL(g,m){}setItemTTL(g,m,y){}isStale(g){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new ZeroArray(this.max),this.removeItemSize=g=>{this.calculatedSize-=this.sizes[g],this.sizes[g]=0},this.requireSize=(g,m,y,k)=>{if(this.isBackgroundFetch(m))return 0;if(!isPosInt(y)){if(!k)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof k)throw new TypeError("sizeCalculation must be a function");if(y=k(m,g),!isPosInt(y))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return y},this.addItemSize=(g,m,y)=>{if(this.sizes[g]=m,this.maxSize){const m=this.maxSize-this.sizes[g];for(;this.calculatedSize>m;)this.evict(!0)}this.calculatedSize+=this.sizes[g],y&&(y.entrySize=m,y.totalCalculatedSize=this.calculatedSize)}}removeItemSize(g){}addItemSize(g,m){}requireSize(g,m,y,k){if(y||k)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache")}*indexes({allowStale:g=this.allowStale}={}){if(this.size)for(let m=this.tail;this.isValidIndex(m)&&(!g&&this.isStale(m)||(yield m),m!==this.head);)m=this.prev[m]}*rindexes({allowStale:g=this.allowStale}={}){if(this.size)for(let m=this.head;this.isValidIndex(m)&&(!g&&this.isStale(m)||(yield m),m!==this.tail);)m=this.next[m]}isValidIndex(g){return void 0!==g&&this.keyMap.get(this.keyList[g])===g}*entries(){for(const g of this.indexes())void 0===this.valList[g]||void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield[this.keyList[g],this.valList[g]])}*rentries(){for(const g of this.rindexes())void 0===this.valList[g]||void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield[this.keyList[g],this.valList[g]])}*keys(){for(const g of this.indexes())void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.keyList[g])}*rkeys(){for(const g of this.rindexes())void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.keyList[g])}*values(){for(const g of this.indexes())void 0===this.valList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.valList[g])}*rvalues(){for(const g of this.rindexes())void 0===this.valList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.valList[g])}[Symbol.iterator](){return this.entries()}find(g,m){for(const y of this.indexes()){const k=this.valList[y],I=this.isBackgroundFetch(k)?k.__staleWhileFetching:k;if(void 0!==I&&g(I,this.keyList[y],this))return this.get(this.keyList[y],m)}}forEach(g,m=this){for(const y of this.indexes()){const k=this.valList[y],I=this.isBackgroundFetch(k)?k.__staleWhileFetching:k;void 0!==I&&g.call(m,I,this.keyList[y],this)}}rforEach(g,m=this){for(const y of this.rindexes()){const k=this.valList[y],I=this.isBackgroundFetch(k)?k.__staleWhileFetching:k;void 0!==I&&g.call(m,I,this.keyList[y],this)}}get prune(){return deprecatedMethod("prune","purgeStale"),this.purgeStale}purgeStale(){let g=!1;for(const m of this.rindexes({allowStale:!0}))this.isStale(m)&&(this.delete(this.keyList[m]),g=!0);return g}dump(){const g=[];for(const m of this.indexes({allowStale:!0})){const y=this.keyList[m],k=this.valList[m],I=this.isBackgroundFetch(k)?k.__staleWhileFetching:k;if(void 0===I)continue;const N={value:I};if(this.ttls){N.ttl=this.ttls[m];const g=Ni.now()-this.starts[m];N.start=Math.floor(Date.now()-g)}this.sizes&&(N.size=this.sizes[m]),g.unshift([y,N])}return g}load(g){this.clear();for(const[m,y]of g){if(y.start){const g=Date.now()-y.start;y.start=Ni.now()-g}this.set(m,y.value,y)}}dispose(g,m,y){}set(g,m,{ttl:y=this.ttl,start:k,noDisposeOnSet:I=this.noDisposeOnSet,size:N=0,sizeCalculation:P=this.sizeCalculation,noUpdateTTL:z=this.noUpdateTTL,status:O}={}){if(N=this.requireSize(g,m,N,P),this.maxEntrySize&&N>this.maxEntrySize)return O&&(O.set="miss",O.maxEntrySizeExceeded=!0),this.delete(g),this;let U=0===this.size?void 0:this.keyMap.get(g);if(void 0===U)U=this.newIndex(),this.keyList[U]=g,this.valList[U]=m,this.keyMap.set(g,U),this.next[this.tail]=U,this.prev[U]=this.tail,this.tail=U,this.size++,this.addItemSize(U,N,O),O&&(O.set="add"),z=!1;else{this.moveToTail(U);const y=this.valList[U];if(m!==y){if(this.isBackgroundFetch(y)?y.__abortController.abort(new Error("replaced")):I||(this.dispose(y,g,"set"),this.disposeAfter&&this.disposed.push([y,g,"set"])),this.removeItemSize(U),this.valList[U]=m,this.addItemSize(U,N,O),O){O.set="replace";const g=y&&this.isBackgroundFetch(y)?y.__staleWhileFetching:y;void 0!==g&&(O.oldValue=g)}}else O&&(O.set="update")}if(0===y||0!==this.ttl||this.ttls||this.initializeTTLTracking(),z||this.setItemTTL(U,y,k),this.statusTTL(O,U),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max&&0!==this.max?this.evict(!1):0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const g=this.valList[this.head];return this.evict(!0),g}}evict(g){const m=this.head,y=this.keyList[m],k=this.valList[m];return this.isBackgroundFetch(k)?k.__abortController.abort(new Error("evicted")):(this.dispose(k,y,"evict"),this.disposeAfter&&this.disposed.push([k,y,"evict"])),this.removeItemSize(m),g&&(this.keyList[m]=null,this.valList[m]=null,this.free.push(m)),this.head=this.next[m],this.keyMap.delete(y),this.size--,m}has(g,{updateAgeOnHas:m=this.updateAgeOnHas,status:y}={}){const k=this.keyMap.get(g);if(void 0!==k){if(!this.isStale(k))return m&&this.updateItemAge(k),y&&(y.has="hit"),this.statusTTL(y,k),!0;y&&(y.has="stale",this.statusTTL(y,k))}else y&&(y.has="miss");return!1}peek(g,{allowStale:m=this.allowStale}={}){const y=this.keyMap.get(g);if(void 0!==y&&(m||!this.isStale(y))){const g=this.valList[y];return this.isBackgroundFetch(g)?g.__staleWhileFetching:g}}backgroundFetch(g,m,y,k){const I=void 0===m?void 0:this.valList[m];if(this.isBackgroundFetch(I))return I;const N=new Pi;y.signal&&y.signal.addEventListener("abort",(()=>N.abort(y.signal.reason)));const P={signal:N.signal,options:y,context:k},cb=(k,I=!1)=>{const{aborted:O}=N.signal,U=y.ignoreFetchAbort&&void 0!==k;return y.status&&(O&&!I?(y.status.fetchAborted=!0,y.status.fetchError=N.signal.reason,U&&(y.status.fetchAbortIgnored=!0)):y.status.fetchResolved=!0),!O||U||I?(this.valList[m]===z&&(void 0===k?z.__staleWhileFetching?this.valList[m]=z.__staleWhileFetching:this.delete(g):(y.status&&(y.status.fetchUpdated=!0),this.set(g,k,P.options))),k):fetchFail(N.signal.reason)},fetchFail=k=>{const{aborted:I}=N.signal,P=I&&y.allowStaleOnFetchAbort,O=P||y.allowStaleOnFetchRejection,U=O||y.noDeleteOnFetchRejection;if(this.valList[m]===z){!U||void 0===z.__staleWhileFetching?this.delete(g):P||(this.valList[m]=z.__staleWhileFetching)}if(O)return y.status&&void 0!==z.__staleWhileFetching&&(y.status.returnedStale=!0),z.__staleWhileFetching;if(z.__returned===z)throw k};y.status&&(y.status.fetchDispatched=!0);const z=new Promise(((m,k)=>{this.fetchMethod(g,I,P).then((g=>m(g)),k),N.signal.addEventListener("abort",(()=>{y.ignoreFetchAbort&&!y.allowStaleOnFetchAbort||(m(),y.allowStaleOnFetchAbort&&(m=g=>cb(g,!0)))}))})).then(cb,(g=>(y.status&&(y.status.fetchRejected=!0,y.status.fetchError=g),fetchFail(g))));return z.__abortController=N,z.__staleWhileFetching=I,z.__returned=null,void 0===m?(this.set(g,z,{...P.options,status:void 0}),m=this.keyMap.get(g)):this.valList[m]=z,z}isBackgroundFetch(g){return g&&"object"==typeof g&&"function"==typeof g.then&&Object.prototype.hasOwnProperty.call(g,"__staleWhileFetching")&&Object.prototype.hasOwnProperty.call(g,"__returned")&&(g.__returned===g||null===g.__returned)}async fetch(g,{allowStale:m=this.allowStale,updateAgeOnGet:y=this.updateAgeOnGet,noDeleteOnStaleGet:k=this.noDeleteOnStaleGet,ttl:I=this.ttl,noDisposeOnSet:N=this.noDisposeOnSet,size:P=0,sizeCalculation:z=this.sizeCalculation,noUpdateTTL:O=this.noUpdateTTL,noDeleteOnFetchRejection:U=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:B=this.allowStaleOnFetchRejection,ignoreFetchAbort:M=this.ignoreFetchAbort,allowStaleOnFetchAbort:j=this.allowStaleOnFetchAbort,fetchContext:G=this.fetchContext,forceRefresh:H=!1,status:V,signal:$}={}){if(!this.fetchMethod)return V&&(V.fetch="get"),this.get(g,{allowStale:m,updateAgeOnGet:y,noDeleteOnStaleGet:k,status:V});const q={allowStale:m,updateAgeOnGet:y,noDeleteOnStaleGet:k,ttl:I,noDisposeOnSet:N,size:P,sizeCalculation:z,noUpdateTTL:O,noDeleteOnFetchRejection:U,allowStaleOnFetchRejection:B,allowStaleOnFetchAbort:j,ignoreFetchAbort:M,status:V,signal:$};let Z=this.keyMap.get(g);if(void 0===Z){V&&(V.fetch="miss");const m=this.backgroundFetch(g,Z,q,G);return m.__returned=m}{const k=this.valList[Z];if(this.isBackgroundFetch(k)){const g=m&&void 0!==k.__staleWhileFetching;return V&&(V.fetch="inflight",g&&(V.returnedStale=!0)),g?k.__staleWhileFetching:k.__returned=k}const I=this.isStale(Z);if(!H&&!I)return V&&(V.fetch="hit"),this.moveToTail(Z),y&&this.updateItemAge(Z),this.statusTTL(V,Z),k;const N=this.backgroundFetch(g,Z,q,G),P=void 0!==N.__staleWhileFetching,z=P&&m;return V&&(V.fetch=P&&I?"stale":"refresh",z&&I&&(V.returnedStale=!0)),z?N.__staleWhileFetching:N.__returned=N}}get(g,{allowStale:m=this.allowStale,updateAgeOnGet:y=this.updateAgeOnGet,noDeleteOnStaleGet:k=this.noDeleteOnStaleGet,status:I}={}){const N=this.keyMap.get(g);if(void 0!==N){const P=this.valList[N],z=this.isBackgroundFetch(P);return this.statusTTL(I,N),this.isStale(N)?(I&&(I.get="stale"),z?(I&&(I.returnedStale=m&&void 0!==P.__staleWhileFetching),m?P.__staleWhileFetching:void 0):(k||this.delete(g),I&&(I.returnedStale=m),m?P:void 0)):(I&&(I.get="hit"),z?P.__staleWhileFetching:(this.moveToTail(N),y&&this.updateItemAge(N),P))}I&&(I.get="miss")}connect(g,m){this.prev[m]=g,this.next[g]=m}moveToTail(g){g!==this.tail&&(g===this.head?this.head=this.next[g]:this.connect(this.prev[g],this.next[g]),this.connect(this.tail,g),this.tail=g)}get del(){return deprecatedMethod("del","delete"),this.delete}delete(g){let m=!1;if(0!==this.size){const y=this.keyMap.get(g);if(void 0!==y)if(m=!0,1===this.size)this.clear();else{this.removeItemSize(y);const m=this.valList[y];this.isBackgroundFetch(m)?m.__abortController.abort(new Error("deleted")):(this.dispose(m,g,"delete"),this.disposeAfter&&this.disposed.push([m,g,"delete"])),this.keyMap.delete(g),this.keyList[y]=null,this.valList[y]=null,y===this.tail?this.tail=this.prev[y]:y===this.head?this.head=this.next[y]:(this.next[this.prev[y]]=this.next[y],this.prev[this.next[y]]=this.prev[y]),this.size--,this.free.push(y)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return m}clear(){for(const g of this.rindexes({allowStale:!0})){const m=this.valList[g];if(this.isBackgroundFetch(m))m.__abortController.abort(new Error("deleted"));else{const y=this.keyList[g];this.dispose(m,y,"delete"),this.disposeAfter&&this.disposed.push([m,y,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return deprecatedMethod("reset","clear"),this.clear}get length(){return((g,m)=>{const y=`LRU_CACHE_PROPERTY_${g}`;if(shouldWarn(y)){const{prototype:k}=LRUCache,{get:I}=Object.getOwnPropertyDescriptor(k,g);warn(y,`${g} property`,`cache.${m}`,I)}})("length","size"),this.size}static get AbortController(){return Pi}static get AbortSignal(){return Oi}}var Fi=LRUCache;const mB=g=>1e6*g;var Ui={},Bi={get exports(){return Ui},set exports(g){Ui=g}},Ri={},Mi={};!function(g){const m=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",y="["+m+"]["+(m+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",k=new RegExp("^"+y+"$");g.isExist=function(g){return void 0!==g},g.isEmptyObject=function(g){return 0===Object.keys(g).length},g.merge=function(g,m,y){if(m){const k=Object.keys(m),I=k.length;for(let N=0;N<I;N++)g[k[N]]="strict"===y?[m[k[N]]]:m[k[N]]}},g.getValue=function(m){return g.isExist(m)?m:""},g.isName=function(g){const m=k.exec(g);return!(null==m)},g.getAllMatches=function(g,m){const y=[];let k=m.exec(g);for(;k;){const I=[];I.startIndex=m.lastIndex-k[0].length;const N=k.length;for(let g=0;g<N;g++)I.push(k[g]);y.push(I),k=m.exec(g)}return y},g.nameRegexp=y}(Mi);const Di=Mi,ji={allowBooleanAttributes:!1,unpairedTags:[]};function isWhiteSpace(g){return" "===g||"\t"===g||"\n"===g||"\r"===g}function readPI(g,m){const y=m;for(;m<g.length;m++)if("?"!=g[m]&&" "!=g[m]);else{const k=g.substr(y,m-y);if(m>5&&"xml"===k)return getErrorObject("InvalidXml","XML declaration allowed only at the start of the document.",getLineNumberForPosition(g,m));if("?"==g[m]&&">"==g[m+1]){m++;break}}return m}function readCommentAndCDATA(g,m){if(g.length>m+5&&"-"===g[m+1]&&"-"===g[m+2]){for(m+=3;m<g.length;m++)if("-"===g[m]&&"-"===g[m+1]&&">"===g[m+2]){m+=2;break}}else if(g.length>m+8&&"D"===g[m+1]&&"O"===g[m+2]&&"C"===g[m+3]&&"T"===g[m+4]&&"Y"===g[m+5]&&"P"===g[m+6]&&"E"===g[m+7]){let y=1;for(m+=8;m<g.length;m++)if("<"===g[m])y++;else if(">"===g[m]&&(y--,0===y))break}else if(g.length>m+9&&"["===g[m+1]&&"C"===g[m+2]&&"D"===g[m+3]&&"A"===g[m+4]&&"T"===g[m+5]&&"A"===g[m+6]&&"["===g[m+7])for(m+=8;m<g.length;m++)if("]"===g[m]&&"]"===g[m+1]&&">"===g[m+2]){m+=2;break}return m}Ri.validate=function(g,m){m=Object.assign({},ji,m);const y=[];let k=!1,I=!1;"\ufeff"===g[0]&&(g=g.substr(1));for(let P=0;P<g.length;P++)if("<"===g[P]&&"?"===g[P+1]){if(P+=2,P=readPI(g,P),P.err)return P}else{if("<"!==g[P]){if(isWhiteSpace(g[P]))continue;return getErrorObject("InvalidChar","char '"+g[P]+"' is not expected.",getLineNumberForPosition(g,P))}{let z=P;if(P++,"!"===g[P]){P=readCommentAndCDATA(g,P);continue}{let O=!1;"/"===g[P]&&(O=!0,P++);let U="";for(;P<g.length&&">"!==g[P]&&" "!==g[P]&&"\t"!==g[P]&&"\n"!==g[P]&&"\r"!==g[P];P++)U+=g[P];if(U=U.trim(),"/"===U[U.length-1]&&(U=U.substring(0,U.length-1),P--),N=U,!Di.isName(N)){let m;return m=0===U.trim().length?"Invalid space after '<'.":"Tag '"+U+"' is an invalid name.",getErrorObject("InvalidTag",m,getLineNumberForPosition(g,P))}const B=readAttributeStr(g,P);if(!1===B)return getErrorObject("InvalidAttr","Attributes for '"+U+"' have open quote.",getLineNumberForPosition(g,P));let M=B.value;if(P=B.index,"/"===M[M.length-1]){const y=P-M.length;M=M.substring(0,M.length-1);const I=validateAttributeString(M,m);if(!0!==I)return getErrorObject(I.err.code,I.err.msg,getLineNumberForPosition(g,y+I.err.line));k=!0}else if(O){if(!B.tagClosed)return getErrorObject("InvalidTag","Closing tag '"+U+"' doesn't have proper closing.",getLineNumberForPosition(g,P));if(M.trim().length>0)return getErrorObject("InvalidTag","Closing tag '"+U+"' can't have attributes or invalid starting.",getLineNumberForPosition(g,z));if(0===y.length)return getErrorObject("InvalidTag","Closing tag '"+U+"' has not been opened.",getLineNumberForPosition(g,z));{const m=y.pop();if(U!==m.tagName){let y=getLineNumberForPosition(g,m.tagStartPos);return getErrorObject("InvalidTag","Expected closing tag '"+m.tagName+"' (opened in line "+y.line+", col "+y.col+") instead of closing tag '"+U+"'.",getLineNumberForPosition(g,z))}0==y.length&&(I=!0)}}else{const N=validateAttributeString(M,m);if(!0!==N)return getErrorObject(N.err.code,N.err.msg,getLineNumberForPosition(g,P-M.length+N.err.line));if(!0===I)return getErrorObject("InvalidXml","Multiple possible root nodes found.",getLineNumberForPosition(g,P));-1!==m.unpairedTags.indexOf(U)||y.push({tagName:U,tagStartPos:z}),k=!0}for(P++;P<g.length;P++)if("<"===g[P]){if("!"===g[P+1]){P++,P=readCommentAndCDATA(g,P);continue}if("?"!==g[P+1])break;if(P=readPI(g,++P),P.err)return P}else if("&"===g[P]){const m=validateAmpersand(g,P);if(-1==m)return getErrorObject("InvalidChar","char '&' is not expected.",getLineNumberForPosition(g,P));P=m}else if(!0===I&&!isWhiteSpace(g[P]))return getErrorObject("InvalidXml","Extra text at the end",getLineNumberForPosition(g,P));"<"===g[P]&&P--}}}var N;return k?1==y.length?getErrorObject("InvalidTag","Unclosed tag '"+y[0].tagName+"'.",getLineNumberForPosition(g,y[0].tagStartPos)):!(y.length>0)||getErrorObject("InvalidXml","Invalid '"+JSON.stringify(y.map((g=>g.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):getErrorObject("InvalidXml","Start tag expected.",1)};const Gi='"',Hi="'";function readAttributeStr(g,m){let y="",k="",I=!1;for(;m<g.length;m++){if(g[m]===Gi||g[m]===Hi)""===k?k=g[m]:k!==g[m]||(k="");else if(">"===g[m]&&""===k){I=!0;break}y+=g[m]}return""===k&&{value:y,index:m,tagClosed:I}}const Vi=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function validateAttributeString(g,m){const y=Di.getAllMatches(g,Vi),k={};for(let g=0;g<y.length;g++){if(0===y[g][1].length)return getErrorObject("InvalidAttr","Attribute '"+y[g][2]+"' has no space in starting.",getPositionFromMatch(y[g]));if(void 0!==y[g][3]&&void 0===y[g][4])return getErrorObject("InvalidAttr","Attribute '"+y[g][2]+"' is without value.",getPositionFromMatch(y[g]));if(void 0===y[g][3]&&!m.allowBooleanAttributes)return getErrorObject("InvalidAttr","boolean attribute '"+y[g][2]+"' is not allowed.",getPositionFromMatch(y[g]));const I=y[g][2];if(!validateAttrName(I))return getErrorObject("InvalidAttr","Attribute '"+I+"' is an invalid name.",getPositionFromMatch(y[g]));if(k.hasOwnProperty(I))return getErrorObject("InvalidAttr","Attribute '"+I+"' is repeated.",getPositionFromMatch(y[g]));k[I]=1}return!0}function validateAmpersand(g,m){if(";"===g[++m])return-1;if("#"===g[m])return function validateNumberAmpersand(g,m){let y=/\d/;for("x"===g[m]&&(m++,y=/[\da-fA-F]/);m<g.length;m++){if(";"===g[m])return m;if(!g[m].match(y))break}return-1}(g,++m);let y=0;for(;m<g.length;m++,y++)if(!(g[m].match(/\w/)&&y<20)){if(";"===g[m])break;return-1}return m}function getErrorObject(g,m,y){return{err:{code:g,msg:m,line:y.line||y,col:y.col}}}function validateAttrName(g){return Di.isName(g)}function getLineNumberForPosition(g,m){const y=g.substring(0,m).split(/\r?\n/);return{line:y.length,col:y[y.length-1].length+1}}function getPositionFromMatch(g){return g.startIndex+g[1].length}var $i={};const qi={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(g,m){return m},attributeValueProcessor:function(g,m){return m},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(g,m,y){return g}};$i.buildOptions=function(g){return Object.assign({},qi,g)},$i.defaultOptions=qi;var Zi=class XmlNode{constructor(g){this.tagname=g,this.child=[],this[":@"]={}}add(g,m){"__proto__"===g&&(g="#__proto__"),this.child.push({[g]:m})}addChild(g){"__proto__"===g.tagname&&(g.tagname="#__proto__"),g[":@"]&&Object.keys(g[":@"]).length>0?this.child.push({[g.tagname]:g.child,":@":g[":@"]}):this.child.push({[g.tagname]:g.child})}};const Wi=Mi;function readEntityExp(g,m){let y="";for(;m<g.length&&"'"!==g[m]&&'"'!==g[m];m++)y+=g[m];if(y=y.trim(),-1!==y.indexOf(" "))throw new Error("External entites are not supported");const k=g[m++];let I="";for(;m<g.length&&g[m]!==k;m++)I+=g[m];return[y,I,m]}function isComment(g,m){return"!"===g[m+1]&&"-"===g[m+2]&&"-"===g[m+3]}function isEntity(g,m){return"!"===g[m+1]&&"E"===g[m+2]&&"N"===g[m+3]&&"T"===g[m+4]&&"I"===g[m+5]&&"T"===g[m+6]&&"Y"===g[m+7]}function isElement(g,m){return"!"===g[m+1]&&"E"===g[m+2]&&"L"===g[m+3]&&"E"===g[m+4]&&"M"===g[m+5]&&"E"===g[m+6]&&"N"===g[m+7]&&"T"===g[m+8]}function isAttlist(g,m){return"!"===g[m+1]&&"A"===g[m+2]&&"T"===g[m+3]&&"T"===g[m+4]&&"L"===g[m+5]&&"I"===g[m+6]&&"S"===g[m+7]&&"T"===g[m+8]}function isNotation(g,m){return"!"===g[m+1]&&"N"===g[m+2]&&"O"===g[m+3]&&"T"===g[m+4]&&"A"===g[m+5]&&"T"===g[m+6]&&"I"===g[m+7]&&"O"===g[m+8]&&"N"===g[m+9]}function validateEntityName(g){if(Wi.isName(g))return g;throw new Error(`Invalid entity name ${g}`)}var Xi=function readDocType$1(g,m){const y={};if("O"!==g[m+3]||"C"!==g[m+4]||"T"!==g[m+5]||"Y"!==g[m+6]||"P"!==g[m+7]||"E"!==g[m+8])throw new Error("Invalid Tag instead of DOCTYPE");{m+=9;let k=1,I=!1,N=!1,P="";for(;m<g.length;m++)if("<"!==g[m]||N)if(">"===g[m]){if(N?"-"===g[m-1]&&"-"===g[m-2]&&(N=!1,k--):k--,0===k)break}else"["===g[m]?I=!0:P+=g[m];else{if(I&&isEntity(g,m))m+=7,[entityName,val,m]=readEntityExp(g,m+1),-1===val.indexOf("&")&&(y[validateEntityName(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(I&&isElement(g,m))m+=8;else if(I&&isAttlist(g,m))m+=8;else if(I&&isNotation(g,m))m+=9;else{if(!isComment)throw new Error("Invalid DOCTYPE");N=!0}k++,P=""}if(0!==k)throw new Error("Unclosed DOCTYPE")}return{entities:y,i:m}};const Yi=/^[-+]?0x[a-fA-F0-9]+$/,Ji=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Ki={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const Qi=Mi,tr=Zi,sr=Xi,hr=function toNumber$1(g,m={}){if(m=Object.assign({},Ki,m),!g||"string"!=typeof g)return g;let y=g.trim();if(void 0!==m.skipLike&&m.skipLike.test(y))return g;if(m.hex&&Yi.test(y))return Number.parseInt(y,16);{const k=Ji.exec(y);if(k){const I=k[1],N=k[2];let P=function trimZeros(g){if(g&&-1!==g.indexOf("."))return"."===(g=g.replace(/0+$/,""))?g="0":"."===g[0]?g="0"+g:"."===g[g.length-1]&&(g=g.substr(0,g.length-1)),g;return g}(k[3]);const z=k[4]||k[6];if(!m.leadingZeros&&N.length>0&&I&&"."!==y[2])return g;if(!m.leadingZeros&&N.length>0&&!I&&"."!==y[1])return g;{const k=Number(y),O=""+k;return-1!==O.search(/[eE]/)||z?m.eNotation?k:g:-1!==y.indexOf(".")?"0"===O&&""===P||O===P||I&&O==="-"+P?k:g:N?P===O||I+P===O?k:g:y===O||y===I+O?k:g}}return g}};function addExternalEntities(g){const m=Object.keys(g);for(let y=0;y<m.length;y++){const k=m[y];this.lastEntities[k]={regex:new RegExp("&"+k+";","g"),val:g[k]}}}function parseTextData(g,m,y,k,I,N,P){if(void 0!==g&&(this.options.trimValues&&!k&&(g=g.trim()),g.length>0)){P||(g=this.replaceEntitiesValue(g));const k=this.options.tagValueProcessor(m,g,y,I,N);if(null==k)return g;if(typeof k!=typeof g||k!==g)return k;if(this.options.trimValues)return parseValue(g,this.options.parseTagValue,this.options.numberParseOptions);return g.trim()===g?parseValue(g,this.options.parseTagValue,this.options.numberParseOptions):g}}function resolveNameSpace(g){if(this.options.removeNSPrefix){const m=g.split(":"),y="/"===g.charAt(0)?"/":"";if("xmlns"===m[0])return"";2===m.length&&(g=y+m[1])}return g}const lr=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function buildAttributesMap(g,m,y){if(!this.options.ignoreAttributes&&"string"==typeof g){const y=Qi.getAllMatches(g,lr),k=y.length,I={};for(let g=0;g<k;g++){const k=this.resolveNameSpace(y[g][1]);let N=y[g][4],P=this.options.attributeNamePrefix+k;if(k.length)if(this.options.transformAttributeName&&(P=this.options.transformAttributeName(P)),"__proto__"===P&&(P="#__proto__"),void 0!==N){this.options.trimValues&&(N=N.trim()),N=this.replaceEntitiesValue(N);const g=this.options.attributeValueProcessor(k,N,m);I[P]=null==g?N:typeof g!=typeof N||g!==N?g:parseValue(N,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(I[P]=!0)}if(!Object.keys(I).length)return;if(this.options.attributesGroupName){const g={};return g[this.options.attributesGroupName]=I,g}return I}}const parseXml=function(g){g=g.replace(/\r\n?/g,"\n");const m=new tr("!xml");let y=m,k="",I="";for(let N=0;N<g.length;N++){if("<"===g[N])if("/"===g[N+1]){const m=findClosingIndex(g,">",N,"Closing Tag is not closed.");let P=g.substring(N+2,m).trim();if(this.options.removeNSPrefix){const g=P.indexOf(":");-1!==g&&(P=P.substr(g+1))}this.options.transformTagName&&(P=this.options.transformTagName(P)),y&&(k=this.saveTextToParentTag(k,y,I));const z=I.substring(I.lastIndexOf(".")+1);if(P&&-1!==this.options.unpairedTags.indexOf(P))throw new Error(`Unpaired tag can not be used as closing tag: </${P}>`);let O=0;z&&-1!==this.options.unpairedTags.indexOf(z)?(O=I.lastIndexOf(".",I.lastIndexOf(".")-1),this.tagsNodeStack.pop()):O=I.lastIndexOf("."),I=I.substring(0,O),y=this.tagsNodeStack.pop(),k="",N=m}else if("?"===g[N+1]){let m=readTagExp(g,N,!1,"?>");if(!m)throw new Error("Pi Tag is not closed.");if(k=this.saveTextToParentTag(k,y,I),this.options.ignoreDeclaration&&"?xml"===m.tagName||this.options.ignorePiTags);else{const g=new tr(m.tagName);g.add(this.options.textNodeName,""),m.tagName!==m.tagExp&&m.attrExpPresent&&(g[":@"]=this.buildAttributesMap(m.tagExp,I,m.tagName)),this.addChild(y,g,I)}N=m.closeIndex+1}else if("!--"===g.substr(N+1,3)){const m=findClosingIndex(g,"--\x3e",N+4,"Comment is not closed.");if(this.options.commentPropName){const P=g.substring(N+4,m-2);k=this.saveTextToParentTag(k,y,I),y.add(this.options.commentPropName,[{[this.options.textNodeName]:P}])}N=m}else if("!D"===g.substr(N+1,2)){const m=sr(g,N);this.docTypeEntities=m.entities,N=m.i}else if("!["===g.substr(N+1,2)){const m=findClosingIndex(g,"]]>",N,"CDATA is not closed.")-2,P=g.substring(N+9,m);k=this.saveTextToParentTag(k,y,I);let z=this.parseTextData(P,y.tagname,I,!0,!1,!0,!0);null==z&&(z=""),this.options.cdataPropName?y.add(this.options.cdataPropName,[{[this.options.textNodeName]:P}]):y.add(this.options.textNodeName,z),N=m+2}else{let P=readTagExp(g,N,this.options.removeNSPrefix),z=P.tagName;const O=P.rawTagName;let U=P.tagExp,B=P.attrExpPresent,M=P.closeIndex;this.options.transformTagName&&(z=this.options.transformTagName(z)),y&&k&&"!xml"!==y.tagname&&(k=this.saveTextToParentTag(k,y,I,!1));const j=y;if(j&&-1!==this.options.unpairedTags.indexOf(j.tagname)&&(y=this.tagsNodeStack.pop(),I=I.substring(0,I.lastIndexOf("."))),z!==m.tagname&&(I+=I?"."+z:z),this.isItStopNode(this.options.stopNodes,I,z)){let m="";if(U.length>0&&U.lastIndexOf("/")===U.length-1)"/"===z[z.length-1]?(z=z.substr(0,z.length-1),I=I.substr(0,I.length-1),U=z):U=U.substr(0,U.length-1),N=P.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(z))N=P.closeIndex;else{const y=this.readStopNodeData(g,O,M+1);if(!y)throw new Error(`Unexpected end of ${O}`);N=y.i,m=y.tagContent}const k=new tr(z);z!==U&&B&&(k[":@"]=this.buildAttributesMap(U,I,z)),m&&(m=this.parseTextData(m,z,I,!0,B,!0,!0)),I=I.substr(0,I.lastIndexOf(".")),k.add(this.options.textNodeName,m),this.addChild(y,k,I)}else{if(U.length>0&&U.lastIndexOf("/")===U.length-1){"/"===z[z.length-1]?(z=z.substr(0,z.length-1),I=I.substr(0,I.length-1),U=z):U=U.substr(0,U.length-1),this.options.transformTagName&&(z=this.options.transformTagName(z));const g=new tr(z);z!==U&&B&&(g[":@"]=this.buildAttributesMap(U,I,z)),this.addChild(y,g,I),I=I.substr(0,I.lastIndexOf("."))}else{const g=new tr(z);this.tagsNodeStack.push(y),z!==U&&B&&(g[":@"]=this.buildAttributesMap(U,I,z)),this.addChild(y,g,I),y=g}k="",N=M}}else k+=g[N]}return m.child};function addChild(g,m,y){const k=this.options.updateTag(m.tagname,y,m[":@"]);!1===k||("string"==typeof k?(m.tagname=k,g.addChild(m)):g.addChild(m))}const replaceEntitiesValue$1=function(g){if(this.options.processEntities){for(let m in this.docTypeEntities){const y=this.docTypeEntities[m];g=g.replace(y.regx,y.val)}for(let m in this.lastEntities){const y=this.lastEntities[m];g=g.replace(y.regex,y.val)}if(this.options.htmlEntities)for(let m in this.htmlEntities){const y=this.htmlEntities[m];g=g.replace(y.regex,y.val)}g=g.replace(this.ampEntity.regex,this.ampEntity.val)}return g};function saveTextToParentTag(g,m,y,k){return g&&(void 0===k&&(k=0===Object.keys(m.child).length),void 0!==(g=this.parseTextData(g,m.tagname,y,!1,!!m[":@"]&&0!==Object.keys(m[":@"]).length,k))&&""!==g&&m.add(this.options.textNodeName,g),g=""),g}function isItStopNode(g,m,y){const k="*."+y;for(const y in g){const I=g[y];if(k===I||m===I)return!0}return!1}function findClosingIndex(g,m,y,k){const I=g.indexOf(m,y);if(-1===I)throw new Error(k);return I+m.length-1}function readTagExp(g,m,y,k=">"){const I=function tagExpWithClosingIndex(g,m,y=">"){let k,I="";for(let N=m;N<g.length;N++){let m=g[N];if(k)m===k&&(k="");else if('"'===m||"'"===m)k=m;else if(m===y[0]){if(!y[1])return{data:I,index:N};if(g[N+1]===y[1])return{data:I,index:N}}else"\t"===m&&(m=" ");I+=m}}(g,m+1,k);if(!I)return;let N=I.data;const P=I.index,z=N.search(/\s/);let O=N,U=!0;-1!==z&&(O=N.substring(0,z),N=N.substring(z+1).trimStart());const B=O;if(y){const g=O.indexOf(":");-1!==g&&(O=O.substr(g+1),U=O!==I.data.substr(g+1))}return{tagName:O,tagExp:N,closeIndex:P,attrExpPresent:U,rawTagName:B}}function readStopNodeData(g,m,y){const k=y;let I=1;for(;y<g.length;y++)if("<"===g[y])if("/"===g[y+1]){const N=findClosingIndex(g,">",y,`${m} is not closed`);if(g.substring(y+2,N).trim()===m&&(I--,0===I))return{tagContent:g.substring(k,y),i:N};y=N}else if("?"===g[y+1]){y=findClosingIndex(g,"?>",y+1,"StopNode is not closed.")}else if("!--"===g.substr(y+1,3)){y=findClosingIndex(g,"--\x3e",y+3,"StopNode is not closed.")}else if("!["===g.substr(y+1,2)){y=findClosingIndex(g,"]]>",y,"StopNode is not closed.")-2}else{const k=readTagExp(g,y,">");if(k){(k&&k.tagName)===m&&"/"!==k.tagExp[k.tagExp.length-1]&&I++,y=k.closeIndex}}}function parseValue(g,m,y){if(m&&"string"==typeof g){const m=g.trim();return"true"===m||"false"!==m&&hr(g,y)}return Qi.isExist(g)?g:""}var fr=class OrderedObjParser{constructor(g){this.options=g,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(g,m)=>String.fromCharCode(Number.parseInt(m,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(g,m)=>String.fromCharCode(Number.parseInt(m,16))}},this.addExternalEntities=addExternalEntities,this.parseXml=parseXml,this.parseTextData=parseTextData,this.resolveNameSpace=resolveNameSpace,this.buildAttributesMap=buildAttributesMap,this.isItStopNode=isItStopNode,this.replaceEntitiesValue=replaceEntitiesValue$1,this.readStopNodeData=readStopNodeData,this.saveTextToParentTag=saveTextToParentTag,this.addChild=addChild}},gr={};function compress(g,m,y){let k;const I={};for(let N=0;N<g.length;N++){const P=g[N],z=propName$1(P);let O="";if(O=void 0===y?z:y+"."+z,z===m.textNodeName)void 0===k?k=P[z]:k+=""+P[z];else{if(void 0===z)continue;if(P[z]){let g=compress(P[z],m,O);const y=isLeafTag(g,m);P[":@"]?assignAttributes(g,P[":@"],O,m):1!==Object.keys(g).length||void 0===g[m.textNodeName]||m.alwaysCreateTextNode?0===Object.keys(g).length&&(m.alwaysCreateTextNode?g[m.textNodeName]="":g=""):g=g[m.textNodeName],void 0!==I[z]&&I.hasOwnProperty(z)?(Array.isArray(I[z])||(I[z]=[I[z]]),I[z].push(g)):m.isArray(z,O,y)?I[z]=[g]:I[z]=g}}}return"string"==typeof k?k.length>0&&(I[m.textNodeName]=k):void 0!==k&&(I[m.textNodeName]=k),I}function propName$1(g){const m=Object.keys(g);for(let g=0;g<m.length;g++){const y=m[g];if(":@"!==y)return y}}function assignAttributes(g,m,y,k){if(m){const I=Object.keys(m),N=I.length;for(let P=0;P<N;P++){const N=I[P];k.isArray(N,y+"."+N,!0,!0)?g[N]=[m[N]]:g[N]=m[N]}}}function isLeafTag(g,m){const{textNodeName:y}=m,k=Object.keys(g).length;return 0===k||!(1!==k||!g[y]&&"boolean"!=typeof g[y]&&0!==g[y])}gr.prettify=function prettify$1(g,m){return compress(g,m)};const{buildOptions:mr}=$i,br=fr,{prettify:vr}=gr,wr=Ri;var yr=class XMLParser{constructor(g){this.externalEntities={},this.options=mr(g)}parse(g,m){if("string"==typeof g);else{if(!g.toString)throw new Error("XML data is accepted in String or Bytes[] form.");g=g.toString()}if(m){!0===m&&(m={});const y=wr.validate(g,m);if(!0!==y)throw Error(`${y.err.msg}:${y.err.line}:${y.err.col}`)}const y=new br(this.options);y.addExternalEntities(this.externalEntities);const k=y.parseXml(g);return this.options.preserveOrder||void 0===k?k:vr(k,this.options)}addEntity(g,m){if(-1!==m.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==g.indexOf("&")||-1!==g.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===m)throw new Error("An entity with value '&' is not permitted");this.externalEntities[g]=m}};function arrToStr(g,m,y,k){let I="",N=!1;for(let P=0;P<g.length;P++){const z=g[P],O=propName(z);if(void 0===O)continue;let U="";if(U=0===y.length?O:`${y}.${O}`,O===m.textNodeName){let g=z[O];isStopNode(U,m)||(g=m.tagValueProcessor(O,g),g=replaceEntitiesValue(g,m)),N&&(I+=k),I+=g,N=!1;continue}if(O===m.cdataPropName){N&&(I+=k),I+=`<![CDATA[${z[O][0][m.textNodeName]}]]>`,N=!1;continue}if(O===m.commentPropName){I+=k+`\x3c!--${z[O][0][m.textNodeName]}--\x3e`,N=!0;continue}if("?"===O[0]){const g=attr_to_str(z[":@"],m),y="?xml"===O?"":k;let P=z[O][0][m.textNodeName];P=0!==P.length?" "+P:"",I+=y+`<${O}${P}${g}?>`,N=!0;continue}let B=k;""!==B&&(B+=m.indentBy);const M=k+`<${O}${attr_to_str(z[":@"],m)}`,j=arrToStr(z[O],m,U,B);-1!==m.unpairedTags.indexOf(O)?m.suppressUnpairedNode?I+=M+">":I+=M+"/>":j&&0!==j.length||!m.suppressEmptyNode?j&&j.endsWith(">")?I+=M+`>${j}${k}</${O}>`:(I+=M+">",j&&""!==k&&(j.includes("/>")||j.includes("</"))?I+=k+m.indentBy+j+k:I+=j,I+=`</${O}>`):I+=M+"/>",N=!0}return I}function propName(g){const m=Object.keys(g);for(let y=0;y<m.length;y++){const k=m[y];if(g.hasOwnProperty(k)&&":@"!==k)return k}}function attr_to_str(g,m){let y="";if(g&&!m.ignoreAttributes)for(let k in g){if(!g.hasOwnProperty(k))continue;let I=m.attributeValueProcessor(k,g[k]);I=replaceEntitiesValue(I,m),!0===I&&m.suppressBooleanAttributes?y+=` ${k.substr(m.attributeNamePrefix.length)}`:y+=` ${k.substr(m.attributeNamePrefix.length)}="${I}"`}return y}function isStopNode(g,m){let y=(g=g.substr(0,g.length-m.textNodeName.length-1)).substr(g.lastIndexOf(".")+1);for(let k in m.stopNodes)if(m.stopNodes[k]===g||m.stopNodes[k]==="*."+y)return!0;return!1}function replaceEntitiesValue(g,m){if(g&&g.length>0&&m.processEntities)for(let y=0;y<m.entities.length;y++){const k=m.entities[y];g=g.replace(k.regex,k.val)}return g}const xr=function toXml(g,m){let y="";return m.format&&m.indentBy.length>0&&(y="\n"),arrToStr(g,m,"",y)},kr={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(g,m){return m},attributeValueProcessor:function(g,m){return m},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Builder(g){this.options=Object.assign({},kr,g),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=isAttribute),this.processTextOrObjNode=processTextOrObjNode,this.options.format?(this.indentate=indentate,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function processTextOrObjNode(g,m,y){const k=this.j2x(g,y+1);return void 0!==g[this.options.textNodeName]&&1===Object.keys(g).length?this.buildTextValNode(g[this.options.textNodeName],m,k.attrStr,y):this.buildObjectNode(k.val,m,k.attrStr,y)}function indentate(g){return this.options.indentBy.repeat(g)}function isAttribute(g){return!(!g.startsWith(this.options.attributeNamePrefix)||g===this.options.textNodeName)&&g.substr(this.attrPrefixLen)}Builder.prototype.build=function(g){return this.options.preserveOrder?xr(g,this.options):(Array.isArray(g)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(g={[this.options.arrayNodeName]:g}),this.j2x(g,0).val)},Builder.prototype.j2x=function(g,m){let y="",k="";for(let I in g)if(Object.prototype.hasOwnProperty.call(g,I))if(void 0===g[I])this.isAttribute(I)&&(k+="");else if(null===g[I])this.isAttribute(I)?k+="":"?"===I[0]?k+=this.indentate(m)+"<"+I+"?"+this.tagEndChar:k+=this.indentate(m)+"<"+I+"/"+this.tagEndChar;else if(g[I]instanceof Date)k+=this.buildTextValNode(g[I],I,"",m);else if("object"!=typeof g[I]){const N=this.isAttribute(I);if(N)y+=this.buildAttrPairStr(N,""+g[I]);else if(I===this.options.textNodeName){let m=this.options.tagValueProcessor(I,""+g[I]);k+=this.replaceEntitiesValue(m)}else k+=this.buildTextValNode(g[I],I,"",m)}else if(Array.isArray(g[I])){const y=g[I].length;let N="";for(let P=0;P<y;P++){const y=g[I][P];void 0===y||(null===y?"?"===I[0]?k+=this.indentate(m)+"<"+I+"?"+this.tagEndChar:k+=this.indentate(m)+"<"+I+"/"+this.tagEndChar:"object"==typeof y?this.options.oneListGroup?N+=this.j2x(y,m+1).val:N+=this.processTextOrObjNode(y,I,m):N+=this.buildTextValNode(y,I,"",m))}this.options.oneListGroup&&(N=this.buildObjectNode(N,I,"",m)),k+=N}else if(this.options.attributesGroupName&&I===this.options.attributesGroupName){const m=Object.keys(g[I]),k=m.length;for(let N=0;N<k;N++)y+=this.buildAttrPairStr(m[N],""+g[I][m[N]])}else k+=this.processTextOrObjNode(g[I],I,m);return{attrStr:y,val:k}},Builder.prototype.buildAttrPairStr=function(g,m){return m=this.options.attributeValueProcessor(g,""+m),m=this.replaceEntitiesValue(m),this.options.suppressBooleanAttributes&&"true"===m?" "+g:" "+g+'="'+m+'"'},Builder.prototype.buildObjectNode=function(g,m,y,k){if(""===g)return"?"===m[0]?this.indentate(k)+"<"+m+y+"?"+this.tagEndChar:this.indentate(k)+"<"+m+y+this.closeTag(m)+this.tagEndChar;{let I="</"+m+this.tagEndChar,N="";return"?"===m[0]&&(N="?",I=""),!y&&""!==y||-1!==g.indexOf("<")?!1!==this.options.commentPropName&&m===this.options.commentPropName&&0===N.length?this.indentate(k)+`\x3c!--${g}--\x3e`+this.newLine:this.indentate(k)+"<"+m+y+N+this.tagEndChar+g+this.indentate(k)+I:this.indentate(k)+"<"+m+y+N+">"+g+I}},Builder.prototype.closeTag=function(g){let m="";return-1!==this.options.unpairedTags.indexOf(g)?this.options.suppressUnpairedNode||(m="/"):m=this.options.suppressEmptyNode?"/":`></${g}`,m},Builder.prototype.buildTextValNode=function(g,m,y,k){if(!1!==this.options.cdataPropName&&m===this.options.cdataPropName)return this.indentate(k)+`<![CDATA[${g}]]>`+this.newLine;if(!1!==this.options.commentPropName&&m===this.options.commentPropName)return this.indentate(k)+`\x3c!--${g}--\x3e`+this.newLine;if("?"===m[0])return this.indentate(k)+"<"+m+y+"?"+this.tagEndChar;{let I=this.options.tagValueProcessor(m,g);return I=this.replaceEntitiesValue(I),""===I?this.indentate(k)+"<"+m+y+this.closeTag(m)+this.tagEndChar:this.indentate(k)+"<"+m+y+">"+I+"</"+m+this.tagEndChar}},Builder.prototype.replaceEntitiesValue=function(g){if(g&&g.length>0&&this.options.processEntities)for(let m=0;m<this.options.entities.length;m++){const y=this.options.entities[m];g=g.replace(y.regex,y.val)}return g};var Er={XMLParser:yr,XMLValidator:Ri,XMLBuilder:Builder};const{XMLParser:Ar,XMLValidator:Tr}=Er,isSvg=g=>{if(null==g)return!1;if(0===(g=g.toString().trim()).length)return!1;if(!0!==Tr.validate(g))return!1;let m;const y=new Ar;try{m=y.parse(g)}catch(g){return!1}return!!m&&"svg"in m};Bi.exports=isSvg,Ui.default=isSvg;exports.Cache=Cache,exports.GB=g=>1e9*g,exports.MemoryCache=class MemoryCache extends Cache{config;cache;constructor(g={}){super(),this.config={maxSize:g?.maxSize??mB(50),ttl:g?.ttl??86400,tbd:g?.tbd??31536e3},this.cache=new Fi({ttl:this.config.ttl,allowStale:!0,updateAgeOnGet:!0,maxSize:this.config.maxSize,sizeCalculation:g=>g.byteLength})}async status(g){return this.cache.has(g)?exports.CacheStatus.HIT:exports.CacheStatus.MISS}async has(g){return this.cache.has(g)}async get(g){return this.cache.get(g)??null}async set(g,m){this.cache.set(g,m,{size:m.byteLength})}async clear(){this.cache.clear()}},exports.RemixImageError=RemixImageError,exports.UnsupportedImageError=UnsupportedImageError,exports.fsResolver=async(y,k,I,N)=>{const P=m.resolve(N,y.slice(1)),z=g.readFileSync(P);if(!z||z.byteLength<2)throw new RemixImageError("Invalid image retrieved from resolver!");let O=null;try{O=g$1(z)}catch(g){if(!Ui((new TextDecoder).decode(z)))throw new UnsupportedImageError("Buffer is not a supported image type!");O=exports.MimeType.SVG}return{buffer:new Uint8Array(z),contentType:O}},exports.generateKey=(...g)=>g.filter((g=>null!=g)).join("_"),exports.imageLoader=async({selfUrl:g,cache:m=null,resolver:y,transformer:k=Ii,useFallbackFormat:I=!0,fallbackFormat:N,useFallbackTransformer:P=!0,fallbackTransformer:O=Ii,defaultOptions:U={},redirectOnFail:B=!1,skipFormats:M=new Set([exports.MimeType.SVG]),basePath:j="public",whitelistedDomains:G=null,blacklistedDomains:H=null,verbose:V=!1},$)=>{const q=parseURL($.url);let Z=null;try{if(!g)throw new RemixImageError("selfUrl is required in RemixImage loader config!",500);let B;try{B=new URL(g)}catch(g){throw new RemixImageError("selfUrl is not a valid URL!")}const $=G?new Set([...G,B.host]):null,tt=H?new Set(H):null;if(K=q.searchParams,Q="src",Z=K.has(Q)?decodeURIComponent(K.get(Q)):null,!Z)throw new RemixImageError("An image URL must be provided!",400);try{Z=decodeURI(Z)}catch(g){throw new RemixImageError("An invalid image URL was provided!",400)}const et=(g=>{const m=z.parse(g,{arrayFormat:"bracket",parseNumbers:!0,parseBooleans:!0,sort:!1});return Object.prototype.hasOwnProperty.call(m,"crop")&&null!=m.crop&&(m.crop=JSON.parse(m.crop)),m})(q.search),vt={fit:"cover",position:"center",background:[0,0,0,0],quality:80,compressionLevel:9,loop:0,delay:100,blurRadius:null,rotate:null,flip:null,crop:null,...U,...et},yt=parseURL(Z,g);if(!vt.width)throw new RemixImageError("A width is required!",400);if(vt.width&&vt.width>8e3)throw new RemixImageError("Requested Image too large!",406);if(vt.height&&vt.height>8e3)throw new RemixImageError("Requested Image too large!",406);const xt=q.search;let kt,Et,It,zt=!0,Ut=!0,Bt=vt.contentType;if(m&&await m.has(xt)){const g=await m.get(xt);g&&(V&&console.log(`Retrieved image [${xt}] from cache.`),zt=!1,Ut=!1,kt=g,It=g$1(kt))}if(!kt){if($&&!$.has(yt.host))throw new RemixImageError("The requested image host is not included on the whitelist!");if(tt&&tt.has(yt.host))throw new RemixImageError("The requested image host is not allowed!");const g=await(y?.(Z,yt.toString(),vt,j));V&&console.log(`Fetched image [${xt}] directly using resolver: ${y?.name}.`),zt=!0,Ut=!0,kt=g?.buffer,It=g?.contentType}if(!kt||!It)throw new RemixImageError("Failed to transform requested image!",500);if(Bt||(Bt=It),!Ut||M?.has(It))Et=kt;else if(null!=k){let g=k;if(!k.supportedInputs.has(It)){if(!P||k===O||!O.supportedInputs.has(It))throw new UnsupportedImageError(`Transformer does not allow this input content type: ${It}!`);console.error(`Transformer does not allow this input content type: ${It}! Falling back to transformer: ${O.name}`),g=O}g.supportedOutputs.has(Bt)||(I&&null!=N&&g.supportedOutputs.has(N)?(console.error(`Transformer does not allow this output content type: ${Bt}! Falling back to mime type: ${N}`),Bt=N):(console.error(`Transformer does not allow this output content type: ${Bt}! Falling back to mime type: ${g.fallbackOutput}`),Bt=g.fallbackOutput)),Et=await g.transform({url:yt.toString(),data:kt,contentType:It},{...vt,contentType:Bt}),V&&console.log(`Successfully transformed image using transformer: ${g.name}`)}if(!Et)throw new RemixImageError("Failed to transform requested image!",500);return zt&&m&&await m.set(xt,Et),W=Et,X=200,Y=Bt,J=m?`private, max-age=${m.config.ttl}, max-stale=${m.config.tbd}`:"public, max-age=31536000",new Response(W,{status:X,headers:{"Content-Type":Y,"Cache-Control":J}})}catch(g){if("undefined"!=typeof process&&"test"===process?.env?.NODE_ENV)throw g;return console.error("RemixImage loader error:",g?.message),console.error(g),B&&Z?new Response(null,{status:302,headers:{Location:Z}}):g instanceof RemixImageError?textResponse(g.errorCode||500,g.message):textResponse(500,"RemixImage encountered an unknown error!")}var W,X,Y,J,K,Q},exports.kB=g=>1e3*g,exports.mB=mB,exports.pureTransformer=Ii,exports.version="1.4.0";
//# sourceMappingURL=index.js.map
