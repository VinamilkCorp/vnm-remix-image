"use strict";const g="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,m="function"==typeof AbortController?AbortController:class AbortController{constructor(){this.signal=new z}abort(g=new Error("This operation was aborted")){this.signal.reason=this.signal.reason||g,this.signal.aborted=!0,this.signal.dispatchEvent({type:"abort",target:this.signal})}},y="function"==typeof AbortSignal,k="function"==typeof m.AbortSignal,z=y?AbortSignal:k?m.AbortController:class AbortSignal{constructor(){this.reason=void 0,this.aborted=!1,this._listeners=[]}dispatchEvent(g){"abort"===g.type&&(this.aborted=!0,this.onabort(g),this._listeners.forEach((m=>m(g)),this))}onabort(){}addEventListener(g,m){"abort"===g&&this._listeners.push(m)}removeEventListener(g,m){"abort"===g&&(this._listeners=this._listeners.filter((g=>g!==m)))}},I=new Set,deprecatedOption=(g,m)=>{const y=`LRU_CACHE_OPTION_${g}`;shouldWarn(y)&&warn(y,`${g} option`,`options.${m}`,LRUCache)},deprecatedMethod=(g,m)=>{const y=`LRU_CACHE_METHOD_${g}`;if(shouldWarn(y)){const{prototype:k}=LRUCache,{get:z}=Object.getOwnPropertyDescriptor(k,g);warn(y,`${g} method`,`cache.${m}()`,z)}},emitWarning=(...g)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...g):console.error(...g)},shouldWarn=g=>!I.has(g),warn=(g,m,y,k)=>{I.add(g);emitWarning(`The ${m} is deprecated. Please use ${y} instead.`,"DeprecationWarning",g,k)},isPosInt=g=>g&&g===Math.floor(g)&&g>0&&isFinite(g),getUintArray=g=>isPosInt(g)?g<=Math.pow(2,8)?Uint8Array:g<=Math.pow(2,16)?Uint16Array:g<=Math.pow(2,32)?Uint32Array:g<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null;class ZeroArray extends Array{constructor(g){super(g),this.fill(0)}}class Stack{constructor(g){if(0===g)return[];const m=getUintArray(g);this.heap=new m(g),this.length=0}push(g){this.heap[this.length++]=g}pop(){return this.heap[--this.length]}}class LRUCache{constructor(g={}){const{max:m=0,ttl:y,ttlResolution:k=1,ttlAutopurge:z,updateAgeOnGet:U,updateAgeOnHas:B,allowStale:P,dispose:M,disposeAfter:O,noDisposeOnSet:H,noUpdateTTL:G,maxSize:N=0,maxEntrySize:j=0,sizeCalculation:q,fetchMethod:Z,fetchContext:V,noDeleteOnFetchRejection:$,noDeleteOnStaleGet:W,allowStaleOnFetchRejection:X,allowStaleOnFetchAbort:Y,ignoreFetchAbort:J}=g,{length:K,maxAge:Q,stale:tt}=g instanceof LRUCache?{}:g;if(0!==m&&!isPosInt(m))throw new TypeError("max option must be a nonnegative integer");const et=m?getUintArray(m):Array;if(!et)throw new Error("invalid max value: "+m);if(this.max=m,this.maxSize=N,this.maxEntrySize=j||this.maxSize,this.sizeCalculation=q||K,this.sizeCalculation){if(!this.maxSize&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=Z||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.fetchContext=V,!this.fetchMethod&&void 0!==V)throw new TypeError("cannot set fetchContext without fetchMethod");if(this.keyMap=new Map,this.keyList=new Array(m).fill(null),this.valList=new Array(m).fill(null),this.next=new et(m),this.prev=new et(m),this.head=0,this.tail=0,this.free=new Stack(m),this.initialFill=1,this.size=0,"function"==typeof M&&(this.dispose=M),"function"==typeof O?(this.disposeAfter=O,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!H,this.noUpdateTTL=!!G,this.noDeleteOnFetchRejection=!!$,this.allowStaleOnFetchRejection=!!X,this.allowStaleOnFetchAbort=!!Y,this.ignoreFetchAbort=!!J,0!==this.maxEntrySize){if(0!==this.maxSize&&!isPosInt(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");if(!isPosInt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!P||!!tt,this.noDeleteOnStaleGet=!!W,this.updateAgeOnGet=!!U,this.updateAgeOnHas=!!B,this.ttlResolution=isPosInt(k)||0===k?k:1,this.ttlAutopurge=!!z,this.ttl=y||Q||0,this.ttl){if(!isPosInt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const g="LRU_CACHE_UNBOUNDED";if(shouldWarn(g)){I.add(g);emitWarning("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",g,LRUCache)}}tt&&deprecatedOption("stale","allowStale"),Q&&deprecatedOption("maxAge","ttl"),K&&deprecatedOption("length","sizeCalculation")}getRemainingTTL(g){return this.has(g,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new ZeroArray(this.max),this.starts=new ZeroArray(this.max),this.setItemTTL=(m,y,k=g.now())=>{if(this.starts[m]=0!==y?k:0,this.ttls[m]=y,0!==y&&this.ttlAutopurge){const g=setTimeout((()=>{this.isStale(m)&&this.delete(this.keyList[m])}),y+1);g.unref&&g.unref()}},this.updateItemAge=m=>{this.starts[m]=0!==this.ttls[m]?g.now():0},this.statusTTL=(g,y)=>{g&&(g.ttl=this.ttls[y],g.start=this.starts[y],g.now=m||getNow(),g.remainingTTL=g.now+g.ttl-g.start)};let m=0;const getNow=()=>{const y=g.now();if(this.ttlResolution>0){m=y;const g=setTimeout((()=>m=0),this.ttlResolution);g.unref&&g.unref()}return y};this.getRemainingTTL=g=>{const y=this.keyMap.get(g);return void 0===y?0:0===this.ttls[y]||0===this.starts[y]?1/0:this.starts[y]+this.ttls[y]-(m||getNow())},this.isStale=g=>0!==this.ttls[g]&&0!==this.starts[g]&&(m||getNow())-this.starts[g]>this.ttls[g]}updateItemAge(g){}statusTTL(g,m){}setItemTTL(g,m,y){}isStale(g){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new ZeroArray(this.max),this.removeItemSize=g=>{this.calculatedSize-=this.sizes[g],this.sizes[g]=0},this.requireSize=(g,m,y,k)=>{if(this.isBackgroundFetch(m))return 0;if(!isPosInt(y)){if(!k)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof k)throw new TypeError("sizeCalculation must be a function");if(y=k(m,g),!isPosInt(y))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return y},this.addItemSize=(g,m,y)=>{if(this.sizes[g]=m,this.maxSize){const m=this.maxSize-this.sizes[g];for(;this.calculatedSize>m;)this.evict(!0)}this.calculatedSize+=this.sizes[g],y&&(y.entrySize=m,y.totalCalculatedSize=this.calculatedSize)}}removeItemSize(g){}addItemSize(g,m){}requireSize(g,m,y,k){if(y||k)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache")}*indexes({allowStale:g=this.allowStale}={}){if(this.size)for(let m=this.tail;this.isValidIndex(m)&&(!g&&this.isStale(m)||(yield m),m!==this.head);)m=this.prev[m]}*rindexes({allowStale:g=this.allowStale}={}){if(this.size)for(let m=this.head;this.isValidIndex(m)&&(!g&&this.isStale(m)||(yield m),m!==this.tail);)m=this.next[m]}isValidIndex(g){return void 0!==g&&this.keyMap.get(this.keyList[g])===g}*entries(){for(const g of this.indexes())void 0===this.valList[g]||void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield[this.keyList[g],this.valList[g]])}*rentries(){for(const g of this.rindexes())void 0===this.valList[g]||void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield[this.keyList[g],this.valList[g]])}*keys(){for(const g of this.indexes())void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.keyList[g])}*rkeys(){for(const g of this.rindexes())void 0===this.keyList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.keyList[g])}*values(){for(const g of this.indexes())void 0===this.valList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.valList[g])}*rvalues(){for(const g of this.rindexes())void 0===this.valList[g]||this.isBackgroundFetch(this.valList[g])||(yield this.valList[g])}[Symbol.iterator](){return this.entries()}find(g,m){for(const y of this.indexes()){const k=this.valList[y],z=this.isBackgroundFetch(k)?k.__staleWhileFetching:k;if(void 0!==z&&g(z,this.keyList[y],this))return this.get(this.keyList[y],m)}}forEach(g,m=this){for(const y of this.indexes()){const k=this.valList[y],z=this.isBackgroundFetch(k)?k.__staleWhileFetching:k;void 0!==z&&g.call(m,z,this.keyList[y],this)}}rforEach(g,m=this){for(const y of this.rindexes()){const k=this.valList[y],z=this.isBackgroundFetch(k)?k.__staleWhileFetching:k;void 0!==z&&g.call(m,z,this.keyList[y],this)}}get prune(){return deprecatedMethod("prune","purgeStale"),this.purgeStale}purgeStale(){let g=!1;for(const m of this.rindexes({allowStale:!0}))this.isStale(m)&&(this.delete(this.keyList[m]),g=!0);return g}dump(){const m=[];for(const y of this.indexes({allowStale:!0})){const k=this.keyList[y],z=this.valList[y],I=this.isBackgroundFetch(z)?z.__staleWhileFetching:z;if(void 0===I)continue;const U={value:I};if(this.ttls){U.ttl=this.ttls[y];const m=g.now()-this.starts[y];U.start=Math.floor(Date.now()-m)}this.sizes&&(U.size=this.sizes[y]),m.unshift([k,U])}return m}load(m){this.clear();for(const[y,k]of m){if(k.start){const m=Date.now()-k.start;k.start=g.now()-m}this.set(y,k.value,k)}}dispose(g,m,y){}set(g,m,{ttl:y=this.ttl,start:k,noDisposeOnSet:z=this.noDisposeOnSet,size:I=0,sizeCalculation:U=this.sizeCalculation,noUpdateTTL:B=this.noUpdateTTL,status:P}={}){if(I=this.requireSize(g,m,I,U),this.maxEntrySize&&I>this.maxEntrySize)return P&&(P.set="miss",P.maxEntrySizeExceeded=!0),this.delete(g),this;let M=0===this.size?void 0:this.keyMap.get(g);if(void 0===M)M=this.newIndex(),this.keyList[M]=g,this.valList[M]=m,this.keyMap.set(g,M),this.next[this.tail]=M,this.prev[M]=this.tail,this.tail=M,this.size++,this.addItemSize(M,I,P),P&&(P.set="add"),B=!1;else{this.moveToTail(M);const y=this.valList[M];if(m!==y){if(this.isBackgroundFetch(y)?y.__abortController.abort(new Error("replaced")):z||(this.dispose(y,g,"set"),this.disposeAfter&&this.disposed.push([y,g,"set"])),this.removeItemSize(M),this.valList[M]=m,this.addItemSize(M,I,P),P){P.set="replace";const g=y&&this.isBackgroundFetch(y)?y.__staleWhileFetching:y;void 0!==g&&(P.oldValue=g)}}else P&&(P.set="update")}if(0===y||0!==this.ttl||this.ttls||this.initializeTTLTracking(),B||this.setItemTTL(M,y,k),this.statusTTL(P,M),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max&&0!==this.max?this.evict(!1):0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const g=this.valList[this.head];return this.evict(!0),g}}evict(g){const m=this.head,y=this.keyList[m],k=this.valList[m];return this.isBackgroundFetch(k)?k.__abortController.abort(new Error("evicted")):(this.dispose(k,y,"evict"),this.disposeAfter&&this.disposed.push([k,y,"evict"])),this.removeItemSize(m),g&&(this.keyList[m]=null,this.valList[m]=null,this.free.push(m)),this.head=this.next[m],this.keyMap.delete(y),this.size--,m}has(g,{updateAgeOnHas:m=this.updateAgeOnHas,status:y}={}){const k=this.keyMap.get(g);if(void 0!==k){if(!this.isStale(k))return m&&this.updateItemAge(k),y&&(y.has="hit"),this.statusTTL(y,k),!0;y&&(y.has="stale",this.statusTTL(y,k))}else y&&(y.has="miss");return!1}peek(g,{allowStale:m=this.allowStale}={}){const y=this.keyMap.get(g);if(void 0!==y&&(m||!this.isStale(y))){const g=this.valList[y];return this.isBackgroundFetch(g)?g.__staleWhileFetching:g}}backgroundFetch(g,y,k,z){const I=void 0===y?void 0:this.valList[y];if(this.isBackgroundFetch(I))return I;const U=new m;k.signal&&k.signal.addEventListener("abort",(()=>U.abort(k.signal.reason)));const B={signal:U.signal,options:k,context:z},cb=(m,z=!1)=>{const{aborted:I}=U.signal,M=k.ignoreFetchAbort&&void 0!==m;return k.status&&(I&&!z?(k.status.fetchAborted=!0,k.status.fetchError=U.signal.reason,M&&(k.status.fetchAbortIgnored=!0)):k.status.fetchResolved=!0),!I||M||z?(this.valList[y]===P&&(void 0===m?P.__staleWhileFetching?this.valList[y]=P.__staleWhileFetching:this.delete(g):(k.status&&(k.status.fetchUpdated=!0),this.set(g,m,B.options))),m):fetchFail(U.signal.reason)},fetchFail=m=>{const{aborted:z}=U.signal,I=z&&k.allowStaleOnFetchAbort,B=I||k.allowStaleOnFetchRejection,M=B||k.noDeleteOnFetchRejection;if(this.valList[y]===P){!M||void 0===P.__staleWhileFetching?this.delete(g):I||(this.valList[y]=P.__staleWhileFetching)}if(B)return k.status&&void 0!==P.__staleWhileFetching&&(k.status.returnedStale=!0),P.__staleWhileFetching;if(P.__returned===P)throw m};k.status&&(k.status.fetchDispatched=!0);const P=new Promise(((m,y)=>{this.fetchMethod(g,I,B).then((g=>m(g)),y),U.signal.addEventListener("abort",(()=>{k.ignoreFetchAbort&&!k.allowStaleOnFetchAbort||(m(),k.allowStaleOnFetchAbort&&(m=g=>cb(g,!0)))}))})).then(cb,(g=>(k.status&&(k.status.fetchRejected=!0,k.status.fetchError=g),fetchFail(g))));return P.__abortController=U,P.__staleWhileFetching=I,P.__returned=null,void 0===y?(this.set(g,P,{...B.options,status:void 0}),y=this.keyMap.get(g)):this.valList[y]=P,P}isBackgroundFetch(g){return g&&"object"==typeof g&&"function"==typeof g.then&&Object.prototype.hasOwnProperty.call(g,"__staleWhileFetching")&&Object.prototype.hasOwnProperty.call(g,"__returned")&&(g.__returned===g||null===g.__returned)}async fetch(g,{allowStale:m=this.allowStale,updateAgeOnGet:y=this.updateAgeOnGet,noDeleteOnStaleGet:k=this.noDeleteOnStaleGet,ttl:z=this.ttl,noDisposeOnSet:I=this.noDisposeOnSet,size:U=0,sizeCalculation:B=this.sizeCalculation,noUpdateTTL:P=this.noUpdateTTL,noDeleteOnFetchRejection:M=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:O=this.allowStaleOnFetchRejection,ignoreFetchAbort:H=this.ignoreFetchAbort,allowStaleOnFetchAbort:G=this.allowStaleOnFetchAbort,fetchContext:N=this.fetchContext,forceRefresh:j=!1,status:q,signal:Z}={}){if(!this.fetchMethod)return q&&(q.fetch="get"),this.get(g,{allowStale:m,updateAgeOnGet:y,noDeleteOnStaleGet:k,status:q});const V={allowStale:m,updateAgeOnGet:y,noDeleteOnStaleGet:k,ttl:z,noDisposeOnSet:I,size:U,sizeCalculation:B,noUpdateTTL:P,noDeleteOnFetchRejection:M,allowStaleOnFetchRejection:O,allowStaleOnFetchAbort:G,ignoreFetchAbort:H,status:q,signal:Z};let $=this.keyMap.get(g);if(void 0===$){q&&(q.fetch="miss");const m=this.backgroundFetch(g,$,V,N);return m.__returned=m}{const k=this.valList[$];if(this.isBackgroundFetch(k)){const g=m&&void 0!==k.__staleWhileFetching;return q&&(q.fetch="inflight",g&&(q.returnedStale=!0)),g?k.__staleWhileFetching:k.__returned=k}const z=this.isStale($);if(!j&&!z)return q&&(q.fetch="hit"),this.moveToTail($),y&&this.updateItemAge($),this.statusTTL(q,$),k;const I=this.backgroundFetch(g,$,V,N),U=void 0!==I.__staleWhileFetching,B=U&&m;return q&&(q.fetch=U&&z?"stale":"refresh",B&&z&&(q.returnedStale=!0)),B?I.__staleWhileFetching:I.__returned=I}}get(g,{allowStale:m=this.allowStale,updateAgeOnGet:y=this.updateAgeOnGet,noDeleteOnStaleGet:k=this.noDeleteOnStaleGet,status:z}={}){const I=this.keyMap.get(g);if(void 0!==I){const U=this.valList[I],B=this.isBackgroundFetch(U);return this.statusTTL(z,I),this.isStale(I)?(z&&(z.get="stale"),B?(z&&(z.returnedStale=m&&void 0!==U.__staleWhileFetching),m?U.__staleWhileFetching:void 0):(k||this.delete(g),z&&(z.returnedStale=m),m?U:void 0)):(z&&(z.get="hit"),B?U.__staleWhileFetching:(this.moveToTail(I),y&&this.updateItemAge(I),U))}z&&(z.get="miss")}connect(g,m){this.prev[m]=g,this.next[g]=m}moveToTail(g){g!==this.tail&&(g===this.head?this.head=this.next[g]:this.connect(this.prev[g],this.next[g]),this.connect(this.tail,g),this.tail=g)}get del(){return deprecatedMethod("del","delete"),this.delete}delete(g){let m=!1;if(0!==this.size){const y=this.keyMap.get(g);if(void 0!==y)if(m=!0,1===this.size)this.clear();else{this.removeItemSize(y);const m=this.valList[y];this.isBackgroundFetch(m)?m.__abortController.abort(new Error("deleted")):(this.dispose(m,g,"delete"),this.disposeAfter&&this.disposed.push([m,g,"delete"])),this.keyMap.delete(g),this.keyList[y]=null,this.valList[y]=null,y===this.tail?this.tail=this.prev[y]:y===this.head?this.head=this.next[y]:(this.next[this.prev[y]]=this.next[y],this.prev[this.next[y]]=this.prev[y]),this.size--,this.free.push(y)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return m}clear(){for(const g of this.rindexes({allowStale:!0})){const m=this.valList[g];if(this.isBackgroundFetch(m))m.__abortController.abort(new Error("deleted"));else{const y=this.keyList[g];this.dispose(m,y,"delete"),this.disposeAfter&&this.disposed.push([m,y,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return deprecatedMethod("reset","clear"),this.clear}get length(){return((g,m)=>{const y=`LRU_CACHE_PROPERTY_${g}`;if(shouldWarn(y)){const{prototype:k}=LRUCache,{get:z}=Object.getOwnPropertyDescriptor(k,g);warn(y,`${g} property`,`cache.${m}`,z)}})("length","size"),this.size}static get AbortController(){return m}static get AbortSignal(){return z}}var U,B=LRUCache;exports.CacheStatus=void 0,(U=exports.CacheStatus||(exports.CacheStatus={})).HIT="hit",U.STALE="stale",U.MISS="miss";class Cache{}const mB=g=>1e6*g;const P={0:{66:{77:"image/bmp"},71:{73:{70:"image/gif"}},73:{73:{42:{0:"image/tiff"}}},77:{77:{0:{42:"image/tiff"}}},137:{80:{78:{71:{13:{10:{26:{10:"image/png"}}}}}}},255:{216:{255:"image/jpeg"}}},4:{102:{116:{121:{112:{97:{118:{105:{102:"image/avif",115:"image/avif"}}}}}}}},8:{87:{69:{66:{80:"image/webp"}}}}},M=[0,4,8];var O;!function(g){g.SVG="image/svg+xml",g.JPEG="image/jpeg",g.PNG="image/png",g.GIF="image/gif",g.WEBP="image/webp",g.BMP="image/bmp",g.TIFF="image/tiff",g.AVIF="image/avif"}(O||(O={}));const i$1=g=>{if(!g||g.byteLength<3)throw new Error("Buffer is not a valid image!");for(const m of M){let y=P[m];for(let k=m;k<=12;k+=1){const m=g[k];if("object"!=typeof y)return y;if(!Object.prototype.hasOwnProperty.call(y,m))break;y=y[m]}}throw new Error("Buffer is not a supported image type!")};var H,G;!function(g){g.SVG="image/svg+xml",g.JPEG="image/jpeg",g.PNG="image/png",g.GIF="image/gif",g.WEBP="image/webp",g.BMP="image/bmp",g.TIFF="image/tiff",g.AVIF="image/avif"}(H||(H={})),function(g){g[g.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",g[g.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",g[g.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",g[g.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",g[g.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"}(G||(G={}));var N,j=G;class h{constructor(g,{toRGBA:m}={toRGBA:!1}){if(this.buffer=g,this.bufferView=new DataView(g.buffer,g.byteOffset,g.byteLength),this.toRGBA=!!m,this.bottomUp=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos=2,"BM"!==this.flag)throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.reserved2=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in j))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.planes=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),32===this.bitPP?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):16===this.bitPP&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>j.BITMAP_INFO_HEADER||3===this.compression||6===this.compression)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>j.BITMAP_V2_INFO_HEADER||6===this.compression)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>j.BITMAP_V3_INFO_HEADER&&(this.pos+=j.BITMAP_V4_HEADER-j.BITMAP_V3_INFO_HEADER),this.headerSize>j.BITMAP_V4_HEADER&&(this.pos+=j.BITMAP_V5_HEADER-j.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const g=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(g);for(let m=0;m<g;m++){const g=this.buffer[this.pos++],y=this.buffer[this.pos++],k=this.buffer[this.pos++],z=this.buffer[this.pos++];this.palette[m]={red:k,green:y,blue:g,quad:z}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const g=function(g,m,y,k){const z=1+~g&g,I=1+~m&m,U=1+~y&y,B=1+~k&k,P=g/z+1,M=m/I+1,O=y/U+1,H=k/B+1;return{shiftRed:m=>(m&g)/z*256/P,shiftGreen:g=>(g&m)/I*256/M,shiftBlue:g=>(g&y)/U*256/O,shiftAlpha:0!==k?g=>(g&k)/B*256/H:()=>255}}(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=g.shiftRed,this.shiftGreen=g.shiftGreen,this.shiftBlue=g.shiftBlue,this.shiftAlpha=g.shiftAlpha}parseRGBA(){switch(this.data=new Uint8Array(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const g=Math.ceil(this.width/8),m=g%4,y=0!==m?4-m:0;this.scanImage(y,g,((g,m)=>{const y=this.buffer[this.pos++],k=m*this.width*4+8*g*4;for(let m=0;m<8&&8*g+m<this.width;m++){const g=this.palette[y>>7-m&1];this.data[k+m*this.locAlpha]=0,this.data[k+4*m+this.locBlue]=g.blue,this.data[k+4*m+this.locGreen]=g.green,this.data[k+4*m+this.locRed]=g.red}}))}bit4(){if(2===this.compression){this.data.fill(0);let g=!1,m=this.bottomUp?this.height-1:0,y=0;for(;y<this.data.length;){const k=this.buffer[this.pos++],z=this.buffer[this.pos++];if(0===k){if(0===z){m+=this.bottomUp?-1:1,y=m*this.width*4,g=!1;continue}if(1===z)break;if(2===z){const g=this.buffer[this.pos++],k=this.buffer[this.pos++];m+=this.bottomUp?-k:k,y+=k*this.width*4+4*g}else{let m=this.buffer[this.pos++];for(let k=0;k<z;k++)y=this.setPixelData(y,g?15&m:(240&m)>>4),1&k&&k+1<z&&(m=this.buffer[this.pos++]),g=!g;1==(z+1>>1&1)&&this.pos++}}else for(let m=0;m<k;m++)y=this.setPixelData(y,g?15&z:(240&z)>>4),g=!g}}else{const g=Math.ceil(this.width/2),m=g%4,y=0!==m?4-m:0;this.scanImage(y,g,((g,m)=>{const y=this.buffer[this.pos++],k=m*this.width*4+2*g*4,z=y>>4;let I=this.palette[z];if(this.data[k]=0,this.data[k+1]=I.blue,this.data[k+2]=I.green,this.data[k+3]=I.red,2*g+1>=this.width)return!1;const U=15&y;I=this.palette[U],this.data[k+4]=0,this.data[k+4+1]=I.blue,this.data[k+4+2]=I.green,this.data[k+4+3]=I.red}))}}bit8(){if(1===this.compression){this.data.fill(0);let g=this.bottomUp?this.height-1:0,m=0;for(;m<this.data.length;){const y=this.buffer[this.pos++],k=this.buffer[this.pos++];if(0===y){if(0===k){g+=this.bottomUp?-1:1,m=g*this.width*4;continue}if(1===k)break;if(2===k){const y=this.buffer[this.pos++],k=this.buffer[this.pos++];g+=this.bottomUp?-k:k,m+=k*this.width*4+4*y}else{for(let g=0;g<k;g++){const g=this.buffer[this.pos++];m=this.setPixelData(m,g)}!0&k&&this.pos++}}else for(let g=0;g<y;g++)m=this.setPixelData(m,k)}}else{const g=this.width%4,m=0!==g?4-g:0;this.scanImage(m,this.width,((g,m)=>{const y=this.buffer[this.pos++],k=m*this.width*4+4*g;if(y<this.palette.length){const g=this.palette[y];this.data[k]=0,this.data[k+1]=g.blue,this.data[k+2]=g.green,this.data[k+3]=g.red}else this.data[k]=0,this.data[k+1]=255,this.data[k+2]=255,this.data[k+3]=255}))}}bit16(){const g=this.width%2*2;this.scanImage(g,this.width,((g,m)=>{const y=m*this.width*4+4*g,k=this.bufferView.getUint16(this.pos,!0);this.pos+=2,this.data[y+this.locRed]=this.shiftRed(k),this.data[y+this.locGreen]=this.shiftGreen(k),this.data[y+this.locBlue]=this.shiftBlue(k),this.data[y+this.locAlpha]=this.shiftAlpha(k)}))}bit24(){const g=this.width%4;this.scanImage(g,this.width,((g,m)=>{const y=m*this.width*4+4*g,k=this.buffer[this.pos++],z=this.buffer[this.pos++],I=this.buffer[this.pos++];this.data[y+this.locRed]=I,this.data[y+this.locGreen]=z,this.data[y+this.locBlue]=k,this.data[y+this.locAlpha]=0}))}bit32(){this.scanImage(0,this.width,((g,m)=>{const y=m*this.width*4+4*g,k=this.readUInt32LE();this.data[y+this.locRed]=this.shiftRed(k),this.data[y+this.locGreen]=this.shiftGreen(k),this.data[y+this.locBlue]=this.shiftBlue(k),this.data[y+this.locAlpha]=this.shiftAlpha(k)}))}scanImage(g=0,m=this.width,y){for(let k=this.height-1;k>=0;k--){const z=this.bottomUp?k:this.height-1-k;for(let g=0;g<m;g++)y.call(this,g,z);this.pos+=g}}readUInt32LE(){const g=this.bufferView.getUint32(this.pos,!0);return this.pos+=4,g}setPixelData(g,m){const{blue:y,green:k,red:z}=this.palette[m];return this.data[g+this.locAlpha]=0,this.data[g+1+this.locBlue]=y,this.data[g+2+this.locGreen]=k,this.data[g+3+this.locRed]=z,g+4}}function f(g){return g.reduce(((g,m)=>g<<1|m),0)}function l(g){return g.quad<<24|g.red<<16|g.green<<8|g.blue}class d{constructor(g){switch(this.buffer=g.data,this.width=g.width,this.height=g.height,this.headerSize=j.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=g.bitPP,this.offset=54,this.reserved1=g.reserved1||0,this.reserved2=g.reserved2||0,this.planes=1,this.compress=0,this.hr=g.hr||0,this.vr=g.vr||0,this.importantColors=g.importantColors||0,this.colors=Math.min(Math.pow(2,this.bitPP-1||1),g.colors||1/0),this.palette=g.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const m=this.width*this.bitPP/32,y=Math.ceil(m);this.extraBytes=4*(y-m),this.rawSize=this.height*y*4+2,this.fileSize=this.rawSize+this.offset,this.data=new Uint8Array(this.fileSize),this.dataView=new DataView(this.data.buffer),this.data.fill(1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data[this.pos++]=this.flag.charCodeAt(0),this.data[this.pos++]=this.flag.charCodeAt(1),this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.dataView.setUint16(this.pos,this.planes,!0),this.pos+=2,this.dataView.setUint16(this.pos,this.bitPP,!0),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&2===this.colors?this.initColors(1):(this.writeUInt32LE(16777215),this.writeUInt32LE(0)),this.pos+=1;let g=[];this.writeImage(((m,y,k)=>{let z=y;z++;const I=this.buffer[z++],U=this.buffer[z++],B=.2126*this.buffer[z++]+.7152*U+.0722*I;return g.push(B>127?0:1),(k+1)%8==0?(this.data[m-1]=f(g),g=[]):k===this.width-1&&g.length>0&&(this.data[m-1]=f(g)<<4,g=[]),z}))}bit4(){const g=this.initColors(4);let m=[];this.writeImage(((y,k,z)=>{let I=k;const U=l({quad:this.buffer[I++],blue:this.buffer[I++],green:this.buffer[I++],red:this.buffer[I++]}),B=g.findIndex((g=>g===U));return-1!==B?m.push(B):m.push(0),(z+1)%2==0&&(this.data[y]=m[0]<<4|m[1],m=[]),I}))}bit8(){const g=this.initColors(8);this.writeImage(((m,y)=>{let k=y;const z=l({quad:this.buffer[k++],blue:this.buffer[k++],green:this.buffer[k++],red:this.buffer[k++]}),I=g.findIndex((g=>g===z));return this.data[m]=-1!==I?I:0,k}))}bit16(){this.writeImage(((g,m)=>{let y=m+1;const k=this.buffer[y++]/8,z=this.buffer[y++]/8,I=this.buffer[y++]/8<<10|z<<5|k;return this.data[g]=255&I,this.data[g+1]=(65280&I)>>8,y}))}bit24(){this.writeImage(((g,m)=>{let y=m+1;return this.data[g]=this.buffer[y++],this.data[g+1]=this.buffer[y++],this.data[g+2]=this.buffer[y++],y}))}bit32(){this.writeImage(((g,m)=>{let y=m;return this.data[g+3]=this.buffer[y++],this.data[g]=this.buffer[y++],this.data[g+1]=this.buffer[y++],this.data[g+2]=this.buffer[y++],y}))}writeImage(g){const m=this.extraBytes+this.width*this.bytesInColor;let y=0;for(let k=0;k<this.height;k++)for(let z=0;z<this.width;z++){const I=Math.floor(this.pos+(this.height-1-k)*m+z*this.bytesInColor);y=g.call(this,I,y,z,k)}}initColors(g){const m=[];if(!this.palette.length)throw new Error(`To encode ${g}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let g=0;g<this.colors;g++){const y=l(this.palette[g]);this.writeUInt32LE(y),m.push(y)}return m}writeUInt32LE(g){this.dataView.setUint32(this.pos,g,!0),this.pos+=4}}!function(g){g[g.NONE=0]="NONE",g[g.BI_RLE8=1]="BI_RLE8",g[g.BI_RLE4=2]="BI_RLE4",g[g.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",g[g.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"}(N||(N={}));const p=g=>{const m=g.length,y=new Uint8Array(m);for(let k=0;k<m;k+=4)y[k]=g[k+3],y[k+1]=g[k+2],y[k+2]=g[k+1],y[k+3]=g[k];return y},q={decode(g){const m=((g,m)=>new h(g,m))(g,{toRGBA:!0});return{width:m.width,height:m.height,data:m.data}},encode:g=>(g=>new d(g))({bitPP:32,width:g.width,height:g.height,data:p(g.data)}).data};var Z,V,$={};function b(g,m,y,k){for(var z=g[m++],I=1<<z,U=I+1,B=U+1,P=z+1,M=(1<<P)-1,O=0,H=0,G=0,N=g[m++],j=new Int32Array(4096),q=null;;){for(;O<16&&0!==N;)H|=g[m++]<<O,O+=8,1===N?N=g[m++]:--N;if(O<P)break;var Z=H&M;if(H>>=P,O-=P,Z!==I){if(Z===U)break;for(var V=Z<B?Z:q,$=0,W=V;W>I;)W=j[W]>>8,++$;var X=W;if(G+$+(V!==Z?1:0)>k)return void console.log("Warning, gif stream longer than expected.");y[G++]=X;var Y=G+=$;for(V!==Z&&(y[G++]=X),W=V;$--;)W=j[W],y[--Y]=255&W,W>>=8;null!==q&&B<4096&&(j[B++]=q<<8|X,B>=M+1&&P<12&&(++P,M=M<<1|1)),q=Z}else B=U+1,M=(1<<(P=z+1))-1,q=null}return G!==k&&console.log("Warning, gif stream shorter than expected."),y}try{V=$.GifWriter=function(g,m,y,k){var z=0,I=void 0===(k=void 0===k?{}:k).loop?null:k.loop,U=void 0===k.palette?null:k.palette;if(m<=0||y<=0||m>65535||y>65535)throw new Error("Width/Height invalid.");function o(g){var m=g.length;if(m<2||m>256||m&m-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return m}g[z++]=71,g[z++]=73,g[z++]=70,g[z++]=56,g[z++]=57,g[z++]=97;var B=0,P=0;if(null!==U){for(var M=o(U);M>>=1;)++B;if(M=1<<B,--B,void 0!==k.background){if((P=k.background)>=M)throw new Error("Background index out of range.");if(0===P)throw new Error("Background index explicitly passed as 0.")}}if(g[z++]=255&m,g[z++]=m>>8&255,g[z++]=255&y,g[z++]=y>>8&255,g[z++]=(null!==U?128:0)|B,g[z++]=P,g[z++]=0,null!==U)for(var O=0,H=U.length;O<H;++O){var G=U[O];g[z++]=G>>16&255,g[z++]=G>>8&255,g[z++]=255&G}if(null!==I){if(I<0||I>65535)throw new Error("Loop count invalid.");g[z++]=33,g[z++]=255,g[z++]=11,g[z++]=78,g[z++]=69,g[z++]=84,g[z++]=83,g[z++]=67,g[z++]=65,g[z++]=80,g[z++]=69,g[z++]=50,g[z++]=46,g[z++]=48,g[z++]=3,g[z++]=1,g[z++]=255&I,g[z++]=I>>8&255,g[z++]=0}var N=!1;this.addFrame=function(m,y,k,I,B,P){if(!0===N&&(--z,N=!1),P=void 0===P?{}:P,m<0||y<0||m>65535||y>65535)throw new Error("x/y invalid.");if(k<=0||I<=0||k>65535||I>65535)throw new Error("Width/Height invalid.");if(B.length<k*I)throw new Error("Not enough pixels for the frame size.");var M=!0,O=P.palette;if(null==O&&(M=!1,O=U),null==O)throw new Error("Must supply either a local or global palette.");for(var H=o(O),G=0;H>>=1;)++G;H=1<<G;var j=void 0===P.delay?0:P.delay,q=void 0===P.disposal?0:P.disposal;if(q<0||q>3)throw new Error("Disposal out of range.");var Z=!1,V=0;if(void 0!==P.transparent&&null!==P.transparent&&(Z=!0,(V=P.transparent)<0||V>=H))throw new Error("Transparent color index.");if((0!==q||Z||0!==j)&&(g[z++]=33,g[z++]=249,g[z++]=4,g[z++]=q<<2|(!0===Z?1:0),g[z++]=255&j,g[z++]=j>>8&255,g[z++]=V,g[z++]=0),g[z++]=44,g[z++]=255&m,g[z++]=m>>8&255,g[z++]=255&y,g[z++]=y>>8&255,g[z++]=255&k,g[z++]=k>>8&255,g[z++]=255&I,g[z++]=I>>8&255,g[z++]=!0===M?128|G-1:0,!0===M)for(var $=0,W=O.length;$<W;++$){var X=O[$];g[z++]=X>>16&255,g[z++]=X>>8&255,g[z++]=255&X}return z=function(g,m,y,k){g[m++]=y;var z=m++,I=1<<y,U=I-1,B=I+1,P=B+1,M=y+1,O=0,H=0;function u(y){for(;O>=y;)g[m++]=255&H,H>>=8,O-=8,m===z+256&&(g[z]=255,z=m++)}function c(g){H|=g<<O,O+=M,u(8)}var G=k[0]&U,N={};c(I);for(var j=1,q=k.length;j<q;++j){var Z=k[j]&U,V=G<<8|Z,$=N[V];if(void 0===$){for(H|=G<<O,O+=M;O>=8;)g[m++]=255&H,H>>=8,O-=8,m===z+256&&(g[z]=255,z=m++);4096===P?(c(I),P=B+1,M=y+1,N={}):(P>=1<<M&&++M,N[V]=P++),G=Z}else G=$}return c(G),c(B),u(1),z+1===m?g[z]=0:(g[z]=m-z-1,g[m++]=0),m}(g,z,G<2?2:G,B),z},this.end=function(){return!1===N&&(g[z++]=59,N=!0),z},this.getOutputBuffer=function(){return g},this.setOutputBuffer=function(m){g=m},this.getOutputBufferPosition=function(){return z},this.setOutputBufferPosition=function(g){z=g}},Z=$.GifReader=function(g){var m=0;if(71!==g[m++]||73!==g[m++]||70!==g[m++]||56!==g[m++]||56!=(g[m++]+1&253)||97!==g[m++])throw new Error("Invalid GIF 87a/89a header.");var y=g[m++]|g[m++]<<8,k=g[m++]|g[m++]<<8,z=g[m++],I=z>>7,U=1<<1+(7&z);g[m++],g[m++];var B=null,P=null;I&&(B=m,P=U,m+=3*U);var M=!0,O=[],H=0,G=null,N=0,j=null;for(this.width=y,this.height=k;M&&m<g.length;)switch(g[m++]){case 33:switch(g[m++]){case 255:if(11!==g[m]||78==g[m+1]&&69==g[m+2]&&84==g[m+3]&&83==g[m+4]&&67==g[m+5]&&65==g[m+6]&&80==g[m+7]&&69==g[m+8]&&50==g[m+9]&&46==g[m+10]&&48==g[m+11]&&3==g[m+12]&&1==g[m+13]&&0==g[m+16])m+=14,j=g[m++]|g[m++]<<8,m++;else for(m+=12;;){if(!((vt=g[m++])>=0))throw Error("Invalid block size");if(0===vt)break;m+=vt}break;case 249:if(4!==g[m++]||0!==g[m+4])throw new Error("Invalid graphics extension block.");var q=g[m++];H=g[m++]|g[m++]<<8,G=g[m++],!(1&q)&&(G=null),N=q>>2&7,m++;break;case 254:for(;;){if(!((vt=g[m++])>=0))throw Error("Invalid block size");if(0===vt)break;m+=vt}break;default:throw new Error("Unknown graphic control label: 0x"+g[m-1].toString(16))}break;case 44:var Z=g[m++]|g[m++]<<8,V=g[m++]|g[m++]<<8,$=g[m++]|g[m++]<<8,W=g[m++]|g[m++]<<8,X=g[m++],Y=X>>6&1,J=1<<1+(7&X),K=B,Q=P,tt=!1;X>>7&&(tt=!0,K=m,Q=J,m+=3*J);var et=m;for(m++;;){var vt;if(!((vt=g[m++])>=0))throw Error("Invalid block size");if(0===vt)break;m+=vt}O.push({x:Z,y:V,width:$,height:W,has_local_palette:tt,palette_offset:K,palette_size:Q,data_offset:et,data_length:m-et,transparent_index:G,interlaced:!!Y,delay:H,disposal:N});break;case 59:M=!1;break;default:throw new Error("Unknown gif block: 0x"+g[m-1].toString(16))}this.numFrames=function(){return O.length},this.loopCount=function(){return j},this.frameInfo=function(g){if(g<0||g>=O.length)throw new Error("Frame index out of range.");return O[g]},this.decodeAndBlitFrameBGRA=function(m,k){var z=this.frameInfo(m),I=z.width*z.height,U=new Uint8Array(I);b(g,z.data_offset,U,I);var B=z.palette_offset,P=z.transparent_index;null===P&&(P=256);var M=z.width,O=y-M,H=M,G=4*(z.y*y+z.x),N=4*((z.y+z.height)*y+z.x),j=G,q=4*O;!0===z.interlaced&&(q+=4*y*7);for(var Z=8,V=0,$=U.length;V<$;++V){var W=U[V];if(0===H&&(H=M,(j+=q)>=N&&(q=4*O+4*y*(Z-1),j=G+(M+O)*(Z<<1),Z>>=1)),W===P)j+=4;else{var X=g[B+3*W],Y=g[B+3*W+1],J=g[B+3*W+2];k[j++]=J,k[j++]=Y,k[j++]=X,k[j++]=255}--H}},this.decodeAndBlitFrameRGBA=function(m,k){var z=this.frameInfo(m),I=z.width*z.height,U=new Uint8Array(I);b(g,z.data_offset,U,I);var B=z.palette_offset,P=z.transparent_index;null===P&&(P=256);var M=z.width,O=y-M,H=M,G=4*(z.y*y+z.x),N=4*((z.y+z.height)*y+z.x),j=G,q=4*O;!0===z.interlaced&&(q+=4*y*7);for(var Z=8,V=0,$=U.length;V<$;++V){var W=U[V];if(0===H&&(H=M,(j+=q)>=N&&(q=4*O+4*y*(Z-1),j=G+(M+O)*(Z<<1),Z>>=1)),W===P)j+=4;else{var X=g[B+3*W],Y=g[B+3*W+1],J=g[B+3*W+2];k[j++]=X,k[j++]=Y,k[j++]=J,k[j++]=255}--H}}}}catch(P){}var W={exports:{}};if(!X)var X={map:function(g,m){var y={};return m?g.map((function(g,k){return y.index=k,m.call(y,g)})):g.slice()},naturalOrder:function(g,m){return g<m?-1:g>m?1:0},sum:function(g,m){var y={};return g.reduce(m?function(g,k,z){return y.index=z,g+m.call(y,k)}:function(g,m){return g+m},0)},max:function(g,m){return Math.max.apply(null,m?X.map(g,m):g)}};var Y=function(){function t(g,m,y){return(g<<10)+(m<<5)+y}function e(g){var m=[],y=!1;function i(){m.sort(g),y=!0}return{push:function(g){m.push(g),y=!1},peek:function(g){return y||i(),void 0===g&&(g=m.length-1),m[g]},pop:function(){return y||i(),m.pop()},size:function(){return m.length},map:function(g){return m.map(g)},debug:function(){return y||i(),m}}}function r(g,m,y,k,z,I,U){var B=this;B.r1=g,B.r2=m,B.g1=y,B.g2=k,B.b1=z,B.b2=I,B.histo=U}function i(){this.vboxes=new e((function(g,m){return X.naturalOrder(g.vbox.count()*g.vbox.volume(),m.vbox.count()*m.vbox.volume())}))}function n(g,m){if(m.count()){var y=m.r2-m.r1+1,k=m.g2-m.g1+1,z=m.b2-m.b1+1,I=X.max([y,k,z]);if(1==m.count())return[m.copy()];var U,B,P,M,O=0,H=[],G=[];if(I==y)for(U=m.r1;U<=m.r2;U++){for(M=0,B=m.g1;B<=m.g2;B++)for(P=m.b1;P<=m.b2;P++)M+=g[t(U,B,P)]||0;O+=M,H[U]=O}else if(I==k)for(U=m.g1;U<=m.g2;U++){for(M=0,B=m.r1;B<=m.r2;B++)for(P=m.b1;P<=m.b2;P++)M+=g[t(B,U,P)]||0;O+=M,H[U]=O}else for(U=m.b1;U<=m.b2;U++){for(M=0,B=m.r1;B<=m.r2;B++)for(P=m.g1;P<=m.g2;P++)M+=g[t(B,P,U)]||0;O+=M,H[U]=O}return H.forEach((function(g,m){G[m]=O-g})),function p(g){var y,k,z,I,B,P=g+"1",M=g+"2",N=0;for(U=m[P];U<=m[M];U++)if(H[U]>O/2){for(z=m.copy(),I=m.copy(),B=(y=U-m[P])<=(k=m[M]-U)?Math.min(m[M]-1,~~(U+k/2)):Math.max(m[P],~~(U-1-y/2));!H[B];)B++;for(N=G[B];!N&&H[B-1];)N=G[--B];return z[M]=B,I[P]=z[M]+1,[z,I]}}(I==y?"r":I==k?"g":"b")}}return r.prototype={volume:function(g){var m=this;return m._volume&&!g||(m._volume=(m.r2-m.r1+1)*(m.g2-m.g1+1)*(m.b2-m.b1+1)),m._volume},count:function(g){var m=this,y=m.histo;if(!m._count_set||g){var k,z,I,U=0;for(k=m.r1;k<=m.r2;k++)for(z=m.g1;z<=m.g2;z++)for(I=m.b1;I<=m.b2;I++)U+=y[t(k,z,I)]||0;m._count=U,m._count_set=!0}return m._count},copy:function(){var g=this;return new r(g.r1,g.r2,g.g1,g.g2,g.b1,g.b2,g.histo)},avg:function(g){var m=this,y=m.histo;if(!m._avg||g){var k,z,I,U,B=0,P=0,M=0,O=0;for(z=m.r1;z<=m.r2;z++)for(I=m.g1;I<=m.g2;I++)for(U=m.b1;U<=m.b2;U++)B+=k=y[t(z,I,U)]||0,P+=k*(z+.5)*8,M+=k*(I+.5)*8,O+=k*(U+.5)*8;m._avg=B?[~~(P/B),~~(M/B),~~(O/B)]:[~~(8*(m.r1+m.r2+1)/2),~~(8*(m.g1+m.g2+1)/2),~~(8*(m.b1+m.b2+1)/2)]}return m._avg},contains:function(g){var m=this,y=g[0]>>3;return gval=g[1]>>3,bval=g[2]>>3,y>=m.r1&&y<=m.r2&&gval>=m.g1&&gval<=m.g2&&bval>=m.b1&&bval<=m.b2}},i.prototype={push:function(g){this.vboxes.push({vbox:g,color:g.avg()})},palette:function(){return this.vboxes.map((function(g){return g.color}))},size:function(){return this.vboxes.size()},map:function(g){for(var m=this.vboxes,y=0;y<m.size();y++)if(m.peek(y).vbox.contains(g))return m.peek(y).color;return this.nearest(g)},nearest:function(g){for(var m,y,k,z=this.vboxes,I=0;I<z.size();I++)((y=Math.sqrt(Math.pow(g[0]-z.peek(I).color[0],2)+Math.pow(g[1]-z.peek(I).color[1],2)+Math.pow(g[2]-z.peek(I).color[2],2)))<m||void 0===m)&&(m=y,k=z.peek(I).color);return k},forcebw:function(){var g=this.vboxes;g.sort((function(g,m){return X.naturalOrder(X.sum(g.color),X.sum(m.color))}));var m=g[0].color;m[0]<5&&m[1]<5&&m[2]<5&&(g[0].color=[0,0,0]);var y=g.length-1,k=g[y].color;k[0]>251&&k[1]>251&&k[2]>251&&(g[y].color=[255,255,255])}},{quantize:function(g,m){if(!g.length||m<2||m>256)return!1;var y=function(g){var m,y,k,z,I=new Array(32768);return g.forEach((function(g){y=g[0]>>3,k=g[1]>>3,z=g[2]>>3,m=t(y,k,z),I[m]=(I[m]||0)+1})),I}(g);y.forEach((function(){}));var k=function(g,m){var y,k,z,I=1e6,U=0,B=1e6,P=0,M=1e6,O=0;return g.forEach((function(g){y=g[0]>>3,k=g[1]>>3,z=g[2]>>3,y<I?I=y:y>U&&(U=y),k<B?B=k:k>P&&(P=k),z<M?M=z:z>O&&(O=z)})),new r(I,U,B,P,M,O,m)}(g,y),z=new e((function(g,m){return X.naturalOrder(g.count(),m.count())}));function l(g,m){for(var k,z=1,I=0;I<1e3;)if((k=g.pop()).count()){var U=n(y,k),B=U[0],P=U[1];if(!B)return;if(g.push(B),P&&(g.push(P),z++),z>=m)return;if(I++>1e3)return}else g.push(k),I++}z.push(k),l(z,.75*m);for(var I=new e((function(g,m){return X.naturalOrder(g.count()*g.volume(),m.count()*m.volume())}));z.size();)I.push(z.pop());l(I,m-I.size());for(var U=new i;I.size();)U.push(I.pop());return U}}}(),J=Y.quantize;function x(g,m){return g[m+3]>=127}function E(g,m,y,k){if(m="number"==typeof m?0|m:5,k="function"==typeof k?k:x,(y="number"==typeof y?0|y:10)<=0)throw new Error("quality must be > 0");for(var z=[],I=4*y,U=0,B=g.length;U<B;U+=I){var P=g[U+0],M=g[U+1],O=g[U+2];k(g,U,g)&&z.push([P,M,O])}var H=J(z,Math.max(2,m)).vboxes;return H?H.map((function(g){return g})).slice(0,m):[]}W.exports=function(g,m,y,k){return E(g,m,y,k).map((function(g){return g.color}))},W.exports.bins=function(g,m,y,k){var z=E(g,m,y,k),I=(z=z.map((function(g){return{color:g.color,size:g.vbox.count()*g.vbox.volume(),amount:0}}))).reduce((function(g,m){return g+m.size}),0);return z.forEach((function(g){g.amount=g.size/I})),z};var K=W.exports;const Q={decode(g){const m=new Z(g),y={width:m.width,height:m.height,data:new Uint8Array(m.width*m.height*4)};return m.decodeAndBlitFrameRGBA(0,y.data),y},encode(g,m){const y=[g.data],k=new Uint8Array(g.width*g.height*y.length+1024),z=new V(k,g.width,g.height,{loop:m.loop});return y.forEach((y=>{const k=((g,m)=>{const y=Math.pow(2,Math.ceil(Math.log(m)/Math.log(2)));let k=K(g,m).map((g=>[g[0],g[1],g[2],255]));if(0===k.length&&(k=K(g,m,10,(()=>!0)).map((g=>[g[0],g[1],g[2],255]))),k.length<y){const g=k.length>0?k[k.length-1]:[0,0,0,0],m=k.length;k.length=y,k.fill(g,m,y)}k[k.length-1]=[0,0,0,0];for(let g=0;g<k.length;g+=1)for(let m=0;m<4;m+=1){const y=k[g][m];null==y||Number.isNaN(y)||y<0?k[g][m]=0:y>255&&(k[g][m]=255)}return k})(y,16),I=((g,m)=>{const y=new Array(g.length/4),k=new Map;m.forEach(((g,m)=>k.set(g,m)));for(let z=0;z<g.length;z+=4){const I=[g[z],g[z+1],g[z+2],g[z+3]];if(k.has(I))y[z/4]=k.get(I);else{let g=1e3,U=0;m.map(((m,y)=>{const k=Math.sqrt(Math.pow(I[0]-m[0],2)+Math.pow(I[1]-m[1],2)+Math.pow(I[2]-m[2],2)+Math.pow(I[3]-m[3],2));k<g&&(g=k,U=y)})),k.set(I,U),y[z/4]=U}}return y})(y,k);z.addFrame(0,0,g.width,g.height,I,{palette:k.map((([g,m,y])=>((g,m,y)=>(g<<16)+(m<<8)+y)(g,m,y))),delay:m.delay,transparent:k.length-1,disposal:2})})),k.slice(0,z.end())}};var tt={exports:{}};!function(){function e(g){var m,y,k,z,I,U=Math.floor,B=new Array(64),P=new Array(64),M=new Array(64),O=new Array(64),H=new Array(65535),G=new Array(65535),N=new Array(64),j=new Array(64),q=[],Z=0,V=7,$=new Array(64),W=new Array(64),X=new Array(64),Y=new Array(256),J=new Array(2048),K=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],tt=[0,1,2,3,4,5,6,7,8,9,10,11],et=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],vt=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],yt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],kt=[0,1,2,3,4,5,6,7,8,9,10,11],xt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Et=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(g,m){for(var y=0,k=0,z=new Array,I=1;I<=16;I++){for(var U=1;U<=g[I];U++)z[m[k]]=[],z[m[k]][0]=y,z[m[k]][1]=I,k++,y++;y*=2}return z}function S(g){for(var m=g[0],y=g[1]-1;y>=0;)m&1<<y&&(Z|=1<<V),y--,--V<0&&(255==Z?(T(255),T(0)):T(Z),V=7,Z=0)}function T(g){q.push(g)}function C(g){T(g>>8&255),T(255&g)}function L(g,m,y,k,z){for(var I,U=z[0],B=z[240],P=function(g,m){var y,k,z,I,U,B,P,M,O,H,G=0;for(O=0;O<8;++O){y=g[G],k=g[G+1],z=g[G+2],I=g[G+3],U=g[G+4],B=g[G+5],P=g[G+6];var j=y+(M=g[G+7]),q=y-M,Z=k+P,V=k-P,$=z+B,W=z-B,X=I+U,Y=I-U,J=j+X,K=j-X,Q=Z+$,tt=Z-$;g[G]=J+Q,g[G+4]=J-Q;var et=.707106781*(tt+K);g[G+2]=K+et,g[G+6]=K-et;var vt=.382683433*((J=Y+W)-(tt=V+q)),yt=.5411961*J+vt,kt=1.306562965*tt+vt,xt=.707106781*(Q=W+V),Et=q+xt,zt=q-xt;g[G+5]=zt+yt,g[G+3]=zt-yt,g[G+1]=Et+kt,g[G+7]=Et-kt,G+=8}for(G=0,O=0;O<8;++O){y=g[G],k=g[G+8],z=g[G+16],I=g[G+24],U=g[G+32],B=g[G+40],P=g[G+48];var It=y+(M=g[G+56]),Ut=y-M,Bt=k+P,jt=k-P,Wt=z+B,Xt=z-B,Yt=I+U,Jt=I-U,Kt=It+Yt,te=It-Yt,ee=Bt+Wt,re=Bt-Wt;g[G]=Kt+ee,g[G+32]=Kt-ee;var ie=.707106781*(re+te);g[G+16]=te+ie,g[G+48]=te-ie;var ne=.382683433*((Kt=Jt+Xt)-(re=jt+Ut)),ae=.5411961*Kt+ne,he=1.306562965*re+ne,le=.707106781*(ee=Xt+jt),fe=Ut+le,ce=Ut-le;g[G+40]=ce+ae,g[G+24]=ce-ae,g[G+8]=fe+he,g[G+56]=fe-he,G++}for(O=0;O<64;++O)H=g[O]*m[O],N[O]=H>0?H+.5|0:H-.5|0;return N}(g,m),M=0;M<64;++M)j[K[M]]=P[M];var O=j[0]-y;y=j[0],0==O?S(k[0]):(S(k[G[I=32767+O]]),S(H[I]));for(var q=63;q>0&&0==j[q];q--);if(0==q)return S(U),y;for(var Z,V=1;V<=q;){for(var $=V;0==j[V]&&V<=q;++V);var W=V-$;if(W>=16){Z=W>>4;for(var X=1;X<=Z;++X)S(B);W&=15}I=32767+j[V],S(z[(W<<4)+G[I]]),S(H[I]),V++}return 63!=q&&S(U),y}function D(g){g<=0&&(g=1),g>100&&(g=100),I!=g&&(function(g){for(var m=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],y=0;y<64;y++){var k=U((m[y]*g+50)/100);k<1?k=1:k>255&&(k=255),B[K[y]]=k}for(var z=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],I=0;I<64;I++){var H=U((z[I]*g+50)/100);H<1?H=1:H>255&&(H=255),P[K[I]]=H}for(var G=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],N=0,j=0;j<8;j++)for(var q=0;q<8;q++)M[N]=1/(B[K[N]]*G[j]*G[q]*8),O[N]=1/(P[K[N]]*G[j]*G[q]*8),N++}(g<50?Math.floor(5e3/g):Math.floor(200-2*g)),I=g)}this.encode=function(g,I){var U;(new Date).getTime(),I&&D(I),q=new Array,Z=0,V=7,C(65496),C(65504),C(16),T(74),T(70),T(73),T(70),T(0),T(1),T(1),T(0),C(1),C(1),T(0),T(0),void 0!==(U=g.comments)&&U.constructor===Array&&U.forEach((g=>{if("string"==typeof g){C(65534);var m,y=g.length;for(C(y+2),m=0;m<y;m++)T(g.charCodeAt(m))}})),function(g){if(g){C(65505),69===g[0]&&120===g[1]&&105===g[2]&&102===g[3]?C(g.length+2):(C(g.length+5+2),T(69),T(120),T(105),T(102),T(0));for(var m=0;m<g.length;m++)T(g[m])}}(g.exifBuffer),function(){C(65499),C(132),T(0);for(var g=0;g<64;g++)T(B[g]);T(1);for(var m=0;m<64;m++)T(P[m])}(),function(g,m){C(65472),C(17),T(8),C(m),C(g),T(3),T(1),T(17),T(0),T(2),T(17),T(1),T(3),T(17),T(1)}(g.width,g.height),function(){C(65476),C(418),T(0);for(var g=0;g<16;g++)T(Q[g+1]);for(var m=0;m<=11;m++)T(tt[m]);T(16);for(var y=0;y<16;y++)T(et[y+1]);for(var k=0;k<=161;k++)T(vt[k]);T(1);for(var z=0;z<16;z++)T(yt[z+1]);for(var I=0;I<=11;I++)T(kt[I]);T(17);for(var U=0;U<16;U++)T(xt[U+1]);for(var B=0;B<=161;B++)T(Et[B])}(),C(65498),C(12),T(3),T(1),T(0),T(2),T(17),T(3),T(17),T(0),T(63),T(0);var H=0,G=0,N=0;Z=0,V=7,this.encode.displayName="_encode_";for(var j,Y,K,zt,It,Ut,Bt,jt,Wt,Xt=g.data,Yt=g.width,Jt=g.height,Kt=4*Yt,te=0;te<Jt;){for(j=0;j<Kt;){for(Ut=It=Kt*te+j,Bt=-1,jt=0,Wt=0;Wt<64;Wt++)Ut=It+(jt=Wt>>3)*Kt+(Bt=4*(7&Wt)),te+jt>=Jt&&(Ut-=Kt*(te+1+jt-Jt)),j+Bt>=Kt&&(Ut-=j+Bt-Kt+4),Y=Xt[Ut++],K=Xt[Ut++],zt=Xt[Ut++],$[Wt]=(J[Y]+J[K+256|0]+J[zt+512|0]>>16)-128,W[Wt]=(J[Y+768|0]+J[K+1024|0]+J[zt+1280|0]>>16)-128,X[Wt]=(J[Y+1280|0]+J[K+1536|0]+J[zt+1792|0]>>16)-128;H=L($,M,H,m,k),G=L(W,O,G,y,z),N=L(X,O,N,y,z),j+=32}te+=8}if(V>=0){var ee=[];ee[1]=V+1,ee[0]=(1<<V+1)-1,S(ee)}return C(65497),new Uint8Array(q)},(new Date).getTime(),g||(g=50),function(){for(var g=String.fromCharCode,m=0;m<256;m++)Y[m]=g(m)}(),m=R(Q,tt),y=R(yt,kt),k=R(et,vt),z=R(xt,Et),function(){for(var g=1,m=2,y=1;y<=15;y++){for(var k=g;k<m;k++)G[32767+k]=y,H[32767+k]=[],H[32767+k][1]=y,H[32767+k][0]=k;for(var z=-(m-1);z<=-g;z++)G[32767+z]=y,H[32767+z]=[],H[32767+z][1]=y,H[32767+z][0]=m-1+z;g<<=1,m<<=1}}(),function(){for(var g=0;g<256;g++)J[g]=19595*g,J[g+256|0]=38470*g,J[g+512|0]=7471*g+32768,J[g+768|0]=-11059*g,J[g+1024|0]=-21709*g,J[g+1280|0]=32768*g+8421375,J[g+1536|0]=-27439*g,J[g+1792|0]=-5329*g}(),D(g),(new Date).getTime()}tt.exports=function(g,m){return void 0===m&&(m=50),{data:new e(m).encode(g,m),width:g.width,height:g.height}}}();var et,vt,yt={exports:{}};et=yt,vt=function(){var g=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),m=4017,y=799,k=3406,z=2276,I=1567,U=3784,B=5793,P=2896;function f(){}function l(g,m){for(var y,k,z=0,I=[],U=16;U>0&&!g[U-1];)U--;I.push({children:[],index:0});var B,P=I[0];for(y=0;y<U;y++){for(k=0;k<g[y];k++){for((P=I.pop()).children[P.index]=m[z];P.index>0;){if(0===I.length)throw new Error("Could not recreate Huffman Table");P=I.pop()}for(P.index++,I.push(P);I.length<=y;)I.push(B={children:[],index:0}),P.children[P.index]=B.children,P=B;z++}y+1<U&&(I.push(B={children:[],index:0}),P.children[P.index]=B.children,P=B)}return I[0].children}function d(m,y,k,z,I,U,B,P,M,O){k.precision,k.samplesPerLine,k.scanLines;var H=k.mcusPerLine,G=k.progressive;k.maxH,k.maxV;var N=y,j=0,q=0;function w(){if(q>0)return q--,j>>q&1;if(255==(j=m[y++])){var g=m[y++];if(g)throw new Error("unexpected marker: "+(j<<8|g).toString(16))}return q=7,j>>>7}function _(g){for(var m,y=g;null!==(m=w());){if("number"==typeof(y=y[m]))return y;if("object"!=typeof y)throw new Error("invalid huffman sequence")}return null}function v(g){for(var m=0;g>0;){var y=w();if(null===y)return;m=m<<1|y,g--}return m}function b(g){var m=v(g);return m>=1<<g-1?m:m+(-1<<g)+1}var Z,V=0,$=0;function A(g,m,y,k,z){var I=y%H,U=(y/H|0)*g.v+k,B=I*g.h+z;void 0===g.blocks[U]&&O.tolerantDecoding||m(g,g.blocks[U][B])}function x(g,m,y){var k=y/g.blocksPerLine|0,z=y%g.blocksPerLine;void 0===g.blocks[k]&&O.tolerantDecoding||m(g,g.blocks[k][z])}var W,X,Y,J,K,Q,tt=z.length;Q=G?0===U?0===P?function(g,m){var y=_(g.huffmanTableDC),k=0===y?0:b(y)<<M;m[0]=g.pred+=k}:function(g,m){m[0]|=w()<<M}:0===P?function(m,y){if(V>0)V--;else for(var k=U,z=B;k<=z;){var I=_(m.huffmanTableAC),P=15&I,O=I>>4;if(0!==P)y[g[k+=O]]=b(P)*(1<<M),k++;else{if(O<15){V=v(O)+(1<<O)-1;break}k+=16}}}:function(m,y){for(var k=U,z=B,I=0;k<=z;){var P=g[k],O=y[P]<0?-1:1;switch($){case 0:var H=_(m.huffmanTableAC),G=15&H;if(I=H>>4,0===G)I<15?(V=v(I)+(1<<I),$=4):(I=16,$=1);else{if(1!==G)throw new Error("invalid ACn encoding");Z=b(G),$=I?2:3}continue;case 1:case 2:y[P]?y[P]+=(w()<<M)*O:0==--I&&($=2==$?3:0);break;case 3:y[P]?y[P]+=(w()<<M)*O:(y[P]=Z<<M,$=0);break;case 4:y[P]&&(y[P]+=(w()<<M)*O)}k++}4===$&&0==--V&&($=0)}:function(m,y){var k=_(m.huffmanTableDC),z=0===k?0:b(k);y[0]=m.pred+=z;for(var I=1;I<64;){var U=_(m.huffmanTableAC),B=15&U,P=U>>4;if(0!==B)y[g[I+=P]]=b(B),I++;else{if(P<15)break;I+=16}}};var et,vt,yt,kt,xt=0;for(vt=1==tt?z[0].blocksPerLine*z[0].blocksPerColumn:H*k.mcusPerColumn,I||(I=vt);xt<vt;){for(X=0;X<tt;X++)z[X].pred=0;if(V=0,1==tt)for(W=z[0],K=0;K<I;K++)x(W,Q,xt),xt++;else for(K=0;K<I;K++){for(X=0;X<tt;X++)for(yt=(W=z[X]).h,kt=W.v,Y=0;Y<kt;Y++)for(J=0;J<yt;J++)A(W,Q,xt,Y,J);if(++xt===vt)break}if(xt===vt)do{if(255===m[y]&&0!==m[y+1])break;y+=1}while(y<m.length-2);if(q=0,(et=m[y]<<8|m[y+1])<65280)throw new Error("marker was not found");if(!(et>=65488&&et<=65495))break;y+=2}return y-N}function u(g,M){var O,H,G=[],N=M.blocksPerLine,j=M.blocksPerColumn,q=N<<3,Z=new Int32Array(64),V=new Uint8Array(64);function b(g,O,H){var G,N,j,q,Z,V,$,W,X,Y,J=M.quantizationTable,K=H;for(Y=0;Y<64;Y++)K[Y]=g[Y]*J[Y];for(Y=0;Y<8;++Y){var Q=8*Y;0!=K[1+Q]||0!=K[2+Q]||0!=K[3+Q]||0!=K[4+Q]||0!=K[5+Q]||0!=K[6+Q]||0!=K[7+Q]?(G=B*K[0+Q]+128>>8,N=B*K[4+Q]+128>>8,j=K[2+Q],q=K[6+Q],Z=P*(K[1+Q]-K[7+Q])+128>>8,W=P*(K[1+Q]+K[7+Q])+128>>8,V=K[3+Q]<<4,$=K[5+Q]<<4,X=G-N+1>>1,G=G+N+1>>1,N=X,X=j*U+q*I+128>>8,j=j*I-q*U+128>>8,q=X,X=Z-$+1>>1,Z=Z+$+1>>1,$=X,X=W+V+1>>1,V=W-V+1>>1,W=X,X=G-q+1>>1,G=G+q+1>>1,q=X,X=N-j+1>>1,N=N+j+1>>1,j=X,X=Z*z+W*k+2048>>12,Z=Z*k-W*z+2048>>12,W=X,X=V*y+$*m+2048>>12,V=V*m-$*y+2048>>12,$=X,K[0+Q]=G+W,K[7+Q]=G-W,K[1+Q]=N+$,K[6+Q]=N-$,K[2+Q]=j+V,K[5+Q]=j-V,K[3+Q]=q+Z,K[4+Q]=q-Z):(X=B*K[0+Q]+512>>10,K[0+Q]=X,K[1+Q]=X,K[2+Q]=X,K[3+Q]=X,K[4+Q]=X,K[5+Q]=X,K[6+Q]=X,K[7+Q]=X)}for(Y=0;Y<8;++Y){var tt=Y;0!=K[8+tt]||0!=K[16+tt]||0!=K[24+tt]||0!=K[32+tt]||0!=K[40+tt]||0!=K[48+tt]||0!=K[56+tt]?(G=B*K[0+tt]+2048>>12,N=B*K[32+tt]+2048>>12,j=K[16+tt],q=K[48+tt],Z=P*(K[8+tt]-K[56+tt])+2048>>12,W=P*(K[8+tt]+K[56+tt])+2048>>12,V=K[24+tt],$=K[40+tt],X=G-N+1>>1,G=G+N+1>>1,N=X,X=j*U+q*I+2048>>12,j=j*I-q*U+2048>>12,q=X,X=Z-$+1>>1,Z=Z+$+1>>1,$=X,X=W+V+1>>1,V=W-V+1>>1,W=X,X=G-q+1>>1,G=G+q+1>>1,q=X,X=N-j+1>>1,N=N+j+1>>1,j=X,X=Z*z+W*k+2048>>12,Z=Z*k-W*z+2048>>12,W=X,X=V*y+$*m+2048>>12,V=V*m-$*y+2048>>12,$=X,K[0+tt]=G+W,K[56+tt]=G-W,K[8+tt]=N+$,K[48+tt]=N-$,K[16+tt]=j+V,K[40+tt]=j-V,K[24+tt]=q+Z,K[32+tt]=q-Z):(X=B*H[Y+0]+8192>>14,K[0+tt]=X,K[8+tt]=X,K[16+tt]=X,K[24+tt]=X,K[32+tt]=X,K[40+tt]=X,K[48+tt]=X,K[56+tt]=X)}for(Y=0;Y<64;++Y){var et=128+(K[Y]+8>>4);O[Y]=et<0?0:et>255?255:et}}w(q*j*8);for(var $=0;$<j;$++){var W=$<<3;for(O=0;O<8;O++)G.push(new Uint8Array(q));for(var X=0;X<N;X++){b(M.blocks[$][X],V,Z);var Y=0,J=X<<3;for(H=0;H<8;H++){var K=G[W+H];for(O=0;O<8;O++)K[J+O]=V[Y++]}}}return G}function c(g){return g<0?0:g>255?255:g}f.prototype={load:function(g){var m=new XMLHttpRequest;m.open("GET",g,!0),m.responseType="arraybuffer",m.onload=function(){var g=new Uint8Array(m.response||m.mozResponseArrayBuffer);this.parse(g),this.onload&&this.onload()}.bind(this),m.send(null)},parse:function(m){var y=1e3*this.opts.maxResolutionInMP*1e3,k=0;function n(){var g=m[k]<<8|m[k+1];return k+=2,g}function a(g){var m,y,k=1,z=1;for(y in g.components)g.components.hasOwnProperty(y)&&(k<(m=g.components[y]).h&&(k=m.h),z<m.v&&(z=m.v));var I=Math.ceil(g.samplesPerLine/8/k),U=Math.ceil(g.scanLines/8/z);for(y in g.components)if(g.components.hasOwnProperty(y)){m=g.components[y];var B=Math.ceil(Math.ceil(g.samplesPerLine/8)*m.h/k),P=Math.ceil(Math.ceil(g.scanLines/8)*m.v/z),M=I*m.h,O=U*m.v,H=[];w(O*M*256);for(var G=0;G<O;G++){for(var N=[],j=0;j<M;j++)N.push(new Int32Array(64));H.push(N)}m.blocksPerLine=B,m.blocksPerColumn=P,m.blocks=H}g.maxH=k,g.maxV=z,g.mcusPerLine=I,g.mcusPerColumn=U}m.length;var z,I,U,B,P=null,M=null,O=[],H=[],G=[],N=[],j=n(),q=-1;if(this.comments=[],65496!=j)throw new Error("SOI not found");for(j=n();65497!=j;){switch(j){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Z=(void 0,void 0,U=n(),B=m.subarray(k,k+U-2),k+=B.length,B);if(65534===j){var V=String.fromCharCode.apply(null,Z);this.comments.push(V)}65504===j&&74===Z[0]&&70===Z[1]&&73===Z[2]&&70===Z[3]&&0===Z[4]&&(P={version:{major:Z[5],minor:Z[6]},densityUnits:Z[7],xDensity:Z[8]<<8|Z[9],yDensity:Z[10]<<8|Z[11],thumbWidth:Z[12],thumbHeight:Z[13],thumbData:Z.subarray(14,14+3*Z[12]*Z[13])}),65505===j&&69===Z[0]&&120===Z[1]&&105===Z[2]&&102===Z[3]&&0===Z[4]&&(this.exifBuffer=Z.subarray(5,Z.length)),65518===j&&65===Z[0]&&100===Z[1]&&111===Z[2]&&98===Z[3]&&101===Z[4]&&0===Z[5]&&(M={version:Z[6],flags0:Z[7]<<8|Z[8],flags1:Z[9]<<8|Z[10],transformCode:Z[11]});break;case 65499:for(var $=n()+k-2;k<$;){var W=m[k++];w(256);var X=new Int32Array(64);if(W>>4){if(W>>4!=1)throw new Error("DQT: invalid table spec");for(te=0;te<64;te++)X[g[te]]=n()}else for(te=0;te<64;te++)X[g[te]]=m[k++];O[15&W]=X}break;case 65472:case 65473:case 65474:n(),(z={}).extended=65473===j,z.progressive=65474===j,z.precision=m[k++],z.scanLines=n(),z.samplesPerLine=n(),z.components={},z.componentsOrder=[];var Y=z.scanLines*z.samplesPerLine;if(Y>y){var J=Math.ceil((Y-y)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${J}MP`)}var K,Q=m[k++];for(Jt=0;Jt<Q;Jt++){K=m[k];var tt=m[k+1]>>4,et=15&m[k+1],vt=m[k+2];if(tt<=0||et<=0)throw new Error("Invalid sampling factor, expected values above 0");z.componentsOrder.push(K),z.components[K]={h:tt,v:et,quantizationIdx:vt},k+=3}a(z),H.push(z);break;case 65476:var yt=n();for(Jt=2;Jt<yt;){var kt=m[k++],xt=new Uint8Array(16),Et=0;for(te=0;te<16;te++,k++)Et+=xt[te]=m[k];w(16+Et);var zt=new Uint8Array(Et);for(te=0;te<Et;te++,k++)zt[te]=m[k];Jt+=17+Et,(kt>>4?G:N)[15&kt]=l(xt,zt)}break;case 65501:n(),I=n();break;case 65500:n(),n();break;case 65498:n();var It=m[k++],Ut=[];for(Jt=0;Jt<It;Jt++){ee=z.components[m[k++]];var Bt=m[k++];ee.huffmanTableDC=N[Bt>>4],ee.huffmanTableAC=G[15&Bt],Ut.push(ee)}var jt=m[k++],Wt=m[k++],Xt=m[k++],Yt=d(m,k,z,Ut,I,jt,Wt,Xt>>4,15&Xt,this.opts);k+=Yt;break;case 65535:255!==m[k]&&k--;break;default:if(255==m[k-3]&&m[k-2]>=192&&m[k-2]<=254){k-=3;break}if(224===j||225==j){if(-1!==q)throw new Error(`first unknown JPEG marker at offset ${q.toString(16)}, second unknown JPEG marker ${j.toString(16)} at offset ${(k-1).toString(16)}`);q=k-1;const g=n();if(255===m[k+g-2]){k+=g-2;break}}throw new Error("unknown JPEG marker "+j.toString(16))}j=n()}if(1!=H.length)throw new Error("only single frame JPEGs supported");for(var Jt=0;Jt<H.length;Jt++){var Kt=H[Jt].components;for(var te in Kt)Kt[te].quantizationTable=O[Kt[te].quantizationIdx],delete Kt[te].quantizationIdx}for(this.width=z.samplesPerLine,this.height=z.scanLines,this.jfif=P,this.adobe=M,this.components=[],Jt=0;Jt<z.componentsOrder.length;Jt++){var ee=z.components[z.componentsOrder[Jt]];this.components.push({lines:u(0,ee),scaleX:ee.h/z.maxH,scaleY:ee.v/z.maxV})}},getData:function(g,m){var y,k,z,I,U,B,P,M,O,H,G,N,j,q,Z,V,$,W,X,Y,J,K=this.width/g,Q=this.height/m,tt=0,et=g*m*this.components.length;w(et);var vt=new Uint8Array(et);switch(this.components.length){case 1:for(y=this.components[0],H=0;H<m;H++)for(U=y.lines[0|H*y.scaleY*Q],O=0;O<g;O++)G=U[0|O*y.scaleX*K],vt[tt++]=G;break;case 2:for(y=this.components[0],k=this.components[1],H=0;H<m;H++)for(U=y.lines[0|H*y.scaleY*Q],B=k.lines[0|H*k.scaleY*Q],O=0;O<g;O++)G=U[0|O*y.scaleX*K],vt[tt++]=G,G=B[0|O*k.scaleX*K],vt[tt++]=G;break;case 3:for(J=!0,this.adobe&&this.adobe.transformCode?J=!0:void 0!==this.opts.colorTransform&&(J=!!this.opts.colorTransform),y=this.components[0],k=this.components[1],z=this.components[2],H=0;H<m;H++)for(U=y.lines[0|H*y.scaleY*Q],B=k.lines[0|H*k.scaleY*Q],P=z.lines[0|H*z.scaleY*Q],O=0;O<g;O++)J?(G=U[0|O*y.scaleX*K],N=B[0|O*k.scaleX*K],W=c(G+1.402*((j=P[0|O*z.scaleX*K])-128)),X=c(G-.3441363*(N-128)-.71413636*(j-128)),Y=c(G+1.772*(N-128))):(W=U[0|O*y.scaleX*K],X=B[0|O*k.scaleX*K],Y=P[0|O*z.scaleX*K]),vt[tt++]=W,vt[tt++]=X,vt[tt++]=Y;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(J=!1,this.adobe&&this.adobe.transformCode?J=!0:void 0!==this.opts.colorTransform&&(J=!!this.opts.colorTransform),y=this.components[0],k=this.components[1],z=this.components[2],I=this.components[3],H=0;H<m;H++)for(U=y.lines[0|H*y.scaleY*Q],B=k.lines[0|H*k.scaleY*Q],P=z.lines[0|H*z.scaleY*Q],M=I.lines[0|H*I.scaleY*Q],O=0;O<g;O++)J?(G=U[0|O*y.scaleX*K],N=B[0|O*k.scaleX*K],j=P[0|O*z.scaleX*K],q=M[0|O*I.scaleX*K],Z=255-c(G+1.402*(j-128)),V=255-c(G-.3441363*(N-128)-.71413636*(j-128)),$=255-c(G+1.772*(N-128))):(Z=U[0|O*y.scaleX*K],V=B[0|O*k.scaleX*K],$=P[0|O*z.scaleX*K],q=M[0|O*I.scaleX*K]),vt[tt++]=255-Z,vt[tt++]=255-V,vt[tt++]=255-$,vt[tt++]=255-q;break;default:throw new Error("Unsupported color mode")}return vt},copyToImageData:function(g,m){var y,k,z,I,U,B,P,M,O,H=g.width,G=g.height,N=g.data,j=this.getData(H,G),q=0,Z=0;switch(this.components.length){case 1:for(k=0;k<G;k++)for(y=0;y<H;y++)z=j[q++],N[Z++]=z,N[Z++]=z,N[Z++]=z,m&&(N[Z++]=255);break;case 3:for(k=0;k<G;k++)for(y=0;y<H;y++)P=j[q++],M=j[q++],O=j[q++],N[Z++]=P,N[Z++]=M,N[Z++]=O,m&&(N[Z++]=255);break;case 4:for(k=0;k<G;k++)for(y=0;y<H;y++)U=j[q++],B=j[q++],z=j[q++],P=255-c(U*(1-(I=j[q++])/255)+I),M=255-c(B*(1-I/255)+I),O=255-c(z*(1-I/255)+I),N[Z++]=P,N[Z++]=M,N[Z++]=O,m&&(N[Z++]=255);break;default:throw new Error("Unsupported color mode")}}};var M=0,O=0;function w(g=0){var m=M+g;if(m>O){var y=Math.ceil((m-O)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${y}MB`)}M=m}return f.resetMaxMemoryUsage=function(g){M=0,O=g},f.getBytesAllocated=function(){return M},f.requestMemoryAllocation=w,f}(),et.exports=function(g,m={}){var y={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...m},k=new Uint8Array(g),z=new vt;z.opts=y,vt.resetMaxMemoryUsage(1024*y.maxMemoryUsageInMB*1024),z.parse(k);var I=y.formatAsRGBA?4:3,U=z.width*z.height*I;try{vt.requestMemoryAllocation(U);var B={width:z.width,height:z.height,exifBuffer:z.exifBuffer,data:y.useTArray?new Uint8Array(U):Buffer.alloc(U)};z.comments.length>0&&(B.comments=z.comments)}catch(g){if(g instanceof RangeError)throw new Error("Could not allocate enough memory for the image. Required: "+U);if(g instanceof ReferenceError&&"Buffer is not defined"===g.message)throw new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true");throw g}return z.copyToImageData(B,y.formatAsRGBA),B};var kt={encode:tt.exports,decode:yt.exports};const xt={decode(g){const m=kt.decode(g,{useTArray:!0,colorTransform:!0});return{width:m.width,height:m.height,data:m.data}},encode(g,m){const y=kt.encode(g,m.quality);return new Uint8Array(y.data)}};var Et={};!function(g){var m="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(g,m){return Object.prototype.hasOwnProperty.call(g,m)}g.assign=function(g){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var y=m.shift();if(y){if("object"!=typeof y)throw new TypeError(y+"must be non-object");for(var k in y)r(y,k)&&(g[k]=y[k])}}return g},g.shrinkBuf=function(g,m){return g.length===m?g:g.subarray?g.subarray(0,m):(g.length=m,g)};var y={arraySet:function(g,m,y,k,z){if(m.subarray&&g.subarray)g.set(m.subarray(y,y+k),z);else for(var I=0;I<k;I++)g[z+I]=m[y+I]},flattenChunks:function(g){var m,y,k,z,I,U;for(k=0,m=0,y=g.length;m<y;m++)k+=g[m].length;for(U=new Uint8Array(k),z=0,m=0,y=g.length;m<y;m++)I=g[m],U.set(I,z),z+=I.length;return U}},k={arraySet:function(g,m,y,k,z){for(var I=0;I<k;I++)g[z+I]=m[y+I]},flattenChunks:function(g){return[].concat.apply([],g)}};g.setTyped=function(m){m?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,y)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,k))},g.setTyped(m)}(Et);var zt={},It={},Ut={},Bt=Et;function F(g){for(var m=g.length;--m>=0;)g[m]=0}var jt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Wt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Xt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Yt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Jt=new Array(576);F(Jt);var Kt=new Array(60);F(Kt);var te=new Array(512);F(te);var ee=new Array(256);F(ee);var re=new Array(29);F(re);var ie,ne,ae,he=new Array(30);function rt(g,m,y,k,z){this.static_tree=g,this.extra_bits=m,this.extra_base=y,this.elems=k,this.max_length=z,this.has_stree=g&&g.length}function it(g,m){this.dyn_tree=g,this.max_code=0,this.stat_desc=m}function nt(g){return g<256?te[g]:te[256+(g>>>7)]}function at(g,m){g.pending_buf[g.pending++]=255&m,g.pending_buf[g.pending++]=m>>>8&255}function st(g,m,y){g.bi_valid>16-y?(g.bi_buf|=m<<g.bi_valid&65535,at(g,g.bi_buf),g.bi_buf=m>>16-g.bi_valid,g.bi_valid+=y-16):(g.bi_buf|=m<<g.bi_valid&65535,g.bi_valid+=y)}function ot(g,m,y){st(g,y[2*m],y[2*m+1])}function ht(g,m){var y=0;do{y|=1&g,g>>>=1,y<<=1}while(--m>0);return y>>>1}function ft(g,m,y){var k,z,I=new Array(16),U=0;for(k=1;k<=15;k++)I[k]=U=U+y[k-1]<<1;for(z=0;z<=m;z++){var B=g[2*z+1];0!==B&&(g[2*z]=ht(I[B]++,B))}}function lt(g){var m;for(m=0;m<286;m++)g.dyn_ltree[2*m]=0;for(m=0;m<30;m++)g.dyn_dtree[2*m]=0;for(m=0;m<19;m++)g.bl_tree[2*m]=0;g.dyn_ltree[512]=1,g.opt_len=g.static_len=0,g.last_lit=g.matches=0}function dt(g){g.bi_valid>8?at(g,g.bi_buf):g.bi_valid>0&&(g.pending_buf[g.pending++]=g.bi_buf),g.bi_buf=0,g.bi_valid=0}function ut(g,m,y,k){var z=2*m,I=2*y;return g[z]<g[I]||g[z]===g[I]&&k[m]<=k[y]}function ct(g,m,y){for(var k=g.heap[y],z=y<<1;z<=g.heap_len&&(z<g.heap_len&&ut(m,g.heap[z+1],g.heap[z],g.depth)&&z++,!ut(m,k,g.heap[z],g.depth));)g.heap[y]=g.heap[z],y=z,z<<=1;g.heap[y]=k}function pt(g,m,y){var k,z,I,U,B=0;if(0!==g.last_lit)do{k=g.pending_buf[g.d_buf+2*B]<<8|g.pending_buf[g.d_buf+2*B+1],z=g.pending_buf[g.l_buf+B],B++,0===k?ot(g,z,m):(ot(g,(I=ee[z])+256+1,m),0!==(U=jt[I])&&st(g,z-=re[I],U),ot(g,I=nt(--k),y),0!==(U=Wt[I])&&st(g,k-=he[I],U))}while(B<g.last_lit);ot(g,256,m)}function gt(g,m){var y,k,z,I=m.dyn_tree,U=m.stat_desc.static_tree,B=m.stat_desc.has_stree,P=m.stat_desc.elems,M=-1;for(g.heap_len=0,g.heap_max=573,y=0;y<P;y++)0!==I[2*y]?(g.heap[++g.heap_len]=M=y,g.depth[y]=0):I[2*y+1]=0;for(;g.heap_len<2;)I[2*(z=g.heap[++g.heap_len]=M<2?++M:0)]=1,g.depth[z]=0,g.opt_len--,B&&(g.static_len-=U[2*z+1]);for(m.max_code=M,y=g.heap_len>>1;y>=1;y--)ct(g,I,y);z=P;do{y=g.heap[1],g.heap[1]=g.heap[g.heap_len--],ct(g,I,1),k=g.heap[1],g.heap[--g.heap_max]=y,g.heap[--g.heap_max]=k,I[2*z]=I[2*y]+I[2*k],g.depth[z]=(g.depth[y]>=g.depth[k]?g.depth[y]:g.depth[k])+1,I[2*y+1]=I[2*k+1]=z,g.heap[1]=z++,ct(g,I,1)}while(g.heap_len>=2);g.heap[--g.heap_max]=g.heap[1],function(g,m){var y,k,z,I,U,B,P=m.dyn_tree,M=m.max_code,O=m.stat_desc.static_tree,H=m.stat_desc.has_stree,G=m.stat_desc.extra_bits,N=m.stat_desc.extra_base,j=m.stat_desc.max_length,q=0;for(I=0;I<=15;I++)g.bl_count[I]=0;for(P[2*g.heap[g.heap_max]+1]=0,y=g.heap_max+1;y<573;y++)(I=P[2*P[2*(k=g.heap[y])+1]+1]+1)>j&&(I=j,q++),P[2*k+1]=I,k>M||(g.bl_count[I]++,U=0,k>=N&&(U=G[k-N]),B=P[2*k],g.opt_len+=B*(I+U),H&&(g.static_len+=B*(O[2*k+1]+U)));if(0!==q){do{for(I=j-1;0===g.bl_count[I];)I--;g.bl_count[I]--,g.bl_count[I+1]+=2,g.bl_count[j]--,q-=2}while(q>0);for(I=j;0!==I;I--)for(k=g.bl_count[I];0!==k;)(z=g.heap[--y])>M||(P[2*z+1]!==I&&(g.opt_len+=(I-P[2*z+1])*P[2*z],P[2*z+1]=I),k--)}}(g,m),ft(I,M,g.bl_count)}function wt(g,m,y){var k,z,I=-1,U=m[1],B=0,P=7,M=4;for(0===U&&(P=138,M=3),m[2*(y+1)+1]=65535,k=0;k<=y;k++)z=U,U=m[2*(k+1)+1],++B<P&&z===U||(B<M?g.bl_tree[2*z]+=B:0!==z?(z!==I&&g.bl_tree[2*z]++,g.bl_tree[32]++):B<=10?g.bl_tree[34]++:g.bl_tree[36]++,B=0,I=z,0===U?(P=138,M=3):z===U?(P=6,M=3):(P=7,M=4))}function _t(g,m,y){var k,z,I=-1,U=m[1],B=0,P=7,M=4;for(0===U&&(P=138,M=3),k=0;k<=y;k++)if(z=U,U=m[2*(k+1)+1],!(++B<P&&z===U)){if(B<M)do{ot(g,z,g.bl_tree)}while(0!=--B);else 0!==z?(z!==I&&(ot(g,z,g.bl_tree),B--),ot(g,16,g.bl_tree),st(g,B-3,2)):B<=10?(ot(g,17,g.bl_tree),st(g,B-3,3)):(ot(g,18,g.bl_tree),st(g,B-11,7));B=0,I=z,0===U?(P=138,M=3):z===U?(P=6,M=3):(P=7,M=4)}}F(he);var le=!1;function bt(g,m,y,k){st(g,0+(k?1:0),3),function(g,m,y){dt(g),at(g,y),at(g,~y),Bt.arraySet(g.pending_buf,g.window,m,y,g.pending),g.pending+=y}(g,m,y)}Ut._tr_init=function(g){le||(function(){var g,m,y,k,z,I=new Array(16);for(y=0,k=0;k<28;k++)for(re[k]=y,g=0;g<1<<jt[k];g++)ee[y++]=k;for(ee[y-1]=k,z=0,k=0;k<16;k++)for(he[k]=z,g=0;g<1<<Wt[k];g++)te[z++]=k;for(z>>=7;k<30;k++)for(he[k]=z<<7,g=0;g<1<<Wt[k]-7;g++)te[256+z++]=k;for(m=0;m<=15;m++)I[m]=0;for(g=0;g<=143;)Jt[2*g+1]=8,g++,I[8]++;for(;g<=255;)Jt[2*g+1]=9,g++,I[9]++;for(;g<=279;)Jt[2*g+1]=7,g++,I[7]++;for(;g<=287;)Jt[2*g+1]=8,g++,I[8]++;for(ft(Jt,287,I),g=0;g<30;g++)Kt[2*g+1]=5,Kt[2*g]=ht(g,5);ie=new rt(Jt,jt,257,286,15),ne=new rt(Kt,Wt,0,30,15),ae=new rt(new Array(0),Xt,0,19,7)}(),le=!0),g.l_desc=new it(g.dyn_ltree,ie),g.d_desc=new it(g.dyn_dtree,ne),g.bl_desc=new it(g.bl_tree,ae),g.bi_buf=0,g.bi_valid=0,lt(g)},Ut._tr_stored_block=bt,Ut._tr_flush_block=function(g,m,y,k){var z,I,U=0;g.level>0?(2===g.strm.data_type&&(g.strm.data_type=function(g){var m,y=4093624447;for(m=0;m<=31;m++,y>>>=1)if(1&y&&0!==g.dyn_ltree[2*m])return 0;if(0!==g.dyn_ltree[18]||0!==g.dyn_ltree[20]||0!==g.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==g.dyn_ltree[2*m])return 1;return 0}(g)),gt(g,g.l_desc),gt(g,g.d_desc),U=function(g){var m;for(wt(g,g.dyn_ltree,g.l_desc.max_code),wt(g,g.dyn_dtree,g.d_desc.max_code),gt(g,g.bl_desc),m=18;m>=3&&0===g.bl_tree[2*Yt[m]+1];m--);return g.opt_len+=3*(m+1)+5+5+4,m}(g),z=g.opt_len+3+7>>>3,(I=g.static_len+3+7>>>3)<=z&&(z=I)):z=I=y+5,y+4<=z&&-1!==m?bt(g,m,y,k):4===g.strategy||I===z?(st(g,2+(k?1:0),3),pt(g,Jt,Kt)):(st(g,4+(k?1:0),3),function(g,m,y,k){var z;for(st(g,m-257,5),st(g,y-1,5),st(g,k-4,4),z=0;z<k;z++)st(g,g.bl_tree[2*Yt[z]+1],3);_t(g,g.dyn_ltree,m-1),_t(g,g.dyn_dtree,y-1)}(g,g.l_desc.max_code+1,g.d_desc.max_code+1,U+1),pt(g,g.dyn_ltree,g.dyn_dtree)),lt(g),k&&dt(g)},Ut._tr_tally=function(g,m,y){return g.pending_buf[g.d_buf+2*g.last_lit]=m>>>8&255,g.pending_buf[g.d_buf+2*g.last_lit+1]=255&m,g.pending_buf[g.l_buf+g.last_lit]=255&y,g.last_lit++,0===m?g.dyn_ltree[2*y]++:(g.matches++,m--,g.dyn_ltree[2*(ee[y]+256+1)]++,g.dyn_dtree[2*nt(m)]++),g.last_lit===g.lit_bufsize-1},Ut._tr_align=function(g){st(g,2,3),ot(g,256,Jt),function(g){16===g.bi_valid?(at(g,g.bi_buf),g.bi_buf=0,g.bi_valid=0):g.bi_valid>=8&&(g.pending_buf[g.pending++]=255&g.bi_buf,g.bi_buf>>=8,g.bi_valid-=8)}(g)};var fe,mt=function(g,m,y,k){for(var z=65535&g,I=g>>>16&65535,U=0;0!==y;){y-=U=y>2e3?2e3:y;do{I=I+(z=z+m[k++]|0)|0}while(--U);z%=65521,I%=65521}return z|I<<16},ce=function(){for(var g,m=[],y=0;y<256;y++){g=y;for(var k=0;k<8;k++)g=1&g?3988292384^g>>>1:g>>>1;m[y]=g}return m}(),At=function(g,m,y,k){var z=ce,I=k+y;g^=-1;for(var U=k;U<I;U++)g=g>>>8^z[255&(g^m[U])];return~g},de={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ue=Et,pe=Ut,ge=mt,we=At,_e=de;function Pt(g,m){return g.msg=_e[m],m}function Mt(g){return(g<<1)-(g>4?9:0)}function Rt(g){for(var m=g.length;--m>=0;)g[m]=0}function St(g){var m=g.state,y=m.pending;y>g.avail_out&&(y=g.avail_out),0!==y&&(ue.arraySet(g.output,m.pending_buf,m.pending_out,y,g.next_out),g.next_out+=y,m.pending_out+=y,g.total_out+=y,g.avail_out-=y,m.pending-=y,0===m.pending&&(m.pending_out=0))}function Tt(g,m){pe._tr_flush_block(g,g.block_start>=0?g.block_start:-1,g.strstart-g.block_start,m),g.block_start=g.strstart,St(g.strm)}function Ct(g,m){g.pending_buf[g.pending++]=m}function Lt(g,m){g.pending_buf[g.pending++]=m>>>8&255,g.pending_buf[g.pending++]=255&m}function Dt(g,m){var y,k,z=g.max_chain_length,I=g.strstart,U=g.prev_length,B=g.nice_match,P=g.strstart>g.w_size-262?g.strstart-(g.w_size-262):0,M=g.window,O=g.w_mask,H=g.prev,G=g.strstart+258,N=M[I+U-1],j=M[I+U];g.prev_length>=g.good_match&&(z>>=2),B>g.lookahead&&(B=g.lookahead);do{if(M[(y=m)+U]===j&&M[y+U-1]===N&&M[y]===M[I]&&M[++y]===M[I+1]){I+=2,y++;do{}while(M[++I]===M[++y]&&M[++I]===M[++y]&&M[++I]===M[++y]&&M[++I]===M[++y]&&M[++I]===M[++y]&&M[++I]===M[++y]&&M[++I]===M[++y]&&M[++I]===M[++y]&&I<G);if(k=258-(G-I),I=G-258,k>U){if(g.match_start=m,U=k,k>=B)break;N=M[I+U-1],j=M[I+U]}}}while((m=H[m&O])>P&&0!=--z);return U<=g.lookahead?U:g.lookahead}function Ht(g){var m,y,k,z,I,U,B,P,M,O,H=g.w_size;do{if(z=g.window_size-g.lookahead-g.strstart,g.strstart>=H+(H-262)){ue.arraySet(g.window,g.window,H,H,0),g.match_start-=H,g.strstart-=H,g.block_start-=H,m=y=g.hash_size;do{k=g.head[--m],g.head[m]=k>=H?k-H:0}while(--y);m=y=H;do{k=g.prev[--m],g.prev[m]=k>=H?k-H:0}while(--y);z+=H}if(0===g.strm.avail_in)break;if(U=g.strm,B=g.window,P=g.strstart+g.lookahead,M=z,O=void 0,(O=U.avail_in)>M&&(O=M),y=0===O?0:(U.avail_in-=O,ue.arraySet(B,U.input,U.next_in,O,P),1===U.state.wrap?U.adler=ge(U.adler,B,O,P):2===U.state.wrap&&(U.adler=we(U.adler,B,O,P)),U.next_in+=O,U.total_in+=O,O),g.lookahead+=y,g.lookahead+g.insert>=3)for(I=g.strstart-g.insert,g.ins_h=g.window[I],g.ins_h=(g.ins_h<<g.hash_shift^g.window[I+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[I+3-1])&g.hash_mask,g.prev[I&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=I,I++,g.insert--,!(g.lookahead+g.insert<3)););}while(g.lookahead<262&&0!==g.strm.avail_in)}function Nt(g,m){for(var y,k;;){if(g.lookahead<262){if(Ht(g),g.lookahead<262&&0===m)return 1;if(0===g.lookahead)break}if(y=0,g.lookahead>=3&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),0!==y&&g.strstart-y<=g.w_size-262&&(g.match_length=Dt(g,y)),g.match_length>=3)if(k=pe._tr_tally(g,g.strstart-g.match_start,g.match_length-3),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=3){g.match_length--;do{g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart}while(0!=--g.match_length);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else k=pe._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(k&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=g.strstart<2?g.strstart:2,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}function Gt(g,m){for(var y,k,z;;){if(g.lookahead<262){if(Ht(g),g.lookahead<262&&0===m)return 1;if(0===g.lookahead)break}if(y=0,g.lookahead>=3&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=2,0!==y&&g.prev_length<g.max_lazy_match&&g.strstart-y<=g.w_size-262&&(g.match_length=Dt(g,y),g.match_length<=5&&(1===g.strategy||3===g.match_length&&g.strstart-g.match_start>4096)&&(g.match_length=2)),g.prev_length>=3&&g.match_length<=g.prev_length){z=g.strstart+g.lookahead-3,k=pe._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-3),g.lookahead-=g.prev_length-1,g.prev_length-=2;do{++g.strstart<=z&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+3-1])&g.hash_mask,y=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart)}while(0!=--g.prev_length);if(g.match_available=0,g.match_length=2,g.strstart++,k&&(Tt(g,!1),0===g.strm.avail_out))return 1}else if(g.match_available){if((k=pe._tr_tally(g,0,g.window[g.strstart-1]))&&Tt(g,!1),g.strstart++,g.lookahead--,0===g.strm.avail_out)return 1}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(k=pe._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<2?g.strstart:2,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}function Ot(g,m,y,k,z){this.good_length=g,this.max_lazy=m,this.nice_length=y,this.max_chain=k,this.func=z}function Ft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ue.Buf16(1146),this.dyn_dtree=new ue.Buf16(122),this.bl_tree=new ue.Buf16(78),Rt(this.dyn_ltree),Rt(this.dyn_dtree),Rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ue.Buf16(16),this.heap=new ue.Buf16(573),Rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ue.Buf16(573),Rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zt(g){var m;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=2,(m=g.state).pending=0,m.pending_out=0,m.wrap<0&&(m.wrap=-m.wrap),m.status=m.wrap?42:113,g.adler=2===m.wrap?0:1,m.last_flush=0,pe._tr_init(m),0):Pt(g,-2)}function qt(g){var m,y=Zt(g);return 0===y&&((m=g.state).window_size=2*m.w_size,Rt(m.head),m.max_lazy_match=fe[m.level].max_lazy,m.good_match=fe[m.level].good_length,m.nice_match=fe[m.level].nice_length,m.max_chain_length=fe[m.level].max_chain,m.strstart=0,m.block_start=0,m.lookahead=0,m.insert=0,m.match_length=m.prev_length=2,m.match_available=0,m.ins_h=0),y}function Vt(g,m,y,k,z,I){if(!g)return-2;var U=1;if(-1===m&&(m=6),k<0?(U=0,k=-k):k>15&&(U=2,k-=16),z<1||z>9||8!==y||k<8||k>15||m<0||m>9||I<0||I>4)return Pt(g,-2);8===k&&(k=9);var B=new Ft;return g.state=B,B.strm=g,B.wrap=U,B.gzhead=null,B.w_bits=k,B.w_size=1<<B.w_bits,B.w_mask=B.w_size-1,B.hash_bits=z+7,B.hash_size=1<<B.hash_bits,B.hash_mask=B.hash_size-1,B.hash_shift=~~((B.hash_bits+3-1)/3),B.window=new ue.Buf8(2*B.w_size),B.head=new ue.Buf16(B.hash_size),B.prev=new ue.Buf16(B.w_size),B.lit_bufsize=1<<z+6,B.pending_buf_size=4*B.lit_bufsize,B.pending_buf=new ue.Buf8(B.pending_buf_size),B.d_buf=1*B.lit_bufsize,B.l_buf=3*B.lit_bufsize,B.level=m,B.strategy=I,B.method=y,qt(g)}fe=[new Ot(0,0,0,0,(function(g,m){var y=65535;for(y>g.pending_buf_size-5&&(y=g.pending_buf_size-5);;){if(g.lookahead<=1){if(Ht(g),0===g.lookahead&&0===m)return 1;if(0===g.lookahead)break}g.strstart+=g.lookahead,g.lookahead=0;var k=g.block_start+y;if((0===g.strstart||g.strstart>=k)&&(g.lookahead=g.strstart-k,g.strstart=k,Tt(g,!1),0===g.strm.avail_out))return 1;if(g.strstart-g.block_start>=g.w_size-262&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):(g.strstart>g.block_start&&(Tt(g,!1),g.strm.avail_out),1)})),new Ot(4,4,8,4,Nt),new Ot(4,5,16,8,Nt),new Ot(4,6,32,32,Nt),new Ot(4,4,16,16,Gt),new Ot(8,16,32,32,Gt),new Ot(8,16,128,128,Gt),new Ot(8,32,128,256,Gt),new Ot(32,128,258,1024,Gt),new Ot(32,258,258,4096,Gt)],It.deflateInit=function(g,m){return Vt(g,m,8,15,8,0)},It.deflateInit2=Vt,It.deflateReset=qt,It.deflateResetKeep=Zt,It.deflateSetHeader=function(g,m){return g&&g.state?2!==g.state.wrap?-2:(g.state.gzhead=m,0):-2},It.deflate=function(g,m){var y,k,z,I;if(!g||!g.state||m>5||m<0)return g?Pt(g,-2):-2;if(k=g.state,!g.output||!g.input&&0!==g.avail_in||666===k.status&&4!==m)return Pt(g,0===g.avail_out?-5:-2);if(k.strm=g,y=k.last_flush,k.last_flush=m,42===k.status)if(2===k.wrap)g.adler=0,Ct(k,31),Ct(k,139),Ct(k,8),k.gzhead?(Ct(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),Ct(k,255&k.gzhead.time),Ct(k,k.gzhead.time>>8&255),Ct(k,k.gzhead.time>>16&255),Ct(k,k.gzhead.time>>24&255),Ct(k,9===k.level?2:k.strategy>=2||k.level<2?4:0),Ct(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(Ct(k,255&k.gzhead.extra.length),Ct(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(g.adler=we(g.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(Ct(k,0),Ct(k,0),Ct(k,0),Ct(k,0),Ct(k,0),Ct(k,9===k.level?2:k.strategy>=2||k.level<2?4:0),Ct(k,3),k.status=113);else{var U=8+(k.w_bits-8<<4)<<8;U|=(k.strategy>=2||k.level<2?0:k.level<6?1:6===k.level?2:3)<<6,0!==k.strstart&&(U|=32),U+=31-U%31,k.status=113,Lt(k,U),0!==k.strstart&&(Lt(k,g.adler>>>16),Lt(k,65535&g.adler)),g.adler=1}if(69===k.status)if(k.gzhead.extra){for(z=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>z&&(g.adler=we(g.adler,k.pending_buf,k.pending-z,z)),St(g),z=k.pending,k.pending!==k.pending_buf_size));)Ct(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>z&&(g.adler=we(g.adler,k.pending_buf,k.pending-z,z)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(73===k.status)if(k.gzhead.name){z=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>z&&(g.adler=we(g.adler,k.pending_buf,k.pending-z,z)),St(g),z=k.pending,k.pending===k.pending_buf_size)){I=1;break}I=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,Ct(k,I)}while(0!==I);k.gzhead.hcrc&&k.pending>z&&(g.adler=we(g.adler,k.pending_buf,k.pending-z,z)),0===I&&(k.gzindex=0,k.status=91)}else k.status=91;if(91===k.status)if(k.gzhead.comment){z=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>z&&(g.adler=we(g.adler,k.pending_buf,k.pending-z,z)),St(g),z=k.pending,k.pending===k.pending_buf_size)){I=1;break}I=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,Ct(k,I)}while(0!==I);k.gzhead.hcrc&&k.pending>z&&(g.adler=we(g.adler,k.pending_buf,k.pending-z,z)),0===I&&(k.status=103)}else k.status=103;if(103===k.status&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&St(g),k.pending+2<=k.pending_buf_size&&(Ct(k,255&g.adler),Ct(k,g.adler>>8&255),g.adler=0,k.status=113)):k.status=113),0!==k.pending){if(St(g),0===g.avail_out)return k.last_flush=-1,0}else if(0===g.avail_in&&Mt(m)<=Mt(y)&&4!==m)return Pt(g,-5);if(666===k.status&&0!==g.avail_in)return Pt(g,-5);if(0!==g.avail_in||0!==k.lookahead||0!==m&&666!==k.status){var B=2===k.strategy?function(g,m){for(var y;;){if(0===g.lookahead&&(Ht(g),0===g.lookahead)){if(0===m)return 1;break}if(g.match_length=0,y=pe._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++,y&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}(k,m):3===k.strategy?function(g,m){for(var y,k,z,I,U=g.window;;){if(g.lookahead<=258){if(Ht(g),g.lookahead<=258&&0===m)return 1;if(0===g.lookahead)break}if(g.match_length=0,g.lookahead>=3&&g.strstart>0&&(k=U[z=g.strstart-1])===U[++z]&&k===U[++z]&&k===U[++z]){I=g.strstart+258;do{}while(k===U[++z]&&k===U[++z]&&k===U[++z]&&k===U[++z]&&k===U[++z]&&k===U[++z]&&k===U[++z]&&k===U[++z]&&z<I);g.match_length=258-(I-z),g.match_length>g.lookahead&&(g.match_length=g.lookahead)}if(g.match_length>=3?(y=pe._tr_tally(g,1,g.match_length-3),g.lookahead-=g.match_length,g.strstart+=g.match_length,g.match_length=0):(y=pe._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++),y&&(Tt(g,!1),0===g.strm.avail_out))return 1}return g.insert=0,4===m?(Tt(g,!0),0===g.strm.avail_out?3:4):g.last_lit&&(Tt(g,!1),0===g.strm.avail_out)?1:2}(k,m):fe[k.level].func(k,m);if(3!==B&&4!==B||(k.status=666),1===B||3===B)return 0===g.avail_out&&(k.last_flush=-1),0;if(2===B&&(1===m?pe._tr_align(k):5!==m&&(pe._tr_stored_block(k,0,0,!1),3===m&&(Rt(k.head),0===k.lookahead&&(k.strstart=0,k.block_start=0,k.insert=0))),St(g),0===g.avail_out))return k.last_flush=-1,0}return 4!==m?0:k.wrap<=0?1:(2===k.wrap?(Ct(k,255&g.adler),Ct(k,g.adler>>8&255),Ct(k,g.adler>>16&255),Ct(k,g.adler>>24&255),Ct(k,255&g.total_in),Ct(k,g.total_in>>8&255),Ct(k,g.total_in>>16&255),Ct(k,g.total_in>>24&255)):(Lt(k,g.adler>>>16),Lt(k,65535&g.adler)),St(g),k.wrap>0&&(k.wrap=-k.wrap),0!==k.pending?0:1)},It.deflateEnd=function(g){var m;return g&&g.state?42!==(m=g.state.status)&&69!==m&&73!==m&&91!==m&&103!==m&&113!==m&&666!==m?Pt(g,-2):(g.state=null,113===m?Pt(g,-3):0):-2},It.deflateSetDictionary=function(g,m){var y,k,z,I,U,B,P,M,O=m.length;if(!g||!g.state)return-2;if(2===(I=(y=g.state).wrap)||1===I&&42!==y.status||y.lookahead)return-2;for(1===I&&(g.adler=ge(g.adler,m,O,0)),y.wrap=0,O>=y.w_size&&(0===I&&(Rt(y.head),y.strstart=0,y.block_start=0,y.insert=0),M=new ue.Buf8(y.w_size),ue.arraySet(M,m,O-y.w_size,y.w_size,0),m=M,O=y.w_size),U=g.avail_in,B=g.next_in,P=g.input,g.avail_in=O,g.next_in=0,g.input=m,Ht(y);y.lookahead>=3;){k=y.strstart,z=y.lookahead-2;do{y.ins_h=(y.ins_h<<y.hash_shift^y.window[k+3-1])&y.hash_mask,y.prev[k&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=k,k++}while(--z);y.strstart=k,y.lookahead=2,Ht(y)}return y.strstart+=y.lookahead,y.block_start=y.strstart,y.insert=y.lookahead,y.lookahead=0,y.match_length=y.prev_length=2,y.match_available=0,g.next_in=B,g.input=P,g.avail_in=U,y.wrap=I,0},It.deflateInfo="pako deflate (from Nodeca project)";var Se={},ze=Et,Ie=!0,Te=!0;try{String.fromCharCode.apply(null,[0])}catch(P){Ie=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(P){Te=!1}for(var Ue=new ze.Buf8(256),Ce=0;Ce<256;Ce++)Ue[Ce]=Ce>=252?6:Ce>=248?5:Ce>=240?4:Ce>=224?3:Ce>=192?2:1;function $t(g,m){if(m<65534&&(g.subarray&&Te||!g.subarray&&Ie))return String.fromCharCode.apply(null,ze.shrinkBuf(g,m));for(var y="",k=0;k<m;k++)y+=String.fromCharCode(g[k]);return y}Ue[254]=Ue[254]=1,Se.string2buf=function(g){var m,y,k,z,I,U=g.length,B=0;for(z=0;z<U;z++)55296==(64512&(y=g.charCodeAt(z)))&&z+1<U&&56320==(64512&(k=g.charCodeAt(z+1)))&&(y=65536+(y-55296<<10)+(k-56320),z++),B+=y<128?1:y<2048?2:y<65536?3:4;for(m=new ze.Buf8(B),I=0,z=0;I<B;z++)55296==(64512&(y=g.charCodeAt(z)))&&z+1<U&&56320==(64512&(k=g.charCodeAt(z+1)))&&(y=65536+(y-55296<<10)+(k-56320),z++),y<128?m[I++]=y:y<2048?(m[I++]=192|y>>>6,m[I++]=128|63&y):y<65536?(m[I++]=224|y>>>12,m[I++]=128|y>>>6&63,m[I++]=128|63&y):(m[I++]=240|y>>>18,m[I++]=128|y>>>12&63,m[I++]=128|y>>>6&63,m[I++]=128|63&y);return m},Se.buf2binstring=function(g){return $t(g,g.length)},Se.binstring2buf=function(g){for(var m=new ze.Buf8(g.length),y=0,k=m.length;y<k;y++)m[y]=g.charCodeAt(y);return m},Se.buf2string=function(g,m){var y,k,z,I,U=m||g.length,B=new Array(2*U);for(k=0,y=0;y<U;)if((z=g[y++])<128)B[k++]=z;else if((I=Ue[z])>4)B[k++]=65533,y+=I-1;else{for(z&=2===I?31:3===I?15:7;I>1&&y<U;)z=z<<6|63&g[y++],I--;I>1?B[k++]=65533:z<65536?B[k++]=z:(z-=65536,B[k++]=55296|z>>10&1023,B[k++]=56320|1023&z)}return $t(B,k)},Se.utf8border=function(g,m){var y;for((m=m||g.length)>g.length&&(m=g.length),y=m-1;y>=0&&128==(192&g[y]);)y--;return y<0||0===y?m:y+Ue[g[y]]>m?y:m};var Qt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Le=It,Re=Et,Fe=Se,Me=de,De=Qt,Ne=Object.prototype.toString;function se(g){if(!(this instanceof se))return new se(g);this.options=Re.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},g||{});var m=this.options;m.raw&&m.windowBits>0?m.windowBits=-m.windowBits:m.gzip&&m.windowBits>0&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new De,this.strm.avail_out=0;var y=Le.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if(0!==y)throw new Error(Me[y]);if(m.header&&Le.deflateSetHeader(this.strm,m.header),m.dictionary){var k;if(k="string"==typeof m.dictionary?Fe.string2buf(m.dictionary):"[object ArrayBuffer]"===Ne.call(m.dictionary)?new Uint8Array(m.dictionary):m.dictionary,0!==(y=Le.deflateSetDictionary(this.strm,k)))throw new Error(Me[y]);this._dict_set=!0}}function oe(g,m){var y=new se(m);if(y.push(g,!0),y.err)throw y.msg||Me[y.err];return y.result}se.prototype.push=function(g,m){var y,k,z=this.strm,I=this.options.chunkSize;if(this.ended)return!1;k=m===~~m?m:!0===m?4:0,"string"==typeof g?z.input=Fe.string2buf(g):"[object ArrayBuffer]"===Ne.call(g)?z.input=new Uint8Array(g):z.input=g,z.next_in=0,z.avail_in=z.input.length;do{if(0===z.avail_out&&(z.output=new Re.Buf8(I),z.next_out=0,z.avail_out=I),1!==(y=Le.deflate(z,k))&&0!==y)return this.onEnd(y),this.ended=!0,!1;0!==z.avail_out&&(0!==z.avail_in||4!==k&&2!==k)||("string"===this.options.to?this.onData(Fe.buf2binstring(Re.shrinkBuf(z.output,z.next_out))):this.onData(Re.shrinkBuf(z.output,z.next_out)))}while((z.avail_in>0||0===z.avail_out)&&1!==y);return 4===k?(y=Le.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,0===y):2!==k||(this.onEnd(0),z.avail_out=0,!0)},se.prototype.onData=function(g){this.chunks.push(g)},se.prototype.onEnd=function(g){0===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Re.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},zt.Deflate=se,zt.deflate=oe,zt.deflateRaw=function(g,m){return(m=m||{}).raw=!0,oe(g,m)},zt.gzip=function(g,m){return(m=m||{}).gzip=!0,oe(g,m)};var je={},qe={},Ze=Et,Ve=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],$e=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],We=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Xe=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Ye=Et,Qe=mt,tr=At,ve=function(g,m){var y,k,z,I,U,B,P,M,O,H,G,N,j,q,Z,V,$,W,X,Y,J,K,Q,tt,et;y=g.state,k=g.next_in,tt=g.input,z=k+(g.avail_in-5),I=g.next_out,et=g.output,U=I-(m-g.avail_out),B=I+(g.avail_out-257),P=y.dmax,M=y.wsize,O=y.whave,H=y.wnext,G=y.window,N=y.hold,j=y.bits,q=y.lencode,Z=y.distcode,V=(1<<y.lenbits)-1,$=(1<<y.distbits)-1;t:do{j<15&&(N+=tt[k++]<<j,j+=8,N+=tt[k++]<<j,j+=8),W=q[N&V];e:for(;;){if(N>>>=X=W>>>24,j-=X,0==(X=W>>>16&255))et[I++]=65535&W;else{if(!(16&X)){if(!(64&X)){W=q[(65535&W)+(N&(1<<X)-1)];continue e}if(32&X){y.mode=12;break t}g.msg="invalid literal/length code",y.mode=30;break t}Y=65535&W,(X&=15)&&(j<X&&(N+=tt[k++]<<j,j+=8),Y+=N&(1<<X)-1,N>>>=X,j-=X),j<15&&(N+=tt[k++]<<j,j+=8,N+=tt[k++]<<j,j+=8),W=Z[N&$];r:for(;;){if(N>>>=X=W>>>24,j-=X,!(16&(X=W>>>16&255))){if(!(64&X)){W=Z[(65535&W)+(N&(1<<X)-1)];continue r}g.msg="invalid distance code",y.mode=30;break t}if(J=65535&W,j<(X&=15)&&(N+=tt[k++]<<j,(j+=8)<X&&(N+=tt[k++]<<j,j+=8)),(J+=N&(1<<X)-1)>P){g.msg="invalid distance too far back",y.mode=30;break t}if(N>>>=X,j-=X,J>(X=I-U)){if((X=J-X)>O&&y.sane){g.msg="invalid distance too far back",y.mode=30;break t}if(K=0,Q=G,0===H){if(K+=M-X,X<Y){Y-=X;do{et[I++]=G[K++]}while(--X);K=I-J,Q=et}}else if(H<X){if(K+=M+H-X,(X-=H)<Y){Y-=X;do{et[I++]=G[K++]}while(--X);if(K=0,H<Y){Y-=X=H;do{et[I++]=G[K++]}while(--X);K=I-J,Q=et}}}else if(K+=H-X,X<Y){Y-=X;do{et[I++]=G[K++]}while(--X);K=I-J,Q=et}for(;Y>2;)et[I++]=Q[K++],et[I++]=Q[K++],et[I++]=Q[K++],Y-=3;Y&&(et[I++]=Q[K++],Y>1&&(et[I++]=Q[K++]))}else{K=I-J;do{et[I++]=et[K++],et[I++]=et[K++],et[I++]=et[K++],Y-=3}while(Y>2);Y&&(et[I++]=et[K++],Y>1&&(et[I++]=et[K++]))}break}}break}}while(k<z&&I<B);k-=Y=j>>3,N&=(1<<(j-=Y<<3))-1,g.next_in=k,g.next_out=I,g.avail_in=k<z?z-k+5:5-(k-z),g.avail_out=I<B?B-I+257:257-(I-B),y.hold=N,y.bits=j},be=function(g,m,y,k,z,I,U,B){var P,M,O,H,G,N,j,q,Z,V=B.bits,$=0,W=0,X=0,Y=0,J=0,K=0,Q=0,tt=0,et=0,vt=0,yt=null,kt=0,xt=new Ze.Buf16(16),Et=new Ze.Buf16(16),zt=null,It=0;for($=0;$<=15;$++)xt[$]=0;for(W=0;W<k;W++)xt[m[y+W]]++;for(J=V,Y=15;Y>=1&&0===xt[Y];Y--);if(J>Y&&(J=Y),0===Y)return z[I++]=20971520,z[I++]=20971520,B.bits=1,0;for(X=1;X<Y&&0===xt[X];X++);for(J<X&&(J=X),tt=1,$=1;$<=15;$++)if(tt<<=1,(tt-=xt[$])<0)return-1;if(tt>0&&(0===g||1!==Y))return-1;for(Et[1]=0,$=1;$<15;$++)Et[$+1]=Et[$]+xt[$];for(W=0;W<k;W++)0!==m[y+W]&&(U[Et[m[y+W]]++]=W);if(0===g?(yt=zt=U,N=19):1===g?(yt=Ve,kt-=257,zt=$e,It-=257,N=256):(yt=We,zt=Xe,N=-1),vt=0,W=0,$=X,G=I,K=J,Q=0,O=-1,H=(et=1<<J)-1,1===g&&et>852||2===g&&et>592)return 1;for(;;){j=$-Q,U[W]<N?(q=0,Z=U[W]):U[W]>N?(q=zt[It+U[W]],Z=yt[kt+U[W]]):(q=96,Z=0),P=1<<$-Q,X=M=1<<K;do{z[G+(vt>>Q)+(M-=P)]=j<<24|q<<16|Z}while(0!==M);for(P=1<<$-1;vt&P;)P>>=1;if(0!==P?(vt&=P-1,vt+=P):vt=0,W++,0==--xt[$]){if($===Y)break;$=m[y+U[W]]}if($>J&&(vt&H)!==O){for(0===Q&&(Q=J),G+=X,tt=1<<(K=$-Q);K+Q<Y&&!((tt-=xt[K+Q])<=0);)K++,tt<<=1;if(et+=1<<K,1===g&&et>852||2===g&&et>592)return 1;z[O=vt&H]=J<<24|K<<16|G-I}}return 0!==vt&&(z[G+vt]=$-Q<<24|64<<16),B.bits=J,0};function me(g){return(g>>>24&255)+(g>>>8&65280)+((65280&g)<<8)+((255&g)<<24)}function ye(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Ye.Buf16(320),this.work=new Ye.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ke(g){var m;return g&&g.state?(m=g.state,g.total_in=g.total_out=m.total=0,g.msg="",m.wrap&&(g.adler=1&m.wrap),m.mode=1,m.last=0,m.havedict=0,m.dmax=32768,m.head=null,m.hold=0,m.bits=0,m.lencode=m.lendyn=new Ye.Buf32(852),m.distcode=m.distdyn=new Ye.Buf32(592),m.sane=1,m.back=-1,0):-2}function Ae(g){var m;return g&&g.state?((m=g.state).wsize=0,m.whave=0,m.wnext=0,ke(g)):-2}function xe(g,m){var y,k;return g&&g.state?(k=g.state,m<0?(y=0,m=-m):(y=1+(m>>4),m<48&&(m&=15)),m&&(m<8||m>15)?-2:(null!==k.window&&k.wbits!==m&&(k.window=null),k.wrap=y,k.wbits=m,Ae(g))):-2}function Ee(g,m){var y,k;return g?(k=new ye,g.state=k,k.window=null,0!==(y=xe(g,m))&&(g.state=null),y):-2}var sr,hr,lr=!0;function Be(g){if(lr){var m;for(sr=new Ye.Buf32(512),hr=new Ye.Buf32(32),m=0;m<144;)g.lens[m++]=8;for(;m<256;)g.lens[m++]=9;for(;m<280;)g.lens[m++]=7;for(;m<288;)g.lens[m++]=8;for(be(1,g.lens,0,288,sr,0,g.work,{bits:9}),m=0;m<32;)g.lens[m++]=5;be(2,g.lens,0,32,hr,0,g.work,{bits:5}),lr=!1}g.lencode=sr,g.lenbits=9,g.distcode=hr,g.distbits=5}function Pe(g,m,y,k){var z,I=g.state;return null===I.window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new Ye.Buf8(I.wsize)),k>=I.wsize?(Ye.arraySet(I.window,m,y-I.wsize,I.wsize,0),I.wnext=0,I.whave=I.wsize):((z=I.wsize-I.wnext)>k&&(z=k),Ye.arraySet(I.window,m,y-k,z,I.wnext),(k-=z)?(Ye.arraySet(I.window,m,y-k,k,0),I.wnext=k,I.whave=I.wsize):(I.wnext+=z,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=z))),0}qe.inflateReset=Ae,qe.inflateReset2=xe,qe.inflateResetKeep=ke,qe.inflateInit=function(g){return Ee(g,15)},qe.inflateInit2=Ee,qe.inflate=function(g,m){var y,k,z,I,U,B,P,M,O,H,G,N,j,q,Z,V,$,W,X,Y,J,K,Q,tt,et=0,vt=new Ye.Buf8(4),yt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!g||!g.state||!g.output||!g.input&&0!==g.avail_in)return-2;12===(y=g.state).mode&&(y.mode=13),U=g.next_out,z=g.output,P=g.avail_out,I=g.next_in,k=g.input,B=g.avail_in,M=y.hold,O=y.bits,H=B,G=P,K=0;t:for(;;)switch(y.mode){case 1:if(0===y.wrap){y.mode=13;break}for(;O<16;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(2&y.wrap&&35615===M){y.check=0,vt[0]=255&M,vt[1]=M>>>8&255,y.check=tr(y.check,vt,2,0),M=0,O=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&M)<<8)+(M>>8))%31){g.msg="incorrect header check",y.mode=30;break}if(8!=(15&M)){g.msg="unknown compression method",y.mode=30;break}if(O-=4,J=8+(15&(M>>>=4)),0===y.wbits)y.wbits=J;else if(J>y.wbits){g.msg="invalid window size",y.mode=30;break}y.dmax=1<<J,g.adler=y.check=1,y.mode=512&M?10:12,M=0,O=0;break;case 2:for(;O<16;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(y.flags=M,8!=(255&y.flags)){g.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){g.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=M>>8&1),512&y.flags&&(vt[0]=255&M,vt[1]=M>>>8&255,y.check=tr(y.check,vt,2,0)),M=0,O=0,y.mode=3;case 3:for(;O<32;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}y.head&&(y.head.time=M),512&y.flags&&(vt[0]=255&M,vt[1]=M>>>8&255,vt[2]=M>>>16&255,vt[3]=M>>>24&255,y.check=tr(y.check,vt,4,0)),M=0,O=0,y.mode=4;case 4:for(;O<16;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}y.head&&(y.head.xflags=255&M,y.head.os=M>>8),512&y.flags&&(vt[0]=255&M,vt[1]=M>>>8&255,y.check=tr(y.check,vt,2,0)),M=0,O=0,y.mode=5;case 5:if(1024&y.flags){for(;O<16;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}y.length=M,y.head&&(y.head.extra_len=M),512&y.flags&&(vt[0]=255&M,vt[1]=M>>>8&255,y.check=tr(y.check,vt,2,0)),M=0,O=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&((N=y.length)>B&&(N=B),N&&(y.head&&(J=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),Ye.arraySet(y.head.extra,k,I,N,J)),512&y.flags&&(y.check=tr(y.check,k,N,I)),B-=N,I+=N,y.length-=N),y.length))break t;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(0===B)break t;N=0;do{J=k[I+N++],y.head&&J&&y.length<65536&&(y.head.name+=String.fromCharCode(J))}while(J&&N<B);if(512&y.flags&&(y.check=tr(y.check,k,N,I)),B-=N,I+=N,J)break t}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(0===B)break t;N=0;do{J=k[I+N++],y.head&&J&&y.length<65536&&(y.head.comment+=String.fromCharCode(J))}while(J&&N<B);if(512&y.flags&&(y.check=tr(y.check,k,N,I)),B-=N,I+=N,J)break t}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;O<16;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(M!==(65535&y.check)){g.msg="header crc mismatch",y.mode=30;break}M=0,O=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),g.adler=y.check=0,y.mode=12;break;case 10:for(;O<32;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}g.adler=y.check=me(M),M=0,O=0,y.mode=11;case 11:if(0===y.havedict)return g.next_out=U,g.avail_out=P,g.next_in=I,g.avail_in=B,y.hold=M,y.bits=O,2;g.adler=y.check=1,y.mode=12;case 12:if(5===m||6===m)break t;case 13:if(y.last){M>>>=7&O,O-=7&O,y.mode=27;break}for(;O<3;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}switch(y.last=1&M,O-=1,3&(M>>>=1)){case 0:y.mode=14;break;case 1:if(Be(y),y.mode=20,6===m){M>>>=2,O-=2;break t}break;case 2:y.mode=17;break;case 3:g.msg="invalid block type",y.mode=30}M>>>=2,O-=2;break;case 14:for(M>>>=7&O,O-=7&O;O<32;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if((65535&M)!=(M>>>16^65535)){g.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&M,M=0,O=0,y.mode=15,6===m)break t;case 15:y.mode=16;case 16:if(N=y.length){if(N>B&&(N=B),N>P&&(N=P),0===N)break t;Ye.arraySet(z,k,I,N,U),B-=N,I+=N,P-=N,U+=N,y.length-=N;break}y.mode=12;break;case 17:for(;O<14;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(y.nlen=257+(31&M),M>>>=5,O-=5,y.ndist=1+(31&M),M>>>=5,O-=5,y.ncode=4+(15&M),M>>>=4,O-=4,y.nlen>286||y.ndist>30){g.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;O<3;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}y.lens[yt[y.have++]]=7&M,M>>>=3,O-=3}for(;y.have<19;)y.lens[yt[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,Q={bits:y.lenbits},K=be(0,y.lens,0,19,y.lencode,0,y.work,Q),y.lenbits=Q.bits,K){g.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;V=(et=y.lencode[M&(1<<y.lenbits)-1])>>>16&255,$=65535&et,!((Z=et>>>24)<=O);){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if($<16)M>>>=Z,O-=Z,y.lens[y.have++]=$;else{if(16===$){for(tt=Z+2;O<tt;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(M>>>=Z,O-=Z,0===y.have){g.msg="invalid bit length repeat",y.mode=30;break}J=y.lens[y.have-1],N=3+(3&M),M>>>=2,O-=2}else if(17===$){for(tt=Z+3;O<tt;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}O-=Z,J=0,N=3+(7&(M>>>=Z)),M>>>=3,O-=3}else{for(tt=Z+7;O<tt;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}O-=Z,J=0,N=11+(127&(M>>>=Z)),M>>>=7,O-=7}if(y.have+N>y.nlen+y.ndist){g.msg="invalid bit length repeat",y.mode=30;break}for(;N--;)y.lens[y.have++]=J}}if(30===y.mode)break;if(0===y.lens[256]){g.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,Q={bits:y.lenbits},K=be(1,y.lens,0,y.nlen,y.lencode,0,y.work,Q),y.lenbits=Q.bits,K){g.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,Q={bits:y.distbits},K=be(2,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,Q),y.distbits=Q.bits,K){g.msg="invalid distances set",y.mode=30;break}if(y.mode=20,6===m)break t;case 20:y.mode=21;case 21:if(B>=6&&P>=258){g.next_out=U,g.avail_out=P,g.next_in=I,g.avail_in=B,y.hold=M,y.bits=O,ve(g,G),U=g.next_out,z=g.output,P=g.avail_out,I=g.next_in,k=g.input,B=g.avail_in,M=y.hold,O=y.bits,12===y.mode&&(y.back=-1);break}for(y.back=0;V=(et=y.lencode[M&(1<<y.lenbits)-1])>>>16&255,$=65535&et,!((Z=et>>>24)<=O);){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(V&&!(240&V)){for(W=Z,X=V,Y=$;V=(et=y.lencode[Y+((M&(1<<W+X)-1)>>W)])>>>16&255,$=65535&et,!(W+(Z=et>>>24)<=O);){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}M>>>=W,O-=W,y.back+=W}if(M>>>=Z,O-=Z,y.back+=Z,y.length=$,0===V){y.mode=26;break}if(32&V){y.back=-1,y.mode=12;break}if(64&V){g.msg="invalid literal/length code",y.mode=30;break}y.extra=15&V,y.mode=22;case 22:if(y.extra){for(tt=y.extra;O<tt;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}y.length+=M&(1<<y.extra)-1,M>>>=y.extra,O-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;V=(et=y.distcode[M&(1<<y.distbits)-1])>>>16&255,$=65535&et,!((Z=et>>>24)<=O);){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(!(240&V)){for(W=Z,X=V,Y=$;V=(et=y.distcode[Y+((M&(1<<W+X)-1)>>W)])>>>16&255,$=65535&et,!(W+(Z=et>>>24)<=O);){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}M>>>=W,O-=W,y.back+=W}if(M>>>=Z,O-=Z,y.back+=Z,64&V){g.msg="invalid distance code",y.mode=30;break}y.offset=$,y.extra=15&V,y.mode=24;case 24:if(y.extra){for(tt=y.extra;O<tt;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}y.offset+=M&(1<<y.extra)-1,M>>>=y.extra,O-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){g.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(0===P)break t;if(N=G-P,y.offset>N){if((N=y.offset-N)>y.whave&&y.sane){g.msg="invalid distance too far back",y.mode=30;break}N>y.wnext?(N-=y.wnext,j=y.wsize-N):j=y.wnext-N,N>y.length&&(N=y.length),q=y.window}else q=z,j=U-y.offset,N=y.length;N>P&&(N=P),P-=N,y.length-=N;do{z[U++]=q[j++]}while(--N);0===y.length&&(y.mode=21);break;case 26:if(0===P)break t;z[U++]=y.length,P--,y.mode=21;break;case 27:if(y.wrap){for(;O<32;){if(0===B)break t;B--,M|=k[I++]<<O,O+=8}if(G-=P,g.total_out+=G,y.total+=G,G&&(g.adler=y.check=y.flags?tr(y.check,z,G,U-G):Qe(y.check,z,G,U-G)),G=P,(y.flags?M:me(M))!==y.check){g.msg="incorrect data check",y.mode=30;break}M=0,O=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;O<32;){if(0===B)break t;B--,M+=k[I++]<<O,O+=8}if(M!==(4294967295&y.total)){g.msg="incorrect length check",y.mode=30;break}M=0,O=0}y.mode=29;case 29:K=1;break t;case 30:K=-3;break t;case 31:return-4;default:return-2}return g.next_out=U,g.avail_out=P,g.next_in=I,g.avail_in=B,y.hold=M,y.bits=O,(y.wsize||G!==g.avail_out&&y.mode<30&&(y.mode<27||4!==m))&&Pe(g,g.output,g.next_out,G-g.avail_out),H-=g.avail_in,G-=g.avail_out,g.total_in+=H,g.total_out+=G,y.total+=G,y.wrap&&G&&(g.adler=y.check=y.flags?tr(y.check,z,G,g.next_out-G):Qe(y.check,z,G,g.next_out-G)),g.data_type=y.bits+(y.last?64:0)+(12===y.mode?128:0)+(20===y.mode||15===y.mode?256:0),(0===H&&0===G||4===m)&&0===K&&(K=-5),K},qe.inflateEnd=function(g){if(!g||!g.state)return-2;var m=g.state;return m.window&&(m.window=null),g.state=null,0},qe.inflateGetHeader=function(g,m){var y;return g&&g.state&&2&(y=g.state).wrap?(y.head=m,m.done=!1,0):-2},qe.inflateSetDictionary=function(g,m){var y,k=m.length;return g&&g.state?0!==(y=g.state).wrap&&11!==y.mode?-2:11===y.mode&&Qe(1,m,k,0)!==y.check?-3:Pe(g,m,k,k)?(y.mode=31,-4):(y.havedict=1,0):-2},qe.inflateInfo="pako inflate (from Nodeca project)";var fr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},gr=qe,mr=Et,wr=Se,vr=fr,br=de,yr=Qt,He=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},kr=Object.prototype.toString;function Ge(g){if(!(this instanceof Ge))return new Ge(g);this.options=mr.assign({chunkSize:16384,windowBits:0,to:""},g||{});var m=this.options;m.raw&&m.windowBits>=0&&m.windowBits<16&&(m.windowBits=-m.windowBits,0===m.windowBits&&(m.windowBits=-15)),!(m.windowBits>=0&&m.windowBits<16)||g&&g.windowBits||(m.windowBits+=32),m.windowBits>15&&m.windowBits<48&&!(15&m.windowBits)&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new yr,this.strm.avail_out=0;var y=gr.inflateInit2(this.strm,m.windowBits);if(y!==vr.Z_OK)throw new Error(br[y]);if(this.header=new He,gr.inflateGetHeader(this.strm,this.header),m.dictionary&&("string"==typeof m.dictionary?m.dictionary=wr.string2buf(m.dictionary):"[object ArrayBuffer]"===kr.call(m.dictionary)&&(m.dictionary=new Uint8Array(m.dictionary)),m.raw&&(y=gr.inflateSetDictionary(this.strm,m.dictionary))!==vr.Z_OK))throw new Error(br[y])}function Oe(g,m){var y=new Ge(m);if(y.push(g,!0),y.err)throw y.msg||br[y.err];return y.result}Ge.prototype.push=function(g,m){var y,k,z,I,U,B=this.strm,P=this.options.chunkSize,M=this.options.dictionary,O=!1;if(this.ended)return!1;k=m===~~m?m:!0===m?vr.Z_FINISH:vr.Z_NO_FLUSH,"string"==typeof g?B.input=wr.binstring2buf(g):"[object ArrayBuffer]"===kr.call(g)?B.input=new Uint8Array(g):B.input=g,B.next_in=0,B.avail_in=B.input.length;do{if(0===B.avail_out&&(B.output=new mr.Buf8(P),B.next_out=0,B.avail_out=P),(y=gr.inflate(B,vr.Z_NO_FLUSH))===vr.Z_NEED_DICT&&M&&(y=gr.inflateSetDictionary(this.strm,M)),y===vr.Z_BUF_ERROR&&!0===O&&(y=vr.Z_OK,O=!1),y!==vr.Z_STREAM_END&&y!==vr.Z_OK)return this.onEnd(y),this.ended=!0,!1;B.next_out&&(0!==B.avail_out&&y!==vr.Z_STREAM_END&&(0!==B.avail_in||k!==vr.Z_FINISH&&k!==vr.Z_SYNC_FLUSH)||("string"===this.options.to?(z=wr.utf8border(B.output,B.next_out),I=B.next_out-z,U=wr.buf2string(B.output,z),B.next_out=I,B.avail_out=P-I,I&&mr.arraySet(B.output,B.output,z,I,0),this.onData(U)):this.onData(mr.shrinkBuf(B.output,B.next_out)))),0===B.avail_in&&0===B.avail_out&&(O=!0)}while((B.avail_in>0||0===B.avail_out)&&y!==vr.Z_STREAM_END);return y===vr.Z_STREAM_END&&(k=vr.Z_FINISH),k===vr.Z_FINISH?(y=gr.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===vr.Z_OK):k!==vr.Z_SYNC_FLUSH||(this.onEnd(vr.Z_OK),B.avail_out=0,!0)},Ge.prototype.onData=function(g){this.chunks.push(g)},Ge.prototype.onEnd=function(g){g===vr.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=mr.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},je.Inflate=Ge,je.inflate=Oe,je.inflateRaw=function(g,m){return(m=m||{}).raw=!0,Oe(g,m)},je.ungzip=Oe;var xr={};(0,Et.assign)(xr,zt,je,fr);var Ar,Er,Sr,zr=xr,Ir={toRGBA8:function(g){var m=g.width,y=g.height;if(null==g.tabs.acTL)return[Ir.toRGBA8.decodeImage(g.data,m,y,g).buffer];var k=[];null==g.frames[0].data&&(g.frames[0].data=g.data);for(var z=m*y*4,I=new Uint8Array(z),U=new Uint8Array(z),B=new Uint8Array(z),P=0;P<g.frames.length;P++){var M=g.frames[P],O=M.rect.x,H=M.rect.y,G=M.rect.width,N=M.rect.height,j=Ir.toRGBA8.decodeImage(M.data,G,N,g);if(0!=P)for(var q=0;q<z;q++)B[q]=I[q];if(0==M.blend?Ir._copyTile(j,G,N,I,m,y,O,H,0):1==M.blend&&Ir._copyTile(j,G,N,I,m,y,O,H,1),k.push(I.buffer.slice(0)),0==M.dispose);else if(1==M.dispose)Ir._copyTile(U,G,N,I,m,y,O,H,0);else if(2==M.dispose)for(q=0;q<z;q++)I[q]=B[q]}return k}};Ir.toRGBA8.decodeImage=function(g,m,y,k){var z=m*y,I=Ir.decode._getBPP(k),U=Math.ceil(m*I/8),B=new Uint8Array(4*z),P=new Uint32Array(B.buffer),M=k.ctype,O=k.depth,H=Ir._bin.readUshort;if(6==M){var G=z<<2;if(8==O)for(var N=0;N<G;N+=4)B[N]=g[N],B[N+1]=g[N+1],B[N+2]=g[N+2],B[N+3]=g[N+3];if(16==O)for(N=0;N<G;N++)B[N]=g[N<<1]}else if(2==M){var j=k.tabs.tRNS;if(null==j){if(8==O)for(N=0;N<z;N++){var q=3*N;P[N]=255<<24|g[q+2]<<16|g[q+1]<<8|g[q]}if(16==O)for(N=0;N<z;N++)q=6*N,P[N]=255<<24|g[q+4]<<16|g[q+2]<<8|g[q]}else{var Z=j[0],V=j[1],$=j[2];if(8==O)for(N=0;N<z;N++){var W=N<<2;q=3*N,P[N]=255<<24|g[q+2]<<16|g[q+1]<<8|g[q],g[q]==Z&&g[q+1]==V&&g[q+2]==$&&(B[W+3]=0)}if(16==O)for(N=0;N<z;N++)W=N<<2,q=6*N,P[N]=255<<24|g[q+4]<<16|g[q+2]<<8|g[q],H(g,q)==Z&&H(g,q+2)==V&&H(g,q+4)==$&&(B[W+3]=0)}}else if(3==M){var X=k.tabs.PLTE,Y=k.tabs.tRNS,J=Y?Y.length:0;if(1==O)for(var K=0;K<y;K++){var Q=K*U,tt=K*m;for(N=0;N<m;N++){W=tt+N<<2;var et=3*(vt=g[Q+(N>>3)]>>7-(7&N)&1);B[W]=X[et],B[W+1]=X[et+1],B[W+2]=X[et+2],B[W+3]=vt<J?Y[vt]:255}}if(2==O)for(K=0;K<y;K++)for(Q=K*U,tt=K*m,N=0;N<m;N++)W=tt+N<<2,et=3*(vt=g[Q+(N>>2)]>>6-((3&N)<<1)&3),B[W]=X[et],B[W+1]=X[et+1],B[W+2]=X[et+2],B[W+3]=vt<J?Y[vt]:255;if(4==O)for(K=0;K<y;K++)for(Q=K*U,tt=K*m,N=0;N<m;N++)W=tt+N<<2,et=3*(vt=g[Q+(N>>1)]>>4-((1&N)<<2)&15),B[W]=X[et],B[W+1]=X[et+1],B[W+2]=X[et+2],B[W+3]=vt<J?Y[vt]:255;if(8==O)for(N=0;N<z;N++){var vt;W=N<<2,et=3*(vt=g[N]),B[W]=X[et],B[W+1]=X[et+1],B[W+2]=X[et+2],B[W+3]=vt<J?Y[vt]:255}}else if(4==M){if(8==O)for(N=0;N<z;N++){W=N<<2;var yt=g[kt=N<<1];B[W]=yt,B[W+1]=yt,B[W+2]=yt,B[W+3]=g[kt+1]}if(16==O)for(N=0;N<z;N++){var kt;W=N<<2,yt=g[kt=N<<2],B[W]=yt,B[W+1]=yt,B[W+2]=yt,B[W+3]=g[kt+2]}}else if(0==M)for(Z=k.tabs.tRNS?k.tabs.tRNS:-1,K=0;K<y;K++){var xt=K*U,Et=K*m;if(1==O)for(var zt=0;zt<m;zt++){var It=(yt=255*(g[xt+(zt>>>3)]>>>7-(7&zt)&1))==255*Z?0:255;P[Et+zt]=It<<24|yt<<16|yt<<8|yt}else if(2==O)for(zt=0;zt<m;zt++)It=(yt=85*(g[xt+(zt>>>2)]>>>6-((3&zt)<<1)&3))==85*Z?0:255,P[Et+zt]=It<<24|yt<<16|yt<<8|yt;else if(4==O)for(zt=0;zt<m;zt++)It=(yt=17*(g[xt+(zt>>>1)]>>>4-((1&zt)<<2)&15))==17*Z?0:255,P[Et+zt]=It<<24|yt<<16|yt<<8|yt;else if(8==O)for(zt=0;zt<m;zt++)It=(yt=g[xt+zt])==Z?0:255,P[Et+zt]=It<<24|yt<<16|yt<<8|yt;else if(16==O)for(zt=0;zt<m;zt++)yt=g[xt+(zt<<1)],It=H(g,xt+(zt<<N))==Z?0:255,P[Et+zt]=It<<24|yt<<16|yt<<8|yt}return B},Ir.decode=function(g){for(var m,y=new Uint8Array(g),k=8,z=Ir._bin,I=z.readUshort,U=z.readUint,B={tabs:{},frames:[]},P=new Uint8Array(y.length),M=0,O=0,H=[137,80,78,71,13,10,26,10],G=0;G<8;G++)if(y[G]!=H[G])throw"The input is not a PNG file!";for(;k<y.length;){var N=z.readUint(y,k);k+=4;var j=z.readASCII(y,k,4);if(k+=4,"IHDR"==j)Ir.decode._IHDR(y,k,B);else if("IDAT"==j){for(G=0;G<N;G++)P[M+G]=y[k+G];M+=N}else if("acTL"==j)B.tabs[j]={num_frames:U(y,k),num_plays:U(y,k+4)},m=new Uint8Array(y.length);else if("fcTL"==j){var q;0!=O&&((q=B.frames[B.frames.length-1]).data=Ir.decode._decompress(B,m.slice(0,O),q.rect.width,q.rect.height),O=0);var Z={x:U(y,k+12),y:U(y,k+16),width:U(y,k+4),height:U(y,k+8)},V=I(y,k+22);V=I(y,k+20)/(0==V?100:V);var $={rect:Z,delay:Math.round(1e3*V),dispose:y[k+24],blend:y[k+25]};B.frames.push($)}else if("fdAT"==j){for(G=0;G<N-4;G++)m[O+G]=y[k+G+4];O+=N-4}else if("pHYs"==j)B.tabs[j]=[z.readUint(y,k),z.readUint(y,k+4),y[k+8]];else if("cHRM"==j)for(B.tabs[j]=[],G=0;G<8;G++)B.tabs[j].push(z.readUint(y,k+4*G));else if("tEXt"==j){null==B.tabs[j]&&(B.tabs[j]={});var W=z.nextZero(y,k),X=z.readASCII(y,k,W-k),Y=z.readASCII(y,W+1,k+N-W-1);B.tabs[j][X]=Y}else if("iTXt"==j){null==B.tabs[j]&&(B.tabs[j]={}),W=0;var J=k;W=z.nextZero(y,J),X=z.readASCII(y,J,W-J),y[J=W+1],y[J+1],J+=2,W=z.nextZero(y,J),z.readASCII(y,J,W-J),J=W+1,W=z.nextZero(y,J),z.readUTF8(y,J,W-J),J=W+1,Y=z.readUTF8(y,J,N-(J-k)),B.tabs[j][X]=Y}else if("PLTE"==j)B.tabs[j]=z.readBytes(y,k,N);else if("hIST"==j){var K=B.tabs.PLTE.length/3;for(B.tabs[j]=[],G=0;G<K;G++)B.tabs[j].push(I(y,k+2*G))}else if("tRNS"==j)3==B.ctype?B.tabs[j]=z.readBytes(y,k,N):0==B.ctype?B.tabs[j]=I(y,k):2==B.ctype&&(B.tabs[j]=[I(y,k),I(y,k+2),I(y,k+4)]);else if("gAMA"==j)B.tabs[j]=z.readUint(y,k)/1e5;else if("sRGB"==j)B.tabs[j]=y[k];else if("bKGD"==j)0==B.ctype||4==B.ctype?B.tabs[j]=[I(y,k)]:2==B.ctype||6==B.ctype?B.tabs[j]=[I(y,k),I(y,k+2),I(y,k+4)]:3==B.ctype&&(B.tabs[j]=y[k]);else if("IEND"==j)break;k+=N,z.readUint(y,k),k+=4}return 0!=O&&((q=B.frames[B.frames.length-1]).data=Ir.decode._decompress(B,m.slice(0,O),q.rect.width,q.rect.height),O=0),B.data=Ir.decode._decompress(B,P,B.width,B.height),delete B.compress,delete B.interlace,delete B.filter,B},Ir.decode._decompress=function(g,m,y,k){var z=Ir.decode._getBPP(g),I=Math.ceil(y*z/8),U=new Uint8Array((I+1+g.interlace)*k);return m=Ir.decode._inflate(m,U),0==g.interlace?m=Ir.decode._filterZero(m,g,0,y,k):1==g.interlace&&(m=Ir.decode._readInterlace(m,g)),m},Ir.decode._inflate=function(g,m){return Ir.inflateRaw(new Uint8Array(g.buffer,2,g.length-6),m)},Ir.inflateRaw=((Sr={}).H={},Sr.H.N=function(g,m){var y,k,z=Uint8Array,I=0,U=0,B=0,P=0,M=0,O=0,H=0,G=0,N=0;if(3==g[0]&&0==g[1])return m||new z(0);var j=Sr.H,q=j.b,Z=j.e,V=j.R,$=j.n,W=j.A,X=j.Z,Y=j.m,J=null==m;for(J&&(m=new z(g.length>>>2<<3));0==I;)if(I=q(g,N,1),U=q(g,N+1,2),N+=3,0!=U){if(J&&(m=Sr.H.W(m,G+(1<<17))),1==U&&(y=Y.J,k=Y.h,O=511,H=31),2==U){B=Z(g,N,5)+257,P=Z(g,N+5,5)+1,M=Z(g,N+10,4)+4,N+=14;for(var K=1,Q=0;Q<38;Q+=2)Y.Q[Q]=0,Y.Q[Q+1]=0;for(Q=0;Q<M;Q++){var tt=Z(g,N+3*Q,3);Y.Q[1+(Y.X[Q]<<1)]=tt,tt>K&&(K=tt)}N+=3*M,$(Y.Q,K),W(Y.Q,K,Y.u),y=Y.w,k=Y.d,N=V(Y.u,(1<<K)-1,B+P,g,N,Y.v);var et=j.V(Y.v,0,B,Y.C);O=(1<<et)-1;var vt=j.V(Y.v,B,P,Y.D);H=(1<<vt)-1,$(Y.C,et),W(Y.C,et,y),$(Y.D,vt),W(Y.D,vt,k)}for(;;){var yt=y[X(g,N)&O];N+=15&yt;var kt=yt>>>4;if(kt>>>8==0)m[G++]=kt;else{if(256==kt)break;var xt=G+kt-254;if(kt>264){var Et=Y.q[kt-257];xt=G+(Et>>>3)+Z(g,N,7&Et),N+=7&Et}var zt=k[X(g,N)&H];N+=15&zt;var It=zt>>>4,Ut=Y.c[It],Bt=(Ut>>>4)+q(g,N,15&Ut);for(N+=15&Ut;G<xt;)m[G]=m[G++-Bt],m[G]=m[G++-Bt],m[G]=m[G++-Bt],m[G]=m[G++-Bt];G=xt}}}else{7&N&&(N+=8-(7&N));var jt=4+(N>>>3),Wt=g[jt-4]|g[jt-3]<<8;J&&(m=Sr.H.W(m,G+Wt)),m.set(new z(g.buffer,g.byteOffset+jt,Wt),G),N=jt+Wt<<3,G+=Wt}return m.length==G?m:m.slice(0,G)},Sr.H.W=function(g,m){var y=g.length;if(m<=y)return g;var k=new Uint8Array(y<<1);return k.set(g,0),k},Sr.H.R=function(g,m,y,k,z,I){for(var U=Sr.H.e,B=Sr.H.Z,P=0;P<y;){var M=g[B(k,z)&m];z+=15&M;var O=M>>>4;if(O<=15)I[P]=O,P++;else{var H=0,G=0;16==O?(G=3+U(k,z,2),z+=2,H=I[P-1]):17==O?(G=3+U(k,z,3),z+=3):18==O&&(G=11+U(k,z,7),z+=7);for(var N=P+G;P<N;)I[P]=H,P++}}return z},Sr.H.V=function(g,m,y,k){for(var z=0,I=0,U=k.length>>>1;I<y;){var B=g[I+m];k[I<<1]=0,k[1+(I<<1)]=B,B>z&&(z=B),I++}for(;I<U;)k[I<<1]=0,k[1+(I<<1)]=0,I++;return z},Sr.H.n=function(g,m){for(var y,k,z,I,U=Sr.H.m,B=g.length,P=U.j,M=0;M<=m;M++)P[M]=0;for(M=1;M<B;M+=2)P[g[M]]++;var O=U.K;for(y=0,P[0]=0,k=1;k<=m;k++)y=y+P[k-1]<<1,O[k]=y;for(z=0;z<B;z+=2)0!=(I=g[z+1])&&(g[z]=O[I],O[I]++)},Sr.H.A=function(g,m,y){for(var k=g.length,z=Sr.H.m.r,I=0;I<k;I+=2)if(0!=g[I+1])for(var U=I>>1,B=g[I+1],P=U<<4|B,M=m-B,O=g[I]<<M,H=O+(1<<M);O!=H;)y[z[O]>>>15-m]=P,O++},Sr.H.l=function(g,m){for(var y=Sr.H.m.r,k=15-m,z=0;z<g.length;z+=2){var I=g[z]<<m-g[z+1];g[z]=y[I]>>>k}},Sr.H.M=function(g,m,y){y<<=7&m;var k=m>>>3;g[k]|=y,g[k+1]|=y>>>8},Sr.H.I=function(g,m,y){y<<=7&m;var k=m>>>3;g[k]|=y,g[k+1]|=y>>>8,g[k+2]|=y>>>16},Sr.H.e=function(g,m,y){return(g[m>>>3]|g[1+(m>>>3)]<<8)>>>(7&m)&(1<<y)-1},Sr.H.b=function(g,m,y){return(g[m>>>3]|g[1+(m>>>3)]<<8|g[2+(m>>>3)]<<16)>>>(7&m)&(1<<y)-1},Sr.H.Z=function(g,m){return(g[m>>>3]|g[1+(m>>>3)]<<8|g[2+(m>>>3)]<<16)>>>(7&m)},Sr.H.i=function(g,m){return(g[m>>>3]|g[1+(m>>>3)]<<8|g[2+(m>>>3)]<<16|g[3+(m>>>3)]<<24)>>>(7&m)},Sr.H.m=(Ar=Uint16Array,Er=Uint32Array,{K:new Ar(16),j:new Ar(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new Ar(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new Er(32),J:new Ar(512),_:[],h:new Ar(32),$:[],w:new Ar(32768),C:[],v:[],d:new Ar(32768),D:[],u:new Ar(512),Q:[],r:new Ar(32768),s:new Er(286),Y:new Er(30),a:new Er(19),t:new Er(15e3),k:new Ar(65536),g:new Ar(32768)}),function(){for(var g=Sr.H.m,m=0;m<32768;m++){var y=m;y=(4278255360&(y=(4042322160&(y=(3435973836&(y=(2863311530&y)>>>1|(1431655765&y)<<1))>>>2|(858993459&y)<<2))>>>4|(252645135&y)<<4))>>>8|(16711935&y)<<8,g.r[m]=(y>>>16|y<<16)>>>17}function i(g,m,y){for(;0!=m--;)g.push(0,y)}for(m=0;m<32;m++)g.q[m]=g.S[m]<<3|g.T[m],g.c[m]=g.p[m]<<4|g.z[m];i(g._,144,8),i(g._,112,9),i(g._,24,7),i(g._,8,8),Sr.H.n(g._,9),Sr.H.A(g._,9,g.J),Sr.H.l(g._,9),i(g.$,32,5),Sr.H.n(g.$,5),Sr.H.A(g.$,5,g.h),Sr.H.l(g.$,5),i(g.Q,19,0),i(g.C,286,0),i(g.D,30,0),i(g.v,320,0)}(),Sr.H.N),Ir.decode._readInterlace=function(g,m){for(var y=m.width,k=m.height,z=Ir.decode._getBPP(m),I=z>>3,U=Math.ceil(y*z/8),B=new Uint8Array(k*U),P=0,M=[0,0,4,0,2,0,1],O=[0,4,0,2,0,1,0],H=[8,8,8,4,4,2,2],G=[8,8,4,4,2,2,1],N=0;N<7;){for(var j=H[N],q=G[N],Z=0,V=0,$=M[N];$<k;)$+=j,V++;for(var W=O[N];W<y;)W+=q,Z++;var X=Math.ceil(Z*z/8);Ir.decode._filterZero(g,m,P,Z,V);for(var Y=0,J=M[N];J<k;){for(var K=O[N],Q=P+Y*X<<3;K<y;){var tt;if(1==z&&(tt=(tt=g[Q>>3])>>7-(7&Q)&1,B[J*U+(K>>3)]|=tt<<7-(7&K)),2==z&&(tt=(tt=g[Q>>3])>>6-(7&Q)&3,B[J*U+(K>>2)]|=tt<<6-((3&K)<<1)),4==z&&(tt=(tt=g[Q>>3])>>4-(7&Q)&15,B[J*U+(K>>1)]|=tt<<4-((1&K)<<2)),z>=8)for(var et=J*U+K*I,vt=0;vt<I;vt++)B[et+vt]=g[(Q>>3)+vt];Q+=z,K+=q}Y++,J+=j}Z*V!=0&&(P+=V*(1+X)),N+=1}return B},Ir.decode._getBPP=function(g){return[1,null,3,1,2,null,4][g.ctype]*g.depth},Ir.decode._filterZero=function(g,m,y,k,z){var I=Ir.decode._getBPP(m),U=Math.ceil(k*I/8),B=Ir.decode._paeth;I=Math.ceil(I/8);var P=0,M=1,O=g[y],H=0;if(O>1&&(g[y]=[0,0,1][O-2]),3==O)for(H=I;H<U;H++)g[H+1]=g[H+1]+(g[H+1-I]>>>1)&255;for(var G=0;G<z;G++)if(H=0,0==(O=g[(M=(P=y+G*U)+G+1)-1]))for(;H<U;H++)g[P+H]=g[M+H];else if(1==O){for(;H<I;H++)g[P+H]=g[M+H];for(;H<U;H++)g[P+H]=g[M+H]+g[P+H-I]}else if(2==O)for(;H<U;H++)g[P+H]=g[M+H]+g[P+H-U];else if(3==O){for(;H<I;H++)g[P+H]=g[M+H]+(g[P+H-U]>>>1);for(;H<U;H++)g[P+H]=g[M+H]+(g[P+H-U]+g[P+H-I]>>>1)}else{for(;H<I;H++)g[P+H]=g[M+H]+B(0,g[P+H-U],0);for(;H<U;H++)g[P+H]=g[M+H]+B(g[P+H-I],g[P+H-U],g[P+H-I-U])}return g},Ir.decode._paeth=function(g,m,y){var k=g+m-y,z=k-g,I=k-m,U=k-y;return z*z<=I*I&&z*z<=U*U?g:I*I<=U*U?m:y},Ir.decode._IHDR=function(g,m,y){var k=Ir._bin;y.width=k.readUint(g,m),m+=4,y.height=k.readUint(g,m),m+=4,y.depth=g[m],m++,y.ctype=g[m],m++,y.compress=g[m],m++,y.filter=g[m],m++,y.interlace=g[m],m++},Ir._bin={nextZero:function(g,m){for(;0!=g[m];)m++;return m},readUshort:function(g,m){return g[m]<<8|g[m+1]},writeUshort:function(g,m,y){g[m]=y>>8&255,g[m+1]=255&y},readUint:function(g,m){return 16777216*g[m]+(g[m+1]<<16|g[m+2]<<8|g[m+3])},writeUint:function(g,m,y){g[m]=y>>24&255,g[m+1]=y>>16&255,g[m+2]=y>>8&255,g[m+3]=255&y},readASCII:function(g,m,y){for(var k="",z=0;z<y;z++)k+=String.fromCharCode(g[m+z]);return k},writeASCII:function(g,m,y){for(var k=0;k<y.length;k++)g[m+k]=y.charCodeAt(k)},readBytes:function(g,m,y){for(var k=[],z=0;z<y;z++)k.push(g[m+z]);return k},pad:function(g){return g.length<2?"0"+g:g},readUTF8:function(g,m,y){for(var k,z="",I=0;I<y;I++)z+="%"+Ir._bin.pad(g[m+I].toString(16));try{k=decodeURIComponent(z)}catch(k){return Ir._bin.readASCII(g,m,y)}return k}},Ir._copyTile=function(g,m,y,k,z,I,U,B,P){for(var M=Math.min(m,z),O=Math.min(y,I),H=0,G=0,N=0;N<O;N++)for(var j=0;j<M;j++)if(U>=0&&B>=0?(H=N*m+j<<2,G=(B+N)*z+U+j<<2):(H=(-B+N)*m-U+j<<2,G=N*z+j<<2),0==P)k[G]=g[H],k[G+1]=g[H+1],k[G+2]=g[H+2],k[G+3]=g[H+3];else if(1==P){var q=g[H+3]*(1/255),Z=g[H]*q,V=g[H+1]*q,$=g[H+2]*q,W=k[G+3]*(1/255),X=k[G]*W,Y=k[G+1]*W,J=k[G+2]*W,K=1-q,Q=q+W*K,tt=0==Q?0:1/Q;k[G+3]=255*Q,k[G+0]=(Z+X*K)*tt,k[G+1]=(V+Y*K)*tt,k[G+2]=($+J*K)*tt}else if(2==P)q=g[H+3],Z=g[H],V=g[H+1],$=g[H+2],W=k[G+3],X=k[G],Y=k[G+1],J=k[G+2],q==W&&Z==X&&V==Y&&$==J?(k[G]=0,k[G+1]=0,k[G+2]=0,k[G+3]=0):(k[G]=Z,k[G+1]=V,k[G+2]=$,k[G+3]=q);else if(3==P){if(q=g[H+3],Z=g[H],V=g[H+1],$=g[H+2],W=k[G+3],X=k[G],Y=k[G+1],J=k[G+2],q==W&&Z==X&&V==Y&&$==J)continue;if(q<220&&W>20)return!1}return!0},Ir.encode=function(g,m,y,k,z,I,U){null==k&&(k=0),null==U&&(U=!1);var B=Ir.encode.compress(g,m,y,k,[!1,!1,!1,0,U]);return Ir.encode.compressPNG(B,-1),Ir.encode._main(B,m,y,z,I)},Ir.encodeLL=function(g,m,y,k,z,I,U,B){for(var P={ctype:0+(1==k?0:2)+(0==z?0:4),depth:I,frames:[]},M=(k+z)*I,O=M*m,H=0;H<g.length;H++)P.frames.push({rect:{x:0,y:0,width:m,height:y},img:new Uint8Array(g[H]),blend:0,dispose:1,bpp:Math.ceil(M/8),bpl:Math.ceil(O/8)});return Ir.encode.compressPNG(P,0,!0),Ir.encode._main(P,m,y,U,B)},Ir.encode._main=function(g,m,y,k,z){null==z&&(z={});var I=Ir.crc.crc,U=Ir._bin.writeUint,B=Ir._bin.writeUshort,P=Ir._bin.writeASCII,M=8,O=g.frames.length>1,H=!1,G=33+(O?20:0);if(null!=z.sRGB&&(G+=13),null!=z.pHYs&&(G+=21),3==g.ctype){for(var N=g.plte.length,j=0;j<N;j++)g.plte[j]>>>24!=255&&(H=!0);G+=8+3*N+4+(H?8+1*N+4:0)}for(var q=0;q<g.frames.length;q++)O&&(G+=38),G+=(Q=g.frames[q]).cimg.length+12,0!=q&&(G+=4);G+=12;var Z=new Uint8Array(G),V=[137,80,78,71,13,10,26,10];for(j=0;j<8;j++)Z[j]=V[j];if(U(Z,M,13),P(Z,M+=4,"IHDR"),U(Z,M+=4,m),U(Z,M+=4,y),Z[M+=4]=g.depth,Z[++M]=g.ctype,Z[++M]=0,Z[++M]=0,Z[++M]=0,U(Z,++M,I(Z,M-17,17)),M+=4,null!=z.sRGB&&(U(Z,M,1),P(Z,M+=4,"sRGB"),Z[M+=4]=z.sRGB,U(Z,++M,I(Z,M-5,5)),M+=4),null!=z.pHYs&&(U(Z,M,9),P(Z,M+=4,"pHYs"),U(Z,M+=4,z.pHYs[0]),U(Z,M+=4,z.pHYs[1]),Z[M+=4]=z.pHYs[2],U(Z,++M,I(Z,M-13,13)),M+=4),O&&(U(Z,M,8),P(Z,M+=4,"acTL"),U(Z,M+=4,g.frames.length),U(Z,M+=4,null!=z.loop?z.loop:0),U(Z,M+=4,I(Z,M-12,12)),M+=4),3==g.ctype){for(U(Z,M,3*(N=g.plte.length)),P(Z,M+=4,"PLTE"),M+=4,j=0;j<N;j++){var $=3*j,W=g.plte[j],X=255&W,Y=W>>>8&255,J=W>>>16&255;Z[M+$+0]=X,Z[M+$+1]=Y,Z[M+$+2]=J}if(U(Z,M+=3*N,I(Z,M-3*N-4,3*N+4)),M+=4,H){for(U(Z,M,N),P(Z,M+=4,"tRNS"),M+=4,j=0;j<N;j++)Z[M+j]=g.plte[j]>>>24&255;U(Z,M+=N,I(Z,M-N-4,N+4)),M+=4}}var K=0;for(q=0;q<g.frames.length;q++){var Q=g.frames[q];O&&(U(Z,M,26),P(Z,M+=4,"fcTL"),U(Z,M+=4,K++),U(Z,M+=4,Q.rect.width),U(Z,M+=4,Q.rect.height),U(Z,M+=4,Q.rect.x),U(Z,M+=4,Q.rect.y),B(Z,M+=4,k[q]),B(Z,M+=2,1e3),Z[M+=2]=Q.dispose,Z[++M]=Q.blend,U(Z,++M,I(Z,M-30,30)),M+=4);var tt=Q.cimg;U(Z,M,(N=tt.length)+(0==q?0:4));var et=M+=4;P(Z,M,0==q?"IDAT":"fdAT"),M+=4,0!=q&&(U(Z,M,K++),M+=4),Z.set(tt,M),U(Z,M+=N,I(Z,et,M-et)),M+=4}return U(Z,M,0),P(Z,M+=4,"IEND"),U(Z,M+=4,I(Z,M-4,4)),M+=4,Z.buffer},Ir.encode.compressPNG=function(g,m,y){for(var k=0;k<g.frames.length;k++){var z=g.frames[k];z.rect.width;var I=z.rect.height,U=new Uint8Array(I*z.bpl+I);z.cimg=Ir.encode._filterZero(z.img,I,z.bpp,z.bpl,U,m,y)}},Ir.encode.compress=function(g,m,y,k,z){for(var I=z[0],U=z[1],B=z[2],P=z[3],M=z[4],O=6,H=8,G=255,N=0;N<g.length;N++)for(var j=new Uint8Array(g[N]),q=j.length,Z=0;Z<q;Z+=4)G&=j[Z+3];var V=255!=G,$=Ir.encode.framize(g,m,y,I,U,B),W={},X=[],Y=[];if(0!=k){var J=[];for(Z=0;Z<$.length;Z++)J.push($[Z].img.buffer);var K=Ir.encode.concatRGBA(J),Q=Ir.quantize(K,k),tt=0,et=new Uint8Array(Q.abuf);for(Z=0;Z<$.length;Z++){var vt=(ie=$[Z].img).length;for(Y.push(new Uint8Array(Q.inds.buffer,tt>>2,vt>>2)),N=0;N<vt;N+=4)ie[N]=et[tt+N],ie[N+1]=et[tt+N+1],ie[N+2]=et[tt+N+2],ie[N+3]=et[tt+N+3];tt+=vt}for(Z=0;Z<Q.plte.length;Z++)X.push(Q.plte[Z].est.rgba)}else for(N=0;N<$.length;N++){var yt=$[N],kt=new Uint32Array(yt.img.buffer),xt=yt.rect.width,Et=(q=kt.length,new Uint8Array(q));for(Y.push(Et),Z=0;Z<q;Z++){var zt=kt[Z];if(0!=Z&&zt==kt[Z-1])Et[Z]=Et[Z-1];else if(Z>xt&&zt==kt[Z-xt])Et[Z]=Et[Z-xt];else{var It=W[zt];if(null==It&&(W[zt]=It=X.length,X.push(zt),X.length>=300))break;Et[Z]=It}}}var Ut=X.length;for(Ut<=256&&0==M&&(H=Ut<=2?1:Ut<=4?2:Ut<=16?4:8,H=Math.max(H,P)),N=0;N<$.length;N++){(yt=$[N]).rect.x,yt.rect.y,xt=yt.rect.width;var Bt=yt.rect.height,jt=yt.img;new Uint32Array(jt.buffer);var Wt=4*xt,Xt=4;if(Ut<=256&&0==M){Wt=Math.ceil(H*xt/8);for(var Yt=new Uint8Array(Wt*Bt),Jt=Y[N],Kt=0;Kt<Bt;Kt++){Z=Kt*Wt;var te=Kt*xt;if(8==H)for(var ee=0;ee<xt;ee++)Yt[Z+ee]=Jt[te+ee];else if(4==H)for(ee=0;ee<xt;ee++)Yt[Z+(ee>>1)]|=Jt[te+ee]<<4-4*(1&ee);else if(2==H)for(ee=0;ee<xt;ee++)Yt[Z+(ee>>2)]|=Jt[te+ee]<<6-2*(3&ee);else if(1==H)for(ee=0;ee<xt;ee++)Yt[Z+(ee>>3)]|=Jt[te+ee]<<7-1*(7&ee)}jt=Yt,O=3,Xt=1}else if(0==V&&1==$.length){Yt=new Uint8Array(xt*Bt*3);var re=xt*Bt;for(Z=0;Z<re;Z++){var ie,ne=4*Z;Yt[ie=3*Z]=jt[ne],Yt[ie+1]=jt[ne+1],Yt[ie+2]=jt[ne+2]}jt=Yt,O=2,Xt=3,Wt=3*xt}yt.img=jt,yt.bpl=Wt,yt.bpp=Xt}return{ctype:O,depth:H,plte:X,frames:$}},Ir.encode.framize=function(g,m,y,k,z,I){for(var U=[],B=0;B<g.length;B++){var P,M=new Uint8Array(g[B]),O=new Uint32Array(M.buffer),H=0,G=0,N=m,j=y,q=k?1:0;if(0!=B){for(var Z=I||k||1==B||0!=U[B-2].dispose?1:2,V=0,$=1e9,W=0;W<Z;W++){for(var X=new Uint8Array(g[B-1-W]),Y=new Uint32Array(g[B-1-W]),J=m,K=y,Q=-1,tt=-1,et=0;et<y;et++)for(var vt=0;vt<m;vt++)O[Ut=et*m+vt]!=Y[Ut]&&(vt<J&&(J=vt),vt>Q&&(Q=vt),et<K&&(K=et),et>tt&&(tt=et));-1==Q&&(J=K=Q=tt=0),z&&(!(1&~J)&&J--,!(1&~K)&&K--);var yt=(Q-J+1)*(tt-K+1);yt<$&&($=yt,V=W,H=J,G=K,N=Q-J+1,j=tt-K+1)}X=new Uint8Array(g[B-1-V]),1==V&&(U[B-1].dispose=2),P=new Uint8Array(N*j*4),Ir._copyTile(X,m,y,P,N,j,-H,-G,0),1==(q=Ir._copyTile(M,m,y,P,N,j,-H,-G,3)?1:0)?Ir.encode._prepareDiff(M,m,y,P,{x:H,y:G,width:N,height:j}):Ir._copyTile(M,m,y,P,N,j,-H,-G,0)}else P=M.slice(0);U.push({rect:{x:H,y:G,width:N,height:j},img:P,blend:q,dispose:0})}if(k)for(B=0;B<U.length;B++)if(1!=(Bt=U[B]).blend){var kt=Bt.rect,xt=U[B-1].rect,Et=Math.min(kt.x,xt.x),zt=Math.min(kt.y,xt.y),It={x:Et,y:zt,width:Math.max(kt.x+kt.width,xt.x+xt.width)-Et,height:Math.max(kt.y+kt.height,xt.y+xt.height)-zt};U[B-1].dispose=1,B-1!=0&&Ir.encode._updateFrame(g,m,y,U,B-1,It,z),Ir.encode._updateFrame(g,m,y,U,B,It,z)}if(1!=g.length)for(var Ut=0;Ut<U.length;Ut++){var Bt;(Bt=U[Ut]).rect.width,Bt.rect.height}return U},Ir.encode._updateFrame=function(g,m,y,k,z,I,U){for(var B=Uint8Array,P=Uint32Array,M=new B(g[z-1]),O=new P(g[z-1]),H=z+1<g.length?new B(g[z+1]):null,G=new B(g[z]),N=new P(G.buffer),j=m,q=y,Z=-1,V=-1,$=0;$<I.height;$++)for(var W=0;W<I.width;W++){var X=I.x+W,Y=I.y+$,J=Y*m+X,K=N[J];0==K||0==k[z-1].dispose&&O[J]==K&&(null==H||0!=H[4*J+3])||(X<j&&(j=X),X>Z&&(Z=X),Y<q&&(q=Y),Y>V&&(V=Y))}-1==Z&&(j=q=Z=V=0),U&&(!(1&~j)&&j--,!(1&~q)&&q--),I={x:j,y:q,width:Z-j+1,height:V-q+1};var Q=k[z];Q.rect=I,Q.blend=1,Q.img=new Uint8Array(I.width*I.height*4),0==k[z-1].dispose?(Ir._copyTile(M,m,y,Q.img,I.width,I.height,-I.x,-I.y,0),Ir.encode._prepareDiff(G,m,y,Q.img,I)):Ir._copyTile(G,m,y,Q.img,I.width,I.height,-I.x,-I.y,0)},Ir.encode._prepareDiff=function(g,m,y,k,z){Ir._copyTile(g,m,y,k,z.width,z.height,-z.x,-z.y,2)},Ir.encode._filterZero=function(g,m,y,k,z,I,U){var B,P=[],M=[0,1,2,3,4];-1!=I?M=[I]:(m*k>5e5||1==y)&&(M=[0]),U&&(B={level:0});for(var O=U&&null!=UZIP?UZIP:zr,H=0;H<M.length;H++){for(var G=0;G<m;G++)Ir.encode._filterLine(z,g,G,k,y,M[H]);P.push(O.deflate(z,B))}var N,j=1e9;for(H=0;H<P.length;H++)P[H].length<j&&(N=H,j=P[H].length);return P[N]},Ir.encode._filterLine=function(g,m,y,k,z,I){var U=y*k,B=U+y,P=Ir.decode._paeth;if(g[B]=I,B++,0==I)if(k<500)for(var M=0;M<k;M++)g[B+M]=m[U+M];else g.set(new Uint8Array(m.buffer,U,k),B);else if(1==I){for(M=0;M<z;M++)g[B+M]=m[U+M];for(M=z;M<k;M++)g[B+M]=m[U+M]-m[U+M-z]+256&255}else if(0==y){for(M=0;M<z;M++)g[B+M]=m[U+M];if(2==I)for(M=z;M<k;M++)g[B+M]=m[U+M];if(3==I)for(M=z;M<k;M++)g[B+M]=m[U+M]-(m[U+M-z]>>1)+256&255;if(4==I)for(M=z;M<k;M++)g[B+M]=m[U+M]-P(m[U+M-z],0,0)+256&255}else{if(2==I)for(M=0;M<k;M++)g[B+M]=m[U+M]+256-m[U+M-k]&255;if(3==I){for(M=0;M<z;M++)g[B+M]=m[U+M]+256-(m[U+M-k]>>1)&255;for(M=z;M<k;M++)g[B+M]=m[U+M]+256-(m[U+M-k]+m[U+M-z]>>1)&255}if(4==I){for(M=0;M<z;M++)g[B+M]=m[U+M]+256-P(0,m[U+M-k],0)&255;for(M=z;M<k;M++)g[B+M]=m[U+M]+256-P(m[U+M-z],m[U+M-k],m[U+M-z-k])&255}}},Ir.crc={table:function(){for(var g=new Uint32Array(256),m=0;m<256;m++){for(var y=m,k=0;k<8;k++)1&y?y=3988292384^y>>>1:y>>>=1;g[m]=y}return g}(),update:function(g,m,y,k){for(var z=0;z<k;z++)g=Ir.crc.table[255&(g^m[y+z])]^g>>>8;return g},crc:function(g,m,y){return 4294967295^Ir.crc.update(4294967295,g,m,y)}},Ir.quantize=function(g,m){var y=new Uint8Array(g),k=y.slice(0),z=new Uint32Array(k.buffer),I=Ir.quantize.getKDtree(k,m),U=I[0],B=I[1];Ir.quantize.planeDst;for(var P=y,M=z,O=P.length,H=new Uint8Array(y.length>>2),G=0;G<O;G+=4){var N=P[G]*(1/255),j=P[G+1]*(1/255),q=P[G+2]*(1/255),Z=P[G+3]*(1/255),V=Ir.quantize.getNearest(U,N,j,q,Z);H[G>>2]=V.ind,M[G>>2]=V.est.rgba}return{abuf:k.buffer,inds:H,plte:B}},Ir.quantize.getKDtree=function(g,m,y){null==y&&(y=1e-4);var k=new Uint32Array(g.buffer),z={i0:0,i1:g.length,bst:null,est:null,tdst:0,left:null,right:null};z.bst=Ir.quantize.stats(g,z.i0,z.i1),z.est=Ir.quantize.estats(z.bst);for(var I=[z];I.length<m;){for(var U=0,B=0,P=0;P<I.length;P++)I[P].est.L>U&&(U=I[P].est.L,B=P);if(U<y)break;var M=I[B],O=Ir.quantize.splitPixels(g,k,M.i0,M.i1,M.est.e,M.est.eMq255);if(M.i0>=O||M.i1<=O)M.est.L=0;else{var H={i0:M.i0,i1:O,bst:null,est:null,tdst:0,left:null,right:null};H.bst=Ir.quantize.stats(g,H.i0,H.i1),H.est=Ir.quantize.estats(H.bst);var G={i0:O,i1:M.i1,bst:null,est:null,tdst:0,left:null,right:null};for(G.bst={R:[],m:[],N:M.bst.N-H.bst.N},P=0;P<16;P++)G.bst.R[P]=M.bst.R[P]-H.bst.R[P];for(P=0;P<4;P++)G.bst.m[P]=M.bst.m[P]-H.bst.m[P];G.est=Ir.quantize.estats(G.bst),M.left=H,M.right=G,I[B]=H,I.push(G)}}for(I.sort((function(g,m){return m.bst.N-g.bst.N})),P=0;P<I.length;P++)I[P].ind=P;return[z,I]},Ir.quantize.getNearest=function(g,m,y,k,z){if(null==g.left)return g.tdst=Ir.quantize.dist(g.est.q,m,y,k,z),g;var I=Ir.quantize.planeDst(g.est,m,y,k,z),U=g.left,B=g.right;I>0&&(U=g.right,B=g.left);var P=Ir.quantize.getNearest(U,m,y,k,z);if(P.tdst<=I*I)return P;var M=Ir.quantize.getNearest(B,m,y,k,z);return M.tdst<P.tdst?M:P},Ir.quantize.planeDst=function(g,m,y,k,z){var I=g.e;return I[0]*m+I[1]*y+I[2]*k+I[3]*z-g.eMq},Ir.quantize.dist=function(g,m,y,k,z){var I=m-g[0],U=y-g[1],B=k-g[2],P=z-g[3];return I*I+U*U+B*B+P*P},Ir.quantize.splitPixels=function(g,m,y,k,z,I){var U=Ir.quantize.vecDot;for(k-=4;y<k;){for(;U(g,y,z)<=I;)y+=4;for(;U(g,k,z)>I;)k-=4;if(y>=k)break;var B=m[y>>2];m[y>>2]=m[k>>2],m[k>>2]=B,y+=4,k-=4}for(;U(g,y,z)>I;)y-=4;return y+4},Ir.quantize.vecDot=function(g,m,y){return g[m]*y[0]+g[m+1]*y[1]+g[m+2]*y[2]+g[m+3]*y[3]},Ir.quantize.stats=function(g,m,y){for(var k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],z=[0,0,0,0],I=y-m>>2,U=m;U<y;U+=4){var B=g[U]*(1/255),P=g[U+1]*(1/255),M=g[U+2]*(1/255),O=g[U+3]*(1/255);z[0]+=B,z[1]+=P,z[2]+=M,z[3]+=O,k[0]+=B*B,k[1]+=B*P,k[2]+=B*M,k[3]+=B*O,k[5]+=P*P,k[6]+=P*M,k[7]+=P*O,k[10]+=M*M,k[11]+=M*O,k[15]+=O*O}return k[4]=k[1],k[8]=k[2],k[9]=k[6],k[12]=k[3],k[13]=k[7],k[14]=k[11],{R:k,m:z,N:I}},Ir.quantize.estats=function(g){var m=g.R,y=g.m,k=g.N,z=y[0],I=y[1],U=y[2],B=y[3],P=0==k?0:1/k,M=[m[0]-z*z*P,m[1]-z*I*P,m[2]-z*U*P,m[3]-z*B*P,m[4]-I*z*P,m[5]-I*I*P,m[6]-I*U*P,m[7]-I*B*P,m[8]-U*z*P,m[9]-U*I*P,m[10]-U*U*P,m[11]-U*B*P,m[12]-B*z*P,m[13]-B*I*P,m[14]-B*U*P,m[15]-B*B*P],O=M,H=Ir.M4,G=[.5,.5,.5,.5],N=0,j=0;if(0!=k)for(var q=0;q<10&&(G=H.multVec(O,G),j=Math.sqrt(H.dot(G,G)),G=H.sml(1/j,G),!(Math.abs(j-N)<1e-9));q++)N=j;var Z=[z*P,I*P,U*P,B*P];return{Cov:M,q:Z,e:G,L:N,eMq255:H.dot(H.sml(255,Z),G),eMq:H.dot(G,Z),rgba:(Math.round(255*Z[3])<<24|Math.round(255*Z[2])<<16|Math.round(255*Z[1])<<8|Math.round(255*Z[0]))>>>0}},Ir.M4={multVec:function(g,m){return[g[0]*m[0]+g[1]*m[1]+g[2]*m[2]+g[3]*m[3],g[4]*m[0]+g[5]*m[1]+g[6]*m[2]+g[7]*m[3],g[8]*m[0]+g[9]*m[1]+g[10]*m[2]+g[11]*m[3],g[12]*m[0]+g[13]*m[1]+g[14]*m[2]+g[15]*m[3]]},dot:function(g,m){return g[0]*m[0]+g[1]*m[1]+g[2]*m[2]+g[3]*m[3]},sml:function(g,m){return[g*m[0],g*m[1],g*m[2],g*m[3]]}},Ir.encode.concatRGBA=function(g){for(var m=0,y=0;y<g.length;y++)m+=g[y].byteLength;var k=new Uint8Array(m),z=0;for(y=0;y<g.length;y++){for(var I=new Uint8Array(g[y]),U=I.length,B=0;B<U;B+=4){var P=I[B],M=I[B+1],O=I[B+2],H=I[B+3];0==H&&(P=M=O=0),k[z+B]=P,k[z+B+1]=M,k[z+B+2]=O,k[z+B+3]=H}z+=U}return k.buffer};const Tr={decode(g){const m=Ir.decode(g);return{width:m.width,height:m.height,data:new Uint8Array(Ir.toRGBA8(m)[0])}},encode(g){const m=Ir.encode([g.data],g.width,g.height,0);return new Uint8Array(m)}};var Ur={256:"imageWidth",257:"imageLength",258:"bitsPerSample",259:"compression",262:"photometricInterpretation",273:"stripOffsets",278:"rowsPerStrip",279:"stripByteCounts",296:"resolutionUnit",320:"colorMap"};function Je(g,m){var y=g.colorMap,k=g.bitsPerSample,z=g.photometricInterpretation,I=void 0;if(m=function(g,m){var y=g.compression;if(y&&1!==y[0])throw 2===y[0]?new Error("CCITT group3 decompressionion is not implemented."):5===y[0]?new Error("LZW decompressionion is not implemented."):6===y[0]?new Error("JPEG decompressionion is not implemented."):7===y[0]?new Error("JPEG2 decompressionion is not implemented."):8===y[0]?new Error("Zip (Adove Deflate) decompressionion is not implemented."):32773===y[0]?new Error("Packbits decompression is not implemented."):new Error("Unknown compression type: "+y[0]);return m}(g,m),!k)throw new Error("Bilevel image decode is not implemented.");if(y)throw new Error("Palette-color image decode is not implemented.");if(z[0]=4===k.length)return m;if(z[0]=3===k.length){I=new Uint8Array(m.length/3*4);for(var U=0;U<m.length/3;U++)I[4*U]=m[3*U],I[4*U+1]=m[3*U+1],I[4*U+2]=m[3*U+2],I[4*U+3]=255;return I}if(z[0]<2&&1===k.length&&4===k[0]){I=new Uint8Array(4*m.length);for(var B=0;B<m.length;B++)I[4*B]=m[B]<<4,I[4*B+1]=m[B+1]<<4,I[4*B+2]=m[B+2]<<4,I[4*B+3]=255;return I}if(z[0]<2&&1===k.length&&8===k[0]){I=new Uint8Array(4*m.length);for(var P=0;P<m.length;P++)I[4*P]=m[P],I[4*P+1]=m[P+1],I[4*P+2]=m[P+2],I[4*P+3]=255;return I}throw new Error("Can't detect image type. PhotometricInterpretation: "+z[0]+", BitsPerSample: "+k)}var $e_decode=function(g){var m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{singlePage:!0},y=function Ke(g){var m=0,y=void 0,k={},z=void 0;function a(m,k){var z=m,I=m+k;if(y)return g.subarray(z,I);for(var U=g.subarray(z,I),B=new Uint8Array(I-z),P=0;P<U.byteLength;P++)B[U.byteLength-P-1]=U[P];return B}function s(m){var k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments[2];if(y){var I=new DataView(g.buffer);if(k>1||z){for(var U=new Uint16Array(k),B=0;B<k;B++)U[B]=I.getUint16(m+(B<<1));return U}return I.getUint16(m)}var P=new DataView(a(m,k<<1).buffer);if(k>1||z){for(var M=new Uint16Array(k),O=0;O<k;O++)M[O]=P.getUint16(O<<1);return M}return P.getUint16(0)}function o(m){var k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments[2];if(y){var I=new DataView(g.buffer);if(k>1||z){for(var U=new Uint32Array(k),B=0;B<k;B++)U[B]=I.getUint32(m+(B<<2));return U}return I.getUint32(m)}var P=new DataView(a(m,k<<2).buffer);if(k>1||z){for(var M=new Uint32Array(k),O=0;O<k;O++)M[O]=P.getUint32(O<<2);return M}return P.getUint32(0)}function h(g,m,z,I){var U=Ur[g];U&&(k[U]=function(g,m,k){var z,I=function(g,m){switch(g){case 1:return m;case 3:return m<<1;case 4:default:return m<<2;case 5:return m<<3}}(g,m);I>4&&(k=o(k)),z=I<4?4/I:m;var U=void 0;switch(g){case 1:break;case 3:U=s(k,z,!0);break;case 4:U=o(k,z,!0)}if(U)return I<4?y?U.slice(0,z-m):U.slice(z-m):U}(m,z,I))}function f(m){for(var y=new Uint8Array(m.stripByteCounts.reduce((function(g,m){return g+m}),0)),k=0,z=0;z<m.stripOffsets.length;z++){var I=g.subarray(m.stripOffsets[z],m.stripOffsets[z]+m.stripByteCounts[z]);y.set(I,k),k+=I.byteLength}return y}if(77===g[0]&&77===g[1])y=!0;else{if(73!==g[0]||73!==g[1])throw new Error("Invalid byte order "+g[0]+g[1]);y=!1}if(42!==a(2,2)[1])throw new Error("not tiff");for(var I=[],U=o(4);0!==U;U=o(m)){var B=s(m=U);k={},m+=2;for(var P=0;P<B;P++)h(s(m),s(m+=2),o(m+=2),m+=4),m+=4;z=f(k),I.push({stripData:z,ifdEntries:k})}return I}(new Uint8Array(g)),k=y.map((function(g){return{width:g.ifdEntries.imageWidth[0],height:g.ifdEntries.imageLength[0],data:Je(g.ifdEntries,g.stripData),ifdEntries:g.ifdEntries}}));if(m.singlePage){if(!k||!k.length)throw new Error("No pages");return k[0]}return k};const Cr={decode(g){const m=$e_decode(g,{singlePage:!0});return{width:m.width,height:m.height,data:m.data}},encode(){throw new Error("Encoding is not supported for TIFF images!")}},Lr={[H.JPEG]:xt,[H.PNG]:Tr,[H.GIF]:Q,[H.BMP]:q,[H.TIFF]:Cr},er=(g,m,y)=>{const k=[],z=[],I=[],U=[];for(let B=0;B<m*y;B++)k.push(g[4*B]),z.push(g[4*B+1]),I.push(g[4*B+2]),U.push(g[4*B+3]);return[k,z,I,U]},rr=(g,m,y,k,z,I)=>{ir(g,m,y,k,(I[0]-1)/2),ir(m,g,y,k,(I[1]-1)/2),ir(g,m,y,k,(I[2]-1)/2)},ir=(g,m,y,k,z)=>{for(let y=0;y<g.length;y++)m[y]=g[y];nr(m,g,y,k,z),ar(g,m,y,k,z)},nr=(g,m,y,k,z)=>{const I=1/(z+z+1);for(let U=0;U<k;U++){let k=U*y,B=k,P=k+z;const M=g[k],O=g[k+y-1];let H=(z+1)*M;for(let m=0;m<z;m++)H+=g[k+m];for(let y=0;y<=z;y++)H+=g[P++]-M,m[k++]=H*I;for(let U=z+1;U<y-z;U++)H+=g[P++]-g[B++],m[k++]=H*I;for(let U=y-z;U<y;U++)H+=O-g[B++],m[k++]=H*I}},ar=(g,m,y,k,z)=>{const I=1/(z+z+1);for(let U=0;U<y;U++){let B=U,P=B,M=B+z*y;const O=g[B],H=g[B+y*(k-1)];let G=(z+1)*O;for(let m=0;m<z;m++)G+=g[B+m*y];for(let k=0;k<=z;k++)G+=g[M]-O,m[B]=G*I,M+=y,B+=y;for(let U=z+1;U<k-z;U++)G+=g[M]-g[P],m[B]=G*I,P+=y,M+=y,B+=y;for(let U=k-z;U<k;U++)G+=H-g[P],m[B]=G*I,P+=y,B+=y}},or=(g,m)=>g<1?Math.round(g*m):g,Br={"center bottom":{horizontalPosition:"center",verticalPosition:"bottom"},"center center":{horizontalPosition:"center",verticalPosition:"center"},"center top":{horizontalPosition:"center",verticalPosition:"top"},"left bottom":{horizontalPosition:"left",verticalPosition:"bottom"},"left center":{horizontalPosition:"left",verticalPosition:"center"},"left top":{horizontalPosition:"left",verticalPosition:"top"},"right bottom":{horizontalPosition:"right",verticalPosition:"bottom"},"right center":{horizontalPosition:"right",verticalPosition:"center"},"right top":{horizontalPosition:"right",verticalPosition:"top"},bottom:{horizontalPosition:"center",verticalPosition:"bottom"},center:{horizontalPosition:"center",verticalPosition:"center"},left:{horizontalPosition:"left",verticalPosition:"center"},right:{horizontalPosition:"right",verticalPosition:"center"},top:{horizontalPosition:"center",verticalPosition:"top"}},dr=(g,m,y,k,z,I)=>{const U=g/m,B=y/k;let P=y,M=k,O=0,H=0;if("contain"===z||"cover"===z){"contain"===z?U>=B?M=y/U:P=k*U:"cover"===z&&(U<B?(P=y,M=y/U):(P=k*U,M=k));const{horizontalPosition:g,verticalPosition:m}=(g=>Br[g]||Br.center)(I);"left"===g?O=0:"center"===g?O=y/2-P/2:"right"===g&&(O=y-P),"top"===m?H=0:"center"===m?H=k/2-M/2:"bottom"===m&&(H=k-M)}return{imageWidth:Math.round(P),imageHeight:Math.round(M),xOffset:Math.round(O),yOffset:Math.round(H)}},ur=(g,m,y,k,z)=>m===k?y:Math.round((g-m)*z+(k-g)*y),cr=(g,m,y,k,z,I,U,B,P,M)=>{const O=[0,0,0,0];for(let m=0;m<4;m+=1){let y=4*(B*g.width+z)+m,M=4*(B*g.width+I)+m;const H=ur(k,z,g.data[y],I,g.data[M]);if(P===B)O[m]=H;else{y=4*(P*g.width+z)+m,M=4*(P*g.width+I)+m;const G=ur(k,z,g.data[y],I,g.data[M]);O[m]=ur(U,B,H,P,G)}}O.every((g=>0===g))?m.set(M,y):m.set(O,y)},pr=(g,m)=>(y,k)=>({x:y+g,y:k+m}),Rr=new Set([H.JPEG,H.PNG,H.GIF,H.BMP,H.TIFF]),Pr=new Set([H.JPEG,H.PNG,H.GIF,H.BMP]);class _r{#t;#e;outputOptions;constructor(g,m,y={}){let k={};if(null==m?(this.#e=i$1(g),k=y||{}):"string"==typeof m?(this.#e=m,k=y||{}):(this.#e=i$1(g),"object"!=typeof m||Array.isArray(m)||(k=m||{})),!Rr.has(this.#e))throw new Error(`Unsupported input file type: ${this.#e}`);this.#t=Lr[this.#e].decode(g),this.outputOptions={background:k.background??[0,0,0,0],quality:k.quality??80,compressionLevel:k.compressionLevel??9,loop:k.loop??0,delay:k.delay??100}}get width(){return this.#t.width}get height(){return this.#t.height}crop(g,m,y,k){return((g,m,y)=>{const k=or(m.x,g.width),z=or(m.y,g.height),I=or(m.width,g.width),U=or(m.height,g.height),B=new Uint8Array(I*U*4);for(let g=0;g<B.length;g+=4)B.set(y,g);const P=I-k,M=U-z;for(let m=0;m<M;m+=1){const y=(z+m)*g.width+k<<2,U=y+(P<<2),M=g.data.subarray(y,U),O=m*I<<2;B.set(M,O)}g.data=B,g.width=I,g.height=U})(this.#t,{x:g,y:m,width:y,height:k},this.outputOptions.background),this}resize(g,m=null,y={}){let k=null,z={};if(null==m?(k=null,z=y||{}):"number"==typeof m?(k=m,z=y||{}):(k=null,"object"!=typeof m||Array.isArray(m)||(z=m||{})),!g&&!k)throw new Error("At least one dimension must be provided!");return((g,m,y,k,z)=>{if(!m&&!y)throw new Error("At least one dimension must be provided!");const{frameWidth:I,frameHeight:U}=((g,m,y,k,z)=>{if(y&&k){if("fill"===z||"contain"===z)return{frameWidth:y,frameHeight:k};if("inside"===z){const z=Math.min(y/g,k/m);return{frameWidth:Math.round(g*z),frameHeight:Math.round(m*z)}}if("outside"===z){const z=Math.max(y/g,k/m);return{frameWidth:Math.round(g*z),frameHeight:Math.round(m*z)}}}const I=g/m;return{frameWidth:y||Math.round(k*I),frameHeight:k||Math.round(y/I)}})(g.width,g.height,m,y,k.fit),{imageWidth:B,imageHeight:P,xOffset:M,yOffset:O}=dr(g.width,g.height,I,U,k.fit,k.position),H=new Uint8Array(I*U*4);for(let g=0;g<H.length;g+=4)H.set(z,g);for(let m=0;m<P&&m+O<U;m+=1)for(let y=0;y<B&&y+M<I;y+=1){if(y+M<0||y+M>=I||m+O<0||m+O>=U)continue;const k=4*((m+O)*I+(y+M)),G=y*g.width/B,N=Math.floor(G),j=Math.min(Math.ceil(G),g.width-1),q=m*g.height/P,Z=Math.floor(q),V=Math.min(Math.ceil(q),g.height-1);cr(g,H,k,G,N,j,q,Z,V,z)}g.data=H,g.width=I,g.height=U})(this.#t,g,k,{fit:z.fit??"cover",position:z.position??"center"},this.outputOptions.background),this}flip(g){return((g,m)=>{if("horizontal"===m||"both"===m)for(let m=0;m<g.height;m+=1){const y=m*g.width;for(let m=0;m<g.width/2;m+=1){const k=y+m<<2,z=g.data.slice(k,k+4),I=y+(g.width-1-m)<<2,U=g.data.slice(I,I+4);g.data.set(z,I),g.data.set(U,k)}}if("vertical"===m||"both"===m)for(let m=0;m<g.width;m+=1)for(let y=0;y<g.height/2;y+=1){const k=y*g.width+m<<2,z=g.data.slice(k,k+4),I=(g.height-1-y)*g.width+m<<2,U=g.data.slice(I,I+4);g.data.set(z,I),g.data.set(U,k)}})(this.#t,g),this}rotate(g){return((g,m,y)=>{const k=m%360*Math.PI/180,z=Math.cos(k),I=Math.sin(k),U=new Uint8Array(g.data.length);for(let g=0;g<U.length;g+=4)U.set(y,g);const B=pr(-g.width/2,-g.height/2),P=pr(g.width/2+.5,g.height/2+.5);for(let m=1;m<=g.height;m++)for(let y=1;y<=g.width;y++){const k=B(y,m),M=P(z*k.x-I*k.y,z*k.y+I*k.x),O=g.width*(m-1)+y-1<<2;if(M.x>=0&&M.x<g.width&&M.y>=0&&M.y<g.height){const m=g.width*(0|M.y)+M.x<<2,y=g.data.subarray(m,m+4);U.set(y,O)}}g.data=U})(this.#t,g,this.outputOptions.background),this}blur(g){return((g,m)=>{const y=er(g.data,g.width,g.height),k=er(g.data,g.width,g.height),z=(g=>{const m=Math.sqrt(12*g*g/3+1);let y=Math.floor(m);y%2==0&&y--;const k=y+2,z=(12*g*g-3*y*y-12*y-9)/(-4*y-4),I=Math.round(z),U=[];for(let g=0;g<3;g++)U.push(g<I?y:k);return U})(m);rr(y[0],k[0],g.width,g.height,0,z),rr(y[1],k[1],g.width,g.height,0,z),rr(y[2],k[2],g.width,g.height,0,z),((g,m,y,k,z,I,U)=>{for(let B=0;B<m*y;B++)g[4*B]=k[B],g[4*B+1]=z[B],g[4*B+2]=I[B],g[4*B+3]=U[B]})(g.data,g.width,g.height,k[0],k[1],k[2],k[3])})(this.#t,g),this}toBuffer(g){const m=g||this.#e;if(!Pr.has(m))throw new Error(`Unsupported output file type: ${m}`);return Lr[m].encode(((g,m,y)=>{if(m===H.GIF){const m=g.data.slice(0),k=y.slice(0);k[3]=255;for(let g=0;g<m.length;g+=4)m[g+3]<128?m.set(k,g):m[g+3]=255;return{width:g.width,height:g.height,data:m}}if(m===H.JPEG){const m=g.data.slice(0);for(let g=3;g<m.length;g+=4)m[g]=255;return{width:g.width,height:g.height,data:m}}return g})(this.#t,m,this.outputOptions.background),this.outputOptions)}}var Fr;exports.MimeType=void 0,(Fr=exports.MimeType||(exports.MimeType={})).SVG="image/svg+xml",Fr.JPEG="image/jpeg",Fr.PNG="image/png",Fr.GIF="image/gif",Fr.WEBP="image/webp",Fr.BMP="image/bmp",Fr.TIFF="image/tiff",Fr.AVIF="image/avif";const Mr={name:"pureTransformer",supportedInputs:Rr,supportedOutputs:Pr,fallbackOutput:exports.MimeType.PNG,transform:async({data:g,contentType:m},{contentType:y,width:k,height:z,fit:I,position:U,background:B,quality:P,loop:M,delay:O,blurRadius:H,rotate:G,flip:N,crop:j,compressionLevel:q})=>{const Z=new _r(g,m,{background:B,loop:M,delay:O,quality:P,compressionLevel:q});return j&&Z.crop(j.x,j.y,j.width,j.height),null==k&&null==z||Z.resize(k,z,{fit:I,position:U}),N&&Z.flip(N),G&&0!==G&&Z.rotate(G),H&&H>0&&Z.blur(H),Z.toBuffer(y)}};class RemixImageError extends Error{errorCode;constructor(g,m){super(g),Object.setPrototypeOf(this,RemixImageError.prototype),this.errorCode=m||500}toString(){return this.message}}class UnsupportedImageError extends RemixImageError{constructor(g){super(g,415),Object.setPrototypeOf(this,UnsupportedImageError.prototype)}}const fetchResolver=async(g,m)=>{const y=new Request(m,{headers:{accept:"image/*"}}),k=await async function fetchImage(g){return await fetch(g)}(y);if(!k.ok)throw new RemixImageError("Failed to fetch image!");const z=await k.arrayBuffer();if(!z||z.byteLength<2)throw new RemixImageError("Invalid image retrieved from resolver!");return{buffer:new Uint8Array(z),contentType:k.headers.get("content-type")}},Or={0:{66:{77:"image/bmp"},71:{73:{70:"image/gif"}},73:{73:{42:{0:"image/tiff"}}},77:{77:{0:{42:"image/tiff"}}},137:{80:{78:{71:{13:{10:{26:{10:"image/png"}}}}}}},255:{216:{255:"image/jpeg"}}},4:{102:{116:{121:{112:{97:{118:{105:{102:"image/avif",115:"image/avif"}}}}}}}},8:{87:{69:{66:{80:"image/webp"}}}}},Dr=[0,4,8];var Hr;!function(g){g.SVG="image/svg+xml",g.JPEG="image/jpeg",g.PNG="image/png",g.GIF="image/gif",g.WEBP="image/webp",g.BMP="image/bmp",g.TIFF="image/tiff",g.AVIF="image/avif"}(Hr||(Hr={}));const textResponse=(g,m="")=>new Response(m,{status:g});var Gr={},strictUriEncode=g=>encodeURIComponent(g).replace(/[!'()*]/g,(g=>`%${g.charCodeAt(0).toString(16).toUpperCase()}`)),Nr="%[a-f0-9]{2}",jr=new RegExp("("+Nr+")|([^%]+?)","gi"),qr=new RegExp("("+Nr+")+","gi");function decodeComponents(g,m){try{return[decodeURIComponent(g.join(""))]}catch(g){}if(1===g.length)return g;m=m||1;var y=g.slice(0,m),k=g.slice(m);return Array.prototype.concat.call([],decodeComponents(y),decodeComponents(k))}function decode(g){try{return decodeURIComponent(g)}catch(k){for(var m=g.match(jr)||[],y=1;y<m.length;y++)m=(g=decodeComponents(m,y).join("")).match(jr)||[];return g}}var decodeUriComponent=function(g){if("string"!=typeof g)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof g+"`");try{return g=g.replace(/\+/g," "),decodeURIComponent(g)}catch(m){return function customDecodeURIComponent(g){for(var m={"%FE%FF":"","%FF%FE":""},y=qr.exec(g);y;){try{m[y[0]]=decodeURIComponent(y[0])}catch(g){var k=decode(y[0]);k!==y[0]&&(m[y[0]]=k)}y=qr.exec(g)}m["%C2"]="";for(var z=Object.keys(m),I=0;I<z.length;I++){var U=z[I];g=g.replace(new RegExp(U,"g"),m[U])}return g}(g)}},splitOnFirst=(g,m)=>{if("string"!=typeof g||"string"!=typeof m)throw new TypeError("Expected the arguments to be of type `string`");if(""===m)return[g];const y=g.indexOf(m);return-1===y?[g]:[g.slice(0,y),g.slice(y+m.length)]},filterObj=function(g,m){for(var y={},k=Object.keys(g),z=Array.isArray(m),I=0;I<k.length;I++){var U=k[I],B=g[U];(z?-1!==m.indexOf(U):m(U,B,g))&&(y[U]=B)}return y};!function(g){const m=strictUriEncode,y=decodeUriComponent,k=splitOnFirst,z=filterObj,I=Symbol("encodeFragmentIdentifier");function validateArrayFormatSeparator(g){if("string"!=typeof g||1!==g.length)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(g,y){return y.encode?y.strict?m(g):encodeURIComponent(g):g}function decode(g,m){return m.decode?y(g):g}function keysSorter(g){return Array.isArray(g)?g.sort():"object"==typeof g?keysSorter(Object.keys(g)).sort(((g,m)=>Number(g)-Number(m))).map((m=>g[m])):g}function removeHash(g){const m=g.indexOf("#");return-1!==m&&(g=g.slice(0,m)),g}function extract(g){const m=(g=removeHash(g)).indexOf("?");return-1===m?"":g.slice(m+1)}function parseValue(g,m){return m.parseNumbers&&!Number.isNaN(Number(g))&&"string"==typeof g&&""!==g.trim()?g=Number(g):!m.parseBooleans||null===g||"true"!==g.toLowerCase()&&"false"!==g.toLowerCase()||(g="true"===g.toLowerCase()),g}function parse(g,m){validateArrayFormatSeparator((m=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},m)).arrayFormatSeparator);const y=function parserForArrayFormat(g){let m;switch(g.arrayFormat){case"index":return(g,y,k)=>{m=/\[(\d*)\]$/.exec(g),g=g.replace(/\[\d*\]$/,""),m?(void 0===k[g]&&(k[g]={}),k[g][m[1]]=y):k[g]=y};case"bracket":return(g,y,k)=>{m=/(\[\])$/.exec(g),g=g.replace(/\[\]$/,""),m?void 0!==k[g]?k[g]=[].concat(k[g],y):k[g]=[y]:k[g]=y};case"colon-list-separator":return(g,y,k)=>{m=/(:list)$/.exec(g),g=g.replace(/:list$/,""),m?void 0!==k[g]?k[g]=[].concat(k[g],y):k[g]=[y]:k[g]=y};case"comma":case"separator":return(m,y,k)=>{const z="string"==typeof y&&y.includes(g.arrayFormatSeparator),I="string"==typeof y&&!z&&decode(y,g).includes(g.arrayFormatSeparator);y=I?decode(y,g):y;const U=z||I?y.split(g.arrayFormatSeparator).map((m=>decode(m,g))):null===y?y:decode(y,g);k[m]=U};case"bracket-separator":return(m,y,k)=>{const z=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!z)return void(k[m]=y?decode(y,g):y);const I=null===y?[]:y.split(g.arrayFormatSeparator).map((m=>decode(m,g)));void 0!==k[m]?k[m]=[].concat(k[m],I):k[m]=I};default:return(g,m,y)=>{void 0!==y[g]?y[g]=[].concat(y[g],m):y[g]=m}}}(m),z=Object.create(null);if("string"!=typeof g)return z;if(!(g=g.trim().replace(/^[?#&]/,"")))return z;for(const I of g.split("&")){if(""===I)continue;let[g,U]=k(m.decode?I.replace(/\+/g," "):I,"=");U=void 0===U?null:["comma","separator","bracket-separator"].includes(m.arrayFormat)?U:decode(U,m),y(decode(g,m),U,z)}for(const g of Object.keys(z)){const y=z[g];if("object"==typeof y&&null!==y)for(const g of Object.keys(y))y[g]=parseValue(y[g],m);else z[g]=parseValue(y,m)}return!1===m.sort?z:(!0===m.sort?Object.keys(z).sort():Object.keys(z).sort(m.sort)).reduce(((g,m)=>{const y=z[m];return Boolean(y)&&"object"==typeof y&&!Array.isArray(y)?g[m]=keysSorter(y):g[m]=y,g}),Object.create(null))}g.extract=extract,g.parse=parse,g.stringify=(g,m)=>{if(!g)return"";validateArrayFormatSeparator((m=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},m)).arrayFormatSeparator);const shouldFilter=y=>m.skipNull&&null==g[y]||m.skipEmptyString&&""===g[y],y=function encoderForArrayFormat(g){switch(g.arrayFormat){case"index":return m=>(y,k)=>{const z=y.length;return void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,[encode(m,g),"[",z,"]"].join("")]:[...y,[encode(m,g),"[",encode(z,g),"]=",encode(k,g)].join("")]};case"bracket":return m=>(y,k)=>void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,[encode(m,g),"[]"].join("")]:[...y,[encode(m,g),"[]=",encode(k,g)].join("")];case"colon-list-separator":return m=>(y,k)=>void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,[encode(m,g),":list="].join("")]:[...y,[encode(m,g),":list=",encode(k,g)].join("")];case"comma":case"separator":case"bracket-separator":{const m="bracket-separator"===g.arrayFormat?"[]=":"=";return y=>(k,z)=>void 0===z||g.skipNull&&null===z||g.skipEmptyString&&""===z?k:(z=null===z?"":z,0===k.length?[[encode(y,g),m,encode(z,g)].join("")]:[[k,encode(z,g)].join(g.arrayFormatSeparator)])}default:return m=>(y,k)=>void 0===k||g.skipNull&&null===k||g.skipEmptyString&&""===k?y:null===k?[...y,encode(m,g)]:[...y,[encode(m,g),"=",encode(k,g)].join("")]}}(m),k={};for(const m of Object.keys(g))shouldFilter(m)||(k[m]=g[m]);const z=Object.keys(k);return!1!==m.sort&&z.sort(m.sort),z.map((k=>{const z=g[k];return void 0===z?"":null===z?encode(k,m):Array.isArray(z)?0===z.length&&"bracket-separator"===m.arrayFormat?encode(k,m)+"[]":z.reduce(y(k),[]).join("&"):encode(k,m)+"="+encode(z,m)})).filter((g=>g.length>0)).join("&")},g.parseUrl=(g,m)=>{m=Object.assign({decode:!0},m);const[y,z]=k(g,"#");return Object.assign({url:y.split("?")[0]||"",query:parse(extract(g),m)},m&&m.parseFragmentIdentifier&&z?{fragmentIdentifier:decode(z,m)}:{})},g.stringifyUrl=(m,y)=>{y=Object.assign({encode:!0,strict:!0,[I]:!0},y);const k=removeHash(m.url).split("?")[0]||"",z=g.extract(m.url),U=g.parse(z,{sort:!1}),B=Object.assign(U,m.query);let P=g.stringify(B,y);P&&(P=`?${P}`);let M=function getHash(g){let m="";const y=g.indexOf("#");return-1!==y&&(m=g.slice(y)),m}(m.url);return m.fragmentIdentifier&&(M=`#${y[I]?encode(m.fragmentIdentifier,y):m.fragmentIdentifier}`),`${k}${P}${M}`},g.pick=(m,y,k)=>{k=Object.assign({parseFragmentIdentifier:!0,[I]:!1},k);const{url:U,query:B,fragmentIdentifier:P}=g.parseUrl(m,k);return g.stringifyUrl({url:U,query:z(B,y),fragmentIdentifier:P},k)},g.exclude=(m,y,k)=>{const z=Array.isArray(y)?g=>!y.includes(g):(g,m)=>!y(g,m);return g.pick(m,z,k)}}(Gr);const parseURL=(g,m)=>{let y;try{y=new URL(g,m)}catch(m){throw new RemixImageError(`Invalid URL: ${g}`,400)}return y};exports.Cache=Cache,exports.GB=g=>1e9*g,exports.MemoryCache=class MemoryCache extends Cache{config;cache;constructor(g={}){super(),this.config={maxSize:g?.maxSize??mB(50),ttl:g?.ttl??86400,tbd:g?.tbd??31536e3},this.cache=new B({ttl:this.config.ttl,allowStale:!0,updateAgeOnGet:!0,maxSize:this.config.maxSize,sizeCalculation:g=>g.byteLength})}async status(g){return this.cache.has(g)?exports.CacheStatus.HIT:exports.CacheStatus.MISS}async has(g){return this.cache.has(g)}async get(g){return this.cache.get(g)??null}async set(g,m){this.cache.set(g,m,{size:m.byteLength})}async clear(){this.cache.clear()}},exports.RemixImageError=RemixImageError,exports.UnsupportedImageError=UnsupportedImageError,exports.fetchResolver=fetchResolver,exports.generateKey=(...g)=>g.filter((g=>null!=g)).join("_"),exports.imageLoader=async({selfUrl:g,cache:m=null,resolver:y=fetchResolver,transformer:k=Mr,useFallbackFormat:z=!0,fallbackFormat:I,useFallbackTransformer:U=!0,fallbackTransformer:B=Mr,defaultOptions:P={},redirectOnFail:M=!1,skipFormats:O=new Set([exports.MimeType.SVG]),basePath:H="public",whitelistedDomains:G=null,blacklistedDomains:N=null,verbose:j=!1},q)=>{const Z=parseURL(q.url);let V=null;try{if(!g)throw new RemixImageError("selfUrl is required in RemixImage loader config!",500);let M;try{M=new URL(g)}catch(g){throw new RemixImageError("selfUrl is not a valid URL!")}const q=G?new Set([...G,M.host]):null,Q=N?new Set(N):null;if(J=Z.searchParams,K="src",V=J.has(K)?decodeURIComponent(J.get(K)):null,!V)throw new RemixImageError("An image URL must be provided!",400);try{V=decodeURI(V)}catch(g){throw new RemixImageError("An invalid image URL was provided!",400)}const tt=(g=>{const m=Gr.parse(g,{arrayFormat:"bracket",parseNumbers:!0,parseBooleans:!0,sort:!1});return Object.prototype.hasOwnProperty.call(m,"crop")&&null!=m.crop&&(m.crop=JSON.parse(m.crop)),m})(Z.search),et={fit:"cover",position:"center",background:[0,0,0,0],quality:80,compressionLevel:9,loop:0,delay:100,blurRadius:null,rotate:null,flip:null,crop:null,...P,...tt},vt=parseURL(V,g);if(!et.width)throw new RemixImageError("A width is required!",400);if(et.width&&et.width>8e3)throw new RemixImageError("Requested Image too large!",406);if(et.height&&et.height>8e3)throw new RemixImageError("Requested Image too large!",406);const yt=Z.search;let kt,xt,Et,zt=!0,It=!0,Ut=et.contentType;if(m&&await m.has(yt)){const g=await m.get(yt);g&&(j&&console.log(`Retrieved image [${yt}] from cache.`),zt=!1,It=!1,kt=g,Et=(g=>{if(!g||g.byteLength<3)throw new Error("Buffer is not a valid image!");for(const m of Dr){let y=Or[m];for(let k=m;k<=12;k+=1){const m=g[k];if("object"!=typeof y)return y;if(!Object.prototype.hasOwnProperty.call(y,m))break;y=y[m]}}throw new Error("Buffer is not a supported image type!")})(kt))}if(!kt){if(q&&!q.has(vt.host))throw new RemixImageError("The requested image host is not included on the whitelist!");if(Q&&Q.has(vt.host))throw new RemixImageError("The requested image host is not allowed!");const g=await y(V,vt.toString(),et,H);j&&console.log(`Fetched image [${yt}] directly using resolver: ${y.name}.`),zt=!0,It=!0,kt=g.buffer,Et=g.contentType}if(!kt||!Et)throw new RemixImageError("Failed to transform requested image!",500);if(Ut||(Ut=Et),!It||O?.has(Et))xt=kt;else if(null!=k){let g=k;if(!k.supportedInputs.has(Et)){if(!U||k===B||!B.supportedInputs.has(Et))throw new UnsupportedImageError(`Transformer does not allow this input content type: ${Et}!`);console.error(`Transformer does not allow this input content type: ${Et}! Falling back to transformer: ${B.name}`),g=B}g.supportedOutputs.has(Ut)||(z&&null!=I&&g.supportedOutputs.has(I)?(console.error(`Transformer does not allow this output content type: ${Ut}! Falling back to mime type: ${I}`),Ut=I):(console.error(`Transformer does not allow this output content type: ${Ut}! Falling back to mime type: ${g.fallbackOutput}`),Ut=g.fallbackOutput)),xt=await g.transform({url:vt.toString(),data:kt,contentType:Et},{...et,contentType:Ut}),j&&console.log(`Successfully transformed image using transformer: ${g.name}`)}if(!xt)throw new RemixImageError("Failed to transform requested image!",500);return zt&&m&&await m.set(yt,xt),$=xt,W=200,X=Ut,Y=m?`private, max-age=${m.config.ttl}, max-stale=${m.config.tbd}`:"public, max-age=31536000",new Response($,{status:W,headers:{"Content-Type":X,"Cache-Control":Y}})}catch(g){if("undefined"!=typeof process&&"test"===process?.env?.NODE_ENV)throw g;return console.error("RemixImage loader error:",g?.message),console.error(g),M&&V?new Response(null,{status:302,headers:{Location:V}}):g instanceof RemixImageError?textResponse(g.errorCode||500,g.message):textResponse(500,"RemixImage encountered an unknown error!")}var $,W,X,Y,J,K},exports.kB=g=>1e3*g,exports.mB=mB,exports.pureTransformer=Mr,exports.version="1.4.0";
//# sourceMappingURL=pure.js.map
