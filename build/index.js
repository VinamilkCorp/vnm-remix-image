"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime");function _interopNamespaceDefault(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(o){if("default"!==o){var n=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,n.get?n:{enumerable:!0,get:function(){return e[o]}})}})),t.default=e,Object.freeze(t)}var t=_interopNamespaceDefault(require("react")),o={},strictUriEncode=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)),n="%[a-f0-9]{2}",a=new RegExp("("+n+")|([^%]+?)","gi"),i=new RegExp("("+n+")+","gi");function decodeComponents(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var o=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],decodeComponents(o),decodeComponents(n))}function decode(e){try{return decodeURIComponent(e)}catch(n){for(var t=e.match(a)||[],o=1;o<t.length;o++)t=(e=decodeComponents(t,o).join("")).match(a)||[];return e}}var decodeUriComponent=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function customDecodeURIComponent(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},o=i.exec(e);o;){try{t[o[0]]=decodeURIComponent(o[0])}catch(e){var n=decode(o[0]);n!==o[0]&&(t[o[0]]=n)}o=i.exec(e)}t["%C2"]="�";for(var a=Object.keys(t),s=0;s<a.length;s++){var c=a[s];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}},splitOnFirst=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const o=e.indexOf(t);return-1===o?[e]:[e.slice(0,o),e.slice(o+t.length)]},filterObj=function(e,t){for(var o={},n=Object.keys(e),a=Array.isArray(t),i=0;i<n.length;i++){var s=n[i],c=e[s];(a?-1!==t.indexOf(s):t(s,c,e))&&(o[s]=c)}return o};!function(e){const t=strictUriEncode,o=decodeUriComponent,n=splitOnFirst,a=filterObj,i=Symbol("encodeFragmentIdentifier");function validateArrayFormatSeparator(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(e,o){return o.encode?o.strict?t(e):encodeURIComponent(e):e}function decode(e,t){return t.decode?o(e):e}function keysSorter(e){return Array.isArray(e)?e.sort():"object"==typeof e?keysSorter(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function removeHash(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function extract(e){const t=(e=removeHash(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function parseValue(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function parse(e,t){validateArrayFormatSeparator((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const o=function parserForArrayFormat(e){let t;switch(e.arrayFormat){case"index":return(e,o,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=o):n[e]=o};case"bracket":return(e,o,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],o):n[e]=[o]:n[e]=o};case"colon-list-separator":return(e,o,n)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],o):n[e]=[o]:n[e]=o};case"comma":case"separator":return(t,o,n)=>{const a="string"==typeof o&&o.includes(e.arrayFormatSeparator),i="string"==typeof o&&!a&&decode(o,e).includes(e.arrayFormatSeparator);o=i?decode(o,e):o;const s=a||i?o.split(e.arrayFormatSeparator).map((t=>decode(t,e))):null===o?o:decode(o,e);n[t]=s};case"bracket-separator":return(t,o,n)=>{const a=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!a)return void(n[t]=o?decode(o,e):o);const i=null===o?[]:o.split(e.arrayFormatSeparator).map((t=>decode(t,e)));void 0!==n[t]?n[t]=[].concat(n[t],i):n[t]=i};default:return(e,t,o)=>{void 0!==o[e]?o[e]=[].concat(o[e],t):o[e]=t}}}(t),a=Object.create(null);if("string"!=typeof e)return a;if(!(e=e.trim().replace(/^[?#&]/,"")))return a;for(const i of e.split("&")){if(""===i)continue;let[e,s]=n(t.decode?i.replace(/\+/g," "):i,"=");s=void 0===s?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?s:decode(s,t),o(decode(e,t),s,a)}for(const e of Object.keys(a)){const o=a[e];if("object"==typeof o&&null!==o)for(const e of Object.keys(o))o[e]=parseValue(o[e],t);else a[e]=parseValue(o,t)}return!1===t.sort?a:(!0===t.sort?Object.keys(a).sort():Object.keys(a).sort(t.sort)).reduce(((e,t)=>{const o=a[t];return Boolean(o)&&"object"==typeof o&&!Array.isArray(o)?e[t]=keysSorter(o):e[t]=o,e}),Object.create(null))}e.extract=extract,e.parse=parse,e.stringify=(e,t)=>{if(!e)return"";validateArrayFormatSeparator((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const shouldFilter=o=>t.skipNull&&null==e[o]||t.skipEmptyString&&""===e[o],o=function encoderForArrayFormat(e){switch(e.arrayFormat){case"index":return t=>(o,n)=>{const a=o.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?o:null===n?[...o,[encode(t,e),"[",a,"]"].join("")]:[...o,[encode(t,e),"[",encode(a,e),"]=",encode(n,e)].join("")]};case"bracket":return t=>(o,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?o:null===n?[...o,[encode(t,e),"[]"].join("")]:[...o,[encode(t,e),"[]=",encode(n,e)].join("")];case"colon-list-separator":return t=>(o,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?o:null===n?[...o,[encode(t,e),":list="].join("")]:[...o,[encode(t,e),":list=",encode(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return o=>(n,a)=>void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?n:(a=null===a?"":a,0===n.length?[[encode(o,e),t,encode(a,e)].join("")]:[[n,encode(a,e)].join(e.arrayFormatSeparator)])}default:return t=>(o,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?o:null===n?[...o,encode(t,e)]:[...o,[encode(t,e),"=",encode(n,e)].join("")]}}(t),n={};for(const t of Object.keys(e))shouldFilter(t)||(n[t]=e[t]);const a=Object.keys(n);return!1!==t.sort&&a.sort(t.sort),a.map((n=>{const a=e[n];return void 0===a?"":null===a?encode(n,t):Array.isArray(a)?0===a.length&&"bracket-separator"===t.arrayFormat?encode(n,t)+"[]":a.reduce(o(n),[]).join("&"):encode(n,t)+"="+encode(a,t)})).filter((e=>e.length>0)).join("&")},e.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[o,a]=n(e,"#");return Object.assign({url:o.split("?")[0]||"",query:parse(extract(e),t)},t&&t.parseFragmentIdentifier&&a?{fragmentIdentifier:decode(a,t)}:{})},e.stringifyUrl=(t,o)=>{o=Object.assign({encode:!0,strict:!0,[i]:!0},o);const n=removeHash(t.url).split("?")[0]||"",a=e.extract(t.url),s=e.parse(a,{sort:!1}),c=Object.assign(s,t.query);let l=e.stringify(c,o);l&&(l=`?${l}`);let d=function getHash(e){let t="";const o=e.indexOf("#");return-1!==o&&(t=e.slice(o)),t}(t.url);return t.fragmentIdentifier&&(d=`#${o[i]?encode(t.fragmentIdentifier,o):t.fragmentIdentifier}`),`${n}${l}${d}`},e.pick=(t,o,n)=>{n=Object.assign({parseFragmentIdentifier:!0,[i]:!1},n);const{url:s,query:c,fragmentIdentifier:l}=e.parseUrl(t,n);return e.stringifyUrl({url:s,query:a(c,o),fragmentIdentifier:l},n)},e.exclude=(t,o,n)=>{const a=Array.isArray(o)?e=>!o.includes(e):(e,t)=>!o(e,t);return e.pick(t,a,n)}}(o);class RemixImageError extends Error{errorCode;constructor(e,t){super(e),Object.setPrototypeOf(this,RemixImageError.prototype),this.errorCode=t||500}toString(){return this.message}}class UnsupportedImageError extends RemixImageError{constructor(e){super(e,415),Object.setPrototypeOf(this,UnsupportedImageError.prototype)}}const remixImageLoader=(e,t,n)=>((e,t)=>{const n=t;return Object.prototype.hasOwnProperty.call(t,"crop")&&(n.crop=JSON.stringify(n.crop)),o.stringifyUrl({url:e,query:n},{skipNull:!0,arrayFormat:"bracket",sort:!1})})(t,{src:encodeURI(e),...n}),sizeComparator=(e,t)=>(e.maxWidth||1/0)-(t.maxWidth||1/0),sizeConverter=e=>e.maxWidth?`(max-width: ${e.maxWidth}px) ${e.size.width}px`:`${e.size.width}px`;function useResponsiveImage(e,o,n={},a=[1],i="/api/image",s=remixImageLoader){return t.useMemo((()=>{let t=e.src||"",c=0;const l=[],d=Array.from(new Set([1,..."number"==typeof a?[a]:a])).sort();for(const a of d)for(const{size:d}of o){const o=s(e.src||"",i,{width:"number"==typeof d.width?d.width*a:d.width,height:"number"==typeof d.height?d.height*a:d.height,fit:"cover",position:"center",background:[0,0,0,0],quality:80,compressionLevel:9,loop:0,delay:100,blurRadius:null,rotate:null,flip:null,crop:null,...n});l.push(o+` ${d.width*a}w`),1===a&&d.width>c&&(c=d.width,t=o)}const p=[...o].sort(sizeComparator).map(sizeConverter);return 1===o.length&&null!=o[0].maxWidth&&p.push(`${o[0].size.width}px`),{...l.length>0&&{srcSet:l.join(", "),sizes:p.join(", ")},src:t}}),[e.src,i,s,o,n,a])}const s=t.forwardRef((({loaderUrl:t="/api/image",loader:o=remixImageLoader,responsive:n=[],options:a={},dprVariants:i=1,decoding:s="async",loading:c="lazy",...l},d)=>{const p=useResponsiveImage(l,n,a,i,t,o);return e.jsx("img",{ref:d,decoding:s,loading:c,...l,...p})}));function r(e){var t,o,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(o=r(e[t]))&&(n&&(n+=" "),n+=o);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function clsx(){for(var e,t,o=0,n="";o<arguments.length;)(e=arguments[o++])&&(t=r(e))&&(n&&(n+=" "),n+=t);return n}function handleLoading(e,t,o){if(e.style.animationDuration="0.125s",e.classList.remove("blur"),!e||e["data-loaded-src"]===t)return;e["data-loaded-src"]=t;("decode"in e?e.decode():Promise.resolve()).catch((()=>{})).then((()=>{if(e.parentNode&&(e.style.animationDuration="0.125s",e.classList.remove("blur"),o)){const{naturalWidth:t,naturalHeight:n}=e;o({naturalWidth:t,naturalHeight:n})}}))}s.displayName="BaseImage";const c=t.memo(t.forwardRef((({src:o,loaderUrl:n="/api/image",loader:a=remixImageLoader,responsive:i=[],options:s={},dprVariants:c=1,decoding:l="async",loading:d="lazy",unoptimized:p=!1,placeholder:u="empty",blurDataURL:m=(p||"blur"!==u?null:a(o||"",n,{width:15,height:15,fit:s?.fit||"cover",position:s?.position||"center",contentType:s.contentType})),placeholderAspectRatio:f=null,onLoadingComplete:g,className:y,style:h={},onLoad:b,...x},v)=>{const j=useResponsiveImage({src:o},i,s,c,n,a),I=t.useMemo((()=>{if(p)return h;const e=function computePlaceholderSize(e=[],t){let o=t||1,n=0;for(let a=0;a<e.length;a+=1){const i=e[a].size||{};i.width&&(i.width>n&&(n=i.width),!t&&i.height&&(o=i.height/i.width))}return{width:n,height:Math.round(n*o)}}(i,f);return{minWidth:e.width,minHeight:e.height,backgroundSize:s?.fit||"cover",backgroundPosition:s?.position||"center",...m&&{backgroundImage:`url("${m}")`},...h}}),[p,i,f,h,s?.fit,s?.position,m]);return e.jsx("img",{ref:t.useCallback((e=>{null!=e&&(p||("blur"===u&&e.classList.add("blur"),e?.complete&&handleLoading(e,o,g)),v&&("function"==typeof v?v(e):v.current=e))}),[p,v,o,u,g]),decoding:l,loading:d,style:I,className:clsx(!p&&"remix-image",!p&&"blur"===u&&"blur-in",y),...x,...j,onLoad:e=>{if(!p){const t=e.currentTarget;console.log(t,o),handleLoading(t,o,g)}b&&b(e)}})})));var l,d;c.displayName="Image",exports.CacheStatus=void 0,(l=exports.CacheStatus||(exports.CacheStatus={})).HIT="hit",l.STALE="stale",l.MISS="miss";exports.MimeType=void 0,(d=exports.MimeType||(exports.MimeType={})).SVG="image/svg+xml",d.JPEG="image/jpeg",d.PNG="image/png",d.GIF="image/gif",d.WEBP="image/webp",d.BMP="image/bmp",d.TIFF="image/tiff",d.AVIF="image/avif";exports.BaseImage=s,exports.Cache=class Cache{},exports.Image=c,exports.RemixImageError=RemixImageError,exports.UnsupportedImageError=UnsupportedImageError,exports.default=c,exports.remixImageLoader=remixImageLoader,exports.useResponsiveImage=useResponsiveImage,exports.version="1.4.0";
//# sourceMappingURL=index.js.map
